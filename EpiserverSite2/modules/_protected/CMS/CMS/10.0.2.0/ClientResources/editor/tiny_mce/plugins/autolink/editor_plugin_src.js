(function(){tinymce.create("tinymce.plugins.AutolinkPlugin",{init:function(e){var t=this;e.onKeyDown.addToTop(function(e,n){return 13==n.keyCode?t.handleEnter(e):void 0}),tinyMCE.isIE||(e.onKeyPress.add(function(e,n){return 41==n.which?t.handleEclipse(e):void 0}),e.onKeyUp.add(function(e,n){return 32==n.keyCode?t.handleSpacebar(e):void 0}))},handleEclipse:function(e){this.parseCurrentLine(e,-1,"(",!0)},handleSpacebar:function(e){this.parseCurrentLine(e,0,"",!0)},handleEnter:function(e){this.parseCurrentLine(e,-1,"",!1)},parseCurrentLine:function(e,t,n){var i,o,a,r,s,l,u,d,c;if(i=e.selection.getRng(!0).cloneRange(),5>i.startOffset){if(d=i.endContainer.previousSibling,null==d){if(null==i.endContainer.firstChild||null==i.endContainer.firstChild.nextSibling)return;d=i.endContainer.firstChild.nextSibling}if(c=d.length,i.setStart(d,c),i.setEnd(d,c),5>i.endOffset)return;o=i.endOffset,r=d}else{if(r=i.endContainer,3!=r.nodeType&&r.firstChild){for(;3!=r.nodeType&&r.firstChild;)r=r.firstChild;3==r.nodeType&&(i.setStart(r,0),i.setEnd(r,r.nodeValue.length))}o=1==i.endOffset?2:i.endOffset-1-t}a=o;do i.setStart(r,o>=2?o-2:0),i.setEnd(r,o>=1?o-1:0),o-=1;while(" "!=""+i&&""!=""+i&&160!=(""+i).charCodeAt(0)&&o-2>=0&&""+i!=n);""+i==n||160==(""+i).charCodeAt(0)?(i.setStart(r,o),i.setEnd(r,a),o+=1):0==i.startOffset?(i.setStart(r,0),i.setEnd(r,a)):(i.setStart(r,o),i.setEnd(r,a));var l=""+i;if("."==l.charAt(l.length-1)&&i.setEnd(r,a-1),l=""+i,u=l.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+-]+@)(.+)$/i),u&&("www."==u[1]?u[1]="http://www.":/@$/.test(u[1])&&!/^mailto:/.test(u[1])&&(u[1]="mailto:"+u[1]),s=e.selection.getBookmark(),e.selection.setRng(i),tinyMCE.execCommand("createlink",!1,u[1]+u[2]),e.selection.moveToBookmark(s),e.nodeChanged(),tinyMCE.isWebKit)){e.selection.collapse(!1);var p=Math.min(r.length,a+1);i.setStart(r,p),i.setEnd(r,p),e.selection.setRng(i)}},getInfo:function(){return{longname:"Autolink",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("autolink",tinymce.plugins.AutolinkPlugin)})();