(function(e,t){e.create("tinymce.plugins.epicontentfragment",{init:function(t,n){var i=this;if("undefined"==typeof epiContentBlockUtilities){var o=e.baseURI.toAbsolute("plugins/epipersonalizedcontent/epicontentblockutilities.js");e.ScriptLoader.load(o,function(){this._init(t,n)},this),e.ScriptLoader.loadQueue()}else this._init(t,n);t.onPreInit.addToTop(function(){var n=e.trim(t.getParam("noneditable_noneditable_class","mceNonEditable"));t.parser.addAttributeFilter("class",function(e){for(var t=e.length;t--;)i._convertContentFragmentToNonEditable(e[t],n)})}),t.onInit.add(function(){i._onInitCalled=!0})},_init:function(e){t.extend(this,epiContentBlockUtilities);var n=this;n.ed=e,n._contentFragmentClass=e.getParam("epicontentfragment_cssclass","epi-contentfragment"),n._enabledControls=e.getParam("epicontentfragment_enabledcontrols",""),n._controlsDisabled=!1;var i=function(e){e.onNodeChange.add(function(e){setTimeout(function(){!e.destroyed&&e.dom.hasClass(e.selection.getNode(),n._contentFragmentClass)&&(n._setDisabled(!0,n._enabledControls),n._controlsDisabled=!0)},0)}),e.onNodeChange.addToTop(function(e,t,i){n._controlsDisabled&&!e.dom.hasClass(i,n._contentFragmentClass)&&(n._setDisabled(!1,n._enabledControls),n._controlsDisabled=!1)}),e.onBeforeExecCommand.add(function(e,t,i,o,a){"mceInsertContent"===t&&n._isSelectionContainsCF()&&(a.terminate=!0)})};n._onInitCalled?i(e):e.onInit.add(i)},_isSelectionContainsCF:function(){return this.ed.dom.hasClass(this.ed.selection.getNode(),this._contentFragmentClass)},_convertContentFragmentToNonEditable:function(e,t){var n=e.attr("class")+" ";-1===n.indexOf("epi-contentfragment")||n.indexOf(t)>=0||(e.attr("contenteditable",null),e.attr("class",n+t))},getInfo:function(){return{longname:"Content Fragment",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:"1.0"}}}),e.PluginManager.add("epicontentfragment",e.plugins.epicontentfragment)})(tinymce,epiJQuery);