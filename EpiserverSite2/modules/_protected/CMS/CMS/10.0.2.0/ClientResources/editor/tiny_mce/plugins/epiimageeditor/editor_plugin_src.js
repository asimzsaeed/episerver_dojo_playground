(function(e,t){var n;e.create("tinymce.plugins.epiimageeditor",{init:function(e){e.addCommand("mceEPiImageEditor",function(){if(-1==e.dom.getAttrib(e.selection.getNode(),"class").indexOf("mceItem")){var i,o=n,a=e.dom.getAttrib(o,"src");if(a){var r=function(t){if(t){var n='img[src^="'+a+'"]',o=e.dom.select(n);e.getWin().focus(),i&&(e.dom.setAttrib(o,"width",t.actualWidth),e.dom.setAttrib(o,"height",t.actualHeight)),e.dom.setAttrib(o,"src",t.src),e.undoManager.add()}e.windowManager.onClose.dispatch()},s={width:e.getParam("epiImageEditor_dialogWidth"),height:e.getParam("epiImageEditor_dialogHeight")},l={};l.src=a,i=e.dom.getAttrib(o,"width"),e.settings.epi_page_context.src=a;var c=EPi.ResolveUrlFromUI("Edit/ImageEditor/ImageEditor.aspx?")+t.param(e.settings.epi_page_context);e.windowManager.onOpen.dispatch(),e.windowManager.open({url:c,width:s.width,height:s.height,onCallback:r,dialogArguments:l})}}}),e.addButton("epiimageeditor",{title:"epiimageeditor.epiimageeditor_desc",cmd:"mceEPiImageEditor","class":"mce_epiimageeditor"}),e.onNodeChange.add(function(e,t,i){var o="IMG"===i.nodeName&&-1===e.dom.getAttrib(i,"class").indexOf("mceItem");t.setActive("epiimageeditor",o),t.setDisabled("epiimageeditor",!o),n=o?i:null})},createControl:function(){return null},getInfo:function(){return{longname:"EPiServer CMS Image Editor Plug-in",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:"1.0"}}}),e.PluginManager.add("epiimageeditor",e.plugins.epiimageeditor)})(tinymce,epiJQuery);