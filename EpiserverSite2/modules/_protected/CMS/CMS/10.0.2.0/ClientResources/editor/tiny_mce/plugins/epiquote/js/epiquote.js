tinyMCEPopup.requireLangPack();var epiquote={init:function(){var e,t,n,i="disabled",o="checked",a=this,r=document.forms[0],s=tinyMCEPopup.editor,l=s.selection;if(t=s.dom.getParent(l.getNode(),"q"),tinyMCEPopup.resizeToInnerSize(),null==t&&(t=s.dom.getParent(l.getNode(),"blockquote")),null!=t){for(a._bookmark=l.getBookmark(),e=0;r.quoteType.length>e;e++)r.quoteType[e].setAttribute(i,i);n="BLOCKQUOTE"==t.nodeName?r.blockquote:r.quote,n.removeAttribute(i),n.setAttribute(o,o),r.title.value=t.title,r.cite.value=t.cite,r.insert.value=s.getLang("update"),r.remove.style.display="",document.title=document.getElementById("general_tab_title").innerHTML=s.getLang("epiquote_dlg.titleupdate")}epiquote._inlineQuoteEnabled()||r.quote.setAttribute(i,i)},insert:function(){var e,t,n,i,o,a,r,s,l=document.forms[0],d=tinyMCEPopup.editor,c=this,u={},m="q";tinyMCEPopup.restoreSelection();var p=d.selection;for(c._bookmark&&p.moveToBookmark(c._bookmark),t=0;l.quoteType.length>t;t++)l.quoteType[t].checked&&(n=l.quoteType[t].value);if(epiquote._trimSelection(p),l.title.value.length&&(u.title=l.title.value),l.cite.value.length&&(u.cite=l.cite.value),n===m){var g=p.getNode();e=d.dom.getParent(g,n),o=d.dom.getParent(g,d.dom.isBlock,d.getBody()),a=p.getContent().toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,""),r=d.dom.getOuterHTML(o).toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,""),s=a===r}if(null==e){if(n===m&&!epiquote._inlineQuoteEnabled())return alert(d.getLang("epiquote_dlg.invalidselectionforq")),!1;i=s?o.innerHTML:p.getContent();var h=p.getNode();null!=h&&"BLOCKQUOTE"==h.nodeName?d.dom.setAttribs(h,u):(i=d.dom.createHTML(n,u,i),s&&(i=d.dom.createHTML("p",{},i)),tinymce.isGecko?d.execCommand("insertHTML",!1,i):tinymce.isIE&&"Control"===d.selection.getSel().type?d.dom.setOuterHTML(d.selection.getSel().createRange().item(0),i):d.execCommand("mceInsertContent",!1,i))}else d.dom.setAttribs(e,u);d.undoManager.add(),tinyMCEPopup.close()},remove:function(){var e,t,n,i=tinyMCEPopup.editor,o=document.forms[0].quoteType;for(n=0;o.length>n;n++)o[n].checked&&(t=o[n].value);t&&(e=i.dom.getParent(i.selection.getNode(),t),tinyMCEPopup.execCommand("mceRemoveNode",i,e)),tinyMCEPopup.close()},_inlineQuoteEnabled:function(){var e=tinyMCEPopup.editor,t=e.selection,n=t.getNode();if(e.dom.getOuterHTML(n)===t.getContent()&&e.dom.isBlock(n))return!1;switch(n.nodeName){case"BODY":case"TD":case"TH":case"UL":case"OL":case"BLOCKQUOTE":return!1}return!0},_trimSelection:function(e){var t,n,i,o,a=e.getRng();tinyMCEPopup.editor,a.toString?t=""+a:a.text&&(t=a.text),t&&t.length&&t.length!=tinymce.trim(t).length&&(n=t.length,i=n-t.replace(/^\s+/,"").length,o=n-t.search(/\s+$/),a.toString||a.text&&(a.moveStart("character",i),a.moveEnd("character",-o)),e.setRng(a))}};tinyMCEPopup.onInit.add(epiquote.init,epiquote);