(function(){var e=tinymce.DOM,t=tinymce.dom.Element,n=tinymce.dom.Event,i=tinymce.each,o=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(t,n){t.onBeforeRenderUI.add(function(){t.windowManager=new tinymce.InlineWindowManager(t),e.loadCSS(n+"/skins/"+(t.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(e){var t=this;t.parent(e),t.zIndex=3e5,t.count=0,t.windows={}},open:function(i,o){var a,r,s,l,c,d,u,m=this,g="",p=m.editor,h=0,f=0;return i=i||{},o=o||{},i.inline?(u=m._frontWindow(),u&&e.get(u.id+"_ifr")&&(u.focussedElement=e.get(u.id+"_ifr").contentWindow.document.activeElement),i.type||(m.bookmark=p.selection.getBookmark(1)),a=e.uniqueId("mce_inlinepopups_"),r=e.getViewPort(),i.width=parseInt(i.width||320),i.height=parseInt(i.height||240)+(tinymce.isIE?8:0),i.min_width=parseInt(i.min_width||150),i.min_height=parseInt(i.min_height||100),i.max_width=parseInt(i.max_width||2e3),i.max_height=parseInt(i.max_height||2e3),i.left=i.left||Math.round(Math.max(r.x,r.x+r.w/2-i.width/2)),i.top=i.top||Math.round(Math.max(r.y,r.y+r.h/2-i.height/2)),i.movable=i.resizable=!0,o.mce_width=i.width,o.mce_height=i.height,o.mce_inline=!0,o.mce_window_id=a,o.mce_auto_focus=i.auto_focus,m.features=i,m.params=o,m.onOpen.dispatch(m,i,o),i.type&&(g+=" mceModal",i.type&&(g+=" mce"+i.type.substring(0,1).toUpperCase()+i.type.substring(1)),i.resizable=!1),i.statusbar&&(g+=" mceStatusbar"),i.resizable&&(g+=" mceResizable"),i.minimizable&&(g+=" mceMinimizable"),i.maximizable&&(g+=" mceMaximizable"),i.movable&&(g+=" mceMovable"),m._addAll(e.doc.body,["div",{id:a,role:"dialog","aria-labelledby":i.type?a+"_content":a+"_title","class":(p.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:a+"_wrapper","class":"mceWrapper"+g},["div",{id:a+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:a+"_title"},i.title||""]],["div",{id:a+"_middle","class":"mceMiddle"},["div",{id:a+"_left","class":"mceLeft",tabindex:"0"}],["span",{id:a+"_content"}],["div",{id:a+"_right","class":"mceRight",tabindex:"0"}]],["div",{id:a+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:a+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:a+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]),e.setStyles(a,{top:-1e4,left:-1e4}),tinymce.isGecko&&e.setStyle(a,"overflow","auto"),i.type||(h+=e.get(a+"_left").clientWidth,h+=e.get(a+"_right").clientWidth,f+=e.get(a+"_top").clientHeight,f+=e.get(a+"_bottom").clientHeight),e.setStyles(a,{top:i.top,left:i.left,width:i.width+h,height:i.height+f}),d=i.url||i.file,d&&(tinymce.relaxedDomain&&(d+=(-1==d.indexOf("?")?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),d=tinymce._addVer(d)),i.type?(e.add(a+"_wrapper","a",{id:a+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),"confirm"==i.type&&e.add(a+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),e.add(a+"_middle","div",{"class":"mceIcon"}),e.setHTML(a+"_content",i.content.replace("\n","<br />")),n.add(a,"keyup",function(e){var t=27;return e.keyCode===t?(i.button_func(!1),n.cancel(e)):void 0}),n.add(a,"keydown",function(t){var i,o=9;return t.keyCode===o?(i=e.select("a.mceCancel",a+"_wrapper")[0],i&&i!==t.target?i.focus():e.get(a+"_ok").focus(),n.cancel(t)):void 0})):(e.add(a+"_content","iframe",{id:a+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),e.setStyles(a+"_ifr",{width:i.width,height:i.height}),e.setAttrib(a+"_ifr","src",d)),s=n.add(a,"mousedown",function(t){var i,o,r=t.target;if(i=m.windows[a],m.focus(a),"A"==r.nodeName||"a"==r.nodeName){if("mceClose"==r.className)return m.close(null,a),n.cancel(t);if("mceMax"==r.className)i.oldPos=i.element.getXY(),i.oldSize=i.element.getSize(),o=e.getViewPort(),o.w-=2,o.h-=2,i.element.moveTo(o.x,o.y),i.element.resizeTo(o.w,o.h),e.setStyles(a+"_ifr",{width:o.w-i.deltaWidth,height:o.h-i.deltaHeight}),e.addClass(a+"_wrapper","mceMaximized");else if("mceMed"==r.className)i.element.moveTo(i.oldPos.x,i.oldPos.y),i.element.resizeTo(i.oldSize.w,i.oldSize.h),i.iframeElement.resizeTo(i.oldSize.w-i.deltaWidth,i.oldSize.h-i.deltaHeight),e.removeClass(a+"_wrapper","mceMaximized");else{if("mceMove"==r.className)return m._startDrag(a,t,r.className);if(e.hasClass(r,"mceResize"))return m._startDrag(a,t,r.className.substring(13))}}}),l=n.add(a,"click",function(e){var t=e.target;if(m.focus(a),"A"==t.nodeName||"a"==t.nodeName)switch(t.className){case"mceClose":return m.close(null,a),n.cancel(e);case"mceButton mceOk":case"mceButton mceCancel":return i.button_func("mceButton mceOk"==t.className),n.cancel(e)}}),n.add([a+"_left",a+"_right"],"focus",function(t){var n=e.get(a+"_ifr");if(n){var i=n.contentWindow.document.body,o=e.select(":input:enabled,*[tabindex=0]",i);t.target.id===a+"_left"?o[o.length-1].focus():o[0].focus()}else e.get(a+"_ok").focus()}),c=m.windows[a]={id:a,mousedown_func:s,click_func:l,element:new t(a,{blocker:1,container:p.getContainer()}),iframeElement:new t(a+"_ifr"),features:i,deltaWidth:h,deltaHeight:f},c.iframeElement.on("focus",function(){m.focus(a)}),0==m.count&&"modal"==m.editor.getParam("dialog_type","modal")?(e.add(e.doc.body,"div",{id:"mceModalBlocker","class":(m.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:m.zIndex-1}}),e.show("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","true")):e.setStyle("mceModalBlocker","z-index",m.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceModalBlocker",{position:"absolute",left:r.x,top:r.y,width:r.w-2,height:r.h-2}),e.setAttrib(a,"aria-hidden","false"),m.focus(a),m._fixIELayout(a,1),e.get(a+"_ok")&&e.get(a+"_ok").focus(),m.count++,c):m.parent(i,o)},focus:function(t){var n,i=this;(n=i.windows[t])&&(n.zIndex=this.zIndex++,n.element.setStyle("zIndex",n.zIndex),n.element.update(),t+="_wrapper",e.removeClass(i.lastId,"mceFocus"),e.addClass(t,"mceFocus"),i.lastId=t,n.focussedElement?n.focussedElement.focus():e.get(t+"_ok")?e.get(n.id+"_ok").focus():e.get(n.id+"_ifr")&&e.get(n.id+"_ifr").focus())},_addAll:function(e,t){var n,i=this,a=tinymce.DOM;if(o(t,"string"))e.appendChild(a.doc.createTextNode(t));else if(t.length)for(e=e.appendChild(a.create(t[0],t[1])),n=2;t.length>n;n++)i._addAll(e,t[n])},_startDrag:function(i,o,a){function r(){c||(E._fixIELayout(i,0),e.add(k.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(E.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:E.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceEventBlocker",{position:"absolute",left:p.x,top:p.y,width:p.w-2,height:p.h-2}),c=new t("mceEventBlocker"),c.update(),d=M.getXY(),u=M.getSize(),h=g.x+d.x-p.x,f=g.y+d.y-p.y,e.add(c.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:h,top:f,width:u.w,height:u.h}}),m=new t("mcePlaceHolder"))}var s,l,c,d,u,m,g,p,h,f,v,y,_,w,b,C,E=this,k=e.doc,P=E.windows[i],M=P.element;return M.getXY(),g={x:0,y:0},p=e.getViewPort(),p.w-=2,p.h-=2,v=o.screenX,y=o.screenY,_=w=b=C=0,s=n.add(k,"mouseup",function(t){return n.remove(k,"mouseup",s),n.remove(k,"mousemove",l),c&&c.remove(),M.moveBy(_,w),M.resizeBy(b,C),u=M.getSize(),e.setStyles(i+"_ifr",{width:u.w-P.deltaWidth,height:u.h-P.deltaHeight}),E._fixIELayout(i,1),n.cancel(t)}),"Move"!=a&&r(),l=n.add(k,"mousemove",function(e){var t,i,o;switch(r(),t=e.screenX-v,i=e.screenY-y,a){case"ResizeW":_=t,b=0-t;break;case"ResizeE":b=t;break;case"ResizeN":case"ResizeNW":case"ResizeNE":"ResizeNW"==a?(_=t,b=0-t):"ResizeNE"==a&&(b=t),w=i,C=0-i;break;case"ResizeS":case"ResizeSW":case"ResizeSE":"ResizeSW"==a?(_=t,b=0-t):"ResizeSE"==a&&(b=t),C=i;break;case"mceMove":_=t,w=i}return(o=P.features.min_width-u.w)>b&&(0!==_&&(_+=b-o),b=o),(o=P.features.min_height-u.h)>C&&(0!==w&&(w+=C-o),C=o),b=Math.min(b,P.features.max_width-u.w),C=Math.min(C,P.features.max_height-u.h),_=Math.max(_,p.x-(h+p.x)),w=Math.max(w,p.y-(f+p.y)),_=Math.min(_,p.w+p.x-(h+u.w+p.x)),w=Math.min(w,p.h+p.y-(f+u.h+p.y)),0!==_+w&&(0>h+_&&(_=0),0>f+w&&(w=0),m.moveTo(h+_,f+w)),0!==b+C&&m.resizeTo(u.w+b,u.h+C),n.cancel(e)}),n.cancel(o)},resizeBy:function(e,t,n){var i=this.windows[n];i&&(i.element.resizeBy(e,t),i.iframeElement.resizeBy(e,t))},close:function(t,i){var o,a,i,r=this,s=e.doc;return i=r._findId(i||t),r.windows[i]?(r.count--,0==r.count&&(e.remove("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","false"),r.editor.focus()),(o=r.windows[i])&&(r.onClose.dispatch(r),n.remove(s,"mousedown",o.mousedownFunc),n.remove(s,"click",o.clickFunc),n.clear(i),n.clear(i+"_ifr"),e.setAttrib(i+"_ifr","src",'javascript:""'),o.element.remove(),delete r.windows[i],a=r._frontWindow(),a&&r.focus(a.id)),void 0):(r.parent(t),void 0)},_frontWindow:function(){var e,t=0;return i(this.windows,function(n){n.zIndex>t&&(e=n,t=n.zIndex)}),e},setTitle:function(t,n){var i;t=this._findId(t),(i=e.get(t+"_title"))&&(i.innerHTML=e.encode(n))},alert:function(t,n){var i,o=this;i=o.open({title:o,type:"alert",button_func:function(e){n&&n.call(e||o,e),o.close(null,i.id)},content:e.encode(o.editor.getLang(t,t)),inline:1,width:400,height:130})},confirm:function(t,n){var i,o=this;i=o.open({title:o,type:"confirm",button_func:function(e){n&&n.call(e||o,e),o.close(null,i.id)},content:e.encode(o.editor.getLang(t,t)),inline:1,width:400,height:130})},_findId:function(t){var n=this;return"string"==typeof t?t:(i(n.windows,function(n){var i=e.get(n.id+"_ifr");return i&&t==i.contentWindow?(t=n.id,!1):void 0}),t)},_fixIELayout:function(t,n){var o,a;tinymce.isIE6&&(i(["n","s","w","e","nw","ne","sw","se"],function(i){var o=e.get(t+"_resize_"+i);e.setStyles(o,{width:n?o.clientWidth:"",height:n?o.clientHeight:"",cursor:e.getStyle(o,"cursor",1)}),e.setStyle(t+"_bottom","bottom","-1px"),o=0}),(o=this.windows[t])&&(o.element.hide(),o.element.show(),i(e.select("div,a",t),function(e){"none"!=e.currentStyle.backgroundImage&&(a=new Image,a.src=e.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),e.get(t).style.filter=""))}}),tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();