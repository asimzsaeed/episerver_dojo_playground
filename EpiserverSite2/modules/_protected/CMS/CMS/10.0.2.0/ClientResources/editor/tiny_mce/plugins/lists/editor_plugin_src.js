(function(){function e(e,t){for(;e&&(8===e.nodeType||3===e.nodeType&&/^[ \t\n\r]*$/.test(e.nodeValue));)e=t(e);return e}function t(t){return e(t,function(e){return e.previousSibling})}function n(t){return e(t,function(e){return e.nextSibling})}function i(e,t,n){return e.dom.getParent(t,function(e){return-1!==tinymce.inArray(n,e)})}function o(e){return e&&("OL"===e.tagName||"UL"===e.tagName)}function a(e,n){var i,a,r;for(i=t(e.lastChild);o(i);)a=i,i=t(a.previousSibling);return a&&(r=n.create("li",{style:"list-style-type: none;"}),n.split(e,a),n.insertAfter(r,a),r.appendChild(a),r.appendChild(a),e=r.previousSibling),e}function r(e,t,n){return e=s(e,t,n),l(e,t,n)}function s(e,n,i){var o=t(e.previousSibling);return o?d(o,e,n?o:!1,i):e}function l(e,t,i){var o=n(e.nextSibling);return o?d(e,o,t?o:!1,i):e}function d(e,t,n,i){return c(e,t,!!n,i)?g(e,t,n):(e&&"LI"===e.tagName&&o(t)&&e.appendChild(t),t)}function c(e,t,n,i){return e&&t?"LI"===e.tagName&&"LI"===t.tagName?"none"===t.style.listStyleType||m(t):o(e)?e.tagName===t.tagName&&(n||e.style.listStyleType===t.style.listStyleType)||u(t):i&&"P"===e.tagName&&"P"===t.tagName:!1}function u(e){var i=n(e.firstChild),a=t(e.lastChild);return i&&a&&o(e)&&i===a&&(o(i)||"none"===i.style.listStyleType||m(i))}function m(e){var i=n(e.firstChild),a=t(e.lastChild);return i&&a&&i===a&&o(i)}function g(e,i,o){var a=t(e.lastChild),r=n(i.firstChild);for("P"===e.tagName&&e.appendChild(e.ownerDocument.createElement("br"));i.firstChild;)e.appendChild(i.firstChild);return o&&(e.style.listStyleType=o.style.listStyleType),i.parentNode.removeChild(i),d(a,r,!1),e}function p(e,t){var n;return t.is(e,"li,ol,ul")||(n=t.getParent(e,"li"),n&&(e=n)),e}var f,h=tinymce.each,y=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(e){function t(t){return t.keyCode===tinymce.VK.TAB&&!(t.altKey||t.ctrlKey)&&(e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList"))}function n(){var e=r(),t=e.parentNode.parentNode,n=e.parentNode.lastChild===e;return n&&!i(t)&&s(e)}function i(e){return o(e)?e.parentNode&&"LI"===e.parentNode.tagName:"LI"===e.tagName}function a(){return e.selection.isCollapsed()&&s(r())}function r(){var t=e.selection.getStart();return"BR"!=t.tagName&&""!=t.tagName||"LI"!=t.parentNode.tagName?t:t.parentNode}function s(e){var t=e.childNodes.length;return"LI"===e.tagName?0==t?!0:1==t&&(""==e.firstChild.tagName||"BR"==e.firstChild.tagName||l(e)):!1}function l(e){var t=tinymce.grep(e.parentNode.childNodes,function(e){return"LI"==e.tagName}),n=e==t[t.length-1],i=e.firstChild;return tinymce.isIE9&&n&&(i.nodeValue==String.fromCharCode(160)||i.nodeValue==String.fromCharCode(32))}function d(e){return e.keyCode===tinymce.VK.ENTER}function c(e){return d(e)&&!e.shiftKey}function u(e){return t(e)?P:c(e)&&n()?M:c(e)&&a()?E:M}function m(e,t){(I==P||I==E||tinymce.isGecko&&I==x)&&y.cancel(t)}function g(){var t=e.selection.getRng(!0),n=t.startContainer;if(3==n.nodeType){var i=n.nodeValue;return tinymce.isIE9&&i.length>1&&32==i.charCodeAt(i.length-1)?t.endOffset==i.length-1:t.endOffset==i.length}return 1==n.nodeType?t.endOffset==n.childNodes.length:!1}function p(){var t=e.selection.getNode(),n="h1,h2,h3,h4,h5,h6,p,div",i=e.dom.is(t,n)&&"LI"===t.parentNode.tagName&&t.parentNode.lastChild===t;return e.selection.isCollapsed()&&i&&g()}function f(e,t){if(c(t)&&p()){var n=e.selection.getNode(),i=e.dom.create("li"),o=e.dom.getParent(n,"li");e.dom.insertAfter(i,o),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?e.selection.setCursorLocation(i,1):e.selection.setCursorLocation(i,0),t.preventDefault()}}function h(e,t){function n(e){var t=e.firstChild,n=null;do{if(!t)break;"LI"===t.tagName&&(n=t)}while(t=t.nextSibling);return n}function i(e,t){for(;e.childNodes.length>0;)t.appendChild(e.childNodes[0])}var o;if(tinymce.isGecko){var a=e.selection.getStart();if(t.keyCode==tinymce.VK.BACKSPACE&&"IMG"===a.tagName&&(o=a.parentNode.previousSibling)){var r;if("UL"===o.tagName||"OL"===o.tagName)r=o;else{if(!o.previousSibling||"UL"!==o.previousSibling.tagName&&"OL"!==o.previousSibling.tagName)return;r=o.previousSibling}var s=n(r),l=e.dom.createRng();l.setStart(s,1),l.setEnd(s,1),e.selection.setRng(l),e.selection.collapse(!0);var d=e.selection.getBookmark(),c=a.parentNode.cloneNode(!0);"P"===c.tagName||"DIV"===c.tagName?i(c,s):s.appendChild(c),a.parentNode.parentNode.removeChild(a.parentNode),e.selection.moveToBookmark(d)}}}function v(t){var n=e.dom.getParent(t,"ol,ul");if(null!=n){var i=n.lastChild;e.selection.setCursorLocation(i,0)}}function _(t,n){var i=e.getDoc().createTextNode("﻿");t.insertBefore(i,n),e.selection.setCursorLocation(i,0),e.execCommand("mceRepaint")}function b(e,t){if(d(t)){var n=r();if(n){var i=n.parentNode,o=i&&i.parentNode;o&&"LI"==o.nodeName&&o.firstChild==i&&n==i.firstChild&&_(o,i)}}}function C(e,t){if(d(t)){var n=r();if(1===e.dom.select("ul li",n).length){var i=n.firstChild;_(n,i)}}}function w(e,t){function n(t){for(var n=[],i=new tinymce.dom.TreeWalker(t.firstChild,t),o=i.current();o;o=i.next())e.dom.is(o,"ol,ul,li")&&n.push(o);return n}if(t.keyCode==tinymce.VK.BACKSPACE){var i=r();if(i){var o=e.dom.getParent(i,"ol,ul"),a=e.selection.getRng();if(o&&o.firstChild===i&&0==a.startOffset){var s=n(i);return s.unshift(i),e.execCommand("Outdent",!1,s),e.undoManager.add(),y.cancel(t)}}}}function k(e,t){var n=r();if(t.keyCode===tinymce.VK.BACKSPACE&&e.dom.is(n,"li")&&n.parentNode.firstChild!==n&&1===e.dom.select("ul,ol",n).length){var i=n.previousSibling;e.dom.remove(e.dom.select("br",n)),e.dom.remove(n,!0);var o=tinymce.grep(i.childNodes,function(e){return 3===e.nodeType});if(1===o.length){var a=o[0];e.selection.setCursorLocation(a,a.length)}return e.undoManager.add(),y.cancel(t)}}var P="TABBING",E="EMPTY",x="ESCAPE",M="UNKNOWN",I=M;this.ed=e,e.addCommand("Indent",this.indent,this),e.addCommand("Outdent",this.outdent,this),e.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),e.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),e.onInit.add(function(){e.editorCommands.addCommands({outdent:function(){function t(t){return t=i.getParent(t,i.isBlock),t&&parseInt(e.dom.getStyle(t,"margin-left")||0,10)+parseInt(e.dom.getStyle(t,"padding-left")||0,10)>0}var n=e.selection,i=e.dom;return t(n.getStart())||t(n.getEnd())||e.queryCommandState("InsertOrderedList")||e.queryCommandState("InsertUnorderedList")}},"state")}),e.onKeyUp.add(function(e,t){if(I==P)return e.execCommand(t.shiftKey?"Outdent":"Indent",!0,null),I=M,y.cancel(t);if(I==E){var n=r(),i=e.settings.list_outdent_on_enter===!0||t.shiftKey;return e.execCommand(i?"Outdent":"Indent",!0,null),tinymce.isIE&&v(n),y.cancel(t)}if(I==x)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var o=e.getDoc().createTextNode("﻿");e.selection.getNode().appendChild(o)}else if(tinymce.isIE9||tinymce.isGecko)return e.execCommand("Outdent"),y.cancel(t)}),e.onKeyDown.add(function(e,t){I=u(t)}),e.onKeyDown.add(m),e.onKeyDown.add(h),e.onKeyDown.add(f),tinymce.isGecko&&e.onKeyUp.add(b),tinymce.isIE8&&e.onKeyUp.add(C),(tinymce.isGecko||tinymce.isWebKit)&&e.onKeyDown.add(w),tinymce.isWebKit&&e.onKeyDown.add(k)},applyList:function(e,t){function n(e){e&&"BR"===e.tagName&&v.remove(e)}function i(t){function i(e){(e.style.marginLeft||e.style.paddingLeft)&&g.adjustPaddingFunction(!1)(e)}var a,l=v.create(e);if("LI"===t.tagName);else{if("P"===t.tagName||"DIV"===t.tagName||"BODY"===t.tagName)return s(t,function(e,r){o(e,r,"BODY"===t.tagName?null:e.parentNode),a=e.parentNode,i(a),n(r)}),a&&("LI"===a.tagName&&("P"===t.tagName||k.length>1)&&v.split(a.parentNode.parentNode,a.parentNode),r(a.parentNode,!0)),void 0;a=v.create("li"),v.insertAfter(a,t),a.appendChild(t),i(t),t=a}v.insertAfter(l,t),l.appendChild(t),r(l,!0),_.push(t)}function o(e,t,n){for(var o,a,r=e;!v.isBlock(e.parentNode)&&e.parentNode!==v.getRoot();)e=v.split(e.parentNode,e.previousSibling),e=e.nextSibling,r=e;if(n){for(o=n.cloneNode(!0),e.parentNode.insertBefore(o,e);o.firstChild;)v.remove(o.firstChild);o=v.rename(o,"li")}else o=v.create("li"),e.parentNode.insertBefore(o,e);for(;r&&r!=t;)a=r.nextSibling,o.appendChild(r),r=a;0===o.childNodes.length&&(o.innerHTML='<br _mce_bogus="1" />'),i(o)}function s(e,t){function n(e,t){var n,i=v.createRng();return f.keep=!0,y.selection.moveToBookmark(f),f.keep=!1,n=y.selection.getRng(!0),t||(t=e.parentNode.lastChild),i.setStartBefore(e),i.setEndAfter(t),!(i.compareBoundaryPoints(r,n)>0||0>=i.compareBoundaryPoints(s,n))}function i(e){return e.nextSibling?e.nextSibling:v.isBlock(e.parentNode)||e.parentNode===v.getRoot()?void 0:i(e.parentNode)}var o,a,r=3,s=1,l="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";o=e.firstChild;var d=!1;h(v.select(l,e),function(e){return e.hasAttribute&&e.hasAttribute("_mce_bogus")?!0:(n(o,e)&&(v.addClass(e,"_mce_tagged_br"),o=i(e)),void 0)}),d=o&&n(o,void 0),o=e.firstChild,h(v.select(l,e),function(e){var n=i(e);return e.hasAttribute&&e.hasAttribute("_mce_bogus")?!0:(v.hasClass(e,"_mce_tagged_br")?(t(o,e,a),a=null):a=e,o=n,void 0)}),d&&t(o,void 0,a)}function d(e){s(e,function(e,t,i){o(e,t),n(t),n(i)})}function c(e){-1===tinymce.inArray(_,e)&&(e.parentNode.tagName===t&&(v.split(e.parentNode,e),i(e),l(e.parentNode,!1)),_.push(e))}function u(e){var t,n,i,o;if(-1===tinymce.inArray(_,e)){for(e=a(e,v);v.is(e.parentNode,"ol,ul,li");)v.split(e.parentNode,e);if(_.push(e),e=v.rename(e,"p"),i=r(e,!1,y.settings.force_br_newlines),i===e)for(t=e.firstChild;t;)v.isBlock(t)?(t=v.split(t.parentNode,t),o=!0,n=t.nextSibling&&t.nextSibling.firstChild):(n=t.nextSibling,o&&"BR"===t.tagName&&v.remove(t),o=!1),t=n}}var m,g=this,y=g.ed,v=y.dom,_=[],b=!1,C=!1,w=!1,k=y.selection.getSelectedBlocks();h(k,function(n){n=p(n,v),n.tagName===t||"LI"===n.tagName&&n.parentNode.tagName===t?C=!0:n.tagName===e||"LI"===n.tagName&&n.parentNode.tagName===e?b=!0:w=!0}),m=w&&!b||C||0===k.length?{LI:c,H1:i,H2:i,H3:i,H4:i,H5:i,H6:i,P:i,BODY:i,DIV:k.length>1?i:d,defaultAction:d,elements:this.selectedBlocks()}:{defaultAction:u,elements:this.selectedBlocks(),processEvenIfEmpty:!0},this.process(m)},indent:function(){function e(e){var t=s.create("li",{style:"list-style-type: none;"});return s.insertAfter(t,e),t}function t(t){var n,i=e(t),o=s.getParent(t,"ol,ul"),a=o.tagName,r=s.getStyle(o,"list-style-type"),l={};return""!==r&&(l.style="list-style-type: "+r+";"),n=s.create(a,l),i.appendChild(n),n}function n(e){if(!i(o,e,l)){e=a(e,s);var n=t(e);n.appendChild(e),r(n.parentNode,!1),r(n,!1),l.push(e)}}var o=this.ed,s=o.dom,l=[];this.process({LI:n,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(e,t){function n(e){var t,n,r;if(!i(s,e,d)){if(""!==l.getStyle(e,"margin-left")||""!==l.getStyle(e,"padding-left"))return o.adjustPaddingFunction(!1)(e);if(r=l.getStyle(e,"text-align",!0),"center"===r||"right"===r)return l.setStyle(e,"text-align","left"),void 0;e=a(e,l),t=e.parentNode,n=e.parentNode.parentNode,"P"===n.tagName?l.split(n,e.parentNode):(l.split(t,e),"LI"===n.tagName?l.split(n,e):l.is(n,"ol,ul")||l.rename(e,"p")),d.push(e)}}var o=this,s=o.ed,l=s.dom,d=[],c=t&&tinymce.is(t,"array")?t:this.selectedBlocks();this.process({LI:n,defaultAction:this.adjustPaddingFunction(!1),elements:c}),h(d,r)},process:function(e){function t(e){var t=tinymce.grep(e.childNodes,function(e){return!("BR"===e.nodeName||"SPAN"===e.nodeName&&"bookmark"==c.getAttrib(e,"data-mce-type")||3==e.nodeType&&(e.nodeValue==String.fromCharCode(160)||""==e.nodeValue))});return 0===t.length}function n(n){if(c.removeClass(n,"_mce_act_on"),n&&1===n.nodeType&&!(!e.processEvenIfEmpty&&r.length>1&&t(n))){n=p(n,c);var i=e[n.tagName];i||(i=e.defaultAction),i(n)}}function i(e){l.splitSafeEach(e.childNodes,n,!0)}function o(e,t){return t>=0&&e.hasChildNodes()&&e.childNodes.length>t&&"BR"===e.childNodes[t].tagName}function a(){var e=d.getNode(),t=c.getParent(e,"td");return null!==t}var r,s,l=this,d=l.ed.selection,c=l.ed.dom;if(r=e.elements,s=d.getRng(!0),s.collapsed||(o(s.endContainer,s.endOffset-1)&&(s.setEnd(s.endContainer,s.endOffset-1),d.setRng(s)),o(s.startContainer,s.startOffset)&&(s.setStart(s.startContainer,s.startOffset+1),d.setRng(s))),tinymce.isIE8){var u=l.ed.selection.getNode();if("LI"===u.tagName&&u.parentNode.lastChild!==u){var m=l.ed.getDoc().createTextNode("﻿");u.appendChild(m)}}f=d.getBookmark(),e.OL=e.UL=i,l.splitSafeEach(r,n),d.moveToBookmark(f),f=null,a()||l.ed.execCommand("mceRepaint")},splitSafeEach:function(e,t,n){n||tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(e,t):h(e,t)},classBasedEach:function(e,t){var n,i,o=this.ed.dom;for(h(e,function(e){o.addClass(e,"_mce_act_on")}),n=o.select("._mce_act_on");n.length>0;)i=n.shift(),o.removeClass(i,"_mce_act_on"),t(i),n=o.select("._mce_act_on")},adjustPaddingFunction:function(e){var t,n,i=this.ed;return t=i.settings.indentation,n=/[a-z%]+/i.exec(t),t=parseInt(t,10),function(o){var a,r;a=parseInt(i.dom.getStyle(o,"margin-left")||0,10)+parseInt(i.dom.getStyle(o,"padding-left")||0,10),r=e?a+t:a-t,i.dom.setStyle(o,"padding-left",""),i.dom.setStyle(o,"margin-left",r>0?r+n:"")}},selectedBlocks:function(){var e=this.ed,t=e.selection.getSelectedBlocks();return 0==t.length?[e.dom.getRoot()]:t},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})();