(function(){function e(e,t){return e.getParam(t,n[t])}var t=tinymce.each,n={paste_auto_cleanup_on_paste:!0,paste_enable_default_filters:!0,paste_block_drop:!1,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:!1,paste_remove_styles:!1,paste_remove_styles_if_webkit:!0,paste_convert_middot_lists:!0,paste_convert_headers_to_strong:!1,paste_dialog_width:"450",paste_dialog_height:"400",paste_max_consecutive_linebreaks:2,paste_text_use_dialog:!1,paste_text_sticky:!1,paste_text_sticky_default:!1,paste_text_notifyalways:!1,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};tinymce.create("tinymce.plugins.PastePlugin",{init:function(n,i){function o(t,i){var o,a=n.dom;r.onPreProcess.dispatch(r,t),t.node=a.create("div",0,t.content),tinymce.isGecko&&(o=n.selection.getRng(!0),o.startContainer==o.endContainer&&3==o.startContainer.nodeType&&1===t.node.childNodes.length&&/^(p|h[1-6]|pre)$/i.test(t.node.firstChild.nodeName)&&-1===t.content.indexOf("__MCE_ITEM__")&&a.remove(t.node.firstChild,!0)),r.onPostProcess.dispatch(r,t),t.content=n.serializer.serialize(t.node,{getInner:1,forced_root_block:""}),!i&&n.pasteAsPlainText?(r._insertPlainText(t.content),e(n,"paste_text_sticky")||(n.pasteAsPlainText=!1,n.controlManager.setActive("pastetext",!1))):r._insert(t.content)}function a(e){function i(e){e.preventDefault()}var a,r,s,l,d,c,u=n.selection,m=n.dom,p=n.getBody();if((e.clipboardData||m.doc.dataTransfer)&&(c=(e.clipboardData||m.doc.dataTransfer).getData("Text"),n.pasteAsPlainText))return e.preventDefault(),o({content:m.encode(c).replace(/\r?\n/g,"<br />")}),void 0;if(!m.get("_mcePaste"))return a=m.add(p,"div",{id:"_mcePaste","class":"mcePaste","data-mce-bogus":"1"},"﻿﻿"),d=p!=n.getDoc().body?m.getPos(n.selection.getStart(),p).y:p.scrollTop+m.getViewPort(n.getWin()).y,m.setStyles(a,{position:"absolute",left:tinymce.isGecko?-40:0,top:d-25,width:1,height:1,overflow:"hidden"}),tinymce.isIE?(l=u.getRng(),s=m.doc.body.createTextRange(),s.moveToElementText(a),s.execCommand("Paste"),m.remove(a),"﻿﻿"===a.innerHTML?(n.execCommand("mcePasteWord"),e.preventDefault(),void 0):(u.setRng(l),u.setContent(""),setTimeout(function(){o({content:a.innerHTML})},0),tinymce.dom.Event.cancel(e))):(m.bind(n.getDoc(),"mousedown",i),m.bind(n.getDoc(),"keydown",i),r=n.selection.getRng(),a=a.firstChild,s=n.getDoc().createRange(),s.setStart(a,0),s.setEnd(a,2),u.setRng(s),window.setTimeout(function(){var e,a="";m.select("div.mcePaste > div.mcePaste").length?a="<p>"+m.encode(c).replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br />")+"</p>":(e=m.select("div.mcePaste"),t(e,function(e){var n=e.firstChild;n&&"DIV"==n.nodeName&&n.style.marginTop&&n.style.backgroundColor&&m.remove(n,1),t(m.select("span.Apple-style-span",e),function(e){m.remove(e,1)}),t(m.select("br[data-mce-bogus]",e),function(e){m.remove(e)}),"mcePaste"!=e.parentNode.className&&(a+=e.innerHTML)})),t(m.select("div.mcePaste"),function(e){m.remove(e)}),r&&u.setRng(r),o({content:a}),m.unbind(n.getDoc(),"mousedown",i),m.unbind(n.getDoc(),"keydown",i)},0),void 0)}var r=this;r.editor=n,r.url=i,r.onPreProcess=new tinymce.util.Dispatcher(r),r.onPostProcess=new tinymce.util.Dispatcher(r),r.onPreProcess.add(r._preProcess),r.onPostProcess.add(r._postProcess),r.onPreProcess.add(function(e,t){n.execCallback("paste_preprocess",e,t)}),r.onPostProcess.add(function(e,t){n.execCallback("paste_postprocess",e,t)}),n.onKeyDown.addToTop(function(e,t){return(tinymce.isMac?t.metaKey:t.ctrlKey)&&86==t.keyCode||t.shiftKey&&45==t.keyCode?!1:void 0}),n.pasteAsPlainText=e(n,"paste_text_sticky_default"),n.addCommand("mceInsertClipboardContent",function(e,t){o(t,!0)}),e(n,"paste_text_use_dialog")||n.addCommand("mcePasteText",function(){var t=tinymce.util.Cookie;n.pasteAsPlainText=!n.pasteAsPlainText,n.controlManager.setActive("pastetext",n.pasteAsPlainText),n.pasteAsPlainText&&!t.get("tinymcePasteText")&&(e(n,"paste_text_sticky")?n.windowManager.alert(n.translate("paste.plaintext_mode_sticky")):n.windowManager.alert(n.translate("paste.plaintext_mode")),e(n,"paste_text_notifyalways")||t.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31)))}),n.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"}),n.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"}),e(n,"paste_auto_cleanup_on_paste")&&(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)?n.onKeyDown.addToTop(function(e,t){((tinymce.isMac?t.metaKey:t.ctrlKey)&&86==t.keyCode||t.shiftKey&&45==t.keyCode)&&a(t)}):n.onPaste.addToTop(function(e,t){return a(t)})),n.onInit.add(function(){n.controlManager.setActive("pastetext",n.pasteAsPlainText),e(n,"paste_block_drop")&&n.dom.bind(n.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(e){return e.preventDefault(),e.stopPropagation(),!1})}),r._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(n,i){function o(e){t(e,function(e){d=e.constructor==RegExp?d.replace(e,""):d.replace(e[0],e[1])})}function a(e,t){if("all"===s)return"";var n=c(u(t.replace(/^(["'])(.*)\1$/,"$2")," "),function(e){return/^(?!mso)/i.test(e)});return n.length?' class="'+n.join(" ")+'"':""}var r,s,l=this.editor,d=i.content,c=tinymce.grep,u=tinymce.explode,m=tinymce.trim;if(0!=l.settings.paste_enable_default_filters){if(tinymce.isIE&&document.documentMode>=9&&/<(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)/.test(i.content)&&(o([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]),o([[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])),/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(d)||i.wordContent){i.wordContent=!0,o([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]),e(l,"paste_convert_headers_to_strong")&&(d=d.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>")),e(l,"paste_convert_middot_lists")&&o([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]]),o([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi," "]]);do r=d.length,d=d.replace(/(<?!(ol|ul)[^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1"),d=d.replace(/(<(ol|ul)[^>]*\s)(?:id|name|language|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1");while(r!=d.length);0==e(l,"paste_retain_style_properties").replace(/^none$/i,"").length?d=d.replace(/<\/?span[^>]*>/gi,""):o([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(e,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(e,n,i){var o=[],a=0,r=u(m(i).replace(/&quot;/gi,"'"),";");return t(r,function(e){function t(e){return e+("0"!==e&&/\d$/.test(e))?"px":""}var n,i,r=u(e,":");if(2==r.length){switch(n=r[0].toLowerCase(),i=r[1].toLowerCase(),n){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":return o[a++]=n.replace(/^mso-|-alt$/g,"")+":"+t(i),void 0;case"horiz-align":return o[a++]="text-align:"+i,void 0;case"vert-align":return o[a++]="vertical-align:"+i,void 0;case"font-color":case"mso-foreground":return o[a++]="color:"+i,void 0;case"mso-background":case"mso-highlight":return o[a++]="background:"+i,void 0;case"mso-default-height":return o[a++]="min-height:"+t(i),void 0;case"mso-default-width":return o[a++]="min-width:"+t(i),void 0;case"mso-padding-between-alt":return o[a++]="border-collapse:separate;border-spacing:"+t(i),void 0;case"text-line-through":return("single"==i||"double"==i)&&(o[a++]="text-decoration:line-through"),void 0;case"mso-zero-height":return"yes"==i&&(o[a++]="display:none"),void 0}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(n))return;o[a++]=n+":"+r[1]}}),a>0?n+' style="'+o.join(";")+'"':n}]])}e(l,"paste_convert_headers_to_strong")&&o([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]),o([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]),s=e(l,"paste_strip_class_attributes"),"none"!==s&&(d=d.replace(/ class="([^"]+)"/gi,a),d=d.replace(/ class=([\-\w]+)/gi,a)),e(l,"paste_remove_spans")&&(d=d.replace(/<\/?span[^>]*>/gi,"")),i.content=d}},_postProcess:function(n,i){var o,a=this,r=a.editor,s=r.dom;0!=r.settings.paste_enable_default_filters&&(i.wordContent&&(t(s.select("a",i.node),function(e){e.href&&-1==e.href.indexOf("#_Toc")||s.remove(e,1)}),e(r,"paste_convert_middot_lists")&&a._convertLists(n,i),o=e(r,"paste_retain_style_properties"),tinymce.is(o,"string")&&"all"!==o&&"*"!==o&&(o=tinymce.explode(o.replace(/^none$/i,"")),t(s.select("*",i.node),function(e){var t,n,i,a={},r=0;if(o)for(t=0;o.length>t;t++)n=o[t],i=s.getStyle(e,n),i&&(a[n]=i,r++);s.setAttrib(e,"style",""),o&&r>0?s.setStyles(e,a):"SPAN"!=e.nodeName||e.className||s.remove(e,!0)}))),e(r,"paste_remove_styles")||e(r,"paste_remove_styles_if_webkit")&&tinymce.isWebKit?t(s.select("*[style]",i.node),function(e){e.removeAttribute("style"),e.removeAttribute("data-mce-style")}):tinymce.isWebKit&&t(s.select("*",i.node),function(e){e.removeAttribute("data-mce-style")}))},_convertLists:function(e,n){var i,o,a,r,s,l=e.editor.dom,d=-1,c=[];t(l.select("p",n.node),function(e){var n,s,u,m,p,g="";for(n=e.firstChild;n&&3==n.nodeType;n=n.nextSibling)g+=n.nodeValue;g=e.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g," "),/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(g)&&(s="ul"),/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(g)&&(s="ol"),s?(a=parseFloat(e.style.marginLeft||0),a>d&&c.push(a),i&&s==r?a>d?i=o.appendChild(l.create(s)):d>a&&(m=tinymce.inArray(c,a),p=l.getParents(i.parentNode,s),i=p[p.length-1-m]||i):(i=l.create(s),l.insertAfter(i,e)),t(l.select("span",e),function(e){var t=e.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");"ul"==s&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(t)?l.remove(e):/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(t)&&l.remove(e)}),u=e.innerHTML,u="ul"==s?e.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,""):e.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*[\w|'<'|'>']+\.(&nbsp;|\u00a0)+\s*/,""),o=i.appendChild(l.create("li",0,u)),l.remove(e),d=a,r=s):i=d=0}),s=n.node.innerHTML,-1!=s.indexOf("__MCE_ITEM__")&&(n.node.innerHTML=s.replace(/__MCE_ITEM__/g,""))},_insert:function(e,t){var n=this.editor,i=n.selection.getRng();n.selection.isCollapsed()||i.startContainer==i.endContainer||n.getDoc().execCommand("Delete",!1,null),n.execCommand("mceInsertContent",!1,e,{skip_undo:t})},_insertPlainText:function(n){function i(e){t(e,function(e){n=e.constructor==RegExp?n.replace(e,""):n.replace(e[0],e[1])})}var o=this.editor,a=e(o,"paste_text_linebreaktype"),r=e(o,"paste_text_replacements"),s=tinymce.is;if("string"==typeof n&&n.length>0){/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(n)?i([/[\n\r]+/g]):i([/\r+/g]),i([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"	"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"]]);var l=Number(e(o,"paste_max_consecutive_linebreaks"));if(l>-1){for(var d=RegExp("\n{"+(l+1)+",}","g"),c="";l>c.length;)c+="\n";i([[d,c]])}n=o.dom.decode(tinymce.html.Entities.encodeRaw(n)),s(r,"array")?i(r):s(r,"string")&&i(RegExp(r,"gi")),"none"==a?i([[/\n+/g," "]]):"br"==a?i([[/\n/g,"<br />"]]):"p"==a?i([[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"]]):i([[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]]),o.execCommand("mceInsertContent",!1,n)}},_legacySupport:function(){var t=this,n=t.editor;n.addCommand("mcePasteWord",function(){n.windowManager.open({file:t.url+"/pasteword.htm",width:parseInt(e(n,"paste_dialog_width")),height:parseInt(e(n,"paste_dialog_height")),inline:1})}),e(n,"paste_text_use_dialog")&&n.addCommand("mcePasteText",function(){n.windowManager.open({file:t.url+"/pastetext.htm",width:parseInt(e(n,"paste_dialog_width")),height:parseInt(e(n,"paste_dialog_height")),inline:1})}),n.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}}),tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)})();