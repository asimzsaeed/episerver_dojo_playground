function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=tinyMCEPopup.editor,t=e.dom,n=t.getParent(e.selection.getStart(),"tr"),i=document.forms[0],o=t.parseStyle(t.getAttrib(n,"style")),a=n.parentNode.nodeName.toLowerCase(),r=t.getAttrib(n,"align"),l=t.getAttrib(n,"valign"),s=trimSize(getStyle(n,"height","height")),c=t.getAttrib(n,"class"),d=convertRGBToHex(getStyle(n,"bgcolor","backgroundColor")),u=getStyle(n,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),m=t.getAttrib(n,"id"),p=t.getAttrib(n,"lang"),g=t.getAttrib(n,"dir");selectByValue(i,"rowtype",a),setActionforRowType(i,a),0==t.select("td.mceSelected,th.mceSelected",n).length?(addClassesToList("class",tinyMCEPopup.getParam("style_formats",!1)?{tagCheckHandler:function(e){return"TD"==e.nodeName?e=tinyMCEPopup.editor.dom.getParent(e,"TR"):"TABLE"==e.nodeName&&(e=e.firstChild||e),e},tagCheckCleanUp:function(){}}:"table_row_styles"),TinyMCE_EditableSelects.init(),i.bgcolor.value=d,i.backgroundimage.value=u,i.height.value=s,i.id.value=m,i.lang.value=p,i.style.value=t.serializeStyle(o),selectByValue(i,"align",r),selectByValue(i,"valign",l),selectByValue(i,"class",c,!0,!0),selectByValue(i,"dir",g),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bgcolor_pick","bgcolor")):tinyMCEPopup.dom.hide("action")}function updateAction(){var e,t,n=tinyMCEPopup.editor,i=n.dom,o=document.forms[0],a=getSelectValue(o,"action");if(!AutoValidator.validate(o))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(o).join(". ")+"."),!1;if(tinyMCEPopup.restoreSelection(),e=i.getParent(n.selection.getStart(),"tr"),t=i.getParent(n.selection.getStart(),"table"),i.select("td.mceSelected,th.mceSelected",e).length>0)return tinymce.each(t.rows,function(e){var t;for(t=0;e.cells.length>t;t++)if(i.hasClass(e.cells[t],"mceSelected"))return updateRow(e,!0),void 0}),n.addVisual(),n.nodeChanged(),n.execCommand("mceEndUndoLevel"),tinyMCEPopup.close(),void 0;switch(a){case"row":updateRow(e);break;case"all":for(var r=t.getElementsByTagName("tr"),l=0;r.length>l;l++)updateRow(r[l],!0);break;case"odd":case"even":for(var r=t.getElementsByTagName("tr"),l=0;r.length>l;l++)(0==l%2&&"odd"==a||0!=l%2&&"even"==a)&&updateRow(r[l],!0,!0)}n.addVisual(),n.nodeChanged(),n.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function updateRow(e,t,n){var i=tinyMCEPopup.editor,o=document.forms[0],a=i.dom,r=e.parentNode.nodeName.toLowerCase(),l=getSelectValue(o,"rowtype"),s=i.getDoc();if(t||a.setAttrib(e,"id",o.id.value),a.setAttrib(e,"align",getSelectValue(o,"align")),a.setAttrib(e,"vAlign",getSelectValue(o,"valign")),a.setAttrib(e,"lang",o.lang.value),a.setAttrib(e,"dir",getSelectValue(o,"dir")),a.setAttrib(e,"style",a.serializeStyle(a.parseStyle(o.style.value))),a.setAttrib(e,"class",getSelectValue(o,"class")),a.setAttrib(e,"background",""),a.setAttrib(e,"bgColor",""),a.setAttrib(e,"height",""),e.style.height=getCSSSize(o.height.value),e.style.backgroundColor=o.bgcolor.value,e.style.backgroundImage=""!=o.backgroundimage.value?"url('"+o.backgroundimage.value+"')":"",r!=l&&!n){for(var c=e.cloneNode(1),d=a.getParent(e,"table"),u=l,m=null,p=0;d.childNodes.length>p;p++)d.childNodes[p].nodeName.toLowerCase()==u&&(m=d.childNodes[p]);null==m&&(m=s.createElement(u),"CAPTION"==d.firstChild.nodeName?i.dom.insertAfter(m,d.firstChild):d.insertBefore(m,d.firstChild)),m.appendChild(c),e.parentNode.removeChild(e),e=c}a.setAttrib(e,"style",a.serializeStyle(a.parseStyle(e.style.cssText)))}function changedBackgroundImage(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,n=t.parseStyle(e.style.value);n["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=t.serializeStyle(n)}function changedStyle(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,n=t.parseStyle(e.style.value);e.backgroundimage.value=n["background-image"]?n["background-image"].replace(RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):"",n.height&&(e.height.value=trimSize(n.height)),n["background-color"]&&(e.bgcolor.value=n["background-color"],updateColor("bgcolor_pick","bgcolor"))}function changedSize(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,n=t.parseStyle(e.style.value),i=e.height.value;n.height=""!=i?getCSSSize(i):"",e.style.value=t.serializeStyle(n)}function changedColor(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,n=t.parseStyle(e.style.value);n["background-color"]=e.bgcolor.value,e.style.value=t.serializeStyle(n)}function changedRowType(){var e=document.forms[0],t=getSelectValue(e,"rowtype");setActionforRowType(e,t)}function setActionforRowType(e,t){"tbody"===t?e.action.disabled=!1:(selectByValue(e,"action","row"),e.action.disabled=!0)}tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(init);