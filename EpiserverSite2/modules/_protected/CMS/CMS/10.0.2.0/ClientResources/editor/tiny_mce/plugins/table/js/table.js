function insertTable(){var e,t,n,i,o,a,r,l,s,c,d,u,m=document.forms[0],g=tinyMCEPopup.editor,p=g.dom,h=2,f=2,y=0,_=-1,v=-1,b="";if(tinyMCEPopup.restoreSelection(),!AutoValidator.validate(m))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(m).join(". ")+"."),!1;if(s=p.getParent(g.selection.getNode(),"table"),h=m.elements.cols.value,f=m.elements.rows.value,y=""!=m.elements.border.value?m.elements.border.value:0,_=""!=m.elements.cellpadding.value?m.elements.cellpadding.value:"",v=""!=m.elements.cellspacing.value?m.elements.cellspacing.value:"",e=getSelectValue(m,"align"),a=getSelectValue(m,"tframe"),r=getSelectValue(m,"rules"),t=m.elements.width.value,n=m.elements.height.value,bordercolor=m.elements.bordercolor.value,bgcolor=m.elements.bgcolor.value,i=getSelectValue(m,"class"),id=m.elements.id.value,summary=m.elements.summary.value,style=m.elements.style.value,dir=m.elements.dir.value,lang=m.elements.lang.value,background=m.elements.backgroundimage.value,o=m.elements.caption.checked,c=tinyMCEPopup.getParam("table_cell_limit",!1),d=tinyMCEPopup.getParam("table_row_limit",!1),u=tinyMCEPopup.getParam("table_col_limit",!1),u&&h>u)return tinyMCEPopup.alert(g.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,u)),!1;if(d&&f>d)return tinyMCEPopup.alert(g.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,d)),!1;if(c&&h*f>c)return tinyMCEPopup.alert(g.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,c)),!1;if("update"==action)return p.setAttrib(s,"cellPadding",_,!0),p.setAttrib(s,"cellSpacing",v,!0),isCssSize(y)?p.setAttrib(s,"border",""):p.setAttrib(s,"border",y),""==y&&(p.setStyle(s,"border-width",""),p.setStyle(s,"border",""),p.setAttrib(s,"border","")),p.setAttrib(s,"align",e),p.setAttrib(s,"frame",a),p.setAttrib(s,"rules",r),p.setAttrib(s,"class",i),p.setAttrib(s,"style",style),p.setAttrib(s,"id",id),p.setAttrib(s,"summary",summary),p.setAttrib(s,"dir",dir),p.setAttrib(s,"lang",lang),l=g.dom.select("caption",s)[0],l&&!o&&l.parentNode.removeChild(l),!l&&o&&(l=s.ownerDocument.createElement("caption"),(!tinymce.isIE||tinymce.isIE11)&&(l.innerHTML='<br data-mce-bogus="1"/>'),s.insertBefore(l,s.firstChild)),t&&g.settings.inline_styles?(p.setStyle(s,"width",t),p.setAttrib(s,"width","")):(p.setAttrib(s,"width",t,!0),p.setStyle(s,"width","")),p.setAttrib(s,"borderColor",""),p.setAttrib(s,"bgColor",""),p.setAttrib(s,"background",""),n&&g.settings.inline_styles?(p.setStyle(s,"height",n),p.setAttrib(s,"height","")):(p.setAttrib(s,"height",n,!0),p.setStyle(s,"height","")),s.style.backgroundImage=""!=background?"url('"+background+"')":"",""!=bordercolor?(s.style.borderColor=bordercolor,s.style.borderStyle=""==s.style.borderStyle?"solid":s.style.borderStyle,s.style.borderWidth=cssSize(y)):s.style.borderColor="",s.style.backgroundColor=bgcolor,s.style.height=getCSSSize(n),g.addVisual(),g.nodeChanged(),g.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),(m.width.value!=orgTableWidth||m.height.value!=orgTableHeight)&&g.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;b+="<table",b+=makeAttrib("id",id),isCssSize(y)||(b+=makeAttrib("border",y)),b+=makeAttrib("cellpadding",_),b+=makeAttrib("cellspacing",v),b+=makeAttrib("data-mce-new","1"),t&&g.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(t)&&(t+="px"),style+="width: "+t):b+=makeAttrib("width",t),b+=makeAttrib("align",e),b+=makeAttrib("frame",a),b+=makeAttrib("rules",r),b+=makeAttrib("class",i),b+=makeAttrib("style",style),b+=makeAttrib("summary",summary),b+=makeAttrib("dir",dir),b+=makeAttrib("lang",lang),b+=">",o&&(b+=!tinymce.isIE||tinymce.isIE11?'<caption><br data-mce-bogus="1"/></caption>':"<caption></caption>");for(var w=0;f>w;w++){b+="<tr>";for(var C=0;h>C;C++)b+=!tinymce.isIE||tinymce.isIE11?'<td><br data-mce-bogus="1"/></td>':"<td></td>";b+="</tr>"}if(b+="</table>",g.settings.fix_table_elements){var k="";g.focus(),g.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(e){k&&(k+=","),k+=e+" ._mce_marker"}),tinymce.each(g.dom.select(k),function(e){g.dom.split(g.dom.getParent(e,"h1,h2,h3,h4,h5,h6,p"),e)}),p.setOuterHTML(p.select("br._mce_marker")[0],b)}else g.execCommand("mceInsertContent",!1,b);tinymce.each(p.select("table[data-mce-new]"),function(e){var t=p.select("td,th",e);tinymce.isIE&&!tinymce.isIE11&&null==e.nextSibling&&(g.settings.forced_root_block?p.insertAfter(p.create(g.settings.forced_root_block),e):p.insertAfter(p.create("br",{"data-mce-bogus":"1"}),e));try{g.selection.setCursorLocation(t[0],0)}catch(n){}p.setAttrib(e,"data-mce-new","")}),g.addVisual(),g.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),tinyMCEPopup.close()}function makeAttrib(e,t){var n=document.forms[0],i=n.elements[e];return(t===void 0||null==t)&&(t="",i&&(t=i.value)),""==t?"":(t=t.replace(/&/g,"&amp;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")," "+e+'="'+t+'"')}function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=2,t=2,n=tinyMCEPopup.getParam("table_default_border","0"),i=tinyMCEPopup.getParam("table_default_cellpadding",""),o=tinyMCEPopup.getParam("table_default_cellspacing",""),a="",r="",l="",s="",c="",d="",u="",m="",g="",p="",h="",f="",c="",s="",y="",_="",v=tinyMCEPopup.editor,b=v.dom,w=document.forms[0],C=b.getParent(v.selection.getNode(),"table");if(tinymce.each("cellpadding cellspacing align".split(" "),function(e){var t=tinyMCEPopup.dom.getParent(e+"label","td"),n=tinyMCEPopup.dom.getParent(e,"td");t&&n&&!tinyMCEPopup.editor.schema.isValid("table",e)&&(t.style.display="none",n.style.display="none")}),tinymce.each("summary id rules dir style frame".split(" "),function(e){var t=tinyMCEPopup.dom.getParent(e,"tr")||tinyMCEPopup.dom.getParent("t"+e,"tr");t&&!tinyMCEPopup.editor.schema.isValid("table",e)&&(t.style.display="none")}),action=tinyMCEPopup.getWindowArg("action"),action||(action=C?"update":"insert"),C&&"insert"!=action){for(var k=C.rows,e=0,x=0;k.length>x;x++)k[x].cells.length>e&&(e=k[x].cells.length);e=e,t=k.length,st=b.parseStyle(b.getAttrib(C,"style")),n=trimSize(getStyle(C,"border","borderWidth")),i=b.getAttrib(C,"cellpadding",""),o=b.getAttrib(C,"cellspacing",""),r=trimSize(getStyle(C,"width","width")),l=trimSize(getStyle(C,"height","height")),s=convertRGBToHex(getStyle(C,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(C,"bgcolor","backgroundColor")),a=b.getAttrib(C,"align",a),_=b.getAttrib(C,"frame"),y=b.getAttrib(C,"rules"),d=tinymce.trim(b.getAttrib(C,"class").replace(/mceItem.+/g,"")),u=b.getAttrib(C,"id"),m=b.getAttrib(C,"summary"),g=b.serializeStyle(st),p=b.getAttrib(C,"dir"),h=b.getAttrib(C,"lang"),f=getStyle(C,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),w.caption.checked=C.getElementsByTagName("caption").length>0,orgTableWidth=r,orgTableHeight=l,action="update",w.insert.value=v.getLang("update")}addClassesToList("class",tinyMCEPopup.getParam("style_formats",!1)?{tag:"TABLE"}:"table_styles"),TinyMCE_EditableSelects.init(),selectByValue(w,"align",a),selectByValue(w,"tframe",_),selectByValue(w,"rules",y),selectByValue(w,"class",d,!0,!0),w.cols.value=e,w.rows.value=t,w.border.value=n,w.cellpadding.value=i,w.cellspacing.value=o,w.width.value=r,w.height.value=l,w.bordercolor.value=s,w.bgcolor.value=c,w.id.value=u,w.summary.value=m,w.style.value=g,w.dir.value=p,w.lang.value=h,w.backgroundimage.value=f,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),"update"==action&&(w.cols.disabled=!0,w.rows.disabled=!0)}function changedSize(){var e=document.forms[0],t=dom.parseStyle(e.style.value),n=e.height.value;t.height=""!=n?getCSSSize(n):"",e.style.value=dom.serializeStyle(t)}function isCssSize(e){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(e)}function cssSize(e,t){return e=tinymce.trim(e||t),isCssSize(e)?e:parseInt(e,10)+"px"}function changedBackgroundImage(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=dom.serializeStyle(t)}function changedBorder(){var e=document.forms[0],t=dom.parseStyle(e.style.value);""==e.border.value||!isCssSize(e.border.value)&&""==e.bordercolor.value?e.border.value||(t.border="",t["border-width"]=""):t["border-width"]=cssSize(e.border.value),e.style.value=dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,""!=e.bordercolor.value&&(t["border-color"]=e.bordercolor.value,t["border-width"]||(t["border-width"]=cssSize(e.border.value,1))),e.style.value=dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=dom.parseStyle(e.style.value);e.backgroundimage.value=t["background-image"]?t["background-image"].replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):"",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);