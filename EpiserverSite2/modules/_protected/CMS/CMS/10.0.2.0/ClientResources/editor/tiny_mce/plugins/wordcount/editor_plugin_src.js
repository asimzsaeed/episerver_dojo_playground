(function(){tinymce.create("tinymce.plugins.WordCount",{block:0,id:null,countre:null,cleanre:null,init:function(e){function t(e){return e!==o&&(e===a.ENTER||o===a.SPACEBAR||n(o))}function n(e){return e===a.DELETE||e===a.BACKSPACE}var i=this,o=0,a=tinymce.VK;i.countre=e.getParam("wordcount_countregex",/[\w\u2019\u00co-\u00ff^\uc397^u00f7\'-]+/g),i.cleanre=e.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\'\"_+=\\\/-]*/g),i.update_rate=e.getParam("wordcount_update_rate",2e3),i.update_on_delete=e.getParam("wordcount_update_on_delete",!1),i.id=e.id+"-word-count",e.onPostRender.add(function(e){var t,n;n=e.getParam("wordcount_target_id"),n?tinymce.DOM.add(n,"span",{},'<span id="'+i.id+'">0</span>'):(t=tinymce.DOM.get(e.id+"_path_row"),t&&tinymce.DOM.add(t.parentNode,"div",{style:"float: right"},e.getLang("wordcount.words","Words: ")+'<span id="'+i.id+'">0</span>'))}),e.onInit.add(function(e){e.selection.onSetContent.add(function(){i._count(e)}),i._count(e)}),e.onSetContent.add(function(e){i._count(e)}),e.onKeyUp.add(function(e,a){(t(a.keyCode)||i.update_on_delete&&n(a.keyCode))&&i._count(e),o=a.keyCode})},_getCount:function(e){var t=0,n=e.getContent({format:"raw"});if(n){n=n.replace(/\.\.\./g," "),n=n.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),n=n.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),n=n.replace(this.cleanre,"");var i=n.match(this.countre);i&&(t=i.length)}return t},_count:function(e){var t=this;t.block||(t.block=1,setTimeout(function(){if(!e.destroyed){var n=t._getCount(e);tinymce.DOM.setHTML(t.id,""+n),setTimeout(function(){t.block=0},t.update_rate)}},1))},getInfo:function(){return{longname:"Word Count plugin",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/wordcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("wordcount",tinymce.plugins.WordCount)})();