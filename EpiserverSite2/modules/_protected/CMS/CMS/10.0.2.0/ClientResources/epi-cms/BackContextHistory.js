//>>built
define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/store/Memory","epi/shell/ContextHistory","epi/shell/ViewSettings"],function(_1,_2,_3,_4,_5,_6){return _1([_5],{createStore:function(){return new _4({data:[],idProperty:"uri"});},onContextChanged:function(_7,_8,_9){if(_8&&_8.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},closeAndNavigateBack:function(_a){var _b=this._getLastItem();var _c=this.store.data.filter(function(_d){return _b.typeIdentifier&&(_b.typeIdentifier===_d.typeIdentifier);});_c.forEach(function(_e){var _f=this.store.getIdentity(_e);this.store.remove(_f);},this);var _10=this._getLastItem();var uri=_10&&_10.uri?{uri:_10.uri}:{uri:_6.settings.defaultContext};_3.publish("/epi/shell/context/request",uri,{sender:_a});},getPrevious:function(){var _11=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_11&&_11.length>1)?_11[1]:null;},_updateStore:function(_12){var _13=this._getLastItem();if(_13&&_13.uri===_12.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){return this.store.data[this.store.data.length-1];}return null;},_removeLastItem:function(){var _14=this._getLastItem();if(_14){this.store.remove(this.store.getIdentity(_14));}}});});