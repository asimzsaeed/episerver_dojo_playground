//>>built
define("epi-cms/_ContentContextMixin",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_8],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_3.after(this.getContentDataStore(),"onItemChanged",_2.hitch(this,this.itemChanged)));},getContentDataStore:function(){if(!this.contentDataStore){var _a=_6.resolve("epi.storeregistry");this.contentDataStore=_a.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _b=new _4();_5(this.getCurrentContext(),_2.hitch(this,function(_c){if(!this._isContentContext(_c)){_b.reject({message:"Not a content data",context:_c});return;}_5(this.getContentDataStore().get(_c.id),function(_d){_b.resolve(_d);});}));return _b;},contextChanged:function(_e,_f){this.inherited(arguments);if(!this._isContentContext(_e)){this._currentContentContext=null;return;}var _10=(_f&&_f.forceContextChange?_f.forceContextChange:false);if(!_10&&this._isSameAsCurrentContentContext(_e)){return;}this._currentContentContext=_e;this.contentContextChanged(_e,_f);},contextUpdated:function(ctx,_11){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_11);},contentContextChanged:function(ctx,_12){},contentContextUpdated:function(ctx,_13){},itemChanged:function(id,_14){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_15,_16){var _17=new _7(_15),_18=new _7(_16);if(this.ignoreVersionWhenComparingLinks&&_17.getType()==="epi.cms.contentdata"&&_18.getType()==="epi.cms.contentdata"&&_9.compareIgnoreVersion(_17.getId(),_18.getId())){return true;}else{if(_15===_16){return true;}}return false;}});});