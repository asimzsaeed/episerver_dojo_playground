//>>built
define("epi-cms/component/ContentNavigationTree",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,res){return _3([_19,_10,_b,_11],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_16,nodeConstructor:_15,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _a();this.selection=new _c();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",_4.hitch(this,function(_21){_21?this._copyCommand.execute():this._cutCommand.execute();})),this.on("paste",_4.hitch(this,function(){_7(this._pasteCommand.execute(),_4.hitch(this,function(){this.selectedNode.expand();}));})),this.on("delete",_4.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("select",_4.hitch(this,this._onTreeNodeClicked)));this.connect(this,"onClick","_onTreeNodeClicked");var _22=_4.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_22);this.subscribe("/dnd/cancel",_22);},startup:function(){this.inherited(arguments);_7(this.getCurrentContext(),_4.hitch(this,function(_23){this.contextChanged(_23);}));},_preparePathNodes:function(_24){var _25=this,_26;_1.some(_24,function(_27,_28){var _29=_25.getNodesByItem(_27),_2a=_29.length===1&&!_29[0];if(_28>0&&_2a){_1.forEach(_26,function(_2b){if(_2b.state==="LOADED"){_2b._loadDeferred=null;}});return true;}_26=_29;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showLanguagesCommand=new _14({model:this});var _2c=this._contextMenuCommandProvider.get("commands");_1.some(_2c,_4.hitch(this,function(_2d){if(_2d instanceof _1c){this._copyCommand=_2d;}else{if(_2d instanceof _1d){this._cutCommand=_2d;}else{if(_2d instanceof _1f){this._pasteCommand=_2d;}else{if(_2d instanceof _1e){this._deleteCommand=_2d;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showLanguagesCommand].concat(_2c);},_setShowAllLanguagesAttr:function(_2e){this._set("showAllLanguages",_2e);this.model.set("showAllLanguages",_2e);},_onTreeNodeClicked:function(_2f,_30,_31){_7(this.getCurrentContext(),_4.hitch(this,function(_32){var _33=true;if(_32&&_18.isContentReference(_32.id)){_33=_18.compareIgnoreVersion(_2f.contentLink,_32.id);}var _34=function(_35){var _36={typeName:_d.getResourceValue(_2f.typeIdentifier,"name"),name:_2f.name};_6.publish("/epi/shell/context/request",{uri:_2f.uri},{sender:_4.mixin(_35,{requestedContent:_36}),forceContextChange:true});};if(!_33){_34(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_34,300);}));},contentContextChanged:function(_37,_38){var _39=new _18(_37.id),_3a=_39.createVersionUnspecificReference().toString(),_3b=_12.wastebasketPage.toString();this.inherited(arguments);if(_3a===_3b){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_3a;if(_38&&_38.sender===this&&this.selectedItem&&_3a===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_37.dataType)){this.selectContent(_3a,false,true).then(_4.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_3c){return this.tree.model.isSupportedType(_3c);},_getSelectionData:function(_3d){return _3d?[{type:"epi.cms.contentdata",data:_3d}]:[];},_updateGlobalToolbarButtons:function(_3e){var _3f=_3e||this.get("selectedNode"),_40=_3f?this._getSelectionData(_3f.item):[];if(this._createCommand){this._createCommand.set("model",_3f&&_3f.item);}this._contextMenuCommandProvider.updateCommandModel(_3f&&_3f.item);this.selection.set("data",_40);},contextChangeFailed:function(_41,_42,_43){this.inherited(arguments);if(_41){if(_43&&_43.sender===this){this.selectContent(_41.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!==this.selectedNode&&this._focusNode.rowNode){_5.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_5.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(_44){this._removeHighlightClass();this._focusNode=_44;},_showContextMenu:function(evt){if(!this._contextMenu){this.own(this._contextMenu=new _1a({leftClickToOpen:true,category:"context",popupParent:this}),_2.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_2.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _45=this.inherited(arguments);if(_45.item.contentLink===this.tree.model.rootPage){var _46=_1.filter(_45.domNode.children,function(_47){return _47.className===this._separatorAfterCssClass;},this);}_45.on("onContextMenuClick",_4.hitch(this,function(_48){this._updateGlobalToolbarButtons(_48.node);this.set("_focusNode",_48.node);this._showContextMenu(_48);}));return _45;},getIconClass:function(_49,_4a){var _4b=this.inherited(arguments);if(!_49||!_49.properties||!_49.properties.pageShortcutType){return _4b;}var _4c="";switch(_49.properties.pageShortcutType){case _13.pageShortcutTypes.Shortcut:_4c="epi-iconObjectInternalLink";break;case _13.pageShortcutTypes.External:_4c="epi-iconObjectExternalLink";break;case _13.pageShortcutTypes.Inactive:_4c="epi-iconObjectNoLink";break;case _13.pageShortcutTypes.FetchData:_4c=!_49.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _4c?_4b+" "+_4c:_4b;},enableDrop:function(_4d,_4e){_4d._droppable=_4e;},_showNotificationMessage:function(_4f){var _50=new _e({description:_9.toHTML(_4f)});_50.show();},_onNodeMouseEnter:function(_51,evt){this.inherited(arguments);_51.showContextMenu(true);},_onNodeMouseLeave:function(_52,evt){this.inherited(arguments);_52.showContextMenu(false);}});});