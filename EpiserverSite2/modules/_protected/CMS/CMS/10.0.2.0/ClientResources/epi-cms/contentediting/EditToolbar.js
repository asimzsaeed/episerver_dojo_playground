//>>built
define("epi-cms/contentediting/EditToolbar",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dojo/topic","dojo/when","epi","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_a],{res:_b,_editActionViewModel:null,_commands:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_8;this._commands.revertToPublished.watch("canExecute",_2.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _9();this.own(this._editActionViewModel);},resize:function(_d){this.inherited(arguments);if(_d){_4.toggle(this.domNode,"epi-editToolbarNarrow",_d.w<620);_4.toggle(this.domNode,"epi-editToolbarMedium",_d.w>=620&&_d.w<1000);this._editActionViewModel.set("expanded",_d.w>=1000);this.setItemProperty("autosave","isInNarrowToolbar",_d.w<1000);}},setupChildren:function(_e,_f){var _10=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:_7.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_5.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:_7.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_5.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:_2.hitch(this,function(){this._commands.revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:_7.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit/form/ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-modeButton"},action:function(){if(this.get("state")==="Loading"){return;}this.set("state","Loading");setTimeout(function(){_5.publish("/epi/cms/action/switcheditmode");},0);}}];var _11=_e?_e:[];_10=_f?_f.concat(_10):_10;return this.inherited(arguments,[_11,_10]);},_setContentViewModelAttr:function(_12){this._set("contentViewModel",_12);_6(this.isSetup(),_2.hitch(this,function(){this._updateToolbarItemsModel(_12);}));},_updateToolbarItemsModel:function(_13){this.setItemProperty("autosave","label","");this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _14=_13.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_14.contentLink});var _15="",_16="";if(_13.viewName==="formedit"){this.setItemProperty("editmodeswitch","checked",true);_15=this.res.onpageedit.title;_16=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_15=this.res.formedit.title;_16=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_15);this.setItemProperty("editmodeswitch","label",_16);var _17=this._hasCustomViews(this.viewConfigurations.availableViews);var _18=this._hasBuiltInViews(this.viewConfigurations.availableViews);this.setItemVisibility("editmodeswitch",!_17&&_18&&_14.hasTemplate);this.setItemVisibility("viewselect",_17);this._editActionViewModel.set("dataModel",_13);},_hasCustomViews:function(_19){return _3.filter(_19,function(_1a){return !_1a.hideFromViewMenu&&_1a.key!=="onpageedit"&&_1a.key!=="formedit";}).length;},_hasBuiltInViews:function(_1b){return _3.filter(_1b,function(_1c){return _1c.key==="onpageedit"||_1c.key==="formedit";}).length===2;}});});