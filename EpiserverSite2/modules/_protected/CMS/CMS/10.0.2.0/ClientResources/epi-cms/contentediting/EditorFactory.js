//>>built
define("epi-cms/contentediting/EditorFactory",["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","epi-cms/ApplicationSettings"],function(_1,_2,_3,_4){return _1(null,{defaultWrapperType:null,_registeredEditorWrappers:null,onEditorCreated:function(_5){},onEditorResolved:function(_6,_7){},constructor:function(){var _8=_4.uiDefaults;this._registeredEditorWrappers={};this.defaultWrapperType=(_8&&_8.defaultEditorWrapper)||"floating";},registerEditorWrapper:function(_9,_a,_b){this._registeredEditorWrappers[_9]={wrapperClassType:_a,initializer:_b};},_getWrapperAndEditor:function(_c){var _d=_c.type;var _e=_c.name;var _f=_c.wrapperType;var _10=_c.editorParams||{};var _11=_c.editorWidgetType;if(!_f){if(_c.metadata.customEditorSettings&&_c.metadata.customEditorSettings.uiWrapperType){_f=_c.metadata.customEditorSettings.uiWrapperType;}else{_f=this.defaultWrapperType;}}if(!_11){if(_c.metadata.customEditorSettings&&_c.metadata.customEditorSettings.uiType){_11=_c.metadata.customEditorSettings.uiType;}else{if(_c.metadata.uiType){_11=_c.metadata.uiType;}else{_11="epi/shell/widget/FormContainer";_3.mixin(_10,{metadata:_c.metadata,onFieldCreated:function(_12,_13){}});}}}if(!_11){throw ("Could not resolve editor widget for property: "+_c.name);}if(_c.metadata.customEditorSettings&&_c.metadata.customEditorSettings.uiParams){_3.mixin(_10,_c.metadata.customEditorSettings.uiParams);}var _14=this._registeredEditorWrappers[_f];if(!_14){throw ("No suitable editor wrapper found for type: "+_f);}var _15={wrapperInitializer:_14.initializer,wrapperType:_14.wrapperClassType,editorWidgetType:_11,editorParams:_10};this.onEditorResolved(_15,_c);if(_f){return _15;}throw ("No suitable editor found");},createEditor:function(_16,_17,_18,_19){var def=new _2();var _1a=this._getWrapperAndEditor(_16);var _1b=_1a.wrapperType;var _1c=_1a.editorWidgetType;require([_1b,_1c],_3.hitch(this,function(_1d){var _1e=_19||{};if(_16.metadata){_3.mixin(_1e,_16.metadata.settings);_3.mixin(_1e,_1a.editorParams);_1e.selections=_16.metadata.selections;}var _1f={wrapperType:_1a.wrapperType,editorWidgetType:_1a.editorWidgetType,editorParams:_1e,blockDisplayNode:_17,overlayItem:_1e.overlayItem,property:_16,propertyName:_16.name,propertyDisplayName:_16.metadata.displayName,value:_18,contentModel:_16.contentModel};var _20=new _1d(_1f);var _21=_1a.wrapperInitializer;if(_21){_3.mixin(_1f.editorParams,{parent:_20});_21(_20,_1f);}this.onEditorCreated(_20.getEditorWidget());def.resolve(_20);}));return def;}});});