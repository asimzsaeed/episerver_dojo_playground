//>>built
define("epi-cms/contentediting/FloatingEditorWrapper",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/topic","dijit/focus","epi/dependency","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _2([_a],{formContainerWidgetType:"epi/shell/widget/FormContainer",isOverlayDisabled:true,isUndoDisabled:true,_overlayContainer:null,postCreate:function(){this.inherited(arguments);var _b=this;this.own(_6.subscribe("/epi/shell/context/request",function(_c,_d){if(!_d.contextIdSyncChange){_b.tryToStopEditing(false);_b._destroyDialog();}}),_6.subscribe("/epi/shell/action/changeview",function(){_b._removeEditingFeatures();}));},destroy:function(){this._removeEditingFeatures();this._destroyDialog();this.inherited(arguments);},startEdit:function(_e){_3.mixin(this.editorParams,_e);var _f=this;_f._destroyDialog();return _f._setupDialog().then(function(){_f.own(_4.after(_f._dialog,"onAfterShow",function(){_f._startEdit(_e);_f._onTryToStopWithInvalidValue();}));return _f._dialog.show();});},_createDialog:function(_10){return new _9({title:this.propertyDisplayName,content:_10,duration:350,snapToNode:this.blockDisplayNode,positioner:_8.resolve("epi.shell.layout.PositioningUtility"),showButtonContainer:false});},_setBlockDisplayNodeAttr:function(_11){this.inherited(arguments);var _12=this._dialog;if(_12){_12.set("snapToNode",_11);}},_setupDialog:function(){var _13={};var _14=function(_15,_16){_13[_15]=_16;};var _17=_3.hitch(this,function(_18){for(var _19 in _13){var _1a=_13[_19];_1a.set("parent",this);}_13=null;});var _1b=_3.mixin({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){_3.mixin(_1b,{onFieldCreated:_14,onFormCreated:_17,doLayout:false});}var _1c=new _5();require([this.editorWidgetType],_3.hitch(this,function(_1d){var _1e=new _1d(_1b);this.editorWidget=_1e;var _1f=this._createDialog(_1e);this._handlers=[this.connect(_1f,"onButtonClose",this._onButtonClose),this.connect(_1f,"onCancel",this._onDialogCancel),this.connect(_1f.doneButtonNode,"onClick",this._onButtonClose),this.connect(_1e,"onChange",this._onChange),this.connect(_1e,"onKeyPress","_onEditorKeyPress")];this._dialog=_1f;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}_1c.resolve();}));return _1c.promise;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){_1.forEach(this._handlers,function(_20){_20.remove();});this._handlers=null;if(this._dialog){this._dialog.destroy();this._dialog=null;}if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}},_removeEditingFeatures:function(){var _21=this._dialog;if(_21&&_21.open){_21.hide();}},_onTryToStopWithInvalidValue:function(){_7.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){this.tryToStopEditing(false);}});});