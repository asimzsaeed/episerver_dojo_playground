//>>built
define("epi-cms/contentediting/PseudoContextualCommandDecorator",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_1,_2,_3,_4,_5,_6,_7){return _2(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_8,_9,_a){this._clearContextualCommandHandlers();if(!(_8 instanceof Array)||_8.length<=0||typeof _9!=="object"){return;}this._decorateCommands(_8,_9,_a);},_decorateCommands:function(_b,_c,_d){_1.forEach(_b,function(_e){if(!this._isValidCommand(_e)){return;}if(typeof _d==="function"&&!_d(this._isNormalCommand(_e)?_e.model:_e.get("selectionData"))){return;}this._onAroundCommandExecute(_e,_c);},this);},_onAroundCommandExecute:function(_f,_10){var _11=this;_11._contextualCommandHandlers.push(_4.around(_f,"execute",function(_12){return function(){var _13=_11._decorateCommandBeforeExecute(_f,_10);_12.apply(_f,arguments);_11._restoreCommandAfterExecute(_f,_13);};}));},_decorateCommandBeforeExecute:function(_14,_15){var _16=this._decorateCommand(_14);if(this._isNormalCommand(_14)){_3.mixin(_16,this._decorateNormalCommand(_14,_15));}else{if(_14.isInstanceOf(_7)){_3.mixin(_16,this._decorateSelectionCommand(_14,_15));}}_14.set({canExecute:true,isAvailable:true,createAsLocalAsset:true});return _16;},_decorateCommand:function(_17){var _18={createAsLocalAsset:_17.get("createAsLocalAsset")};_17.isInstanceOf(_6)&&_17.unwatchClipboardChange();_17.isInstanceOf(_7)&&_17.unwatchSelectionChange();return _18;},_decorateNormalCommand:function(_19,_1a){var _1b={model:_19.get("model")};_19.set("model",_1a);return _1b;},_decorateSelectionCommand:function(_1c,_1d){var _1e={data:_1c.get("selectionData")};var _1f=_1c.get("model");if(_1f&&typeof _1f.refreshRoots=="function"){_1c.onRefreshSelection=function(){return _1f.refreshRoots();};}_1c.selection.set("data",[{data:_1d,type:_1c.get("selectionType")}]);return _1e;},_restoreCommandAfterExecute:function(_20,_21){this._restoreCommand(_20,_21);if(this._isNormalCommand(_20)){this._restoreNormalCommand(_20,_21);return;}if(_20.isInstanceOf(_7)){this._restoreSelectionCommand(_20,_21);}},_restoreCommand:function(_22,_23){_22.set("createAsLocalAsset",_23.createAsLocalAsset);_22.isInstanceOf(_6)&&_22.watchClipboardChange();_22.isInstanceOf(_7)&&_22.watchSelectionChange();},_restoreNormalCommand:function(_24,_25){_24.set("model",_25.model);},_restoreSelectionCommand:function(_26,_27){_26.selection.set("data",_27.data);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_1.forEach(this._contextualCommandHandlers,function(_28){typeof _28.remove==="function"&&_28.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_29){return !(_29.isInstanceOf(_7)||_29.isInstanceOf(_6));},_isValidCommand:function(_2a){return !!(_2a&&_2a.isInstanceOf(_5)&&_2a.model);}});});