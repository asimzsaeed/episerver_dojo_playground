//>>built
require({cache:{"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\"\r\n                        data-dojo-attach-point=\"mainButton\"\r\n                        data-dojo-attach-event=\"onClick: _onMainButtonClick\"\r\n                        class=\"epi-button--bold epi-button--full-width\"></button>\r\n            </li>\r\n        </ul>\r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n"}});define("epi-cms/contentediting/PublishMenu",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,on,_a,_b,_c,_d,_e,_f,epi,_10,_11,_12,_13,_14,_15,res){return _2([_d,_f,_11],{templateString:_15,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _12();},modelBindingMap:{commands:["commands"],mainButtonCommand:["mainButtonCommand"],mainButtonSectionVisible:["mainButtonSectionVisible"],lastChangeStatus:["lastChangeStatus"],topInfoSectionVisible:["topInfoSectionVisible"],publishInfoSectionVisible:["publishInfoSectionVisible"],lastPublishedTitle:["lastPublishedTitle"],lastPublishedTitleVisible:["lastPublishedTitleVisible"],lastPublishedText:["lastPublishedText"],lastPublishedViewLinkVisible:["lastPublishedViewLinkVisible"],lastPublishedViewLinkHref:["lastPublishedViewLinkHref"],additionalInfoSectionVisible:["additionalInfoSectionVisible"],additionalInfoText:["additionalInfoText"],typeIdentifier:["typeIdentifier"]},_setCommandsAttr:function(_16){this.focusedChild=null;this.destroyDescendants();this._addCommandsToMenu(_16);this.focusFirstChild();},_setMainButtonCommandAttr:function(_17){this._set("mainButtonCommand",_17);if(_17){this.mainButton.set("label",_17.label);this.mainButton.set("disabled",!_17.get("canExecute"));_7.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_7.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_17.options&&_17.options.mainButtonClass){this._addedMainButtonClass=_17.options.mainButtonClass;_7.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_18){_5.set(this.mainButtonSection,"display",_18?"":"none");_5.set(this.mainButton.domNode,"display",_18?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_19){_5.set(this.topInfoSection,"display",_19?"":"none");},_setPublishInfoSectionVisibleAttr:function(_1a){_5.set(this.publishInfoSection,"display",_1a?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_1b){_5.set(this.lastPublishedTitleNode,"display",_1b?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_1c){_5.set(this.lastPublishedViewLinkNode,"display",_1c?"":"none");},_setLastPublishedViewLinkHrefAttr:function(_1d){_6.set(this.lastPublishedViewLinkNode,"href",_1d);},_setAdditionalInfoSectionVisibleAttr:function(_1e){_5.set(this.additionalInfoSection,"display",_1e?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_1f){var _20=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_21=_20&&_20.downloadUrl,_22=_1f&&_10.getValue(_1f,"actAsAnAsset");if(!_22||!_21){_6.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);_9.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_6.set(this.lastPublishedViewLinkNode,"title",res.download);_9.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",_4.hitch(this,function(e){_3.stop(e);var _23=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_23&&_23.downloadUrl,_24=_23.name;_13.download(url,_24);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(_25,_26,_27){if(_26){this._removeCommandsFromMenu(_4.isArray(_26)?_26:[_26]);}if(_27){this._addCommandsToMenu(_4.isArray(_27)?_27:[_27]);}},_addCommandsToMenu:function(_28){_1.forEach(_28,function(_29){if(_29!==this.model.mainButtonCommand){this._menuBuilder.create(_29,this);}},this);},_removeCommandsFromMenu:function(_2a){var _2b=this.menu.getChildren();_1.forEach(_2a,function(_2c){for(var i=_2b.length-1;i>=0;i--){var _2d=_2b[i];if(_2d._command===_2c){this.removeChild(_2d);break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_7.add(this.mainButton.domNode,"epi-loading");var _2e=_4.hitch(this,function(_2f){if(_2f||this.mainButtonCommand.options&&this.mainButtonCommand.options.resetLabelAfterExecution){this.mainButton.set("label",this.mainButtonCommand.label);}_7.remove(this.mainButton.domNode,"epi-loading");if(this.mainButtonCommand.options&&!this.mainButtonCommand.options.keepMenuOpen){this.onExecute();}}),_30=_4.hitch(this,function(){this.model.set("lastExecutedCommand",this.mainButtonCommand);});_c(this.mainButtonCommand.execute(),function(){return _c(_2e(false),_30);},function(){return _2e();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _31=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_31){this.focusedChild._setSelected(false);return _5.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _32=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _5.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_32){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_33){var _34=_8.getMarginBox(this.domNode),_35=_8.getPadExtents(this.topInfoSection),_36=_8.getMarginBox(this.mainButton.containerNode),_37=_8.getMarginBox(this.containerNode);var _38=Math.max(_36.w+_35.l+_35.r,_34.w);_38=Math.max(_37.w,_38);_33.w=_38;_8.setMarginBox(this.domNode,_33);}});});