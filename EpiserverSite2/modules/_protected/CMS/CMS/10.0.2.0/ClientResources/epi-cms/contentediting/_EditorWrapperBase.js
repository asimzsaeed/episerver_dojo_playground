//>>built
define("epi-cms/contentediting/_EditorWrapperBase",["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/keys","dijit/_Widget","dijit/form/_TextBoxMixin","epi/epi"],function(_1,_2,_3,_4,_5,_6,_7){return _1([_5],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,closeOnViewportClick:true,onStartEdit:function(_8,_9){},onValueChange:function(_a,_b,_c){},onCancel:function(_d){},onStopEdit:function(_e,_f,_10){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,_2.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.remove();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(_11,_12,_13){if(!this.editing){this.set("value",_13);}},startEdit:function(_14){this._startEdit(_14);},_startEdit:function(_15){_2.mixin(this.editorParams,_15);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=_2.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_16){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_16);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=_2.clone(val);},hasBeenEdited:function(){return this.editing&&(!_7.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!_7.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_17){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_17);}else{this.cancel(_17);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){this.set("editing",false);this._removeEditingFeatures();},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===_4.ESCAPE){_3.stop(e);this.cancel();}else{if(e.keyCode===_4.ENTER&&e.target.tagName==="INPUT"){_3.stop(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(!this.editing&&ew&&!_7.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(_18){this.setEditorValue(_18);this._set("value",this.getEditorValue()||_18);},_setBlockDisplayNodeAttr:function(_19){this.blockDisplayNode=null;this._set("blockDisplayNode",_19);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(_2.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName==="INPUT"){_6.selectInputText(this.editorWidget.focusNode);}}),0);}});});