//>>built
define("epi-cms/contentediting/viewmodel/ContentAreaViewModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojox/uuid/generateRandomUuid","epi/dependency","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi-cms/_ContentContextMixin"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _2([_b,_c],{selectedItem:null,postscript:function(){this.inherited(arguments);this.contentTypeService=this.contentTypeService||_7.resolve("epi.cms.ContentTypeService");if(!this._contentTypeStore){var _d=_7.resolve("epi.storeregistry");this._contentTypeStore=_d.get("epi.cms.contenttype");}},addChild:function(_e){if(!(_e instanceof _8)&&!(_e instanceof _9)){var _f=new _8(_e);this.own(_f.watch("roleIdentities",_3.hitch(this,function(){this.emit("changed");})));if(_f.contentGroup){_e=this._groups[_f.contentGroup];if(!_e){_e=this._createGroup(_f.contentGroup);}_e.addChild(_f);}else{_e=_f;}}else{_e.set("contentGroup",null);if(_e instanceof _9){this.own(_e.on("childrenChanged",_3.hitch(this,function(){this._emitChildrenChanged(_e);if(_e.getChildren().length===0){this.removeChild(_e);}})));}else{if(_e instanceof _8){_e.resetRoleIdentities();this.own(_e.watch("roleIdentities",_3.hitch(this,function(){this.emit("changed");})));}}}this.own(_e.on("changed",_3.hitch(this,function(){this.emit("changed");})));this.inherited(arguments);this._handles[_e.id]=_e.on("selected",_3.hitch(this,"set","selectedItem"));},canCreateBlock:function(_10,_11){var _12=this.contentTypeService;return _4([this.getCurrentContext(),this.getCurrentContent()]).then(function(_13){var _14=_13[0],_15=_13[1];if(!_14||!_15){return false;}var _16=_a.isActionAvailable(_15,_a.action.Create,_a.providerCapabilities.Create,true);if(!_16||!_14.capabilities.resourceable||_14.currentMode==="create"||_14.currentMode==="translate"){return false;}return _5(_12.getAcceptedChildTypes(_15.contentLink,true,["episerver.core.blockdata"],_10,_11)).then(function(_17){return !!_17.length;});});},moveVisible:function(_18,_19){var _1a=_1.filter(this.getChildren(),function(_1b){return _1b.get("visible");}),_1c=_19?1:-1,_1d=_1.indexOf(_1a,_18)+_1c,_1e=this.indexOf(_1a[_1d]);this.modify(_3.hitch(this,function(){this.move(_18,_1e);}));},moveOutsideGroup:function(_1f){if(!_1f.contentGroup){return;}var _20=this.getChild({name:_1f.contentGroup}),_21=this.indexOf(_20);this.modify(_3.hitch(this,function(){_20.removeChild(_1f);this.addChild(_1f,_21);}));},personalize:function(_22){var _23=this.indexOf(_22);this.removeChild(_22);var _24=new _9({name:"group_"+Date.now(),expandOnAdd:true});_22.set("ensurePersonalization",true);_24.addChild(_22);this.addChild(_24,_23);},_valueGetter:function(){var _25=[];_1.forEach(this.getChildren(),function(_26){_25=_25.concat(_26.serialize());});return _25;},_valueSetter:function(_27){this._transformValueToModels(_27);},_selectedItemSetter:function(_28){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=_28;},_transformValueToModels:function(_29){this.modify(function(){var _2a=this.getChildren();for(var i=_2a.length-1;i>=0;i--){this.removeChild(_2a[i]);}this._groups={};_1.forEach(_29,function(_2b){var _2c=new _8(_2b);this.own(_2c.watch("roleIdentities",_3.hitch(this,function(){this.emit("changed");})));if(_2c.contentGroup){var _2d=this._groups[_2c.contentGroup];if(!_2d){_2d=this._createGroup(_2c.contentGroup);this.addChild(_2d);}_2d.addChild(_2c,_2d.getChildren().length);}else{this.addChild(_2c);}},this);},this,false);},_createGroup:function(_2e){var _2f=new _9({name:_2e});this._groups[_2e]=_2f;return _2f;},_hash:function(_30){return (_30.contentLink||_30.name)+"_"+_6();}});});