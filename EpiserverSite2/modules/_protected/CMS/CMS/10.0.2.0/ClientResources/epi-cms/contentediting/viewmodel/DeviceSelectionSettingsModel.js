//>>built
define("epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel",["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/topic","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/OptionGroup","epi/i18n!epi/cms/nls/episerver.cms.widget"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1([_3],{resolution:null,channel:null,postscript:function(){this.inherited(arguments);this._updateLabel();if(!this.get("viewSettingsManager")){this.set("viewSettingsManager",_5.resolve("epi.viewsettingsmanager"));}if(!this.get("channelStore")){var _9=_5.resolve("epi.storeregistry");this.set("channelStore",_9.get("epi.cms.displaychannels"));}},_resolutionSetter:function(_a){if(_a!==this.resolution){this.resolution=_a;this._onChange();}},_channelSetter:function(_b){if(_b!==this.channel){this.channel=_b;this.set("resolution",this._getDefaultResolutionForChannel(_b));this._onChange();}},_viewSettingsManagerSetter:function(_c){this.viewSettingsManager=_c;this.set("resolution",_c.getSettingProperty("resolution"));this.set("channel",_c.getSettingProperty("epichannel"));},_channelStoreSetter:function(_d){this.channelStore=_d;this._initialize();},_onChange:function(){this._updateLabel(this.get("resolution"),this.get("channel"));var _e=[{key:"resolution",value:this.get("resolution")},{key:"epichannel",value:this.get("channel")}];_4.publish("/epi/cms/action/viewsettingvaluechanged",_e);},_updateLabel:function(_f,_10){var _11=_8.channelbutton.defaulttooltip;if(_f||_10){_11=_2.replace(_8.channelbutton.tooltip,{channel:this._getOptionLabel(this._availableChannels,_10),resolution:this._getOptionLabel(this._availableResolutions,_f)});}this.set("label",_11);},_getOptionLabel:function(_12,_13){var _14=this._find(_12,function(_15){return _15.value===_13;});return _14&&_14.label||"";},_initialize:function(){this.channelStore.query({query:"getallregistered"}).then(_2.hitch(this,function(_16){this._availableResolutions=this._getAvailableResolutions();this._availableChannels=[{value:null,label:_8.channelselector.defaultitem}].concat(_16.map(function(_17){return {value:_17.channelName,label:_17.name,resolutionId:_17.resolutionId};}));this.set("options",[new _7({property:"channel",model:this,label:_8.channelselector.header,options:this._availableChannels}),new _7({property:"resolution",model:this,label:_8.resolutionselector.header,options:this._availableResolutions})]);}));},_getAvailableResolutions:function(){var _18=[{value:null,label:_8.channelselector.defaultitem}];if(_6.displayResolutions){_18=_18.concat(_6.displayResolutions.map(function(r){return {value:r.width+"x"+r.height,label:r.name,id:r.id};}));}return _18;},_getDefaultResolutionForChannel:function(_19){var _1a=this._availableResolutions;if(!(_19&&_2.isArray(_1a))){return null;}_19=this._find(this._availableChannels,function(c){return c.value===_19;});var _1b=this._find(_1a,function(r){return (r.id===_19.resolutionId);});return _1b?_1b.value:null;},_find:function(_1c,_1d){var _1e=null;if(!_2.isArray(_1c)){return null;}_1c.some(function(_1f){if(_1d(_1f)){_1e=_1f;return true;}});return _1e;}});});