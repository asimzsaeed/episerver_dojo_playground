//>>built
define("epi-cms/contentediting/viewmodel/ItemCollectionViewModel",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin","epi-cms/contentediting/viewmodel/LinkItemModel"],function(_1,_2,_3,_4,_5,_6,_7){return _1([_6],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(_8,_9){_1.safeMixin(this,_9);},postscript:function(_a){require([this.itemModelType],_2.hitch(this,function(_b){this.itemModelClass=_b;this._instanceId=new Date().getTime();this._init(_a);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var _c=this.getItemIndex(this._selectedItem);this._data.splice(_c,1);var _d=this._data.length;this.set("selectedItem",this._data[_c>=_d?_d-1:_c]||null);this.emit("changed");},addTo:function(_e,_f,_10){if(!_e){return false;}if(this.getItemIndex(_e)>=0){this.moveTo(_e,null,false);this.emit("changed");}else{var _11=this;_5(_11._createItemModel(_e),function(_12){if(!_f){_11._data.push(_12);}else{var _13=_11.getItemIndex(_f)+(_10?0:1);_11._data.splice(_13,0,_12);}_11.emit("changed",{uiChanged:false});});}},moveTo:function(_14,_15,_16){if(!_14&&!this._selectedItem){return false;}this.set("selectedItem",_14||this._selectedItem);var _17=this.getItemIndex(this._selectedItem);this._data.splice(_17,1);var _18=(_15?this.getItemIndex(_15):(this._data.length-1))+(_16?0:1);this._data.splice(_18,0,this._selectedItem);this.emit("changed");},updateItemData:function(_19){var _1a=this.getItemIndex(this._selectedItem);if(_1a<0){return;}var _1b=this;_5(_1b._createItemModel(_19),function(_1c){_1b._selectedItem=_1b._data[_1a]=_1c;_1b.emit("changed");});},swap:function(_1d,_1e){if(!this._data[_1d]||!this._data[_1e]){return false;}var _1f=this._data[_1d];this._data[_1d]=this._data[_1e];this._data[_1e]=_1f;return true;},getItemIndex:function(_20){var _21=-1;if(!_20||!(_20 instanceof this.itemModelClass)){return _21;}this._data.some(function(i,o){if(i.id===_20.id){_21=o;return true;}return false;},this);return _21;},_init:function(_22){var _23=this,_24;this.set("selectedItem",null);if(!(_22 instanceof Array)){this._data=[];}else{_24=_22.map(function(_25){return this._createItemModel(_25);},this);_4(_24).then(function(_26){_23._data=_26;_23.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(_27){var _28=this.itemModelClass,id={id:this._generateItemId()},_29,dfd=new _3();if(this.getItemIndex(_27)>=0){return _27;}if(_27 instanceof _28){_29=_2.mixin(_2.clone(_27),id);}else{_29=new _28(_2.mixin(_2.clone(_27),id));}_5(_29.parse(true),function(){dfd.resolve(_29);});return dfd;},_move:function(_2a){var _2b=this.getItemIndex(this._selectedItem);if(_2b<0){return false;}return this.swap(_2b,_2b+_2a);},_canMoveNextGetter:function(){var _2c=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&_2c>=0&&_2c<(this._data.length-1));},_canMovePreviousGetter:function(){var _2d=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&_2d>0&&_2d<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(_2e){return _2e.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(_2f){this._init(_2f);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(_30){this._selectedItem=_30;}});});