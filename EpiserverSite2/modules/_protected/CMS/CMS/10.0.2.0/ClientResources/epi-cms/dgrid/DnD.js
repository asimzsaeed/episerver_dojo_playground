//>>built
define("epi-cms/dgrid/DnD",["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9=_1(_4,{_legalMouseDown:function(_a){var _b=this.inherited(arguments);return _b&&_a.target!==this.grid.bodyNode;},getSelectedNodes:function(){var _c=this.grid;var _d=this.inherited(arguments);if(!_c.selection||Object.keys(_c.selection).length===0){if(_d.length){_c.select(_d[0]);}return _d;}var _e=false;var _f=new _3();for(var id in _c.selection){if(_c.row(id).element!==_d[0]){_f.push(_c.row(id).element);}else{_e=true;_f.push(_d[0]);}}if(_e){return _f;}_c.clearSelection();if(_d.length){_c.select(_d[0]);}return _d;},destroy:function(){this.grid=null;this.inherited(arguments);}});return _1([],{dndSourceTypes:null,dndParams:null,dndConstructor:_9,dndDisabled:false,dndFormatSuffix:null,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},destroy:function(){this.inherited(arguments);this.dndSource&&this.dndSource.destroy();this.dndParams=this.dndSource=null;},insertRow:function(_10){var row=this.inherited(arguments);if(this.dndDisabled){return row;}_8(row,".dojoDndItem");this._setupDnD();var _11={};if(this.query){_11.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_10,type:this._getDndType(_10),options:_11});return row;},_getDndType:function(_12){var _13=_7.getAndConcatenateValues(_12.typeIdentifier,"dndTypes");if((!_13||_13.length<=0)&&this.dndSourceTypes){_13=this.dndSourceTypes;}if(this.dndFormatSuffix){_13=_13.map(_2.hitch(this,function(_14){return _14+"."+this.dndFormatSuffix;}));}return _13;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=_2.hitch(this,this._dndNodeCreator);}this.dndSource=new this.dndConstructor(this.bodyNode,_2.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(_15,_16){var _17,_18;_17=this._getDndType(_15);if(!_17&&this.dndTypes){_17=this.dndTypes;}_18=_5.create("div").appendChild(document.createTextNode(_15.name));return {node:_18,type:_17,data:_15};}});});