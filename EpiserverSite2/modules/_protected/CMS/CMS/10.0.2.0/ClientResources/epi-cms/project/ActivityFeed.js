//>>built
define("epi-cms/project/ActivityFeed",["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/focus","dijit/registry","dgrid/util/misc","epi/dependency","dijit/_WidgetBase","dijit/_CssStateMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","epi-cms/project/Activity","epi-cms/project/ActivityCommentForm"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11){var _12=_1([_e,_f]);return _1([_a,_b,_c,_d],{baseClass:"epi-activity-feed",noDataMessage:"",query:null,queryOptions:null,modelBindingMap:{isSingleItemSelected:["isSingleItemSelected"],query:["query"],noDataMessage:["noDataMessage"]},postMixInProperties:function(){this.inherited(arguments);this.activityService=this.activityService||_9.resolve("epi.cms.ActivityService");this.queryOptions=this.queryOptions||{sort:[{attribute:"created",descending:true}]};},buildRendering:function(){this.inherited(arguments);this.commentForm=new _11({model:this.model});_3.add(this.commentForm.domNode,"epi-card");this.list=new _12({className:"dgrid--centered-no-data-message",cleanEmptyObservers:false,insertRow:this._insertRow,removeRow:this._removeRow,renderRow:this._renderRow.bind(this),keepScrollPosition:true});this.list.bodyNode.tabIndex=0;this.own(this.commentForm,this.model.on("save",this.focus.bind(this)),_2.around(this.list,"resize",this._resizeList.bind(this)));this.commentForm.placeAt(this.list.bodyNode,"first");this.domNode.appendChild(this.list.domNode);this.list.resize();},startup:function(){this.inherited(arguments);this.commentForm.startup();this.list.startup();},focus:function(){_6.focus(this.list.bodyNode);},refresh:function(){this.list.refresh();},_insertRow:function(){var row=this.inherited(arguments),_13=_7.byNode(row);_13.startup();return row;},_removeRow:function(_14,_15){this.inherited(arguments);var _16=_14.element||_14,_17=_7.byNode(_16);if(_17){_17.destroy(_15);}},_renderRow:function(_18){var _19=new _10({activity:_18});_3.add(_19.domNode,"epi-card");return _19.domNode;},_resizeList:function(_1a){return function(){_1a.apply(this.list,arguments);var _1b=this.model.isSingleItemSelected?_4.getMarginBox(this.commentForm.domNode).h:0;_5.set(this.list.contentNode,"height","calc(100% - "+_1b+"px)");}.bind(this);},_setNoDataMessageAttr:function(_1c){this.noDataMessage=_1c;this.list.set("noDataMessage",_1c);},_setQueryAttr:function(_1d){this._set("query",_1d);if(!this._queryFunction){this._queryFunction=_8.debounce(this._setQueryCallback.bind(this),null,200);}this._queryFunction(this.model.store,_1d);},_setQueryCallback:function(_1e,_1f){if(this._destroyed){return;}var _20=this.model.isSingleItemSelected;_3.toggle(this.domNode,"epi-activity-feed--single-item",_20);_3.toggle(this.commentForm.domNode,"dijitHidden",!_20);this.list.set("store",_1e,_1f,this.queryOptions);this.list.resize();}});});