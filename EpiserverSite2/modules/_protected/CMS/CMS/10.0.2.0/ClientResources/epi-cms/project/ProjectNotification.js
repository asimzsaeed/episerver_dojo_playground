//>>built
require({cache:{"url:epi-cms/project/templates/ProjectNotification.html":"<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon epi-iconProject\"></span>\n<span class=\"dijitReset dijitInline epi-project-notification__content\">{partOfProject}</span>"}});define("epi-cms/project/ProjectNotification",["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/Stateful","dojox/html/entities","epi/dependency","epi/shell/DestroyableByKey","epi-cms/ApplicationSettings","epi-cms/contentediting/command/CreateDraft","epi-cms/core/ContentReference","dojo/text!./templates/ProjectNotification.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.notifications"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_4,_7],{_projectService:null,_createDraftCommand:null,constructor:function(_d,_e){this._projectService=_e||_6.resolve("epi.cms.ProjectService");this._createDraftCommand=new _9({ignoreContentStatus:true});this.own(this._projectService.on("project-item-updated",_2.hitch(this,this._onItemUpdated)),this._projectService.on("project-item-removed",_2.hitch(this,this._onItemRemoved)),this._projectService.on("project-updated",function(){this._onModelChanged(this.value);}.bind(this)));},_valueSetter:function(_f){this.value=_f;if(!_f||!_f.contentLink){this.set("model",null);this._currentProjectItemId=0;return;}this._createDraftCommand.set("model",_f);var _10="contentLinkWatch";this.destroyByKey(_10);this.ownByKey(_10,_f.watch("contentLink",_2.hitch(this,"_onModelChanged",_f)));this._onModelChanged(_f);},_onItemUpdated:function(_11){this._onItemsAddedOrRemoved(_11.id);},_onItemRemoved:function(id){this._onItemsAddedOrRemoved(id);},_onItemsAddedOrRemoved:function(_12){if(!this.model){return;}if(this._currentProjectItemId===_12){this._updateNotification(this.model.contentLink);}},_onModelChanged:function(_13){if(_13.get("isSuspended")){return;}this._projectService.getProjectItemForContent(_13.contentLink).then(function(_14){var _15=_13.languageContext,_16=_15&&_15.isTranslationNeeded&&_8.currentContentLanguage===_15.preferredLanguage;this.set("model",_13);this._currentProjectItemId=_14&&_14.id||0;this._updateNotification(_13.contentLink,_13.contentData.isPartOfAnotherProject,_16);}.bind(this)).otherwise(function(){this._currentProjectItemId=0;}.bind(this));},_updateNotification:function(_17,_18,_19){var _1a=this;_3([this._projectService.getProjectsForContent(_17),this._projectService.getCurrentProject()]).then(function(_1b){var _1c=_1b[0],_1d=_1b[1];if(_1c.length===0){_1a.set("notification",null);return;}var _1e=_1c.map(function(_1f){return _5.encode(_1f.name);}).join(", ");var _20="";if(_18){_20=_c.partofanotherproject+": "+_1e;}else{if(_1d){_20=_c.partofcurrentproject;}else{_20=_c.partofproject+": "+_1e;}}var _21=_2.replace(_b,{partOfProject:_20});var _22=_18&&_1a._projectService.isProjectModeEnabled&&!_19?[_1a._createDraftCommand]:[];_1a.set("notification",{content:_21,commands:_22});});}});});