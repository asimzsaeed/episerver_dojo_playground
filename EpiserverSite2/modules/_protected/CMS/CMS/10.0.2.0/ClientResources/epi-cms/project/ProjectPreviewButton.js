//>>built
define("epi-cms/project/ProjectPreviewButton",["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/topic","epi/dependency","epi/i18n!epi/nls/episerver.cms.components.project.preview","epi/shell/widget/DeferredDropDownButton","epi-cms/project/ProjectSelectorList"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_8],{iconClass:"epi-icon--medium epi-iconProject",baseClass:"",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_6.resolve("epi.storeregistry").get("epi.cms.project");},buildRendering:function(){this.inherited(arguments);_3.add(this.domNode,["epi-chromeless","epi-mediumButton"]);if(!this.dropDown){this.dropDown=new _9({baseClass:"dijitMenu",enableDefaultValue:true,defaultValueText:_7.defaultoption,store:this.store,header:_7.header});}},postCreate:function(){this.inherited(arguments);var _a=this,_b=_6.resolve("epi.viewsettingsmanager").getSettingProperty("project"),_c=_b?this.store.get(parseInt(_b)):new _4().resolve();_c.then(function(_d){_a.dropDown.set("selectedProject",_d);_a._updateButtonState(_d);}).always(function(){_a.own(_a.dropDown.watch("selectedProject",_2.hitch(_a,"_selectedProjectChanged")));});},loadAndOpenDropDown:function(){if(this.isLoaded()){return this.inherited(arguments).then(_2.hitch(this,function(){return this.dropDown.refresh();}));}return this.inherited(arguments);},_selectedProjectChanged:function(_e,_f,_10){var _11=_10?_10.id:null;_5.publish("/epi/cms/action/viewsettingvaluechanged","project",_11);this._updateButtonState(_10);},_updateButtonState:function(_12){var _13=_7.defaulttooltip;if(_12){_13=_2.replace(_7.tooltip,{project:_12.name});}this.set("title",_13);_3.toggle(this.iconNode,"epi-icon--active",!!_12);}});});