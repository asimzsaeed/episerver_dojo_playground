//>>built
define("epi-cms/project/viewmodels/_ActivityViewModel",["dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/regexp","dojo/when","dojox/html/entities","epi/dependency","epi/string","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.notification.autocomplete"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_9],{activityService:null,editLabel:_b.edit,sendLabel:_b.post,resetLabel:_b.cancel,errorMessage:"",isEditEnabled:true,readOnly:true,hideOnPost:true,placeholderText:"",noNotificationUserMessage:_c.nodatamessage,notificationUserStore:null,postscript:function(){this.inherited(arguments);this.activityService=this.activityService||_7.resolve("epi.cms.ActivityService");this.profile=this.profile||_7.resolve("epi.shell.Profile");this.notificationUserStore=this.notificationUserStore||_7.resolve("epi.storeregistry").get("epi.cms.notification.users");},save:function(_d){var _e=this._save(_d);_e.otherwise(this._handleError.bind(this));return _e;},_save:function(_f){},_handleError:function(){this.set("errorMessage",_a.errormessage);},_isEditEnabledGetter:function(){if(this.message){return (this.author||this.changedBy)===this.profile.userName;}return this.isEditEnabled;},_messageSetter:function(_10){this.message=_10;this._changeAttrValue("formattedMessage",this.get("formattedMessage"));},_formattedMessageGetter:function(){var _11=this.message;var map=_6.html;_11=_11&&_6.encode(_11,map);_11=_11&&_11.replace(/(\\n)/ig,"");if(!_11||!this.notificationUserStore){return new _2().resolve(_8.toHTML(_11));}var _12=/\B@([^\s":;|=,+*?<>[\]\/\\]+)/g,_13=_11.match(_12)||[],_14={},_15=_13.map(function(_16){var _17=_16.replace(/^@/,""),_18=encodeURIComponent(_17);return _5(this.notificationUserStore.get(_18)).then(function(_19){_14[_17]=_19.displayName;}).otherwise(function(){});}.bind(this));return _3(_15).then(function(){_11=_11.replace(_12,function(_1a,key){return _14[key]?"<strong>"+_8.encodeForWebString(_14[key])+"</strong>":_1a;});return _8.toHTML(_11);});}});});