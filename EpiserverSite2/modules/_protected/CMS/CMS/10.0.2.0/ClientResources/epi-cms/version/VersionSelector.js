//>>built
require({cache:{"url:epi-cms/version/template/VersionSelector.html":"<div>\n    <div data-dojo-attach-point=\"languageSelectorContainer\" class=\"epi-flatToolbar\">\n        <select data-dojo-attach-point=\"languageSelector\" data-dojo-type=\"epi-cms/version/LanguageSelector\" class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\"></select>\n    </div>\n    <div data-dojo-attach-point=\"gridNode\" class=\"epi-plain-grid epi-grid-max-height--300\"></div>\n</div>\n"}});define("epi-cms/version/VersionSelector",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi-cms/core/ContentReference","dojo/text!./template/VersionSelector.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/extensions/ColumnHider","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","epi-cms/dgrid/formatters","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","epi/shell/widget/_FocusableMixin","epi-cms/version/LanguageSelector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17){return _1([_13,_14,_15,_16,_17],{baseClass:"epi-version-selector",templateString:_8,contentLink:null,markedContentLink:null,languages:null,store:null,region:null,buildRendering:function(){this.inherited(arguments);this.grid=new (_1([_a,_b,_c,_d,_10,_f,_e]))({columns:{selector:{label:"",formatter:function(){return _11.icon("epi-iconCheckmark");},sortable:false},icon:{label:"",formatter:function(){return _11.icon("");},sortable:false},language:{label:_9.language,sortable:false},status:{label:_9.status,renderCell:_12.commonDraft},savedDate:{label:_9.saved,formatter:_12.localizedDate,className:"epi-grid--30"},savedBy:{label:_9.by,formatter:_12.userName,sortable:false}},cellNavigation:false,selectionEvents:"click",selectionMode:"exclusive",sort:[{attribute:"savedDate",descending:true}]},this.gridNode);this.own(this.grid,this.grid.on("dgrid-refresh-complete",_3.hitch(this,"_refreshComplete")),this.grid.on("dgrid-select",_3.hitch(this,"_versionSelected")),_4.around(this.grid,"renderRow",_3.hitch(this,"_renderRow")),this.languageSelector.watch("value",_3.hitch(this,"_updateFilter")),this.on("keydown",_3.hitch(this,"_onKeydown")));},startup:function(){if(this._started){return;}this.inherited(arguments);this.grid.startup();this.grid.set("store",this.store,{contentLink:this.contentLink});},resize:function(){this.inherited(arguments);this.grid.resize();},refresh:function(){if(this._started){this.grid.refresh();}},_setContentLinkAttr:function(_18){if(this.contentLink===_18){return;}if(this._started&&!_7.compareIgnoreVersion(this.contentLink,_18)){this.languageSelector.set("value",this.languageSelector.defaultOption.value);this.grid.set("query",{contentLink:_18});}this.contentLink=_18;this.grid.clearSelection();this.grid.select(_18);},_setCurrentLanguageAttr:function(_19){this._set("currentLanguage",_19);this.languageSelector.set("currentLanguage",_19);},_setLanguagesAttr:function(_1a){this._set("languages",_1a);this.languageSelector.set("languages",_1a);var _1b=_1a&&_1a.length;this.languageSelector.set("disabled",!_1b);_5.toggle(this.languageSelectorContainer,"dijitHidden",!_1b);this.grid.toggleColumnHiddenState("language",!_1b);},_setMarkedContentLinkAttr:function(_1c){var row=this._getRowElement(this.markedContentLink);if(row){_5.remove(row,"dgrid-row--marked");}row=this._getRowElement(_1c);if(row){_5.add(row,"dgrid-row--marked");}this.markedContentLink=_1c;},_setRegionAttr:function(_1d){var _1e=this.baseClass+"--"+_1d,_1f=this.baseClass+"--"+this.region;this.region=_1d;_5.replace(this.domNode,_1e,_1f);},_refreshComplete:function(){this.grid.select(this.contentLink);this.emit("loaded");},_versionSelected:function(e){if(e.parentType){var _20=e.rows&&e.rows[0].data;this.contentLink=_20.contentLink;this.emit("change",{version:_20});}},_renderRow:function(_21){var _22=this;return function(_23){var row=_21.apply(this,arguments);if(_23.contentLink===_22.markedContentLink){_5.add(row,"dgrid-row--marked");}return row;};},_getRowElement:function(_24){if(_24){return this.grid.row(_24).element;}},_updateFilter:function(_25,_26,_27){if(this._started){if(_27!==this.languageSelector.defaultOption.value){this.grid.set("query",{contentLink:this.contentLink,language:_27});}else{this.grid.set("query",{contentLink:this.contentLink});}}this.refresh();},_onKeydown:function(evt){if(evt.ctrlKey||evt.altKey||evt.keyCode!==_6.TAB){return;}if(evt.shiftKey){this.focusPrev();}else{this.focusNext();}_2.stop(evt);}});});