//>>built
define("epi-cms/visitorgroups/command/VisitorGroupViewSettingsModel",["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_4,_6],{selectedGroup:null,tooltip:_8.defaulttooltip,defaultItem:{value:null,label:_9.defaultitem},options:[],postscript:function(){this.inherited(arguments);if(!this._store){var _a=_7.resolve("epi.storeregistry");this._store=_a.get("epi.cms.visitorgroup");}if(!this._viewSettingsManager){this._viewSettingsManager=_7.resolve("epi.viewsettingsmanager");}var _b=this._viewSettingsManager.getSettingProperty("visitorgroup");var _c=this;_5(this._store.query()).then(function(_d){if(!(_d instanceof Array)){_d=[];}var _e=_d.map(function(_f){return {label:_f.name,value:_f.id};});_e.unshift(_c.defaultItem);_c.set("options",_e);_c.set("selectedGroup",_b,false);});},_selectedGroupSetter:function(_10,_11){if(this.selectedGroup===_10){return;}this.selectedGroup=_10;this._setTooltip();if(_11===false){return;}_3.publish("/epi/cms/action/viewsettingvaluechanged","visitorgroup",this.selectedGroup);},_setTooltip:function(){var _12=this._getGroup(this.selectedGroup);if(_12){this.set("tooltip",_2.replace(_8.tooltip,{visitorgroup:_12.label}));}else{this.set("tooltip",_8.defaulttooltip);}},_getGroup:function(id){if(id===this.defaultItem.value){return null;}for(var idx in this.options){if(this.options[idx].value===id){return this.options[idx];}}return null;}});});