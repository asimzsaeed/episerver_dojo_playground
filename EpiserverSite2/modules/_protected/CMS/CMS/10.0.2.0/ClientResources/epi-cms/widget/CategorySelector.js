//>>built
require({cache:{"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>"}});define("epi-cms/widget/CategorySelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/dependency","epi/epi","epi/shell/widget/dialog/Dialog","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,epi,_13,_14,res){return _2([_b,_a,_c,_f,_11],{templateString:_14,localization:res,multiple:true,value:null,store:null,_categories:null,_categoriesParentsName:{},onChange:function(_15){},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _16=_12.resolve("epi.storeregistry");this.store=_16.get("epi.cms.category");}},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(_17){if(!_3.isArray(_17)){_17=[_17];}var _18=_1.filter(_17,function(v){return !!v;});this._setValueAndFireOnChange(_18);if(_18.length>0){this._set("value",_18);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(_19){if(epi.areEqual(this._categories,_19)){return;}this._categories=_19;this.onChange(this._categories);this._updateDisplayNode();},_getValueAttr:function(){return this._categories;},_setReadOnlyAttr:function(_1a){this._set("readOnly",_1a);_8.set(this.button.domNode,"display",_1a?"none":"");_6.toggle(this.domNode,"dijitReadOnly",_1a);},focus:function(){this.button.focus();},_createCategoryButton:function(_1b){if(_9("div[data-epi-category-id="+_1b.id+"]",this.categoriesGroupContainer).length!==0){return;}var _1c=_7.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _1d=_7.create("div",{"class":"dijitInline epi-resourceName"});var _1e=_7.create("div",{"class":"dojoxEllipsis",innerHTML:_1b.description});_7.place(_1e,_1d);_7.place(_1d,_1c);this._tooltip=new _e({connectId:_1e,label:this._getCategoryPath(_1b)});var _1f=_7.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_5.set(_1f,"data-epi-category-id",_1b.id);var _20=_1f.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_1f,_20,_3.hitch(this,this._onRemoveClick));_7.place(_1f,_1d);}else{_7.place(_7.create("span",{innerHTML:"&nbsp;"}),_1d);}_7.place(_1c,this.categoriesGroupContainer);},_getCategoryPath:function(_21){if(!_21.parentsNameCollection||_21.parentsNameCollection.length===1){return "";}var _22=_21.parentsNameCollection[1];for(var i=2;i<_21.parentsNameCollection.length;i++){_22=_22+"/"+_21.parentsNameCollection[i];}return _22;},_createNoCategoriesChosenSpan:function(){_7.create("div",{innerHTML:this.localization.nocategorieschosen,"class":"epi-categoriesGroup__message"},this.categoriesGroupContainer,"only");},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";if(!this._categories||this._categories.length===0){this._createNoCategoriesChosenSpan();return;}this._categoriesParentsName={};var _23=[];this._categories.forEach(function(_24){_23.push(this.store.refresh(_24));},this);this._updateDisplayPromise=_4(_23).then(_3.hitch(this,function(_25){this._updateDisplayPromise=null;_25.forEach(function(_26){if(_26&&_26.visible){this._categoriesParentsName[_26.id]=_26.parentsNameCollection;this._createCategoryButton(_26);}else{var _27=this._categories.indexOf(_26.id);if(_27!==-1){this._categories.splice(_27,1);}}if(this._categories.length===0){this._createNoCategoriesChosenSpan();}},this);}));},_onRemoveClick:function(arg){if(!this._categories){return;}var _28=parseInt(_5.get(arg.target,"data-epi-category-id"),10);var _29=this._categories.indexOf(_28);if(_29===-1){return;}var _2a=_3.clone(this._categories);_2a.splice(_29,1);this.set("value",_2a);},_getCategoriesParentsNameClone:function(){var _2b={};_1.forEach(this._categories,_3.hitch(this,function(_2c){_2b[_2c]=this._categoriesParentsName[_2c];}));return _2b;},_onShow:function(){this.categorySelectorDialog.set("value",_3.clone(this._categories));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _2d=this.categorySelectorDialog.get("value");this.set("value",_2d);},_isEmptyArray:function(_2e){return !_2e||_2e.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _10({rootCategory:this.root});this.dialog=new _13({title:this.localization.popuptitle,content:this.categorySelectorDialog,destroyOnHide:false,dialogClass:"epi-dialog-portrait"});this.own(this.dialog);this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});