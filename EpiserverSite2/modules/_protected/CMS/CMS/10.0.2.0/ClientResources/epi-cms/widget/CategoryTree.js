//>>built
define("epi-cms/widget/CategoryTree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(_1,_2,_3,_4,_5,_6,_7){return _2([_4],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _7({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",_3.hitch(this,this._onNodeOpen));this.connect(this,"onClose",_3.hitch(this,this._onNodeClose));this.watch("selectedNodeData",_3.hitch(this,this._loadSelectedNodes));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(_8){return new _6(_8);},getTooltip:function(_9){var _a=this.model.getTooltip||this.model.getLabel;return _a?_a(_9):this.inherited(arguments);},getNodeById:function(_b){var _c=this.getNodesByItem(_b.toString());if(!_c){return null;}return _c[0];},_getTotalSelectedNodes:function(_d,_e,_f){if(!_d||!_d.item||!_d.item.hasChildren||!_3.isArray(_e)||_e.length===0||!_f){return 0;}var _10=0,_11=[],_12=[],_13=_3.clone(_d.item.parentsNameCollection);var _14=function(_15){if(_3.isArray(_15)&&_15.length>0){_15.pop();}};_13[_13.length-1]=_d.item.name;_1.forEach(_e,function(_16){_11=_3.clone(_f[_16]);_14(_11);_12=_3.clone(_11);_3.mixin(_12,_13);if(_3.isArray(_11)&&_5.areEqual(_11,_12)){_10++;}},this);return _10;},_setTotalSelectedNodes:function(_17){if(_17){_17.set("totalSelectedNodes",this._getTotalSelectedNodes(_17,this.selectedNodeIds,this.selectedNodeData));_1.forEach(_17.getChildren(),function(_18){if(_18&&_18.item&&_18.item.hasChildren){if(_18.isExpanded){this._setTotalSelectedNodes(_18);}else{_18.set("totalSelectedNodes",this._getTotalSelectedNodes(_18,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(_3.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(_19){_19.set("totalSelectedNodes",this._getTotalSelectedNodes(_19,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_1a,_1b){if(!this.getNodeById(_1b.id)){return;}var _1c=this.selectedNodeIds.indexOf(_1b.id),_1d=_1c!==-1;if(_1a&&!_1d){this.selectedNodeIds.push(_1b.id);this.selectedNodeData[_1b.id]=_1b.parentsNameCollection;}if(!_1a&&_1d){this.selectedNodeIds.splice(_1c,1);this.selectedNodeData[_1b.id]={};}},_onNodeOpen:function(_1e,_1f){this.set("toggleSelectNodes",_1f,this.selectedNodeIds);this._setTotalSelectedNodes(_1f);},_onNodeClose:function(_20,_21){this._setTotalSelectedNodes(_21);},_setToggleSelectNodesAttr:function(_22,_23){if(!_22||!_3.isArray(_23)){return;}var _24=false;_1.forEach(_22.getChildren(),function(_25){if(_25){_24=_23.indexOf(_25.item.id)!==-1;_25.set("checked",_24);if(_25.hasChildren()){this.set("toggleSelectNodes",_25,_23);}}},this);},_createTreeNode:function(_26){var _27=this.buildNodeFromTemplate(_26);_27.connect(_27,"onNodeSelectChanged",_3.hitch(this,function(_28,_29){this._onNodeSelectChanged(_28,_29);}));this._onNodeCreated(_27);return _27;}});});