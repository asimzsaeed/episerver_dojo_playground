//>>built
require({cache:{"url:epi-cms/widget/templates/_HyperLinkLanguageField.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\n    <label for=\"${id}\">${language}</label>\n</div>"}});define("epi-cms/widget/HyperLinkSelector",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/when","dojo/promise/all","dojo/string","dijit/_Widget","dijit/_Container","epi/dependency","epi/Url","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/contentediting/editors/SelectionEditor","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel","epi-cms/form/EmailValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","dojo/text!./templates/_HyperLinkLanguageField.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15){return _2([_b,_c,_f],{value:null,showLanguageSelector:true,_hasBeenBlurred:false,modelClassName:_12,modelBindingMap:{wrapperSettings:["wrapperSettings"],selectedWrapper:["selectedWrapper"]},_languageSelector:null,_languageSelectorWrapperNode:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _16=_2(this.modelClassName);this.model=new _16({providers:this.providers});}this._languageStore=this._languageStore||_d.resolve("epi.storeregistry").get("epi.cms.language");},buildRendering:function(){this.inherited(arguments);this._createLanguageSelector();},startup:function(){this.inherited(arguments);this._languageSelector.startup();var _17=this,_18=this._languageSelector;_8(this._languageStore.get(),function(_19){if(_17.get("showLanguageSelector")){if(_19.length<=1){_17._toggleLanguageSelector(false);}else{_17._toggleLanguageSelector(true);}}var _1a=_19.map(function(_1b){return {text:_1b.name,value:_1b.languageId};});_1a.splice(0,0,{text:_14.automaticlanguage,value:""});_18.set("selections",_1a);_18.set("value","");_17._createInputWrappers();});},onSelectorsCreated:function(_1c){},_setShowLanguageSelectorAttr:function(_1d){this._set("showLanguageSelector",_1d);this._toggleLanguageSelector(_1d);},_setSelectedWrapperAttr:function(_1e){if(!_1e){return;}_1.forEach(this.wrappers,function(_1f){_1f.set("selected",false);});_1e.set("selected",true);var _20=true;if(_1e.settings.isContentLink){_20=false;}this._languageSelector.set("disabled",_20);},_createLanguageSelector:function(){this.own(this._languageSelector=new _11());this._languageSelectorWrapperNode=_7.toDom(_a.substitute(_15,{id:this._languageSelector.id,language:_14.language}));_7.place(this._languageSelectorWrapperNode,this.domNode,"first");this._languageSelector.placeAt(this._languageSelectorWrapperNode,"last");},_toggleLanguageSelector:function(_21){_6.toggle(this._languageSelectorWrapperNode,"dijitHidden",!_21);},_createInputWrappers:function(){var _22=this.model.wrapperSettings,_23=[],_24=this;_22.forEach(function(_25){var def=new _4();_23.push(def.promise);require([_25.widgetType],function(_26){var _27=new _10(_3.mixin(_25,{groupName:_25.groupName+this.id,inputWidgetCtor:_26,required:_24.required}));_24.own(_27.on("radioButtonChange",_3.hitch(this,function(){_24.set("selectedWrapper",_27);_27.focus();})));if(_25.invisible){_5.set(_27.domNode,{display:"none"});}def.resolve(_27);});},this);_8(_9(_23),function(_28){if(_28.length===0){return;}_28.forEach(function(_29){_24.addChild(_29);});_24.set("wrappers",_28);var _2a=_24.get("value");if(_2a){_24._setValueForWidgets(_2a);}else{_24.set("selectedWrapper",_28[0]);}_24.onSelectorsCreated(_24);});},_getSelectedWrapper:function(){return _1.filter(this.wrappers,function(_2b){return _2b.get("selected");})[0];},_getValueAttr:function(){var _2c=this._getSelectedWrapper();if(_2c){if(_2c.inputWidget&&_2c.settings.isContentLink){return this.model.getUrlValue(_2c.inputWidget.get("permanentLink"),this._languageSelector.get("value"),this.value);}else{return _2c.get("value");}}return this.value;},_setValueAttr:function(_2d){this._set("value",_2d);this._setValueForWidgets(_2d);},_setValueForWidgets:function(_2e){var _2f=this.get("wrappers");if(!_2f){return;}_1.forEach(_2f,function(_30){_30.set("value",null);});if(!_2e){return;}var url=new _e(this.value);this._languageSelector.set("value",url.getQueryParameterValue("epslanguage"));_8(this.model.getContentData(_2e),_3.hitch(this,function(_31){if(_31){_1.every(_2f,function(_32){if(_32&&_32.settings.isContentLink){if(_1.some(_32.settings.allowedTypes,_3.hitch(this,function(_33){return this.model.isBaseTypeIdentifier(_31.typeIdentifier,_33);}))){_32.set("value",_31.contentLink);this.set("selectedWrapper",_32);return false;}}return true;},this);}else{_1.every(_2f,function(_34){if(_34&&!_34.settings.isContentLink){var _35=_34.inputWidget;if(_35&&this._isValidEditorWidget(_2e,_35)&&_35.validator(_2e,_35.constraints)){_34.set("value",_2e);this.set("selectedWrapper",_34);return false;}}return true;},this);}}));},_isValidEditorWidget:function(_36,_37){if(_37 instanceof _13){return _e(_36).scheme==="mailto";}return true;},validate:function(){var _38=this._getSelectedWrapper();if(_38){_38._hasBeenBlurred=this._hasBeenBlurred;return _38.validate();}return false;},focus:function(){var _39=this._getSelectedWrapper();if(_39){_39.focus();}},reset:function(){this._hasBeenBlurred=false;this.set("value",null);}});});