//>>built
require({cache:{"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n        <span class=\"epi-removedByContainer\">\r\n            <label for=\"removedBy_${id}\">${resources.removedby}</label>\r\n            <select data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"removedBy\" id=\"removedBy_${id}\" data-dojo-attach-event='onChange: _onDeletedByChange'>\r\n            </select>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>"}});define("epi-cms/widget/TrashItemList",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,put,epi,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24,_25){return _2([_11,_12,_13,_b,_e,_21],{resources:_24,epi:epi,templateString:_25,_grid:null,_observers:{},_setQueryOptionsAttr:function(_26){this._set("queryOptions",_26);this._initialize();},updateRemovedBy:function(_27){var _28=this.model.get("currentTrash");if(this.model.isEmptyTrash){this.bindDefaultUserSelector();return;}var _29=this.store.query({referenceId:_27.query.referenceId,query:"getblockrootchildren"});var _2a=_3.hitch(this,function(_2b,_2c,_2d){var _2e=_28.isDefaultProvider?"":_28.name;_10(this.model.trashStore.query({providerName:_2e}),_3.hitch(this,function(_2f){if(_2f){var _30=_2f.deletedByUsers;_28.deletedByUsers=_30;this.bindUserSelector(_30);}}));});var id=_28.name,_31=this._observers[id];if(_31){_31.cancel();delete this._observers[id];}this._observers[id]=_29.observe(_2a,true);},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.bindUserSelector(this.model.get("currentTrash").deletedByUsers);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",_3.hitch(this,function(_32){this.emit("searchBoxChange",_32);}));this.removedBy._updateSelection=function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!_3.isArray(val)){val=[val];}_1.forEach(this._getChildren(),function(_33){var _34=_1.some(val,function(v){return _33.option&&(v===_33.option.value);});_5.toggle(_33.domNode,this.baseClass+"SelectedOption",_34);_33.domNode.setAttribute("aria-selected",_34);},this);};},resize:function(){if(this._grid){var top=_7.position(this._grid.domNode).y;var _35=_7.position(_4.body()).h;_8.set(this._grid.domNode,"height",(_35-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_6.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},bindDefaultUserSelector:function(){this.removedBy._onChangeActive=false;this.removedBy.removeOption(this.removedBy.options);this.removedBy.addOption({label:epi.resources.text.anyone,value:""});this.removedBy._onChangeActive=true;},bindUserSelector:function(_36){if(_36){var _37=this.removedBy.get("value");this.bindDefaultUserSelector();this.removedBy._onChangeActive=false;_1.forEach(_36,function(_38){this.removedBy.addOption({label:this._createUserFriendlyUsername(_38),value:_38});},this);this.removedBy.set("value",_37);this.removedBy._onChangeActive=true;}},_createGrid:function(_39,_3a){var _3b=_2([_16,_17,_18,_1d,_1a]);var _3c=new _3b({store:_39,columns:{name:_19({field:"name",label:epi.resources.header.name,renderCell:_3.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_1e.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_1e.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _15({target:_3c.domNode,color:"#fff"}).placeAt(document.body);this._standby.startup();this.own(_9.after(_3c,"expand",function(_3d){var row=_3d.element?_3d:_3c.row(_3d),_3e=_c(row.element).parent()[0];if(_3e){_8.set(_3e,"height","");}},true));_9.after(_3c,"_processScroll",_3.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_9.before(_3c,"adjustRowIndices",function(_3f){if(_3f){_1.forEach(_c("div.dgrid-no-data",this.contentNode),function(div){_d.set(div,"");});}});_9.around(_3c,"insertRow",_3.hitch(this,this._aroundInsertRow));_9.before(_3c,"renderArray",_3.hitch(this,function(_40,_41,_42){var _43=this.queryOptions.query;if(_43&&_43.query==="searchdeletedcontent"){_40.map(function(_44){if(_44){_44.hasChildren=false;}});}}));if(_3a){_3c.set("queryOptions",_3a.options);_3c.set("query",_3a.query);}var _45="epi-dgrid-mouseover";_3c.on(_1b.enterRow,function(evt){_5.add(this,_45);});_3c.on(_1b.leaveRow,function(evt){_5.remove(this,_45);});_3c.on(".epi-gridAction:click",_3.hitch(this,function(evt){var row=_3c.row(evt);this.emit("itemClick",row);}));_3c.on(".dgrid-column-action:keydown",_3.hitch(this,function(e){if(e.keyCode===_a.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=_3c.row(e);this.emit("itemClick",row);}}));return _3c;},_renderTreeNode:function(_46,_47,td,_48){if(_46&&_46.thumbnailUrl){var _49=_6.create("img",{src:_46.thumbnailUrl+_f.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_6.place(_1e.ellipsis(_1e.htmlEncode(_47)),td);}else{var _4a=_1f.getValue(_46.typeIdentifier,"iconClass")||"epi-iconObjectPage";_6.place(_1e.icon(_4a+" epi-objectIcon",_1e.ellipsis(_1e.htmlEncode(_47))),td);}},_renderActionMenu:function(_4b){var _4c={title:_24.restore.tooltip,label:_24.restore.label};return _3.replace("<a class=\"epi-gridAction epi-visibleLink\" title=\"{title}\">{label}</a>",_4c);},_localizeDate:function(_4d){return _22.toUserFriendlyString(_4d);},_createUserFriendlyUsername:function(_4e){return _23.toUserFriendlyString(_1e.htmlEncode(_4e));},_onDeletedByChange:function(_4f){if(this.model.isEmptyTrash){this.model.isEmptyTrash=false;return;}this.emit("deletedByChange",_4f);},_showStandby:function(_50){if(!this._standby){return;}if(_50){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_24.trashitemempty+"</span></span>";},_aroundInsertRow:function(_51){return _3.hitch(this,function(_52,_53,_54,i,_55){var row=_51.apply(this._grid,arguments);if(_52&&_52.thumbnailUrl){_5.add(row,"epi-mediaContent");}return row;});}});});