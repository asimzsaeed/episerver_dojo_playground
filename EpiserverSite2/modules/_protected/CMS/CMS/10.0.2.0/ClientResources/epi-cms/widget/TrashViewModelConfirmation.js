//>>built
define("epi-cms/widget/TrashViewModelConfirmation",["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/dialog/Confirmation","epi/shell/widget/dialog/Alert","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return function(_10){var _11=function(_12,_13,_14){var _15=new _3();var _16=new _b({description:_8.toHTML(_13),title:_8.toHTML(_12),onAction:function(_17){_17?_15.resolve(_14):_15.cancel();}});_16.show();return _15;};var _18=function(_19,_1a,_1b){var _1c=function(_1d){var _1e=_7.resolve("epi.cms.contentRepositoryDescriptors");var _1f=[];for(var key in _1e){_1e[key].containedTypes.forEach(function(_20){if(_9.isBaseTypeIdentifier(_1d.typeIdentifier,_20)){_1f=_1f.concat(_1e[key].containedTypes);}});}return _1f;};var df=new _3(),_21=_f.restore.dialog,_22=_9.getValue(_19.typeIdentifier,"containerTypes"),_23=_1c(_19),_24={showButtons:false,roots:_1a,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_22||_23,selectedContentType:_19.typeIdentifier,showAllLanguages:true};var _25=new _d(_24);var _26=new _a({title:_8.toHTML(_21.title),description:_1b||_8.toHTML(_21.description),confirmActionText:_8.toHTML(_f.restore.label),content:_25});var _27=function(_28){_6(_10.contentStore.query({id:_28}),function(_29){_26.onActionPropertyChanged({name:"ok"},"disabled",!_29);});};_25.on("change",function(_2a){if(_2a){_27(_2a);}else{_26.onActionPropertyChanged({name:"ok"},"disabled",true);}});_26.on("execute",function(){df.resolve(_25.get("value"));});_26.on("onHide",function(){df.cancel();});_26.show();_25.onChange(null);return df;};var _2b=function(_2c,_2d){var _2e=_e.action.Create,_2f=_e.providerCapabilities.Create,_30=_2d&&!(_2d.isWastebasket||_2d.isDeleted)&&_e.isActionAvailable(_2d,_2e,_2f,true,true);if(!_30){var _31=new _c({description:_8.toHTML(_f.restore.userdonothavepermission)});_31.show();return false;}return true;};var _32=function(_33){var _34=_7.resolve("epi.cms.contentRepositoryDescriptors");var _35=[];for(var key in _34){_34[key].containedTypes.forEach(function(_36){if(_9.isBaseTypeIdentifier(_33.typeIdentifier,_36)){_34[key].roots.forEach(function(_37){if(_35.indexOf(_37)===-1){_35.push(_37);}});}});}return _35;};var _38=function(_39,_3a,_3b,_3c,_3d,_3e){var _3f;if(!_3d||!_39||!_3a){return false;}if(_3c&&_3b){_3f=_11(_f.restore.label,_f.restore.confirmquestion,_3b);}else{_3f=_18(_3a,_32(_3a),_3e);}_6(_3f,function(_40){_6(_39.contentStore.get(_40),function(_41){if(!_2b(_3a,_41)){return false;}return _3d.apply(_39,[_3a,_40]);});},function(){return false;});};_5.around(_10,"restore",function(_42){return function(_43,_44){var _45;return _6(_10.contentStore.query({id:_43.contentLink}),_4.hitch(this,function(_46){var _47=null;var _48=null;if(_46.hasOwnProperty("statusCode")&&(_46.statusCode===401||_46.statusCode===403)){_47=_8.toHTML(_f.restore.userdonothavepermission);}if(_46.hasOwnProperty("isDeleted")&&!_46.isDeleted){_47=_8.toHTML(_f.restore.contentalreadyrestored);_48=function(){_10.updateTrash(_10.get("currentTrash"));};}if(_47){var _49=new _c({description:_47,onAction:_48});_49.show();return false;}var _4a=_10.get("currentTrash");if(_46.parentLink!==_4a.wasteBasketLink){return _6(_18(_46,_32(_46)),function(_4b){_6(_10.contentStore.get(_4b),function(_4c){if(!_2b(_46,_4c)){return false;}return _42.apply(_10,[_46,_4b]);});},function(){return false;});}else{return _6(_10.getOldParent(_46.contentLink),function(_4d){var _4e=_4d?_4d.contentLink:null;_38(_10,_46,_4e,_4e!=null,_42);});}}),_4.hitch(this,function(_4f){var _50=new _c({description:_8.toHTML(_f.restore.contentdeletedpermanently),onAction:function(){_10.updateTrash(_10.get("currentTrash"));}});_50.show();return false;}));};});return _10;};});