//>>built
define("epi-cms/widget/XFormEditor",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/when","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/html","dijit/focus","dijit/form/Button","epi/shell/widget/dialog/Dialog","epi/dependency","epi-cms/legacy/LegacyFormEditor","epi-cms/_ContentContextMixin","epi-cms/legacy/LegacyDialogPopup","epi/routes","epi-cms/widget/XFormPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,res,_13){return _1([_e,_f],{localization:_3.mixin(res,_13),destroyOnHide:true,editorWidgetClass:_12,store:null,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft dijitInputContainer epi-xFormEditor\">                <div data-dojo-attach-point=\"output\" data-dojo-type=\"dijit/form/TextBox\" value=\"${localization.helptext}\"></div>                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.buttonlabel}'\"></div>                <a href=\"#\" data-dojo-attach-point=\"viewDataLink\" data-dojo-attach-event=\"click: _openViewDataDialog\" title=\"${localization.viewdata.tooltip}\" class=\"disabled\">${localization.viewdata.text}</a>            </div>",postMixInProperties:function(){this.inherited(arguments);var _14=_d.resolve("epi.storeregistry");this.store=this.store||_14.get("epi.cms.xform");},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},openEditor:function(){this.inherited(arguments);this.onFocus();},_createDialog:function(){if(this.contentLink){_3.mixin(this.params,{contentLink:this.contentLink});}else{_4(this.getCurrentContext(),_3.hitch(this,function(_15){_3.mixin(this.params,{contentLink:_15.id});}));}this.inherited(arguments);},_openViewDataDialog:function(evt){_2.stop(evt);if(_5.contains(this.viewDataLink,"disabled")){return;}this._showFormDataDialog("Edit/XFormViewData.aspx",this.contentLink,this.value);},_onCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_onDialogCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_showFormDataDialog:function(_16,_17,_18){var _19=_11.getActionPath({id:_17,path:_16,moduleArea:"LegacyCMS",IsInLegacyWrapper:true,formid:_18}),_1a=new _10({url:_19,dialogArguments:window.document,showCancelButton:true,features:{width:750,height:300},autoFit:true,showLoadingOverlay:false});this.connect(_1a,"onLoad",function(_1b){if(!_1b){return;}var h1=_8("h1[class=\"EP-prefix\"]",_1b.containerIframe.contentDocument.body);_7.create("span",{innerHTML:this.localization.viewdata.forms+" >"},h1.parent()[0],"first");var _1c=_8("select[id$=\"SelectForm\"]",_1b.containerIframe.contentDocument.body);if(_1c){_6.set(_1c.parent()[0],"display","none");}var _1d=_8("input[type=\"checkbox\"][id$=\"ShowResultFromAllPages\"]",_1b.containerIframe.contentDocument.body);if(_1d){_6.set(_1d.parent()[0],"display","none");}});_1a.show();},_setDisplayTextAndValue:function(_1e){this.output.set("value",_1e);this.output.set("title",_1e);},setDisplayValue:function(_1f){if(!_1f){this._setDisplayTextAndValue(this.localization.helptext);_5.add(this.viewDataLink,"disabled");return;}this._updateDisplayPromise=_4(this.store.query({id:_1f}),_3.hitch(this,function(_20){this._updateDisplayPromise=null;if(_20&&_20.name){this._setDisplayTextAndValue(_20.name);this.contentLink&&_5.remove(this.viewDataLink,"disabled");}else{this.set("value",null);}}));}});});