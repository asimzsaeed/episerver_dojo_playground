//>>built
define("epi-cms/widget/sharedContentDialogHandler",["dojo/_base/lang","dojo/Deferred","dojo/when","dojox/html/entities","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){var _c=function(_d){var _e=new _2(),_f=_d.contentData.contentLink,_10=_6.resolve("epi.storeregistry"),_11=_10.get("epi.cms.content.search"),_12=new _9({target:document.body,zIndex:999}).placeAt(document.body);_12.show(50,0);_3(_11.get(_f),function(_13){var _14=_d.mode||_c.mode.confirm,_15=_14===_c.mode.confirm,_16=new _a({model:{contentData:_13,mode:_14}});var _17=_16.watch("numberOfReferences",function(_18,_19,_1a){_17.remove();var _1b;if(_15){var key=_13.hasChildren?"movetotrashwithsubcontentdescription":"movetotrashdescription";_1b=_7.getResourceValue(_13.typeIdentifier,key);}else{_1b=_7.getResourceValue(_13.typeIdentifier,"referencesdescription");}_1b=_1.replace(_1b,[_4.encode(_13.name)]);var _1c=_d.title;if(!_1c){var _1d=_15?"movetotrash":"references";_1c=_7.getResourceValue(_13.typeIdentifier,_1d);}var _1e=new _8({focusActionsOnLoad:true,defaultActionsVisible:_15,dialogClass:"epi-dialog-contentReferences",title:_1c,description:_1b,cancelActionText:_5.resources.action.cancel,confirmActionText:_1a===0?_b.buttons.movetotrash:_b.buttons.movetotrashanyway,setFocusOnConfirmButton:_1a===0});if(!_15){_1e.definitionConsumer.add({name:"close",label:_5.resources.action.close,action:_1e.onCancel});}_1e.connect(_1e,"onExecute",_e.resolve);_1e.connect(_1e,"onCancel",_e.cancel);_1e.set("content",_16);var _1f=_16.on("viewReference",function(){_1e.hide();_1f.remove();});_12.hide();_1e.show();});_16.startup();});return _e.promise;};_c.mode={confirm:"confirm",show:"show"};return _c;});