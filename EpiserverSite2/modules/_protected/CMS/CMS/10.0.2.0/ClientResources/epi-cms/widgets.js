//>>built
require({cache:{"epi-cms/layers/cms-widgets":function(){define(["dijit/form/ValidationTextBox","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/CMSModule","epi-cms/compare/views/CompareView","epi-cms/compare/views/SideBySideCompareView","epi-cms/compare/views/AllPropertiesCompareView","epi-cms/component/ContextHistory","epi-cms/component/GlobalToolbar","epi-cms/component/MainNavigationComponent","epi-cms/component/Media","epi-cms/component/PageNavigationTree","epi-cms/component/RecentlyChanged","epi-cms/component/SharedBlocks","epi-cms/component/SiteTree","epi-cms/component/Tasks","epi-cms/component/Trash","epi-cms/component/Versions","epi-cms/contentediting/_Renderer","epi-cms/contentediting/ContentDetails","epi-cms/contentediting/CreateContent","epi-cms/contentediting/CreateLanguageBranch","epi-cms/contentediting/DateTimeNowEditor","epi-cms/contentediting/DialogEditorWrapper","epi-cms/contentediting/EditActionPanel","epi-cms/contentediting/EditingBase","epi-cms/contentediting/editors/CheckBoxListEditor","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/ContentAreaEditor","epi-cms/contentediting/editors/ItemCollectionEditor","epi-cms/contentediting/editors/PreviewableDateTimeEditor","epi-cms/contentediting/editors/PreviewableTextEditor","epi-cms/contentediting/editors/SelectionEditor","epi-cms/contentediting/editors/ShortcutEditor","epi-cms/contentediting/editors/TinyMCEEditor","epi-cms/contentediting/editors/TinyMCEOverlayItem","epi-cms/contentediting/editors/TinyMCEInlineEditor","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/FloatingEditorWrapper","epi-cms/contentediting/FlyoutEditorWrapper","epi-cms/contentediting/FormEditing","epi-cms/contentediting/InlineEditorWrapper","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/OnPageEditing","epi-cms/contentediting/PageDataController","epi-cms/contentediting/PropertyRenderer","epi-cms/contentediting/PublishMenu","epi-cms/contentediting/SettingsPanel","epi-cms/contentediting/ValidationTextboxWithWarning","epi-cms/contentediting/viewmodel/ContentDetailsViewModel","epi-cms/conversion/PropertyContentAreaConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/layout/CreateContentGroupContainer","epi-cms/layout/EditLayoutContainer","epi-cms/legacy/LegacyDialogPopup","epi-cms/legacy/LegacyFormEditor","epi-cms/project/Overview","epi-cms/project/ProjectComponent","epi-cms/project/ProjectModeToolbar","epi-cms/project/ProjectChangesComponent","epi-cms/version/LanguageSelector","epi-cms/widget/_GridWidgetBase","epi-cms/widget/CategorySelector","epi-cms/widget/ContentSelector","epi-cms/widget/HyperLinkSelector","epi-cms/widget/NotificationStatusBar","epi-cms/widget/NotificationStatusZone","epi-cms/widget/overlay/Block","epi-cms/widget/overlay/ContentArea","epi-cms/widget/overlay/ItemCollection","epi-cms/widget/overlay/overlayFactory","epi-cms/widget/ReadOnlyDateTimeEditor","epi-cms/widget/TooltipDialog","epi-cms/widget/UrlContentSelector","epi-cms/widget/UrlSelector","epi-cms/widget/XFormEditor"],1);},"epi-cms/_ContentContextMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_8],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_3.after(this.getContentDataStore(),"onItemChanged",_2.hitch(this,this.itemChanged)));},getContentDataStore:function(){if(!this.contentDataStore){var _a=_6.resolve("epi.storeregistry");this.contentDataStore=_a.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _b=new _4();_5(this.getCurrentContext(),_2.hitch(this,function(_c){if(!this._isContentContext(_c)){_b.reject({message:"Not a content data",context:_c});return;}_5(this.getContentDataStore().get(_c.id),function(_d){_b.resolve(_d);});}));return _b;},contextChanged:function(_e,_f){this.inherited(arguments);if(!this._isContentContext(_e)){this._currentContentContext=null;return;}var _10=(_f&&_f.forceContextChange?_f.forceContextChange:false);if(!_10&&this._isSameAsCurrentContentContext(_e)){return;}this._currentContentContext=_e;this.contentContextChanged(_e,_f);},contextUpdated:function(ctx,_11){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_11);},contentContextChanged:function(ctx,_12){},contentContextUpdated:function(ctx,_13){},itemChanged:function(id,_14){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_15,_16){var _17=new _7(_15),_18=new _7(_16);if(this.ignoreVersionWhenComparingLinks&&_17.getType()==="epi.cms.contentdata"&&_18.getType()==="epi.cms.contentdata"&&_9.compareIgnoreVersion(_17.getId(),_18.getId())){return true;}else{if(_15===_16){return true;}}return false;}});});},"epi-cms/core/ContentReference":function(){define(["dojo/_base/declare","epi/epi"],function(_19,epi){var _1a=_19(null,{id:0,workId:0,providerName:null,isSelfReference:false,constructor:function(_1b){if(_1b){this._parse(_1b);}},_parse:function(_1c){if(typeof _1c==="object"){this.id=parseInt(_1c.ID||_1c.id||_1c.iD||_1c.Id||0,10);this.workId=parseInt(_1c.WorkID||_1c.workId||0,10);this.providerName=_1c.ProviderName||_1c.providerName||null;}else{if(typeof _1c==="string"){if(_1c==="-"){this.isSelfReference=true;this.id=0;this.workId=-1;}else{this.isSelfReference=false;var v=String();v.split("_");var _1d=_1c.split("_");this.id=parseInt(_1d[0],10);this.workId=parseInt(_1d[1],10)||0;this.providerName=_1d[2]||"";}}else{if(typeof _1c==="number"){this.id=_1c;this.workId=0;this.providerName="";}}}if(isNaN(this.id)){throw new Error("The id parameter of a content reference must be an integer");}if(isNaN(this.workId)&&!this.isSelfReference){throw new Error("The workId of a content reference must be an integer");}},toString:function(){if(this.isSelfReference){return "-";}var _1e=String(this.id);if(this.workId!==0){_1e+="_"+this.workId;}if(this.providerName){_1e+=(this.workId===0?"__":"_")+this.providerName;}return _1e;},createVersionUnspecificReference:function(){return new _1a({id:this.id,providerName:this.providerName});}});_1a.isContentReference=function(_1f){try{return !!(new _1a(_1f));}catch(error){return false;}};_1a.toContentReference=function(obj){if(obj instanceof _1a){return obj;}else{if(typeof obj==="string"||typeof obj==="number"){return new _1a(obj);}}return _1a.emptyContentReference;};_1a.compareIgnoreVersion=function(_20,_21){var c1=_1a.toContentReference(_20);var c2=_1a.toContentReference(_21);var _22=c1.createVersionUnspecificReference();var _23=c2.createVersionUnspecificReference();return epi.areEqual(_22,_23);};_1a.emptyContentReference=new _1a({id:-1,workId:-1});return _1a;});},"epi-cms/ApplicationSettings":function(){define("epi-cms/ApplicationSettings",[],function(){return {};});},"epi-cms/CMSModule":function(){define("epi-cms/CMSModule",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/_Module","epi/dependency","epi/shell/request/mutators","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/store/JsonRest","epi/shell/store/Throttle","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/BackContextHistory","epi-cms/ContextSynchronizer","epi-cms/conversion/ContentFragmentConverter","epi-cms/conversion/ContentLightUriConverter","epi-cms/conversion/ContentReferenceConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/store/configurableQueryEngine","epi-cms/store/PageVersionQueryEngine","epi-cms/project/ProjectActivitiesQueryEngine","epi-cms/component/command/GlobalToolbarCommandProvider","epi-cms/compare/command/CompareCommandProvider","epi-cms/notification/command/NotificationCommandProvider","epi-cms/command/ViewSettingsCommandProvider","epi-cms/contentediting/EditorFactory","epi-cms/contentediting/InUseNotificationManager","epi-cms/contentediting/ViewSettingsManager","epi-cms/project/ProjectService","epi-cms/project/ActivityService","epi-cms/notification/NotificationService","epi-cms/project/request/projectMode","epi-cms/request/contentLanguage","epi-cms/project/ProjectModeRequestInterceptor","epi-cms/project/ProjectItemQueryEngine","epi-cms/contentediting/command/Editing","epi-cms/contentediting/commandproviders/ContentDetails","epi-cms/contentediting/commandproviders/PublishMenu","epi-cms/contentediting/commandproviders/PublishMenuGlobal","epi-cms/contentediting/viewsettings/ChannelViewSetting","epi-cms/contentediting/viewsettings/ResolutionViewSetting","epi-cms/contentediting/viewsettings/ViewLanguageViewSetting","epi-cms/contentediting/viewsettings/VisitorGroupViewSetting","epi-cms/project/ProjectViewSetting","epi-cms/widget/ContentTypeService","epi-cms/Profile"],function(_24,_25,_26,_27,epi,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_3a,_3b,_3c,_3d,_3e,_3f,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_4a,_4b,_4c,_4d,_4e,_4f,_50,_51,_52,_53,_54){return _25([_28],{_settings:null,_hashWrapper:null,_firstTimeHashUpdated:false,constructor:function(_55){this._settings=_55;},initialize:function(){this.inherited(arguments);_2a.add(_46);_2a.add(_47);_25.safeMixin(_31,this._settings);var _56=_29.resolve("epi.shell.Profile");return _27(_56.getContentLanguage()).then(_26.hitch(this,function(_57){_31.currentContentLanguage=_56.contentLanguage=_57;this.registerDependency("epi.cms.BackContextHistory",new _32());this.registerDependency("epi.cms.ContextSynchronizer",new _33(),undefined,function(_58){_58.destroy();});this.registerDependency("epi.cms.contentEditing.command.Editing",_4a);this._hashWrapper=_29.resolve("epi.shell.HashWrapper");var _59=this.resolveDependency("epi.shell.ContextService");this.registerDependency("epi.cms.contentRepositoryDescriptors",this._settings.contentRepositoryDescriptors);_59.registerRoute("epi.cms.contentdata",_26.hitch(this,this._redirectContentDataContext));_59.registerRoute("epi.cms.project",_26.hitch(this,this._redirectProjectContext));this._initializeEditorFactory();this._initializeStores();this.registerDependency("epi.cms.ProjectService",new _43());this.registerDependency("epi.cms.ActivityService",new _44());this.registerDependency("epi.cms.NotificationService",new _45());this._projectModeRequestInterceptor=new _48();this.registerDependency("epi.cms.ContentTypeService",new _53());this._setupConverters(_29);this._setupViewSettings(_59);var _5a=_29.resolve("epi.globalcommandregistry");_5a.registerProvider("epi.cms.publishmenu",new _4d());_5a.registerProvider("epi.cms.globalToolbar",new _3c());_5a.registerProvider("epi.cms.globalToolbar",new _3d());_5a.registerProvider("epi.cms.globalToolbar",new _3f());_5a.registerProvider("epi.cms.globalToolbar",new _3e());this._setupInUseNotificationManager(_5a);}));},_redirectContentDataContext:function(_5b,_5c,uri){if(_30.viewName==="/episerver/dashboard"){var _5d=_2b.getActionPath({moduleArea:"CMS",controller:"Home",action:""});_5d=_5d.substring(0,_5d.length-1);var _5e=_5d+"#"+this._hashWrapper.extractHash(_5b,_5c);this._redirect(_5e);}else{if(_5b.hasSiteChanged){var _5f=_5b.fullHomeUrl+"#"+this._hashWrapper.extractHash(_5b,_5c);this._redirect(_5f);}else{if(_5c&&_5c.trigger==="internal"&&this._firstTimeHashUpdated){return;}this._firstTimeHashUpdated=true;this._hashWrapper.onContextChange(_5b,_5c);}}},_redirectProjectContext:function(_60,_61){this._hashWrapper.onContextChange(_60,_61);},_redirect:function(url){window.location=url;},_setupConverters:function(_62){var _63=new _35(),_64=new _36(),_65=new _34(),_66=new _37(),_67=this.resolveDependency("epi.cms.contentRepositoryDescriptors"),key;for(key in _67){var _68=_67[key];if(_68.linkableTypes){_68.linkableTypes.forEach(function(_69){_2c.registerConverter(_69,_69+".link",_63);_2c.registerConverter(_69+".fragment",_69+".link",_63);_2c.registerConverter(_69,"link",_63);});}}for(key in _2f._uiDescriptors){var _6a=_2f._uiDescriptors[key].descriptor;_2c.registerConverter(_6a.typeIdentifier,_6a.typeIdentifier+".reference",_64);_2c.registerConverter(_6a.typeIdentifier+".fragment",_6a.typeIdentifier+".reference",_64);_2c.registerConverter(_6a.typeIdentifier,_6a.typeIdentifier+".light",_63);_2c.registerConverter(_6a.typeIdentifier,_6a.typeIdentifier+".fragment",_65);}_63.registerDefaultConverters(_2c);_66.registerDefaultConverters(_2c);},_setupViewSettings:function(_6b){var _6c=new _42({viewSettings:[new _4f(),new _51(),new _4e(),new _52(_6b),new _50(_6b)]});this.registerDependency("epi.viewsettingsmanager",_6c);},_initializeStores:function(){var _6d=this.resolveDependency("epi.storeregistry"),_6e,_6f,_70;_6e=_6d.create("epi.cms.contentdata",this._getRestPath("contentdata"),{idProperty:"contentLink"});_6f=_6d.create("epi.cms.content.light",this._getRestPath("contentstructure"),{idProperty:"contentLink",queryEngine:_39});_70=_6d.create("epi.cms.contentversion",this._getRestPath("contentversion"),{idProperty:"contentLink",queryEngine:_3a});_6d.create("epi.cms.displayoptions",this._getRestPath("displayoptions"));_6d.create("epi.cms.category",this._getRestPath("categories"));_6d.create("epi.cms.inusenotification",this._getRestPath("inusenotification")).addDependentStore(_6e);_6d.create("epi.cms.visitorgroup",this._getRestPath("visitorgroup"));_6d.create("epi.cms.language",this._getRestPath("language"),{idProperty:"languageId"});_6d.create("epi.cms.sitestructure",this._getRestPath("sitestructure"),{idProperty:"url"});_6d.create("epi.cms.displaychannels",this._getRestPath("channel"));_6d.create("epi.cms.wastebasket",this._getRestPath("wastebasket"));_6d.create("epi.cms.xform",this._getRestPath("xform"));_6d.create("epi.cms.project",this._getRestPath("project"),{queryEngine:_39,realtimeInfo:{subscriptionKey:"/episerver/cms/project"}});_6d.create("epi.cms.project.item",this._getRestPath("project-item"),{queryEngine:_49,realtimeInfo:{subscriptionKey:"/episerver/cms/project-item"}});_6d.create("epi.cms.activities",this._getRestPath("activities"),{queryEngine:_3b,realtimeInfo:{subscriptionKey:"/episerver/cms/activity"}});_6d.create("epi.cms.activities.comments",this._getRestPath("activities-comments"),{realtimeInfo:{subscriptionKey:"/episerver/cms/activity-comment"}});_6d.create("epi.cms.contenttype",this._getRestPath("contenttype")).query();_6d.create("epi.cms.notification",this._getRestPath("notification"),{queryEngine:_39,realtimeInfo:{subscriptionKey:"/episerver/cms/notification"}});_6d.create("epi.cms.notification.users",this._getRestPath("notification-users"),{idProperty:"userName"});_6d.add("epi.cms.contentreferences",new _2e(new _2d({target:this._getRestPath("contentreferences"),idProperty:"contentLink",preventCache:true})));_6d.add("epi.cms.content.search",new _2e(new _2d({target:this._getRestPath("contentstructure"),idProperty:"contentLink"})));_6e.addDependentStore(_6f,{refreshOnPatch:true,refresh:function(_71){var id=_6e.getIdentity(_71);var _72=new _38(id).createVersionUnspecificReference().toString();_6f.refresh(_72);}});_6e.addDependentStore(_70,{transformDelegate:function(_73){if(_73.capabilities&&!_73.capabilities.versionable){return null;}if(!_73.properties){return null;}var _74={pageChangedBy:"savedBy",pageSaved:"savedDate",pageLanguageBranch:"language",pageName:"name",name:"name",icontent_name:"name"};var _75=_26.mixin({},_73);for(var p in _74){if(p in _75.properties){_75[_74[p]]=_75.properties[p];}}return _75;}});},_getRestPath:function(_76){return _2b.getRestPath({moduleArea:"cms",storeName:_76});},_initializeEditorFactory:function(){this.registerDependency("epi.cms.contentediting.EditorFactory",function(){var _77=new _40();_77.registerEditorWrapper("inline","epi-cms/contentediting/InlineEditorWrapper",function(_78,_79){});_77.registerEditorWrapper("richtextinline","epi-cms/contentediting/RichTextInlineEditorWrapper",function(_7a,_7b){});_77.registerEditorWrapper("flyout","epi-cms/contentediting/FlyoutEditorWrapper",function(_7c,_7d){});_77.registerEditorWrapper("floating","epi-cms/contentediting/FloatingEditorWrapper",function(_7e,_7f){});_77.registerEditorWrapper("contenteditable","epi-cms/contentediting/ContentEditableWrapper",function(_80,_81){});_77.registerEditorWrapper("legacyProperty","epi-cms/contentediting/DialogEditorWrapper",function(_82,_83){_82.closeOnChange=true;_82.showButtons=false;});return _77;});},_setupInUseNotificationManager:function(_84){var _85=new _41();this.registerDependency("epi.cms.contentediting.inUseNotificationManager",_85);_84.registerProvider("epi.cms.publishmenu",new _4c());_84.registerProvider("epi.cms.contentdetailsmenu",new _4b());}});});},"epi-cms/BackContextHistory":function(){define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/store/Memory","epi/shell/ContextHistory","epi/shell/ViewSettings"],function(_86,_87,_88,_89,_8a,_8b){return _86([_8a],{createStore:function(){return new _89({data:[],idProperty:"uri"});},onContextChanged:function(_8c,_8d,_8e){if(_8d&&_8d.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},closeAndNavigateBack:function(_8f){var _90=this._getLastItem();var _91=this.store.data.filter(function(_92){return _90.typeIdentifier&&(_90.typeIdentifier===_92.typeIdentifier);});_91.forEach(function(_93){var _94=this.store.getIdentity(_93);this.store.remove(_94);},this);var _95=this._getLastItem();var uri=_95&&_95.uri?{uri:_95.uri}:{uri:_8b.settings.defaultContext};_88.publish("/epi/shell/context/request",uri,{sender:_8f});},getPrevious:function(){var _96=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_96&&_96.length>1)?_96[1]:null;},_updateStore:function(_97){var _98=this._getLastItem();if(_98&&_98.uri===_97.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){return this.store.data[this.store.data.length-1];}return null;},_removeLastItem:function(){var _99=this._getLastItem();if(_99){this.store.remove(this.store.getIdentity(_99));}}});});},"epi-cms/ContextSynchronizer":function(){define("epi-cms/ContextSynchronizer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/when","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_9a,_9b,_9c,_9d,_9e,_9f){return _9a([_9e],{_subscribeHandle:null,constructor:function(){this._subscribeHandle=_9c.subscribe("/epi/cms/contentdata/updated",this,this._updateCurrentContext);},_updateCurrentContext:function(_a0){var _a1=_a0.contentLink;_9d(this.getCurrentContext(),function(_a2){if(_a2&&_9f.compareIgnoreVersion(_a2.id,_a1)){var _a3={uri:"epi.cms.contentdata:///"+_a1};if(_a2.languageContext){_a3.epslanguage=_a2.languageContext.preferredLanguage;}_9c.publish("/epi/shell/context/updateRequest",_a3);}});},destroy:function(){_9c.unsubscribe(this._subscribeHandle);}});});},"epi-cms/conversion/ContentFragmentConverter":function(){define(["dojo/_base/declare"],function(_a4){return _a4([],{convert:function(_a5,_a6,_a7){if(!_a7){return null;}return {contentLink:_a7.contentLink,name:_a7.name,typeIdentifier:_a7.typeIdentifier};}});});},"epi-cms/conversion/ContentLightUriConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_a8,_a9,_aa,_ab,_ac,_ad){return _a8(null,{_contentStore:null,constructor:function(_ae){_a9.mixin(this,_ae);this._contentStore=this._contentStore||_ab.resolve("epi.storeregistry").get("epi.cms.content.light");},registerDefaultConverters:function(_af){},convert:function(_b0,_b1,_b2){if(!_b2||(!_b2.contentLink&&!_b2.uri)){return null;}var _b3=_b2.contentLink||new _ac(_b2.uri).getId();if(!_b3){return null;}_b3=new _ad(_b3).createVersionUnspecificReference().toString();return _aa(this._contentStore.get(_b3),function(_b4){return {url:_b4.publicUrl,previewUrl:_b4.previewUrl,permanentUrl:_b4.permanentLink,text:_b4.name,typeIdentifier:_b4.typeIdentifier};});}});});},"epi-cms/conversion/ContentReferenceConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_b5,_b6,_b7,_b8,_b9,_ba){return _b5(null,{convert:function(_bb,_bc,_bd){if(!_bd||(!_bd.uri&&!_bd.contentLink)){return null;}var _be;if(_bd.uri){var uri=new _b9(_bd.uri);_be=uri.getId();}else{_be=_bd.contentLink;}return new _ba(_be).createVersionUnspecificReference().toString();}});});},"epi-cms/conversion/PropertyDateConverter":function(){define(["dojo/_base/declare"],function(_bf){return _bf(null,{sourceDataType:"epi.cms.propertydate",targetDataType:"runtimeType",registerDefaultConverters:function(_c0){_c0.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_c1,_c2,_c3){if(_c3&&_c1===this.sourceDataType&&_c2===this.targetDataType){return new Date(_c3);}return null;}});});},"epi-cms/store/configurableQueryEngine":function(){define(["./queryUtils"],function(_c4){return function(_c5,_c6){_c6=_c6||{};return _c4.createEngine(_c5,_c6);};});},"epi-cms/store/queryUtils":function(){define([],function(){function _c7(_c8){return _c8 instanceof Array&&_c8.length>0;};var _c9={createFilter:function(_ca,_cb){var _cc;_cb=_cb||{};switch(typeof _ca){case "object":case "undefined":_cc=function(_cd){return !_ca||Object.keys(_ca).every(function(key){var _ce=_cb.ignore,_cf=_cb.comparers&&_cb.comparers[key],_d0=_ca[key];if(_ce&&_ce.indexOf(key)!==-1){return true;}if(_cf){return _cf(_d0,_cd);}return _d0===_cd[key];});};break;default:throw new Error("Can not query with a "+typeof _ca);}return _cc;},createSorter:function(_d1){if(!_c7(_d1)){throw new Error("Argument must be an array containing sortOptions");}return function(a,b){var _d2,_d3;for(var _d4,i=0;(_d4=_d1[i]);i++){_d2=a[_d4.attribute];_d3=b[_d4.attribute];if(typeof _d2==="string"&&typeof _d3==="string"){_d2=_d2.toLowerCase();_d3=_d3.toLowerCase();}if(_d2!==_d3){return _d4.descending===(_d2>_d3)?-1:1;}}return 0;};},createExecuter:function(_d5,_d6,_d7,_d8){var _d9=_d7||0,end=_d8?_d9+_d8:Infinity;return function(_da){var _db;_da=_d5?_da.filter(_d5):_da.slice(0);_d6&&_da.sort(_d6);if(_d7||_d8){_db=_da.length;_da=_da.slice(_d9,end);_da.total=_db;}return _da;};},createEngine:function(_dc,_dd){var _de,_df,_e0;_dd=_dd||{};_de=_c9.createFilter(_dc,_dd);_df=_c7(_dd.sort)?_c9.createSorter(_dd.sort):null;_e0=_c9.createExecuter(_de,_df,_dd.start,_dd.count);_e0.matches=_de;return _e0;}};return _c9;});},"epi-cms/store/PageVersionQueryEngine":function(){define(["dojo/_base/array","epi-cms/core/ContentReference"],function(_e1,_e2){return function(_e3,_e4){switch(typeof _e3){case "object":case "undefined":var _e5=_e3;_e3=function(_e6){for(var key in _e5){var _e7=_e5[key],_e8=_e7.toString();if(_e8!==_e6[key]&&(!_e2.isContentReference(_e8)||!_e2.compareIgnoreVersion(_e8,_e6[key]))){return false;}}return true;};break;case "string":if(!this[_e3]){throw new Error("No filter function "+_e3+" was found in store");}_e3=this[_e3];break;case "function":break;default:throw new Error("Can not query with a "+typeof _e3);}function _e9(_ea){var _eb=_e1.filter(_ea,_e3);if(_e4&&_e4.sort){_eb.sort(function(a,b){for(var _ec,i=0;(_ec=_e4.sort[i]);i++){var _ed=a[_ec.attribute];var _ee=b[_ec.attribute];if(_ed!==_ee){return _ec.descending===(_ed>_ee)?-1:1;}}return 0;});}if(_e4&&(_e4.start||_e4.count)){var _ef=_eb.length;_eb=_eb.slice(_e4.start||0,(_e4.start||0)+(_e4.count||Infinity));_eb.total=_ef;}return _eb;};_e9.matches=_e3;return _e9;};});},"epi-cms/project/ProjectActivitiesQueryEngine":function(){define(["dojo/_base/lang","epi-cms/store/queryUtils"],function(_f0,_f1){return function(_f2,_f3){_f3=_f0.mixin({comparers:{projectId:function(_f4,_f5){return !_f5.projectId||_f4===_f5.projectId;},contentReferences:function(_f6,_f7){return _f6&&_f6.some(function(_f8){return _f8===_f7.contentLink;});}}},_f3);return _f1.createEngine(_f2,_f3);};});},"epi-cms/component/command/GlobalToolbarCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable","dijit/form/ToggleButton","epi/dependency","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_f9,_fa,_fb,_fc,_fd,_fe,_ff,_100,_101,_102,_103,_104){var _105=_fa([_100,_fd],{iconClass:"epi-iconTree",tooltip:_104.toolbar.buttons.togglenavigationpane,label:_104.toolbar.buttons.togglenavigationpane,order:-10000,canExecute:true,constructor:function(){this.own(_fc.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",_fb.hitch(this,function(_106){this.set("active",_106);})));},_execute:function(){_fc.publish("/epi/layout/pinnable/navigation/toggle");}});var _107=_fa([_100,_fd],{iconClass:"epi-iconFolder",tooltip:_104.toolbar.buttons.toggleassetspane,label:_104.toolbar.buttons.toggleassetspane,order:10000,canExecute:true,constructor:function(){this.own(_fc.subscribe("/epi/layout/pinnable/tools/visibilitychanged",_fb.hitch(this,function(_108){this.set("active",_108);})));},_execute:function(){_fc.publish("/epi/layout/pinnable/tools/toggle");}});return _fa([_103],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_ff.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_101.viewName;this._addLeadingCommands();this._addCreateCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _105(),{widget:_fe,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _109=this.viewName;var _10a=[];var _10b=function(view){return view===_109;};for(var _10c in this.contentRepositoryDescriptors){var _10d=this.contentRepositoryDescriptors[_10c];if(_f9.some(_10d.mainViews,_10b)){_10a.push(_10d);}}_f9.forEach(_10a,function(_10e){_f9.forEach(_10e.creatableTypes,function(type){this.addCommand(this._createCommand(type),{category:"create"});},this);},this);},_createCommand:function(type){return new _102({creatingTypeIdentifier:type});},_addTrailingCommands:function(){this.addToTrailing(new _107(),{widget:_fe,"class":"epi-trailingToggleButton epi-mediumButton"});}});});},"epi-cms/widget/command/CreateContentFromSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/ContentForestStoreModel","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.widget.createcontentselector"],function(_10f,_110,lang,_111,on,_112,when,_113,_114,_115,_116,_117,_118,_119,_11a,_11b,_11c,_11d){return _110([_114,_119],{canExecute:true,canSelectOwnerContent:false,showButtons:false,value:null,showRoot:false,roots:null,creatingTypeIdentifier:null,containerTypeIdentifiers:null,modelContent:null,confirmActionText:_11d.buttons.confirmation,description:null,title:null,createAsLocalAsset:false,autoPublish:false,addToParentsAssetsFolder:false,typeDescriptorManager:null,contentRepositoryDescriptors:null,allowedTypes:null,restrictedTypes:null,postscript:function(){this.inherited(arguments);this._initialize();},_initialize:function(){if(!this.creatingTypeIdentifier){throw "You need to specify a creatingTypeIdentifier";}if(this._initialized){return;}var _11e=_113.resolve("epi.storeregistry");this.contentStore=this.contentStore||_11e.get("epi.cms.content.light");this.contextService=this.contextService||_113.resolve("epi.shell.ContextService");this.contentTypeStore=this.contentTypeStore||_11e.get("epi.cms.contenttype");this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_113.resolve("epi.cms.contentRepositoryDescriptors");var _11f,_120=function(type){return type===this.creatingTypeIdentifier;};for(var _121 in this.contentRepositoryDescriptors){var _122=this.contentRepositoryDescriptors[_121];if(_10f.some(_122.containedTypes,_120,this)){_11f=_122;break;}}if(_11f){var _123=_115.getValue(this.creatingTypeIdentifier,"containerTypes");this.containerTypeIdentifiers=_123?_123:[this.creatingTypeIdentifier];this.roots=this.roots||_11f.roots;}this.modelContent=new _11b({roots:this.roots,additionalQueryOptions:{sort:[{attribute:"name",descending:false}]}});this.preventContextualContentFor=_11f.preventContextualContentFor;this.label=this.label||_115.getResourceValue(this.creatingTypeIdentifier,"create");this.title=this.title||_115.getResourceValue(this.creatingTypeIdentifier,"selectparent");this.description=this.description||_115.getResourceValue(this.creatingTypeIdentifier,"createdescription");this.iconClass=this.iconClass||_115.getValue(this.creatingTypeIdentifier,"commandIconClass");this._initialized=true;},contextChanged:function(ctx,_124){this.set("isAvailable",this._isContentContext(ctx));this.inherited(arguments);},_execute:function(){when(this.getCurrentContent(),lang.hitch(this,function(_125){if(!_125){return;}when(this.contextService.query({uri:"epi.cms.contentdata:///"+_125.contentLink}),lang.hitch(this,function(_126){if(!_126){return;}var _127=_126.languageContext;var _128=!_127||(_127.hasTranslationAccess&&_127.isPreferredLanguageAvailable);var _129=_117.compareIgnoreVersion(_125.contentLink,_118.wastebasketPage);var _12a=!(_129||_125.isDeleted)&&_128&&_11c.isActionAvailable(_125,_11c.action.Create,_11c.providerCapabilities.Create,true);when(this._getAvailableContentTypes(_125.contentLink),lang.hitch(this,function(_12b){var _12c=this._isContentTypeAllowedAsChildToCurrentContext(_12b,_125);if((!_12c&&!this.createAsLocalAsset)||!_12a){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_125);}}));}));}));},_getAvailableContentTypes:function(_12d){return this.contentTypeStore.query({query:"getavailablecontenttypes",localAsset:this.createAsLocalAsset,parentReference:_12d});},_isContentTypeAllowedAsChildToCurrentContext:function(_12e,_12f){var _130=_10f.some(_12e,function(_131){return _115.isBaseTypeIdentifier(_131.typeIdentifier,this.creatingTypeIdentifier);},this);var _132=_10f.some(this.containerTypeIdentifiers,function(type){return _115.isBaseTypeIdentifier(_12f.typeIdentifier,type);});return _130&&_132;},_createDialog:function(){this.selector=new _11a({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,value:this.value,showRoot:this.showRoot,multiRootsMode:true,allowedTypes:this.containerTypeIdentifiers,model:this.modelContent,showContextualContent:true,preventContextualContentFor:this.preventContextualContentFor});this.dialog=new _116({confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector});this.selector.on("change",lang.hitch(this,this._setDialogButtonState));this.dialog.own(_111.after(this.dialog,"hide",lang.hitch(this,function(_133){this.hideDeferred=_133;})));this.dialog.on("execute",lang.hitch(this,this._onContentSelected));this.dialog.show();},_onContentSelected:function(){var _134=this.selector.get("value");when(this.hideDeferred,lang.hitch(this,function(){when(this.contentStore.get(_134),lang.hitch(this,function(_135){this._switchView(_135);}));}));},_switchView:function(_136){when(this.getCurrentContent(),lang.hitch(this,function(_137){var _138=this.isPseudoContextualRoot(_136)||this.createAsLocalAsset;_112.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.creatingTypeIdentifier,parent:_138?_137:_136,editAllPropertiesOnCreate:this.editAllPropertiesOnCreate,addToDestination:this.model,createAsLocalAsset:_138,treatAsSecondaryView:this.createAsLocalAsset,view:_115.getValue(this.creatingTypeIdentifier,"createView"),autoPublish:this.autoPublish,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});}));},_setDialogButtonState:function(_139){if(!_139){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}when(this.contentStore.get(_139),lang.hitch(this,function(_13a){when(this.isPseudoContextualRoot(_13a)?this.contextService.query({uri:"epi.cms.contentdata:///"+this._currentContext.id}):_13a,lang.hitch(this,function(_13b){var _13c=_11c.hasLanguageAccess(_13b),_13d=_13c&&_11c.hasAccess(_13a.accessMask,_11c.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_13d);}));}));}});});},"epi-cms/contentediting/_ContextualContentContextMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/_ContentContextMixin","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/contentediting/PseudoContextualCommandDecorator","epi-cms/core/ContentReference"],function(_13e,_13f,lang,when,_140,_141,_142,_143,_144){return _13f([_140],{_commandDecorator:null,postscript:function(){this.inherited(arguments);this._commandDecorator=this._commandDecorator||new _143();},destroy:function(){this._commandDecorator&&this._commandDecorator.destroy();this.inherited(arguments);},isTypeOfRoot:function(_145){var _146=this.inherited(arguments),_147=this.isContextualContent(_145);return _146!=null?!!(_146||_147):!!(_145&&_147);},isContextualContent:function(_148){return this.isContextualRoot(_148)||this.isPseudoContextualRoot(_148);},isContextualRoot:function(_149){return _149.parentLink==this._getPseudoContextualContent();},isPseudoContextualRoot:function(_14a){var _14b=_144.toContentReference(_14a.contentLink);return !_14b.providerName&&_14b.id==this._getPseudoContextualContent();},hasContextual:function(_14c){if(!(_14c instanceof Array)||_14c.length<=0){return false;}return _13e.some(_14c,this.isContextualContent,this);},canHaveContextualContent:function(_14d){var _14e=_144.toContentReference(_14d.contentLink);return !_13e.some(this.notSupportContextualContents,function(id){return !_14e.providerName&&_14e.id==id;});},getContextualRoot:function(_14f){if(typeof _14f!=="object"){return null;}var _150=lang.clone(_14f);_150.name=this.getContextualRootName(_150);if(this.isPseudoContextualRoot(_150)){_150.hasChildren=false;}return _150;},getContextualRootName:function(_151){var _152=_151&&_151.ownerTypeIdentifier,_153=_152||(this._currentContext&&this._currentContext.dataType)||"",_154=_141.getResourceValue(_153,"name",true);var _155=_141.getResourceValue(_153,"forthis",false);return _154?lang.replace(_155,[_154]):_155;},decoratePseudoContextualCommands:function(_156){when(this.getCurrentContent()).then(lang.hitch(this,function(_157){this._commandDecorator.decorateCommands(_156,_157,lang.hitch(this,this.isPseudoContextualRoot));})).otherwise(function(){});},_getPseudoContextualContent:function(){return _142.contentAssetsFolder;}});});},"epi-cms/contentediting/PseudoContextualCommandDecorator":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_158,_159,lang,_15a,_15b,_15c,_15d){return _159(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_15e,_15f,_160){this._clearContextualCommandHandlers();if(!(_15e instanceof Array)||_15e.length<=0||typeof _15f!=="object"){return;}this._decorateCommands(_15e,_15f,_160);},_decorateCommands:function(_161,_162,_163){_158.forEach(_161,function(_164){if(!this._isValidCommand(_164)){return;}if(typeof _163==="function"&&!_163(this._isNormalCommand(_164)?_164.model:_164.get("selectionData"))){return;}this._onAroundCommandExecute(_164,_162);},this);},_onAroundCommandExecute:function(_165,_166){var self=this;self._contextualCommandHandlers.push(_15a.around(_165,"execute",function(_167){return function(){var _168=self._decorateCommandBeforeExecute(_165,_166);_167.apply(_165,arguments);self._restoreCommandAfterExecute(_165,_168);};}));},_decorateCommandBeforeExecute:function(_169,_16a){var _16b=this._decorateCommand(_169);if(this._isNormalCommand(_169)){lang.mixin(_16b,this._decorateNormalCommand(_169,_16a));}else{if(_169.isInstanceOf(_15d)){lang.mixin(_16b,this._decorateSelectionCommand(_169,_16a));}}_169.set({canExecute:true,isAvailable:true,createAsLocalAsset:true});return _16b;},_decorateCommand:function(_16c){var _16d={createAsLocalAsset:_16c.get("createAsLocalAsset")};_16c.isInstanceOf(_15c)&&_16c.unwatchClipboardChange();_16c.isInstanceOf(_15d)&&_16c.unwatchSelectionChange();return _16d;},_decorateNormalCommand:function(_16e,_16f){var _170={model:_16e.get("model")};_16e.set("model",_16f);return _170;},_decorateSelectionCommand:function(_171,_172){var _173={data:_171.get("selectionData")};var _174=_171.get("model");if(_174&&typeof _174.refreshRoots=="function"){_171.onRefreshSelection=function(){return _174.refreshRoots();};}_171.selection.set("data",[{data:_172,type:_171.get("selectionType")}]);return _173;},_restoreCommandAfterExecute:function(_175,_176){this._restoreCommand(_175,_176);if(this._isNormalCommand(_175)){this._restoreNormalCommand(_175,_176);return;}if(_175.isInstanceOf(_15d)){this._restoreSelectionCommand(_175,_176);}},_restoreCommand:function(_177,_178){_177.set("createAsLocalAsset",_178.createAsLocalAsset);_177.isInstanceOf(_15c)&&_177.watchClipboardChange();_177.isInstanceOf(_15d)&&_177.watchSelectionChange();},_restoreNormalCommand:function(_179,_17a){_179.set("model",_17a.model);},_restoreSelectionCommand:function(_17b,_17c){_17b.selection.set("data",_17c.data);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_158.forEach(this._contextualCommandHandlers,function(_17d){typeof _17d.remove==="function"&&_17d.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_17e){return !(_17e.isInstanceOf(_15d)||_17e.isInstanceOf(_15c));},_isValidCommand:function(_17f){return !!(_17f&&_17f.isInstanceOf(_15b)&&_17f.model);}});});},"epi/shell/command/_ClipboardCommandMixin":function(){define("epi/shell/command/_ClipboardCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_180,lang){return _180(null,{clipboard:null,postscript:function(){this.inherited(arguments);this.watchClipboardChange();},onRefreshClipboard:function(){},watchClipboardChange:function(){this._clipboardChangeWatcher=this.clipboard.watch("data",lang.hitch(this,this._onModelChange));},unwatchClipboardChange:function(){this._clipboardChangeWatcher&&this._clipboardChangeWatcher.unwatch();},_clipboardDataGetter:function(){return this._getClipboardData();},_clipboardTypeGetter:function(){return this._getClipboardData().type;},_getClipboardData:function(){if(!this.clipboard||!(this.clipboard.data instanceof Array)){return null;}return this.clipboard.data;}});});},"epi/shell/command/_SelectionCommandMixin":function(){define("epi/shell/command/_SelectionCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_181,lang){return _181(null,{selection:null,postscript:function(){this.inherited(arguments);this.watchSelectionChange();},onRefreshSelection:function(){},watchSelectionChange:function(){this._selectionChangeWatcher=this.selection.watch("data",lang.hitch(this,this._onModelChange));},unwatchSelectionChange:function(){this._selectionChangeWatcher&&this._selectionChangeWatcher.unwatch();},_selectionDataGetter:function(){var _182=this._getSelectionData();return _182&&_182.type==="epi.cms.contentdata"?_182.data:null;},_selectionTypeGetter:function(){return this._getSelectionData().type;},_getSelectionData:function(){if(!this.selection||!(this.selection.data instanceof Array)){return null;}return this.selection.data[0];}});});},"epi-cms/widget/ContentSelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/when","dijit/layout/_LayoutWidget","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/SearchBox","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_183,_184,lang,_185,when,_186,epi,_187,_188,_189,_18a,_18b,_18c,_18d,_18e){return _184([_186,_18c],{_contentRef:null,res:_18e,baseClass:"epi-content-selector-dialog",roots:null,typeIdentifiers:null,showButtons:true,model:null,allowedTypes:null,restrictedTypes:null,canSelectOwnerContent:true,multiRootsMode:false,_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,showSearchBox:true,searchArea:null,_searchBox:null,buildRendering:function(){this.inherited(arguments);var _18f=this._getTypesToDisplay(),_190=this.model,_191=this.roots||(_190&&_190.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_190||this.showContextualContent){_190=new _18a({roots:_191,typeIdentifiers:_18f,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_190.set("view","contentselector");if(this.showSearchBox&&this.searchArea){this._searchBox=new _18b({innerSearchBoxClass:"epi-search--full-width",triggerContextChange:false,parameters:{allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes},onItemAction:lang.hitch(this,function(item){if(item&&item.metadata&&this._checkAcceptance(item.metadata.typeIdentifier)){this.set("value",item.metadata.id);}})});this._searchBox.set("area",this.searchArea);this._searchBox.set("searchRoots",this.roots);var _192=this._searchBox;_190.getRoots(true).then(function(_193){_192.set("searchRoots",_193.join(","));});this.addChild(this._searchBox);}this.tree=new _189({roots:_191,typeIdentifiers:_18f,allowManipulation:false,model:_190,allowedTypes:lang.clone(this.allowedTypes),restrictedTypes:lang.clone(this.restrictedTypes),disableRestrictedTypes:true,expandExtraNodeItems:_188.startPage});this.addChild(this.tree);this.connect(this.tree,"onClick","_onTreeNodeClick");},layout:function(){this.inherited(arguments);var _194=this._contentBox.h;if(this._searchBox){_194-=_185.getMarginBox(this._searchBox.domNode).h;}var _195=_185.getMarginBox(this.tree.domNode);_195.h=_194;_185.setMarginBox(this.tree.domNode,_195);},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _196=this.contentRepositoryDescriptors||_18d.resolve("epi.cms.contentRepositoryDescriptors");var _197,_198=function(type){return _187.isBaseTypeIdentifier(this.selectedContentType,type);};for(var _199 in _196){var _19a=_196[_199];if(_183.some(_19a.containedTypes,_198,this)){_197=_19a;break;}}return _197.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _19b=[];this._getContainerTypesRecursive(this.allowedTypes,_19b);this._typesToDisplay=_19b;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_19c,_19d,_19e){if(!_19e){_19e=[];}_183.forEach(_19c,lang.hitch(this,function(type){if(_183.indexOf(_19e,type)===-1){_19e.push(type);if(_183.indexOf(_19d,type)===-1){_19d.push(type);}var _19f=_187.getValue(type,"containerTypes");if(_19f){this._getContainerTypesRecursive(_19f,_19d,_19e);}}}));},_setValueAttr:function(_1a0){if(_1a0){this._contentRef=_1a0;var _1a1=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){when(this.tree.onLoadDeferred,lang.hitch(this,function(){this.tree.selectContent(_1a1,true);}));}else{if(!epi.isEmpty(_1a1)){this.tree.selectContent(_1a1,true);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_setAllowedTypesAttr:function(_1a2){this._typesToDisplay=null;this._set("allowedTypes",_1a2);},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_18e.currentpage,settings:{type:"submit"},action:lang.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_1a3){var _1a4=_1a3.contentLink;if(!this._checkAcceptance(_1a3.typeIdentifier)){this.tree.lastFocused.setSelected(false);_1a4=null;}this.set("value",_1a4);this.onChange(this.get("value"));},_checkAcceptance:function(_1a5){var _1a6=_187.getValidAcceptedTypes([_1a5],this.allowedTypes,this.restrictedTypes);return !!_1a6.length;},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_1a7){},focus:function(){this.tree.focus();}});});},"epi-cms/widget/ContentTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/keys","dojo/promise/all","dojo/query","dojo/sniff","dojo/when","dijit/registry","epi/dependency","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/ContentForestStoreModel","epi/i18n!epi/cms/nls/episerver.shared.header"],function(_1a8,_1a9,_1aa,lang,_1ab,_1ac,_1ad,_1ae,_1af,keys,_1b0,_1b1,_1b2,when,_1b3,_1b4,_1b5,_1b6,Tree,_1b7,_1b8,_1b9,_1ba,_1bb){return _1aa([Tree,_1af],{roots:null,expandExtraNodeItems:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,persist:false,expandOnDnd:true,showRoot:false,handleSelection:false,disableRestrictedTypes:false,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=this._createTreeModel();}if(this.allowManipulation){this.dndController=_1b5;this.accept=this.model.containedTypes||this.containedTypes;}this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);this.nodeConstructor=this.nodeConstructor||_1b8;if(this.allowedTypes){var _1bc=_1a8.some(this.allowedTypes,function(item){return item==="episerver.core.contentfolder";});if(!_1bc){this.allowedTypes.push("episerver.core.contentfolder");}}},getItemType:function(item){return _1b6.getAndConcatenateValues(item.typeIdentifier,"dndTypes");},buildRendering:function(){this.model=this._wrapModel(this.model);this.inherited(arguments);},_wrapModel:function(_1bd){return _1b9(this.model);},postCreate:function(){this.inherited(arguments);this.own(this.connect(this.model,"onSelect",lang.hitch(this,this._onSelect)),_1ad.before(this.model,"onToggleContentDisplay",lang.hitch(this,function(_1be,_1bf){var _1c0=this.getNodesByItem(_1be)[0];if(_1c0){_1ac.set(_1c0.domNode,{display:_1bf===true?"":"none"});}})));},onLoad:function(){this.inherited(arguments);return when(this._expandRootNodes(),lang.hitch(this,this._expandExtraNodes));},_expandRootNodes:function(){var _1c1=this.showRoot?[this.rootNode]:this.rootNode.getChildren();return _1b0(_1a8.map(_1c1,this.tree._expandNode,this));},_expandExtraNodes:function(){if(!this.expandExtraNodeItems){return;}var _1c2=this.expandExtraNodeItems instanceof Array?this.expandExtraNodeItems:[this.expandExtraNodeItems];var _1c3=_1a8.map(_1c2,function(item){return this.tree.getNodesByItem(item)[0];},this);_1c3=_1a8.filter(_1c3,Boolean);return _1b0(_1a8.map(_1c3,this.tree._expandNode,this));},checkItemAcceptance:function(_1c4,_1c5,_1c6){var _1c7=true;var _1c8=_1b3.getEnclosingWidget(_1c4),_1c9=_1c8&&_1c8.item;if(!_1c9){return false;}_1c5.forInSelectedItems(function(item){if(!_1c7){return;}var data=item.data;if(data.dndData){data=data.dndData;}_1c7=this.model.canPaste(data,_1c9);},this);return _1c7;},_setAllowManipulationAttr:function(_1ca){this._set("allowManipulation",_1ca);if(_1ca){this.dndController=_1b5;}},_createTreeModel:function(){return new _1ba({roots:this.roots,typeIdentifiers:this.typeIdentifiers});},_onItemDelete:function(item,_1cb){function _1cc(node,_1cd){_1a8.forEach(node.getChildren(),function(_1ce){_1cd.push(_1ce.item);_1cc(_1ce,_1cd);});return _1cd;};if(_1cb){var _1cf=this._itemNodesMap[this.model.getIdentity(item)];if(_1cf){_1a8.forEach(_1cf,function(_1d0){_1a8.forEach(_1cc(_1d0,[]).reverse(),function(_1d1){this._onItemDelete(_1d1);},this);},this);}}this.inherited(arguments);},_setTypeIdentifiersAttr:function(_1d2){this._set("typeIdentifiers",_1d2);if(this.model){this.model.typeIdentifiers=_1d2;}},getTooltip:function(item){var _1d3=this.model.getTooltip||this.model.getLabel;var _1d4=new _1b7(item.contentLink),_1d5=_1d3?_1d3(item):this.inherited(arguments);return _1d5?_1d5+", "+_1bb.id+": "+_1d4.id+" ("+_1bb.type+": "+item.contentTypeName+")":_1d5;},buildNodeFromTemplate:function(args){return new this.nodeConstructor(args);},_createTreeNode:function(args){var _1d6=lang.mixin({},args,{dndData:args.item});return this.buildNodeFromTemplate(_1d6);},getIconClass:function(item,_1d7){if(!item){return this.inherited(arguments);}var _1d8=_1b6.getValue(item.typeIdentifier,"iconClass");if(this.model.isTypeOfRoot(item)){return this.model.getObjectIconClass(item,_1d8);}var _1d9=_1b6.getValue(item.typeIdentifier,"supportsOpenCssClass");if(_1d7&&!item.isSubRoot&&_1d9){_1d8=_1d8+"Open";}return _1d8+this._getItemDisableStyle(item);},getLabelClass:function(item,_1da){return this._getItemDisableStyle(item);},focus:function(){this.focusNode(this.get("selectedNode")||this.rootNode);},_getItemDisableStyle:function(item){if(this.disableRestrictedTypes){return this._isItemRestricted(item)?" is-disabled ":"";}return "";},_isItemRestricted:function(item){var _1db=_1b6.getValidAcceptedTypes([item.typeIdentifier],this.allowedTypes,this.restrictedTypes);return !_1db.length;},_getTargetPath:function(_1dc){var _1dd=this.model,_1de=new _1ae();_1dd.getAncestors(_1dc,function(_1df){_1df.push(_1dc);var _1e0=_1a8.map(_1df,function(item){return _1dd.getIdentity(item).toString();});if(typeof _1dd.filterAncestors==="function"){_1e0=_1dd.filterAncestors(_1e0);}_1de.resolve(_1e0);});return _1de.promise;},_isValidTargetContent:function(_1e1){if(!_1e1){return false;}return !_1e1.isDeleted&&!_1e1.isWastebasket;},_onSelect:function(id,_1e2,_1e3){var _1e4=this.get("selectedNode");this.tree.model.set("previousContextualSelection",{selectedContent:_1e4});this.selectContent(id,_1e2,true,_1e3).then(lang.hitch(this,function(){_1e4=this.get("selectedNode");if(_1e4&&_1e4.item&&_1e4.item.contentLink){this.emit("select",_1e4.item,_1e4);}}));},selectContent:function(_1e5,_1e6,_1e7,_1e8){var self=this,_1e9=self.model,_1ea=new _1ae(),_1eb=function(_1ec){self._preparePathNodes(_1ec);self._setRecursivePaths(_1ec,_1ea,_1e6,_1e8);};when(_1e9.store.get(_1e5),function(_1ed){if(!self._isValidTargetContent(_1ed)){self.set("paths",[]);_1ea.resolve(null);}else{self._getTargetPath(_1ed).then(function(_1ee){self._onSetTargetPath();_1eb(_1ee);});}});return _1ea.promise;},_onSetTargetPath:function(){this.model.set("handleSelection",this.handleSelection);if(!this.handleSelection){return;}var _1ef=this.get("selectedNode");if(_1ef){_1ef=this.getNodesByItem(_1ef.item)[0];if(_1ef){this.model.set("previousSelection",{selectedContent:_1ef,selectedAncestors:_1ef.getTreePath()});}}},_preparePathNodes:function(_1f0){},_setRecursivePaths:function(_1f1,_1f2,_1f3,_1f4){if(!_1f1||_1f1.length===0){return;}this.set("paths",[_1f1]).then(lang.hitch(this,function(){var _1f5=this.get("selectedNode");if(!_1f5){this._setRecursivePaths(_1f1.slice(0,-1),_1f2,_1f3,_1f4);return;}if(_1f3){this.focus();}if(_1f4){_1f4(_1f5);}_1f2.resolve(_1f5);},_1f2.reject));},_onKeyDown:function(item,e){this.inherited(arguments);if(!this.allowManipulation){return;}if(_1a9.isCopyKey(e)){var _1f6=e.keyCode?String.fromCharCode(e.keyCode).toLowerCase():"";switch(_1f6){case "c":this.emit("copyOrCut",true);break;case "x":this.emit("copyOrCut",false);break;case "v":this.emit("paste");break;default:break;}}if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}if(e.keyCode===keys.DELETE){this.emit("delete");}},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);if(_1b2("ie")){_1a8.forEach(_1b1(".dijitTreeRow.dijitTreeRowHover",this.tree.domNode),function(node){_1ab.remove(node,"dijitTreeRowHover");});}}});});},"epi/shell/dnd/tree/dndSource":function(){define("epi/shell/dnd/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin","epi/shell/TypeDescriptorManager"],function(_1f7,_1f8,_1f9,_1fa,_1fb,lang,on,_1fc,_1fd,_1fe,when,_1ff,_200,_201){return _1f9([_1ff,_200],{generateText:false,singular:true,constructor:function(){var _202=this.reject;if(_202){var _203=[];for(var key in this.accept){_203.push(key);}this.accept={};_203=_201.removeIntersectingTypes(_203,this.reject);_1f7.forEach(_203,function(_204){this.accept[_204]=1;},this);for(var i=0;i<_202.length;++i){this.accept[_202[i]]=0;}}},deleteSelectedNodes:function(){},userSelect:function(node){this.inherited(arguments,[node,false,false]);},onDndDrop:function(_205,_206,copy,_207){if(this.containerState==="Over"){var tree=this.tree,_208=tree.model,_209=this.targetAnchor;this.isDragging=false;var _20a;var _20b=(_209&&_209.item)||tree.item;if(this.dropPosition==="Before"||this.dropPosition==="After"){_20b=(_209.getParent()&&_209.getParent().item)||tree.item;_20a=_209.getIndexInParent();if(this.dropPosition==="After"){_20a=_209.getIndexInParent()+1;}}var _20c=this.itemCreator(_206,_209.rowNode,_205,_207);if(_205===this){if(_208.pasteItems){_208.pasteItems(_20c,_20b,copy,_20a);}else{_1f7.forEach(_20c,function(item){if(item.dndData){var _20d=item.dndData.options;var _20e=_20d?_20d.oldParentItem:null;var _20f=_20d?_20d.indexInParent:0;if(typeof _20a=="number"){if(_20b===_20e&&_20f<_20a){_20a-=1;}}_208.pasteItem(item.dndData.data,_20e,_20b,copy,_20a);}});}}else{if(_208.newItems){_208.newItems(_20c,_20b,_20a);}else{_1f7.forEach(_20c,function(item){_208.newItem(item,_20b,_20a);});}}if(!_205.isDragging&&!_207.isDragging){this.onDndEnd();}}if(this===_207&&_205!==_207&&!copy&&_205.onDndItemRemoved){var _210=_1f7.map(_206,function(node){return this._getDndData(_205.getItem(node.id),this.accept,false);},this);_205.onDndItemRemoved(_210,_205,_206,copy,_207);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_211){this.inherited(arguments);var m=_1fe.manager();if(m.canDropFlag){when(this.checkItemAcceptance(this.current.rowNode,m.source,this.dropPosition.toLowerCase()),function(_212){m.canDrop(_212);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(lang.hitch(this,function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}),500);}},onDndEnd:function(){},onDndItemRemoved:function(_213,_214,_215,copy,_216){},itemCreator:function(_217,_218,_219,_21a){return _1f7.map(_217,function(node){return {id:node.id,name:node.textContent||node.innerText||"",dndData:this._getDndData(_219.getItem(node.id),this.accept,this===_219)};},this);},getItem:function(key){var item=this.inherited(arguments);if(this.tree.getItemType&&item&&item.data&&item.data.item){item.type=this.tree.getItemType(item.data.item);}item.options=this.getItemOptions(item);return item;},getItemOptions:function(item){var opts={};if(item.data){if(item.data.getParent){var _21b=item.data.getParent();opts.oldParentItem=_21b?_21b.item:null;}if(item.data.getIndexInParent){opts.indexInParent=item.data.getIndexInParent();}}return opts;},onMouseDown:function(e){var _21c=_1fa.contains(e.target,"dojoDndContainerOver");if(_21c){return;}this.inherited(arguments);},checkAcceptance:function(_21d,_21e){if(this.readOnly){return false;}var _21f=_1f7.map(_21e,function(node){return _21d.getItem(node.id);});return this._checkAcceptanceForItems(_21f,this.accept);}});});},"dijit/tree/dndSource":function(){define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(_220,_221,_222,_223,_224,lang,on,_225,_226,_227,_228){var _229=_222("dijit.tree.dndSource",_228,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_22a){if(!_22a){_22a={};}lang.mixin(this,_22a);var type=_22a.accept instanceof Array?_22a.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_223.add(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_223.add(this.node,"dojoDndTarget");}this.topics=[_226.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_226.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_226.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_226.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];},checkAcceptance:function(){return true;},copyState:function(_22b){return this.copyOnly||_22b;},destroy:function(){this.inherited(arguments);var h;while(h=this.topics.pop()){h.remove();}this.targetAnchor=null;},_onDragMouse:function(e,_22c){var m=_227.manager(),_22d=this.targetAnchor,_22e=this.current,_22f=this.dropPosition;var _230="Over";if(_22e&&this.betweenThreshold>0){if(!this.targetBox||_22d!=_22e){this.targetBox=_224.position(_22e.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_230="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_230="After";}}}if(_22c||_22e!=_22d||_230!=_22f){if(_22d){this._removeItemClass(_22d.rowNode,_22f);}if(_22e){this._addItemClass(_22e.rowNode,_230);}if(!_22e){m.canDrop(false);}else{if(_22e==this.tree.rootNode&&_230!="Over"){m.canDrop(false);}else{var _231=false;if(m.source==this){for(var _232 in this.selection){var _233=this.selection[_232];if(_233.item===_22e.item){_231=true;break;}}}if(_231){m.canDrop(false);}else{if(this.checkItemAcceptance(_22e.rowNode,m.source,_230.toLowerCase())&&!this._isParentChildDrop(m.source,_22e.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_22e;this.dropPosition=_230;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_227.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _234=this.getSelectedTreeNodes();if(_234.length){if(_234.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_234[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_234=r;}_234=_220.map(_234,function(n){return n.domNode;});m.startDrag(this,_234,this.copyState(_221.isCopyKey(e)));this._onDragMouse(e,true);}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(){return true;},onDndSourceOver:function(_235){if(this!=_235){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_227.manager();m.canDrop(false);}}},onDndStart:function(_236,_237,copy){if(this.isSource){this._changeState("Source",this==_236?(copy?"Copied":"Moved"):"");}var _238=this.checkAcceptance(_236,_237);this._changeState("Target",_238?"":"Disabled");if(this==_236){_227.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_239){return _220.map(_239,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_23a,_23b,copy){if(this.containerState=="Over"){var tree=this.tree,_23c=tree.model,_23d=this.targetAnchor;this.isDragging=false;var _23e;var _23f;var _240;_23e=(_23d&&_23d.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_23e=(_23d.getParent()&&_23d.getParent().item)||tree.item;_23f=_23d.getIndexInParent();if(this.dropPosition=="After"){_23f=_23d.getIndexInParent()+1;_240=_23d.getNextSibling()&&_23d.getNextSibling().item;}else{_240=_23d.item;}}else{_23e=(_23d&&_23d.item)||tree.item;}var _241;_220.forEach(_23b,function(node,idx){var _242=_23a.getItem(node.id);if(_220.indexOf(_242.type,"treeNode")!=-1){var _243=_242.data,_244=_243.item,_245=_243.getParent().item;}if(_23a==this){if(typeof _23f=="number"){if(_23e==_245&&_243.getIndexInParent()<_23f){_23f-=1;}}_23c.pasteItem(_244,_245,_23e,copy,_23f,_240);}else{if(_23c.isItem(_244)){_23c.pasteItem(_244,_245,_23e,copy,_23f,_240);}else{if(!_241){_241=this.itemCreator(_23b,_23d.rowNode,_23a);}_23c.newItem(_241[idx],_23e,_23f,_240);}}},this);this.tree._expandNode(_23d);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_227.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_227.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_246,_247){if(!_246.tree||_246.tree!=this.tree){return false;}var root=_246.tree.domNode;var ids=_246.selection;var node=_247.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});return _229;});},"epi/shell/widget/Tree":function(){define("epi/shell/widget/Tree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dijit/focus","dijit/Tree"],function(_248,_249,lang,dom,_24a,Tree){return _249(Tree,{dndParams:["accept","reject"].concat(Tree.prototype.dndParams),postCreate:function(){this.inherited(arguments);this.connect(this.model,"onItemChildrenReload","_onChildrenReload");},_onChildrenReload:function(_24b){var _24c=this.model.getIdentity(_24b),_24d=this._itemNodesMap[_24c];if(_24d){if(_248.some(_24d,function(node){return node.state==="LOADED";})){this.model.getChildren(_24b,lang.hitch(this,function(_24e){_248.forEach(_24d,function(_24f){_24f.setChildItems(_24e);});_248.forEach(_24e,function(_250){this.model.onChange(_250);this._onChildrenReload(_250);},this);}));}else{_248.forEach(_24d,function(node){node.isExpandable=this.model.mayHaveChildren(node.item);node._setExpando(false);},this);}}},_onItemChildrenChange:function(){var _251=null;if(_24a.curNode&&dom.isDescendant(_24a.curNode,this.domNode)){_251=_24a.curNode;}this.inherited(arguments);if(_251){if(dom.isDescendant(_251,this.domNode)){_251.focus();}else{var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}}}}});});},"epi-cms/widget/_ContentTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/string","dijit/Tree","dijit/_TemplatedMixin","dojox/html/ellipsis","epi-cms/widget/_ContentTreeNodeMixin","dojo/text!./templates/_ContentTreeNode.html"],function(_252,_253,_254,_255,Tree,_256,_257,_258,_259){return _252([Tree._TreeNode,_256,_258],{templateString:_259,buildRendering:function(){this.inherited(arguments);_253.add(this.labelNode,"dojoxEllipsis");},_setItemAttr:function(item){this._set("item",item);this.set("dndData",item);if(item&&item.thumbnailUrl){var _25a=_254.create("img",{src:item.thumbnailUrl+_255.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"});this.thumbnailNode.appendChild(_25a);_253.add(this.contentNode,"epi-mediaContent");}this.inherited(arguments);}});});},"dojox/html/ellipsis":function(){define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){if(d.isFF<7){var _25b=1;if("dojoxFFEllipsisDelay" in d.config){_25b=Number(d.config.dojoxFFEllipsisDelay);if(isNaN(_25b)){_25b=1;}}try{var _25c=(function(){var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var xml=document.createElementNS(sNS,"window");var _25d=document.createElementNS(sNS,"description");_25d.setAttribute("crop","end");xml.appendChild(_25d);return function(n){var x=xml.cloneNode(true);x.firstChild.setAttribute("value",n.textContent);n.innerHTML="";n.appendChild(x);};})();}catch(e){}var _25e=d.create;var dd=d.doc;var dp=d.place;var _25f=_25e("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});var _260=function(r,cnt){if(r.collapsed){return;}if(cnt>0){do{_260(r);cnt--;}while(cnt);return;}if(r.endContainer.nodeType==3&&r.endOffset>0){r.setEnd(r.endContainer,r.endOffset-1);}else{if(r.endContainer.nodeType==3){r.setEndBefore(r.endContainer);_260(r);return;}else{if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){var _261=r.endContainer.childNodes[r.endOffset-1];if(_261.nodeType==3){r.setEnd(_261,_261.length-1);}else{if(_261.childNodes.length){r.setEnd(_261,_261.childNodes.length);_260(r);return;}else{r.setEndBefore(_261);_260(r);return;}}}else{r.setEndBefore(r.endContainer);_260(r);return;}}}};var _262=function(n){var c=_25e("div",{className:"dojoxEllipsisContainer"});var e=_25e("div",{className:"dojoxEllipsisShown",style:{display:"none"}});n.parentNode.replaceChild(c,n);c.appendChild(n);c.appendChild(e);var i=_25f.cloneNode(true);var ns=n.style;var es=e.style;var _263;var _264=function(){ns.display="";es.display="none";if(n.scrollWidth<=n.offsetWidth){return;}var r=dd.createRange();r.selectNodeContents(n);ns.display="none";es.display="";var done=false;do{var _265=1;dp(r.cloneContents(),e,"only");var sw=e.scrollWidth,ow=e.offsetWidth;done=(sw<=ow);var pct=(1-((ow*1)/sw));if(pct>0){_265=Math.max(Math.round(e.textContent.length*pct)-1,1);}_260(r,_265);}while(!r.collapsed&&!done);};i.onload=function(){i.contentWindow.onresize=_264;_264();};c.appendChild(i);};var hc=d.hasClass;var doc=d.doc;var s,fn,opt;if(doc.querySelectorAll){s=doc;fn="querySelectorAll";opt=".dojoxEllipsis";}else{if(doc.getElementsByClassName){s=doc;fn="getElementsByClassName";opt="dojoxEllipsis";}else{s=d;fn="query";opt=".dojoxEllipsis";}}fx=function(){d.forEach(s[fn].apply(s,[opt]),function(n){if(!n||n._djx_ellipsis_done){return;}n._djx_ellipsis_done=true;if(_25c&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){_25c(n);}else{_262(n);}});};d.addOnLoad(function(){var t=null;var c=null;var _266=function(){if(c){d.disconnect(c);c=null;}if(t){clearTimeout(t);}t=setTimeout(function(){t=null;fx();c=d.connect(d.body(),"DOMSubtreeModified",_266);},_25b);};_266();});}});},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,_267,_268){var _269={};lang.setObject("dojo.colors",_269);var _26a=function(m1,m2,h){if(h<0){++h;}if(h>1){--h;}var h6=6*h;if(h6<1){return m1+(m2-m1)*h6;}if(2*h<1){return m2;}if(3*h<2){return m1+(m2-m1)*(2/3-h)*6;}return m1;};dojo.colorFromRgb=_267.fromRgb=function(_26b,obj){var m=_26b.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(m){var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){var r=c[0];if(r.charAt(r.length-1)=="%"){a=_268.map(c,function(x){return parseFloat(x)*2.56;});if(l==4){a[3]=c[3];}return _267.fromArray(a,obj);}return _267.fromArray(c,obj);}if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;a=[_26a(m1,m2,H+1/3)*256,_26a(m1,m2,H)*256,_26a(m1,m2,H-1/3)*256,1];if(l==4){a[3]=c[3];}return _267.fromArray(a,obj);}}return null;};var _26c=function(c,low,high){c=Number(c);return isNaN(c)?high:c<low?low:c>high?high:c;};_267.prototype.sanitize=function(){var t=this;t.r=Math.round(_26c(t.r,0,255));t.g=Math.round(_26c(t.g,0,255));t.b=Math.round(_26c(t.b,0,255));t.a=_26c(t.a,0,1);return this;};_269.makeGrey=_267.makeGrey=function(g,a){return _267.fromArray([g,g,g,a]);};lang.mixin(_267.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});return _267;});},"epi-cms/widget/_ContentTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","epi-cms/ContentLanguageHelper"],function(_26d,lang,when,_26e,_26f,_270,_271){return _26d(null,{_missingLanguageCssClass:"epi-ct-missingLanguageRow",_updateItemClasses:function(item){this.inherited(arguments);this._updateLayout();},_updateLayout:function(){this.inherited(arguments);this._updateLanguageIndicator();this._updateIndividualLayout();},_updateIndividualLayout:function(){},_addLanguageIndicator:function(){var _272=this.item.missingLanguageBranch;if(this.iconNodeLanguage){this.iconNodeLanguage.innerHTML=_272.language||"";when(_271.getMissingLanguageMessage(this.item),lang.hitch(this,function(_273){_26e.set(this.iconNodeLanguage,"title",_273||"");}));}_26f.add(this.rowNode,this._missingLanguageCssClass);},_removeLanguageIndicator:function(){if(this.iconNodeLanguage){_270.empty(this.iconNodeLanguage);_26e.remove(this.iconNodeLanguage,"title");}_26f.remove(this.rowNode,this._missingLanguageCssClass);},_updateLanguageIndicator:function(){if(!this._isTypeOfRoot()&&this.item.missingLanguageBranch){this._addLanguageIndicator();}else{this._removeLanguageIndicator();}},_isTypeOfRoot:function(){if(!this.tree.model||typeof this.tree.model.isTypeOfRoot!=="function"){return false;}return this.tree.model.isTypeOfRoot(this.item);}});});},"epi-cms/ContentLanguageHelper":function(){define("epi-cms/ContentLanguageHelper",["dojo/_base/lang","dojo/_base/declare","dojo/_base/Deferred","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(lang,_274,_275,all,_276,_277){return {getMissingLanguageMessage:function(_278){if(!_278||!_278.missingLanguageBranch){return "";}this._languageStore=this._languageStore||_276.resolve("epi.storeregistry").get("epi.cms.language");var def=new _275();var _279=_278.missingLanguageBranch;all([this._languageStore.get(_279.preferredLanguage),this._languageStore.get(_279.language)]).then(lang.hitch(this,function(_27a){var _27b=_279.reason;var _27c="languagenotifications.";if(_27b===6){_27c+="missing";}else{if(_27b===3||_27b===5){_27c+="replacement";}else{if(_27b===4){_27c+="fallback";}}}var _27d=_277.getResourceValue(_278.typeIdentifier,_27c);_27d=lang.replace(_27d,[_27a[0].name,_27a[1].name]);def.resolve(_27d);}),function(){def.resolve("");});return def;}};});},"url:epi-cms/widget/templates/_ContentTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>            \r\n            <span data-dojo-attach-point=\"thumbnailNode\" class=\"epi-thumbnailIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentTreeModelConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/string","dojo/when","dojo/_base/json","dojox/html/entities","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_27e,lang,_27f,_280,_281,when,json,_282,_283,_284,_285,_286,_287,_288,_289,res,_28a){return function(_28b){var _28c=function(_28d){return _28d&&typeof _28d=="function";};var _28e=function(_28f,_290){var _291=new _286({description:_284.toHTML(_28f),onAction:function(){if(_28c(_290)){_290();}}});_291.show();};var _292=function(_293,_294){var _295=new _280();when(_294,function(_296){var _297=new _287({description:_284.toHTML(_296),title:_293,onAction:function(_298){_298?_295.resolve():_295.cancel();}});_297.show();});return _295;};var _299=function(_29a,_29b){when(_29a,function(_29c){if(_29c&&(_29c.message||_29c.statusDescription)){var _29d=_29c.message||_29c.statusDescription;_28e(_29d,_29b);}else{if(_28c(_29b)){_29b();}}},function(e){_28e(_282.encode(json.fromJson(e.xhr.responseText)));});return _29a;};_27f.around(_28b,"pasteItem",function(_29e){return function(_29f,_2a0,_2a1,copy,_2a2){var _2a3=_285.getResourceValue(_29f.typeIdentifier,"move");var _2a4=true;if(_2a1.isWastebasket){_2a4=_289({contentData:_29f});}else{if(_2a2!==undefined&&(_2a1.properties.pageChildOrderRule!==_288.sortOrder.Index)){var _2a5=_281.substitute(res.changepeerorderconfirmation,[_28b.getLabel(_2a1)]);_2a4=_292(_2a3,_2a5);}else{if(!copy){if(!_28b.canCut(_29f)){_28e(_285.getResourceValue(_29f.typeIdentifier,"moverequiresdeleteaccess"),function(){return false;});return;}var _2a6="{0}<br/><br/>{1}",_2a7=lang.replace(_2a6,[_285.getResourceValue(_29f.typeIdentifier,"moveconfirmation"),_285.getResourceValue(_29f.typeIdentifier,"movedescription")]);var _2a8=_283.resolve("epi.cms.ProjectService");if(_2a8.isProjectModeEnabled){_2a7=lang.replace(_2a6,[_2a7,_28a.moveconfirmation]);}_2a4=_292(_2a3,_2a7);}else{if(!_28b.canCopy(_29f)){_28e(_285.getResourceValue(_29f.typeIdentifier,"copynotsupported"));return;}}}}var _2a9=arguments;return when(_2a4,function(){return _29e.apply(_28b,_2a9);},function(){return false;});};});_27f.after(_28b,"pasteItem",function(_2aa){return _2aa&&_299(_2aa);});_27f.after(_28b,"remove",function(_2ab){return _2ab&&_299(_2ab);});return _28b;};});},"epi-cms/contentediting/ContentActionSupport":function(){define(["epi/i18n!epi/cms/nls/episerver.cms.versionstatus"],function(res){var _2ac={},_2ad;if(res){_2ac={0:res.notcreated,1:res.rejected,2:res.checkedout,3:res.checkedin,4:res.published,5:res.previouslypublished,6:res.delayedpublish,7:res.awaitingapproval,100:res.expired};}_2ad={versionStatus:{NotCreated:0,Rejected:1,CheckedOut:2,CheckedIn:3,Published:4,PreviouslyPublished:5,DelayedPublish:6,AwaitingApproval:7,Expired:100},versionLocalizations:_2ac,getVersionStatus:function(_2ae){return this.versionLocalizations[_2ae];},action:{Create:"Create",Edit:"Edit",Delete:"Delete",CheckIn:"CheckIn",Save:"Save",Reject:"Reject",Publish:"Publish",Administer:"Administer",CheckOut:"CheckOut"},accessLevel:{NoAccess:0,Read:1,Create:2,Edit:4,CheckIn:4,Delete:8,Publish:16,Administer:32,FullAccess:63},saveAction:{None:0,Save:1,CheckIn:2,Publish:3,Reject:4,RequestApproval:5,CheckOut:6,Schedule:7,ForceNewVersion:128,ForceCurrentVersion:256,SkipValidation:512,DelayedPublish:1024},sortOrder:{None:0,CreatedDescending:1,CreatedAscending:2,Alphabetical:3,Index:4,ChangedDescending:5,Rank:6,PublishedAscending:7,PublishedDescending:8},providerCapabilities:{None:0,Create:1,Edit:2,Delete:4,Move:8,Copy:16,MultiLanguage:32,Security:64,Search:128,PageFolder:256,Wastebasket:512},isActionAvailable:function(_2af,_2b0,_2b1,_2b2,_2b3){return _2ad.hasAccessToAction(_2af,_2b0,_2b1,_2b2,_2b3)&&_2ad.canPerformAction(_2af,_2b0);},hasAccessToAction:function(_2b4,_2b5,_2b6,_2b7,_2b8){var _2b9;if(!_2b4){return false;}if(!_2b7&&_2b4.capabilities&&_2b4.capabilities.language&&_2b4.missingLanguageBranch&&_2b4.missingLanguageBranch.isTranslationNeeded){return false;}if(_2b6&&!_2ad.hasProviderCapability(_2b4.providerCapabilityMask,_2b6)){return false;}_2b9=_2b8?_2b4.accessRights:_2b4.accessMask;return _2ad.hasAccess(_2b9,_2ad.accessLevel[_2b5]);},canPerformAction:function(_2ba,_2bb){if(_2ba.status===_2ad.versionStatus.DelayedPublish&&(_2bb===_2ad.action.Edit||_2bb===_2ad.action.Publish)){return false;}if(_2bb===_2ad.action.Publish){return !(_2ba.status===_2ad.versionStatus.Published||_2ba.status===_2ad.versionStatus.Expired);}if(_2bb===_2ad.action.CheckIn){return _2ba.status===_2ad.versionStatus.CheckedOut||_2ba.status===_2ad.versionStatus.Rejected;}if(_2bb===_2ad.action.Edit){var _2bc=(_2ba.status===_2ad.versionStatus.Published&&!_2ba.isCommonDraft)||(_2ba.status===_2ad.versionStatus.Expired&&!_2ba.isCommonDraft)||_2ba.status===_2ad.versionStatus.PreviouslyPublished||(_2ba.status===_2ad.versionStatus.CheckedIn&&!_2ba.isPartOfAnotherProject)||_2ba.status===_2ad.versionStatus.DelayedPublish;return !(_2bc||_2ba.isDeleted||_2ba.isWastebasket);}return true;},hasAccess:function(_2bd,_2be){return (_2bd&_2be)===_2be;},hasLanguageAccess:function(item){if(!item){return false;}var _2bf=item.languageContext||item.missingLanguageBranch||item;return !_2bf||(_2bf.hasTranslationAccess&&_2bf.isPreferredLanguageAvailable);},getPermissionMap:function(_2c0){var map={};for(var al in _2ad.accessLevel){map[al]=_2ad.hasAccess(_2c0,_2ad.accessLevel[al]);}return map;},hasProviderCapability:function(_2c1,_2c2){return (_2c1&_2c2)===_2c2;}};return _2ad;});},"epi-cms/widget/sharedContentDialogHandler":function(){define(["dojo/_base/lang","dojo/Deferred","dojo/when","dojox/html/entities","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(lang,_2c3,when,_2c4,epi,_2c5,_2c6,_2c7,_2c8,_2c9,_2ca){var _2cb=function(_2cc){var _2cd=new _2c3(),_2ce=_2cc.contentData.contentLink,_2cf=_2c5.resolve("epi.storeregistry"),_2d0=_2cf.get("epi.cms.content.search"),_2d1=new _2c8({target:document.body,zIndex:999}).placeAt(document.body);_2d1.show(50,0);when(_2d0.get(_2ce),function(_2d2){var mode=_2cc.mode||_2cb.mode.confirm,_2d3=mode===_2cb.mode.confirm,_2d4=new _2c9({model:{contentData:_2d2,mode:mode}});var _2d5=_2d4.watch("numberOfReferences",function(_2d6,_2d7,_2d8){_2d5.remove();var _2d9;if(_2d3){var key=_2d2.hasChildren?"movetotrashwithsubcontentdescription":"movetotrashdescription";_2d9=_2c6.getResourceValue(_2d2.typeIdentifier,key);}else{_2d9=_2c6.getResourceValue(_2d2.typeIdentifier,"referencesdescription");}_2d9=lang.replace(_2d9,[_2c4.encode(_2d2.name)]);var _2da=_2cc.title;if(!_2da){var _2db=_2d3?"movetotrash":"references";_2da=_2c6.getResourceValue(_2d2.typeIdentifier,_2db);}var _2dc=new _2c7({focusActionsOnLoad:true,defaultActionsVisible:_2d3,dialogClass:"epi-dialog-contentReferences",title:_2da,description:_2d9,cancelActionText:epi.resources.action.cancel,confirmActionText:_2d8===0?_2ca.buttons.movetotrash:_2ca.buttons.movetotrashanyway,setFocusOnConfirmButton:_2d8===0});if(!_2d3){_2dc.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:_2dc.onCancel});}_2dc.connect(_2dc,"onExecute",_2cd.resolve);_2dc.connect(_2dc,"onCancel",_2cd.cancel);_2dc.set("content",_2d4);var _2dd=_2d4.on("viewReference",function(){_2dc.hide();_2dd.remove();});_2d1.hide();_2dc.show();});_2d4.startup();});return _2cd.promise;};_2cb.mode={confirm:"confirm",show:"show"};return _2cb;});},"epi-cms/widget/ContentReferences":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/when","epi-cms/dgrid/formatters","epi/shell/TypeDescriptorManager","epi/dependency","./_GridWidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/Evented","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_2de,lang,_2df,_2e0,_2e1,keys,when,_2e2,_2e3,_2e4,_2e5,_2e6,_2e7,_2e8,_2e9,_2ea){return _2de([_2e5,_2e6,_2e7,_2e8],{res:_2ea,templateString:_2e9,storeKeyName:"epi.cms.contentreferences",contextChangeEvent:"dblclick",trackActiveItem:false,ignoreVersionWhenComparingLinks:false,_setTotalLinksAttr:{node:"totalLinksNode",type:"innerText"},_setNotificationAttr:{node:"contentReferencesNotificationNode",type:"innerText"},_setNotificationBarStyleAttr:function(_2eb){switch(_2eb){case 1:_2df.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorOk");break;case 2:_2df.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorWarning");break;}},_setNumberOfReferencesAttr:function(_2ec){var _2ed=this.model.contentData,_2ee=_2ec>0;var _2ef=lang.hitch(this,function(_2f0,_2f1){var text=_2e3.getResourceValue(_2ed.typeIdentifier,_2f0);this.set("notification",text);this.set("notificationBarStyle",_2f1);});if(_2ee){if(_2ed.hasChildren){_2ef("referenceswithsubcontentwarning",2);}else{_2ef("referenceswarning",2);}}else{if(_2ed.hasChildren){_2ef("noreferenceswithsubcontentwarning",null);}else{if(_2ed.publicUrl){_2ef("publicreferencesnote",null);}else{_2ef("noreferencesnote",1);}}}if(_2ee){var _2f2=_2ec===1?_2ea.totallink:_2ea.totallinks;var _2f3=lang.replace(_2f2,[_2ec]);this.set("totalLinks",_2f3);}this._set("numberOfReferences",_2ec);},_setShowToolbarAttr:function(_2f4){_2e1.set(this.captionPanelNode,"display",_2f4?"":"none");},buildRendering:function(){var _2f5=this._getLinkTemplate();var _2f6=lang.mixin({columns:{name:{renderCell:lang.hitch(this,"_renderContentItem")},language:{className:"epi-width10",renderCell:function(obj,_2f7,node){when(_2e4.resolve("epi.shell.Profile").getContentLanguage(),function(_2f8){if(_2f7!==_2f8){node.textContent=_2f7;}});}},treePath:{className:"epi-width50",get:function(item){return item.treePath.join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");},ellipsisNoTooltip:true},view:{className:"epi-width10",label:" ",formatter:function(){return _2f5;},sortable:false}},store:this.store,query:{id:this.model.contentData.contentLink},showHeader:false},this.defaultGridMixin);this.inherited(arguments);this.grid=new this._gridClass(_2f6,this.gridNode);_2df.toggle(this.contentReferencesNotificationBar,"dijitHidden",this.model.mode==="show");},startup:function(){this.inherited(arguments);this.grid.on(".dgrid-column-view a:click",lang.hitch(this,"_onChangeContext"));this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_afterDataFetched"));},fetchData:function(){this.grid.refresh();},_afterDataFetched:function(e){when(e.results.total,lang.hitch(this,function(_2f9){this.set("numberOfReferences",_2f9);this.set("showToolbar",_2f9>0);_2e1.set(this.grid.domNode,"visibility",(_2f9>0)?"visible":"hidden");}));},_onChangeContext:function(e){var row=this.grid.row(e),_2fa={uri:row.data.uri};this._requestNewContext(_2fa,{sender:this});this.emit("viewReference");},_getLinkTemplate:function(){var node=_2e0.create("a",{"class":"epi-visibleLink",innerHTML:_2ea.view.label,title:_2ea.view.tooltip});return node.outerHTML;}});});},"epi-cms/dgrid/formatters":function(){define(["dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","epi/string","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(lang,_2fb,_2fc,_2fd,_2fe,_2ff,misc,_300,_301,_302){var _303={defaultIconClass:"epi-iconObjectUnknown",thumbnail:function(_304){var _305="<image src=\"{0}?{1}\" class=\"epi-floatLeft epi-thumbnail\"/>";return _304?lang.replace(_305,[_304,new Date().getTime()]):"";},contentIcon:function(_306,_307){var _308=_300.getValue(_306,"iconClass");var _309=_308+" epi-objectIcon";if(_307){_309+=" "+_307;}return misc.icon(_309);},contentTypeDescription:function(_30a){return _300.getResourceValue(_30a,"name",false);},languageBranch:function(_30b){return _30b?"<span class=\"epi-missingLanguageIndicator\">"+_30b.language+"</span>":"";},menu:function(_30c){return lang.replace("<span class=\"dijitInline dijitIcon epi-iconContextMenu epi-floatRight\" title=\"{title}\">&nbsp;</span>",_30c);},path:function(path){if(path&&path.length){var _30d=misc.attributeEncode(path.join(" > "));path=_2fe.truncateMiddle(path,40,"…");var text=path.map(misc.htmlEncode).join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");return lang.replace("<span class=\"dgrid-column-treePath dojoxEllipsis\" title=\"{title}\">{text}</span>",{title:_30d,text:text});}return "";},userName:function(_30e){return _2fd.toUserFriendlyHtml(_30e);},localizedDate:function(date){return _2fc.toUserFriendlyHtml(date);},friendlyBoolean:function(_30f){var _310=_30f?"epi-iconCheckmark":"epi-iconStop";return "<div class=\""+_310+"\" />";},versionStatus:function(_311){return _301.getVersionStatus(_311);},commonDraft:function(item,_312,node){if(item.isCommonDraft){node.innerHTML="<span class=\"dijitReset dijitInline dijitIcon epi-iconPrimary epi-floatRight\" title=\""+_302.primarydraft+"\"></span>";}node.innerHTML+=_303.versionStatus(_312);},visibleLink:function(_313,_314){if(!_313){return "";}var text=!_314?misc.htmlEncode(_313):_313;return "<span class=\"epi-visibleLink\">"+text+"</span>";},secondaryText:function(_315,_316){if(!_315){return "";}var text=!_316?misc.htmlEncode(_315):_315;return "<span class=\"epi-secondaryText\">"+text+"</span>";},contentItemFactory:function(_317,_318,_319,_31a,_31b,_31c,_31d){return function(_31e,_31f,node,_320){var _321,_322,text,_323,_324,_325,_326;function get(name){if(typeof _31f.get==="function"){return _31f.get(name);}return _31f[name];};function _327(_328){if(_328){if(typeof _328==="function"){return _328(_31f);}else{return get(_328);}}return _31e;};_325=typeof _31e==="string";_322=_327(_319||(_325?false:"typeIdentifier"));text=_327(_317||(_325?false:"text"));_323=_327(_318||(_325?false:"title"));_324=(_31c&&_327(_31c))||_31f.missingLanguageBranch;_326=_31b&&_327(_31b);_321=_303.contentItem(_322,_324,text,_323,_31a,_326,_31d);node.innerHTML=_321;if(node.nodeName!=="TD"&&_324){_2fb.add(node,"epi-ct-missingLanguageRow");}return _321;};},contentItem:function(_329,_32a,text,_32b,_32c,_32d,_32e){var menu=(_32c&&_32c.hasMenu)?_303.menu(_32c.settings):"",_32f=_303.languageBranch(_32a);_32e=(_32e===null||_32e===undefined)?true:_32e;_32b=_32e?misc.attributeEncode(_32b||text):(_32b||text);text=_32e?misc.htmlEncode(text):text;return (_32d?_303.thumbnail(_32d):_303.contentIcon(_329))+menu+_32f+misc.ellipsis(text,_32b);}};_2ff.addFormatter("contentIcon",_303.contentIcon);_2ff.addFormatter("userName",_303.userName);_2ff.addFormatter("versionStatus",_303.versionStatus);_2ff.addFormatter("localizedDate",_303.localizedDate);_2ff.addFormatter("contentItem",_303.contentItemFactory,true);return _303;});},"epi/username":function(){define("epi/username",["dojox/html/entities","epi/dependency","epi/i18n!epi/shell/ui/nls/episerver.shared.text"],function(_330,_331,_332){return {toUserFriendlyString:function(_333,_334,_335,_336,_337){if(!_334){_334=this._getCurrentUsername();}var _338=_336?"":_332.installer,_339=_337?_332.yousubject:_332.youobject,_33a=_333&&_334.toLowerCase()===_333.toLowerCase()?_339:_333||_338;if(_335){_33a=_33a.charAt(0).toUpperCase()+_33a.slice(1);}return _33a;},toUserFriendlyHtml:function(_33b,_33c,_33d,_33e,_33f){var _340=this.toUserFriendlyString(_33b,_33c,_33d,_33e,_33f);if(_340===""){return _340;}return "<span class='epi-username'>"+_330.encode(_340)+"</span>";},_getCurrentUsername:function(){if(!this.currentUsername){var _341=_331.resolve("epi.shell.Profile");this.currentUsername=_341.get("userName");}return this.currentUsername;}};});},"epi/shell/dgrid/Formatter":function(){define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_342,_343,when,Grid,_344){var _345=_342(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof Grid;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _346;_343.forEach(this.subRows,function(_347){_343.forEach(_347,function(_348){_346=[];_343.forEach(_345.shorthands,function(_349){var _34a=_348[_349],_34b=_345.formatters[_349];if(!!_34a){if(_34b){_346.push(_34b.isFactory?_34b.handler(_34a):_34b.handler);}else{throw new Error("Formatter with key "+_349+" not found");}}});if(_348.formatters){this._findFormatters(_348.formatters,_346);}if(_346.length>0){_348=_344(_348,_346);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(data,_34c,row){return data;}];}}},renderRow:function(_34d,_34e){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_34e]),data=this.field?_34d[this.field]:_34d,_34f=this._resolvedFormatters,i=-1;function _350(_351){var _352=_34f[i],_353;if(_352){row.innerHTML=_351;data=_351;}i++;if(_34f.length>i){_352=_34f[i];_353=_352(data,_34d,row);when(_353,_350);}};if(_34f.length>0){_350();}return row;},_findFormatters:function(_354,_355){_355=_355||[];_343.forEach(_354,function(_356){var type=typeof _356,item,_357;if(type==="string"){item=_345.formatters[_356];if(item){_357=item.isFactory?item.handler():item.handler;_357.allParameters=item.allParameters;}}else{if(type==="function"){_357=_356;}}if(_357){_355.push(_357);}else{throw new Error("Formatter with key "+_356+"not found");}});return _355;}});_345.formatters={};_345.shorthands=[];_345.addFormatter=function(name,_358,_359,_35a){_345.formatters[name]={handler:_358,isFactory:!!_359};if(_35a){_345.shorthands.push(name);}};return _345;});},"epi/shell/dgrid/TemplateColumn":function(){define("epi/shell/dgrid/TemplateColumn",["dojo/_base/array"],function(_35b){return function(_35c,_35d){var _35e=_35c.renderCell;_35c.formatters=_35d||_35c.formatters;if(_35c.formatters&&_35c.formatters.length>0){_35c.renderCell=function(_35f,_360,cell,_361){_35b.forEach(_35c.formatters,function(_362){_360=_362(_360,_35f,cell,_361);});if(_360){cell.innerHTML=_360;}};}return _35e?_35e.call(_35c):_35c;};});},"epi/shell/dgrid/util/misc":function(){require({cache:{"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}"}});define("epi/shell/dgrid/util/misc",["dojo/_base/declare","dojo/_base/lang","dojox/html/entities","epi/shell/dgrid/Formatter","dojo/text!dojox/html/resources/ellipsis.css"],function(_363,lang,_364,_365,_366){var _367={_attributeEncodeMap:[["&","amp"],["\"","quot"]],htmlEncode:function(text){return _364.encode(text);},attributeEncode:function(text){return _364.encode(text,_367._attributeEncodeMap);},ellipsis:function(text,_368){if(!_368||!lang.isString(_368)){_368=text;}return lang.replace("<div class=\"dojoxEllipsis\" title=\"{0}\">{1}</div>",[_368,text]);},ellipsisNoTooltip:function(text){return lang.replace("<div class=\"dojoxEllipsis\">{0}</div>",[text]);},icon:function(icon,text){text=text||"";return lang.replace("<span class=\"dijitInline dijitIcon {0}\"></span>{1}",[icon,text]);}};_365.addFormatter("htmlEncode",_367.htmlEncode,false,true);_365.addFormatter("icon",function(icon){return function(_369){return _367.icon(icon,_369);};},true,true);_365.addFormatter("ellipsis",_367.ellipsis,false,true);_365.addFormatter("ellipsisNoTooltip",_367.ellipsisNoTooltip,false,true);return _367;});},"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}","epi-cms/widget/_GridWidgetBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/keys","dojo/topic","dojo/when","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/layout/_LayoutWidget","epi","epi/datetime","epi/UriParser","epi/username","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi/dependency"],function(_36a,lang,_36b,_36c,keys,_36d,when,_36e,_36f,_370,_371,epi,_372,_373,_374,_375,_376,_377,_378,DnD,_379,_37a,_37b){return _36a([_371,_377],{_gridClass:_36a([_36f,_375,_370,DnD,_36e,_37a]),storeKeyName:null,grid:null,store:null,ignoreVersionWhenComparingLinks:true,trackActiveItem:true,defaultGridMixin:null,currentItem:null,contextChangeEvent:"click",postMixInProperties:function(){this.inherited(arguments);this.defaultGridMixin={selectionMode:"single",dndParams:{creator:lang.hitch(this,this._dndNodeCreator),copyOnly:true,selfAccept:false}};if(!this.store&&this.storeKeyName){var _37c=_37b.resolve("epi.storeregistry");this.store=_37c.get(this.storeKeyName);}},startup:function(){this.inherited(arguments);if(this.contextChangeEvent){var _37d=lang.hitch(this,"_onChangeContext");this.grid.on(".dgrid-row:"+this.contextChangeEvent,_37d);if(typeof this.grid.addKeyHandler=="function"){this.grid.addKeyHandler(keys.ENTER,_37d);this.grid.addKeyHandler(keys.SPACE,_37d);}}this.grid.on("dgrid-select",lang.hitch(this,"_onSelect"));this.grid.on("dgrid-error",lang.hitch(this,"_onError"));if(this.trackActiveItem){this.own(_36b.after(this.grid,"insertRow",lang.hitch(this,this._selectActiveItem)));}this.own(this.connect(this,"layout",lang.hitch(this,function(){this.grid.resize();})));this.grid.startup();},destroy:function(){if(this.grid){this.grid.destroy();}this.inherited(arguments);},select:function(item){this.grid.clearSelection();if(item){var _37e=(item instanceof _378?item:new _378(item.id)).createVersionUnspecificReference().toString();this.grid.select(_37e);}},_forceKeepContext:function(uri){return this._isSameAsCurrentContext(uri);},_onChangeContext:function(e){this._onChangeContextInternal(e);},_onChangeContextInternal:function(e){var row=this.grid.row(e),uri=row.data.uri,_37f={uri:uri};if(this._forceKeepContext(uri)){return;}this._requestNewContext(_37f,{sender:this});},_onSelect:function(e){},_onError:function(e){var _380=this.grid.errorMessage;var _381=e.error;if(_381.status&&_381.status===403){_380=epi.resources.messages.nopermissiontoviewdata;}this._showErrorMessage(_380);},_requestNewContext:function(_382,_383){_36d.publish("/epi/shell/context/request",_382,_383);},restore:function(){this.resize();},_isActiveItem:function(row){return when(this.getCurrentContext(),lang.hitch(this,function(_384){var _385=row.data.uri;return _384&&this._compareUris(_385,_384.uri);}));},_selectActiveItem:function(node){var row=this.grid.row(node);if(!row){return node;}when(this._isActiveItem(row),lang.hitch(this,function(_386){if(_386){if(this.grid.selectionMode==="single"){this.grid.clearSelection();}this.grid.select(row,null);}}));return node;},contextChanged:function(_387,_388){this.inherited(arguments);if(_387.type!=="epi.cms.contentdata"){return;}if(!_388||_388.sender!==this){this.onContextChanged(_387);}},onContextChanged:function(_389){this.fetchData();},fetchData:function(){},_showErrorMessage:function(_38a){this.grid.cleanup();this.grid.contentNode.innerHTML=_38a||"";},contextChangeFailed:function(_38b,_38c,_38d){this.inherited(arguments);if(_38d&&_38d.sender===this){this._selectActiveItem();}},_renderContentItem:function(_38e,_38f,node,_390){node.innerHTML=_379.contentItem(_38e.typeIdentifier,_38e.missingLanguageBranch,_38f);},_localizeDate:function(_391){return _379.localizedDate(_391);},_createUserFriendlyUsername:function(name){return _379.userName(name);},_dndNodeCreator:function(item,hint){var _392=_376.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_392&&this.dndTypes){_392=this.dndTypes;}var node=_36c.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_392,data:item};},_aroundInsertRow:function(_393){return lang.hitch(this,function(_394,_395,_396,i,_397){var row=_393.apply(this.grid,arguments);var _398=this.get("currentItem");if(_398){var _399=(_398 instanceof _378?_398:new _378(_398.id)).createVersionUnspecificReference().toString();if(_399===_394.contentLink){this.select(_398);}}return row;});},_getCurrentItem:function(){return when(this.getCurrentContext(),function(_39a){return {id:(new _378(_39a.id)).id};});}});});},"epi-cms/dgrid/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_39b,lang,_39c,_39d,_39e,_39f,_3a0,put){var _3a1=_39b(_39d,{_legalMouseDown:function(evt){var _3a2=this.inherited(arguments);return _3a2&&evt.target!==this.grid.bodyNode;},getSelectedNodes:function(){var grid=this.grid;var _3a3=this.inherited(arguments);if(!grid.selection||Object.keys(grid.selection).length===0){if(_3a3.length){grid.select(_3a3[0]);}return _3a3;}var _3a4=false;var _3a5=new _39c();for(var id in grid.selection){if(grid.row(id).element!==_3a3[0]){_3a5.push(grid.row(id).element);}else{_3a4=true;_3a5.push(_3a3[0]);}}if(_3a4){return _3a5;}grid.clearSelection();if(_3a3.length){grid.select(_3a3[0]);}return _3a3;},destroy:function(){this.grid=null;this.inherited(arguments);}});return _39b([],{dndSourceTypes:null,dndParams:null,dndConstructor:_3a1,dndDisabled:false,dndFormatSuffix:null,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},destroy:function(){this.inherited(arguments);this.dndSource&&this.dndSource.destroy();this.dndParams=this.dndSource=null;},insertRow:function(_3a6){var row=this.inherited(arguments);if(this.dndDisabled){return row;}put(row,".dojoDndItem");this._setupDnD();var opts={};if(this.query){opts.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_3a6,type:this._getDndType(_3a6),options:opts});return row;},_getDndType:function(_3a7){var _3a8=_3a0.getAndConcatenateValues(_3a7.typeIdentifier,"dndTypes");if((!_3a8||_3a8.length<=0)&&this.dndSourceTypes){_3a8=this.dndSourceTypes;}if(this.dndFormatSuffix){_3a8=_3a8.map(lang.hitch(this,function(type){return type+"."+this.dndFormatSuffix;}));}return _3a8;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=lang.hitch(this,this._dndNodeCreator);}this.dndSource=new this.dndConstructor(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(item,hint){var _3a9,node;_3a9=this._getDndType(item);if(!_3a9&&this.dndTypes){_3a9=this.dndTypes;}node=_39e.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_3a9,data:item};}});});},"epi-cms/dgrid/WithContextMenu":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/query","dgrid/extensions/DijitRegistry","epi/shell/DestroyableByKey","epi/shell/widget/ContextMenu","epi-cms/extension/events"],function(_3aa,_3ab,_3ac,_3ad,on,_3ae,_3af,_3b0,_3b1,_3b2){return _3aa([_3b0,_3af],{contextMenu:null,commandCategory:"context",stopPropagation:false,_contextMenuClass:"epi-iconContextMenu",postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _3b1({category:this.commandCategory,popupParent:this});this.own(this.contextMenu,this.on("."+this._contextMenuClass+":click",this._contextMouseHandler.bind(this)),this.on(on.selector(".dgrid-row",_3b2.keys.shiftf10),this._contextKeyHandler.bind(this)));},startup:function(){this.inherited(arguments);this.contextMenu.startup();},onContextMenuClick:function(e){on.emit(e.target,"dgrid-contextmenu",{bubbles:true});this.contextMenu.scheduleOpen(this.domNode,null,{x:e.pageX,y:e.pageY});},_extendedSelectionHandler:function(e,_3b3){var _3b4=new RegExp("\\b"+this._contextMenuClass+"\\b");if(_3b4.test(e.target.className)&&this.isSelected(_3b3)){return;}this.inherited(arguments);},_isNodeVisible:function(_3b5){if(!_3b5){return false;}var _3b6=_3ad.get(_3b5);return _3b6.display!=="none"&&_3b6.visibility!=="hidden";},_contextMouseHandler:function(e){if(this.stopPropagation){e.stopImmediatePropagation();e.stopPropagation();}this.onContextMenuClick(e);},_contextKeyHandler:function(e){var _3b7=_3ae("."+this._contextMenuClass,e.target)[0],_3b8;if(!this._isNodeVisible(_3b7)){return;}e.stopPropagation();e.preventDefault();_3b8=_3ac.position(_3b7);this.onContextMenuClick({target:_3b7,pageX:_3b8.x,pageY:_3b8.y});}});});},"epi/shell/widget/ContextMenu":function(){define("epi/shell/widget/ContextMenu",["dojo/_base/declare","dojo/aspect","dijit/Menu","dijit/popup","epi/shell/command/_CommandConsumerMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuWithSeparatorBuilder"],function(_3b9,_3ba,Menu,_3bb,_3bc,_3bd,_3be,_3bf){var _3c0;_3ba.before(_3bb,"open",function(args){var _3c1=args.popup;if(_3c1&&_3c1 instanceof _3c0&&_3c1.popupParent){args.parent=_3c1.popupParent;return [args];}});return _3c0=_3b9([Menu,_3bc],{category:null,leftClickToOpen:true,postCreate:function(){this.inherited(arguments);var _3c2={builder:new _3be(),target:this,category:this.category},_3c3;var _3c4=[_3c2,{builder:new _3bf(),target:this,category:"menuWithSeparator"},{builder:new _3be(),target:this,category:"popup"}];_3c3=new _3bd({configuration:_3c4,commandSource:this});_3c3.build();},scheduleOpen:function(_3c5,_3c6,_3c7,_3c8){this._scheduleOpen(_3c5,_3c6,_3c7,_3c8);}});});},"epi/shell/command/builder/MenuWithSeparatorBuilder":function(){define("epi/shell/command/builder/MenuWithSeparatorBuilder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/MenuSeparator","./MenuBuilder"],function(_3c9,_3ca,lang,on,_3cb,_3cc){return _3ca([_3cc],{_addToContainer:function(_3cd,_3ce){this.inherited(arguments,[_3cd,_3ce]);var _3cf=new _3cb({_command:{order:_3cd._command.order}});this.inherited(arguments,[_3cf,_3ce]);}});});},"epi-cms/extension/events":function(){define(["dojo/keys","dojo/on"],function(keys,on){function _3d0(e){return e.keyCode===keys.DELETE;};function _3d1(e){return e.shiftKey;};function _3d2(e){return e.keyCode===keys.F10;};function _3d3(e){return _3d1(e)&&_3d2(e);};function _3d4(type,_3d5){var _3d6=function(node,_3d7){return on(node,type,function(evt){if(_3d5){return _3d5(evt,_3d7);}return _3d7.call(this,evt);});};return _3d6;};return {selector:on.selector,contextmenu:_3d4("contextmenu",function(e,_3d8){_3d8.call(this,e);}),keys:{shiftf10:_3d4("keyup",function(e,_3d9){if(_3d3(e)){_3d9.call(this,e);}}),del:_3d4("keydown",function(e,_3da){if(_3d0(e)){_3da.call(this,e);}})}};});},"url:epi-cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\r\n    <div data-dojo-attach-point=\"contentReferencesNotificationBar\" class=\"epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\r\n        <div data-dojo-attach-point=\"contentReferencesNotificationNode\" class=\"epi-notificationBarText\" ></div>\r\n    </div>\r\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <strong data-dojo-attach-point=\"totalLinksNode\"></strong>\r\n        <div class=\"epi-floatRight\">\r\n            <button class=\"epi-chromelessButton\"\r\n                    data-dojo-type=\"dijit/form/Button\"\r\n                    data-dojo-attach-event=\"onClick:fetchData\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>\r\n","epi-cms/widget/ContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi-cms/widget/ContentTreeStoreModel"],function(_3db,_3dc,lang,_3dd,when,_3de){return _3dc([_3de],{root:null,constructor:function(){this.root={id:"0",name:"ROOT"};},isRoot:function(_3df){var _3e0=this.inherited(arguments);return _3e0||!!(_3df&&this.roots&&(_3db.indexOf(this.roots,this.getIdentity(_3df))>=0));},getRoot:function(_3e1){_3e1(this.root);},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_3e2,_3e3,_3e4){if(_3e2===this.root){var _3e5=_3db.map(this.roots,function(item){return this.store.get(item);},this);when(_3dd(_3e5),_3e3,_3e4);}else{this.inherited(arguments);}},getAncestors:function(item,_3e6){if(this.roots.some(function(_3e7){return this.getIdentity(item)===_3e7;},this)){_3e6([this.root]);return;}var root=this.root,_3e8=lang.hitch(this,function(_3e9){if(_3db.some(this.roots,function(_3ea){return this.getIdentity(_3e9[0])===_3ea;},this)){_3e9.unshift(root);}_3e6(_3e9);});this.inherited(arguments,[item,_3e8]);},getIdentity:function(item){return (item===this.root)?this.root.id:this.inherited(arguments);},canCopy:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canCut:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canDelete:function(item){return !this.isTypeOfRoot(item)&&this.inherited(arguments);},canEdit:function(item){return !this.isRoot(item)&&this.inherited(arguments);}});});},"epi-cms/widget/ContentTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/when","dojo/topic","epi","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/shell/_ContextMixin","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_HierarchicalModelMixin","epi-cms/widget/viewmodel/_UpdateableStoreModelMixin"],function(_3eb,_3ec,_3ed,lang,_3ee,_3ef,_3f0,when,_3f1,epi,_3f2,_3f3,_3f4,_3f5,_3f6,_3f7,_3f8,_3f9,_3fa,_3fb){return _3ed([_3f3,_3fa,_3fb,_3f5],{store:null,root:null,notAllowToDelete:null,notAllowToCopy:null,typeIdentifiers:null,showAllLanguages:true,getChildrenQuery:"getchildren",getRootChildrenQuery:null,_observers:null,_defaultDataStoreName:"epi.cms.content.light",additionalQueryOptions:{},createAsLocalAsset:false,autoSelectPastedItem:true,constructor:function(args){_3ed.safeMixin(this,args);this._observers={};this.store=this.store||_3f2.resolve("epi.storeregistry").get(this._defaultDataStoreName);this._queryOptions=lang.mixin({ignore:["query"],comparers:{typeIdentifiers:lang.hitch(this,function(_3fc,_3fd){return _3eb.some(_3fc,lang.hitch(this,function(item){return item===_3fd.typeIdentifier||_3f4.isBaseTypeIdentifier(_3fd.typeIdentifier,item);}));}),referenceId:function(_3fe,_3ff){return _3f9.compareIgnoreVersion(_3fe,_3ff.parentLink);},allLanguages:function(_400,_401){if(_400||!_401.currentLanguageBranch){return true;}return epi.areEqual(_3f7.currentContentLanguage,_401.currentLanguageBranch.languageId);}},sort:this._getSortSettings(this.typeIdentifiers)},this.additionalQueryOptions);var _402=_3ec.subscribe("/epi/cms/contentdata/updated",this,function(_403){this.store.refresh(_403.contentLink).then(lang.hitch(this,function(){if(_403.recursive){this.onItemChildrenReload(_403);}}));});var _404=_3ec.subscribe("/epi/cms/contentdata/childrenchanged",lang.hitch(this,this._childrenChanged));var _405=_3ec.subscribe("/epi/cms/contentdata/restored",this,function(_406){this._childrenChanged(_406);});var _407=_3ee.after(this.store,"onItemChanged",lang.hitch(this,function(id,item){this.onChange(item);}),true);this._handles=[_402,_404,_405,_407];},destroy:function(){for(var id in this._observers){this._observers[id].cancel();this._observers[id]=null;}if(this._handles){_3eb.forEach(this._handles,function(_408){_408.remove();});this._handles=null;}},isSupportedType:function(_409){return _3eb.some(this.typeIdentifiers,function(type){return type===_409||_3f4.isBaseTypeIdentifier(_409,type);});},_setShowAllLanguagesAttr:function(_40a){this._set("showAllLanguages",_40a);this.onItemChildrenReload(this.root);},getRoot:function(_40b,_40c){if(lang.isArray(this.root)){_40b({});}else{when(this.store.get(this.root),_40b,_40c);}},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_40d,_40e){var id=this.getIdentity(_40d),_40f=id===this.root,_410=_40f&&this.getRootChildrenQuery?this.getRootChildrenQuery:this.getChildrenQuery,_411=this._createQuery({referenceId:id,query:_410}),_412=this.store.query(_411,this._queryOptions),_413=lang.hitch(this,function(item){this.onChange(item);when(this.store.query(_411,this._queryOptions),lang.hitch(this,function(_414){this.onChildrenChange(_40d,_414);}));});var _415=this._observers[id];if(_415){_415.cancel();delete this._observers[id];}this._observers[id]=_412.observe(_413,true);when(_412,_40e);},_getSortSettings:function(_416){if(!_416){return {};}if(_416 instanceof String){_416=[_416];}var self=this,_417,_418=[];_416.map(function(type){_417=_3f4.getValue(type,"sortKey");if(_417){_418.push(_417.sortDescending?{attribute:_417.columnName,descending:true}:{attribute:_417.columnName});}});return _418;},_createQuery:function(_419,_41a){var _41b=this.typeIdentifiers&&(lang.isArray(this.typeIdentifiers)?this.typeIdentifiers:this.typeIdentifiers.split(","));var _41c=this.showAllLanguages?{allLanguages:true}:{},_41d=_41a?{}:{typeIdentifiers:_41b};var _41e=lang.mixin(_419,_41d,_41c);return _41e;},_createChildrenQuery:function(_41f,_420){var _421=lang.mixin(_41f,{query:"getchildren"});return this._createQuery(_421,_420);},move:function(_422,_423){if(!_423.contentLink){_423=this.store.get(_423);}var _424=_3eb.map(_422,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_425){return this.pasteItem(item.data,_425,_423,false);}));},this);return _3f0(_424).then(lang.hitch(this,function(_426){if(_423.contentLink===_3f7.wastebasketPage){var _427=_422.filter(function(i,_428){return !!_426[_428];});if(_427.length){this.onDeleted(_427);}}}));},remove:function(_429){var _42a=_429.map(function(item){return this.store.remove(item.data.contentLink);},this);return _3f0(_42a).then(lang.hitch(this,function(){this.onDeleted(_429);}));},copy:function(_42b,_42c){var _42d=_3eb.map(_42b,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_42e){return this.pasteItem(item.data,_42e,_42c,true);}));},this);return _3f0(_42d);},pasteItem:function(_42f,_430,_431,copy,_432){var id=this.getIdentity(_42f),_433=_431&&_431.isWastebasket,_434=copy?this.store.copy:this.store.move,_435={targetId:this.getIdentity(_431),createAsLocalAsset:this.createAsLocalAsset,sortIndex:_432};return _434.call(this.store,id,_435).then(lang.hitch(this,function(_436){if(_433){this.onDelete(_42f,true);}else{_3f1.publish("/epi/cms/contentdata/childrenchanged",_431.contentLink);}var _437=copy?_436.extraInformation:_42f.contentLink;var _438=_3f9.toContentReference(_437).createVersionUnspecificReference().toString();return when(this.store.refresh(_438),lang.hitch(this,function(item){this._onPasteComplete(item,copy,_433,_430,_431);return _436;}));}));},onPasteComplete:function(){},_onPasteComplete:function(item,copy,_439,_43a,_43b){this.onPasteComplete();this._selectItemOnPasteComplete(item,copy,_439,_43a,_43b);this.inherited(arguments);},_selectItemOnPasteComplete:function(item,copy,_43c,_43d,_43e){if(this.autoSelectPastedItem&&item&&item.contentLink&&!_43c){this.onSelect(item.contentLink,true);}},newItem:function(args,_43f){if(args.dndData&&args.dndData.data){var _440=this.getParentItem(args.dndData);this._pasteNewItem(args.dndData.data,_440,_43f);}},getParentItem:function(_441){if(_441&&_441.data){var _442=_441.data["parentLink"];if(_442){_442=new _3f9(_442).createVersionUnspecificReference().toString();}return {contentLink:_442};}},_pasteNewItem:function(_443,_444,_445){this.pasteItem(_443,_444,_445,false);},_updateItemChanged:function(_446){when(this.store.refresh(_446),lang.hitch(this,function(_447){this._childrenChanged(_447);}));},_childrenChanged:function(_448){var dfd=new _3ef();this.getChildren(_448,lang.hitch(this,function(_449){this.onChildrenChange(_448,_449);dfd.resolve(_449);}));return dfd;},_isNodeAContextAncestor:function(_44a,_44b){var dfd=new _3ef();this.getAncestors(_44b,function(arr){var _44c=arr.map(function(e){return e.contentLink;});var _44d=_44c.indexOf(_44a)!==-1||_3f9.compareIgnoreVersion(_44a,_44b.id);dfd.resolve(_44d);});return dfd;},getIdentity:function(item){if(lang.isObject(item)){return this.store.getIdentity(item);}return item;},getObjectIconClass:function(item,_44e){var _44f=_3f4.getValue(item.typeIdentifier,"iconClass");if(!_44f){return _44e;}var _450="";switch(parseInt(item.contentLink,10)){case _3f7.globalAssetsFolder:_450="AllSites";break;case _3f7.siteAssetsFolder:_450="ThisSite";break;default:break;}return (_450===""&&_44f===_44e)?_44f:(_44e+" "+_44f+_450);},getLabel:function(item){return item.name;},canExpandTo:function(item){var _451=new _3ef();this.getAncestors(item,lang.hitch(this,function(_452){_451.resolve(this.getIdentity(_452[0])===this.root.id);}));return _451.promise;},canCopy:function(item){if(!item){return false;}var _453=item.contentLink,_454=_453===this.root||(_3eb.indexOf(this.notAllowToCopy,_453)>=0);return !_454&&_3f8.hasAccess(item.accessMask,_3f8.accessLevel.Read)&&_3f8.hasProviderCapability(item.providerCapabilityMask,_3f8.providerCapabilities.Copy);},canCut:function(item){if(!item){return false;}var _455=item.contentLink,_456=_455===this.root||(_3eb.indexOf(this.notAllowToDelete,_455)>=0);return !_456&&_3f8.isActionAvailable(item,_3f8.action.Delete,_3f8.providerCapabilities.Move,true);},canDelete:function(item){if(!item){return false;}var _457=item.contentLink,_458=_457===this.root||(_3eb.indexOf(this.notAllowToDelete,_457)>=0);return !_458&&_3f8.isActionAvailable(item,_3f8.action.Delete,_3f8.providerCapabilities.Delete,true);},canPaste:function(item,_459,_45a){if(!item||!_459){return false;}var _45b=_45a&&_459.isWastebasket,_45c=!_45a&&(this.getIdentity(item)===this.getIdentity(_459)),_45d=!_45a&&(item.parentLink===this.getIdentity(_459)),_45e=_3f8.isActionAvailable(_459,_3f8.action.Create,_3f8.providerCapabilities.Create,true);return !_459.isDeleted&&!_45b&&!_45c&&!_45d&&_45e;},canEdit:function(item){if(!item){return false;}var _45f=item.contentLink,_460=_45f===this.root;return !_460&&_3f8.hasAccess(item.accessMask,_3f8.accessLevel.Edit);},onItemChildrenReload:function(_461){},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onDeleted:function(_462){var item=_462[0].data;if(item){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _463=item.capabilities.isPage;when(this._isNodeAContextAncestor(item.contentLink,ctx),lang.hitch(this,function(_464){if(_463&&!_464){return;}if(!_463&&_464){_3f1.publish("/epi/shell/context/request",{uri:_3f6.settings.defaultContext});return;}this.onSelect(item.parentLink,true);}));}));}},onSelect:function(item,_465,_466){}});});},"epi-cms/widget/_HierarchicalModelMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/_HierarchicalModelMixin"],function(_467,lang,_468){return _467([_468],{isTypeOfRoot:function(_469){return !!(_469&&(this.isRoot(_469)||_469.isSubRoot));},isRoot:function(_46a){return !!(_46a&&this.root&&_46a===this.root);}});});},"epi/shell/_HierarchicalModelMixin":function(){define("epi/shell/_HierarchicalModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when"],function(_46b,_46c,lang,_46d,all,when){return _46c([],{parentProperty:"parentLink",store:null,constructor:function(_46e){_46c.safeMixin(this,_46e);},getParentIdentity:function(item){return lang.getObject(this.parentProperty,false,item);},isAncestor:function(_46f,_470){var _471=this.store.getIdentity(_46f),_472=this.store.getIdentity(_470),_473=this.getParentIdentity(_470);if(_471==_472||(_470.parentLink&&_46f.contentLink==_470.parentLink)){return true;}if(_473){return false;}return when(this.store.get(_473),lang.hitch(this,function(_474){return this.isAncestor(_46f,_474);}));},getAncestors:function(item,_475){if(!this.store){_475([]);return;}var obj=typeof item==="object"?item:this.store.get(item);when(obj,lang.hitch(this,function(_476){when(this._getAncestors([_476]),_475);}));},_getAncestors:function(_477){if(this._hasRoot(_477)){return _477.slice(0,-1);}var _478=this.getParentIdentity(_477[0]);if(!_478){return _477.slice(0,-1);}return when(this.store.get(_478),lang.hitch(this,function(_479){if(_479){_477.unshift(_479);return this._getAncestors(_477);}return _477.slice(0,-1);}));},_hasRoot:function(_47a){var _47b=this.roots||[this.root];if(!_47a.length||!_47b.length||typeof this.getIdentity!=="function"){return false;}var _47c=this.getIdentity(_47a[0]);return _46b.some(_47b,function(root){return root==_47c;},this);},refreshAncestors:function(item,_47d){var _47e=this.store,_47f=new _46d(),_480=[],_481=[];this.getAncestors(item,function(_482){_46b.forEach(_482,function(_483){if(!_47d||_47d(_483)){_480.push(when(_47e.refresh(_47e.getIdentity(_483)),function(item){_481.push(item);}));}});all(_480).then(function(){_47f.resolve(_481);});});return _47f.promise;}});});},"epi-cms/widget/viewmodel/_UpdateableStoreModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Evented","dojo/json","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference"],function(_484,_485,lang,_486,_487,json,_488,when,_489,_48a,_48b,_48c){return _485(_487,{updateableStore:null,updateableStoreKey:"epi.cms.contentdata",currentContentService:null,propertyNames:{name:"icontent_name",nameInUrl:"iroutable_routesegment"},refreshTranslatedAncestors:true,onAddDelegate:null,postscript:function(){this._setupStore();this.currentContentService=new _48b();},_setupStore:function(){if(!this.updateableStore&&this.updateableStoreKey){this.updateableStore=_489.resolve("epi.storeregistry").get(this.updateableStoreKey);}},rename:function(id,name){var self=this,_48d=new _486();when(self.patch(id,{name:name,nameInUrl:null}),function(item){when(self.refreshTranslated(id),function(){_48d.resolve(item);},function(e){_48d.reject(e);});},function(e){_48d.reject(e);});return _48d;},translate:function(item){var self=this,id=self.getIdentity(item),_48e={masterLanguageVersionId:id,name:item.name,contentTypeId:item.contentTypeID};return when(self.updateableStore.put(_48e),function(){when(self.store.refresh(id),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);});});});},add:function(item,_48f){var self=this;var def=new _486();when(self.updateableStore.add(item),function(_490){var id=self.getContentId(_490),_491=self.getParentIdentity(item),_492=null;when(self.updateableStore.get(id),function(_493){if(self.getParentIdentity(_493)!==_491){_492=typeof _48f=="function"&&_48f();}when(_492,function(){when(self._childrenChanged(_491),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);def.resolve(_493);});});});});});return def.promise;},patch:function(id,_494){var self=this,_495=new _486(),_496={id:id,properties:{}};for(var key in _494){if(_494.hasOwnProperty(key)){_496.properties[this._convertPropertyName(key)]=json.stringify(_494[key]);}}when(self.updateableStore.patch(_496,{id:_496.id}),function(item){if(item&&item.successful){var _497={contentLink:id,properties:_496.properties,capabilities:{supportsVersions:false}};lang.mixin(_497,_494);when(self.updateableStore.patchCache(_497),_495.resolve,_495.reject);}else{return _495.reject(item&&item.validationErrors);}});return _495;},_convertPropertyName:function(name){return this.propertyNames[name]||name;},refreshTranslated:function(_498){var self=this,_499=new _486(),_49a;function _49b(item){var id=self.getIdentity(item),_49c=self.getParentIdentity(item);if(_49c===self.root||id===self.root||!item.missingLanguageBranch){return false;}return true;};if(!self.refreshTranslatedAncestors){return _499.resolve();}when(self.refreshAncestors(_498,_49b),function(_49d){if(!(_49d instanceof Array)||_49d.length===0){_499.resolve();return;}_49d.reverse();var _49e=_484.some(_49d,function(item){if(!!item.missingLanguageBranch){_49a=self.getLabel(item);return true;}return false;});when(self.store.get(_498),function(_49f){if(_49e&&_49f&&!_49f.missingLanguageBranch){self.emit("translationFailed",_49a);}_499.resolve();});});return _499;},getContentId:function(_4a0){return _48c.toContentReference(_4a0).id.toString();},_onPasteComplete:function(item,copy,_4a1,_4a2,_4a3){if(!item){return;}if(!_4a1){this.refreshTranslated(this.getIdentity(item));}else{this.currentContentService.getCurrentContent().then(lang.hitch(this,function(_4a4){var _4a5=_48c.compareIgnoreVersion(item,_4a4)&&_4a4.isDeleted;if(!_4a5){return;}var _4a6=this._createQuery({referenceId:this.getIdentity(_4a2),query:this.getChildrenQuery},true);when(this.store.query(_4a6,this._queryOptions),lang.hitch(this,function(_4a7){var _4a8=_4a2?_4a2.contentLink:null;if(!_4a7||!(_4a7 instanceof Array)||_4a7.length<=0){_4a8=_48a.startPage;}if(_4a8){var _4a9={uri:"epi.cms.contentdata:///"+_4a8};_488.publish("/epi/shell/context/request",_4a9);}}));})).otherwise(function(){});}}});});},"epi-cms/widget/ContextualContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel"],function(_4aa,_4ab,lang,_4ac,_4ad,_4ae,_4af,when,_4b0,_4b1,_4b2,_4b3){return _4ab([_4b3,_4b1],{handleSelection:null,previousSelection:null,postscript:function(){this.inherited(arguments);this._handles.push(_4af.subscribe("/epi/cms/action/createlocalasset",lang.hitch(this,this.refreshRoots)));this._handles.push(_4af.subscribe("/epi/cms/action/togglecreatemode",lang.hitch(this,this._toggleContextualContent)));this._handles.push(_4ac.around(this,"pasteItem",lang.hitch(this,this._aroundPasteItem)));this._handles.push(_4ac.after(this.store,"get",lang.hitch(this,this._afterStoreGet)));},contextChanged:function(_4b4,_4b5){this.inherited(arguments);this.refreshRoots();},getChildren:function(_4b6,_4b7,_4b8){if(_4b6===this.root){when(this._getRootItems(),_4b7,_4b8);}else{if(this.isPseudoContextualRoot(_4b6)){_4b7([]);return;}this.inherited(arguments);}},getAncestors:function(item,_4b9){var _4ba=this.getInherited(arguments),_4bb=_4b9;when(this.getCurrentContent()).then(lang.hitch(this,function(_4bc){var _4bd=this.roots.concat(_4bc.assetsFolderLink),_4be=lang.hitch(this,function(_4bf){var _4c0;for(var i=_4bf.length-1;i>=0;i--){_4c0=_4bf[i];if(this.isContextualRoot(_4c0)){_4bf[i]=this.getContextualRoot(_4c0);}if(_4aa.indexOf(_4bd,this.getIdentity(_4c0))>=0){_4bf=_4bf.slice(i);_4bf.unshift(this.root);_4b9(_4bf);return;}}_4b9([this.root]);});if(_4aa.indexOf(_4bd,this.getIdentity(item))>=0){_4b9([this.root]);}_4bb=_4be;})).always(lang.hitch(this,function(){_4ba.apply(this,[item,_4bb]);}));},getObjectIconClass:function(_4c1,_4c2){var _4c3=this._currentContext&&this._currentContext.dataType;if(!_4c3){return this.inherited(arguments);}var _4c4=_4b0.getValue(_4c3,"iconClass");return this.isContextualContent(_4c1)?(_4c4?_4c2+" "+_4c4+"Contextual":_4c2):this.inherited(arguments);},onToggleContentDisplay:function(_4c5,_4c6){},onRefreshRoots:function(_4c7){},refreshRoots:function(_4c8){if(_4c8===this){return true;}var self=this;return when(self._getRootItems(),function(_4c9){self.onChildrenChange(self.root,_4c9);if(self.get("handleSelection")===true){return self._setSelection(lang.clone(_4c9).pop());}});},canCopy:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canCut:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canPaste:function(item,_4ca,_4cb){var self=this,_4cc=this.inherited(arguments),_4cd=new _4ad();if(_4cb){_4cd.resolve(_4cc);}else{self.getAncestors(_4ca,function(_4ce){var _4cf=self.isContextualContent(_4ca)||self.hasContextual(_4ce);if(_4cf){when(self.getCurrentContent()).then(function(_4d0){if(_4b2.compareIgnoreVersion(item.contentLink,_4d0.contentLink)){_4cd.resolve(false);}else{self.getAncestors(_4d0.contentLink,function(_4d1){var _4d2=_4aa.some(_4d1,function(_4d3){return item.contentLink===_4d3.contentLink;},this);_4cd.resolve(_4d2?false:_4cc);});}}).otherwise(function(){_4cd.resolve(false);});}else{_4cd.resolve(_4cc);}});}return _4cd.promise;},filterAncestors:function(_4d4){if(!(_4d4 instanceof Array)){return _4d4;}var _4d5=_4d4.indexOf(this._getPseudoContextualContent().toString());if(_4d5!==-1&&_4d5<_4d4.length-1){_4d4.splice(_4d5,1);}return _4d4;},_toggleContextualContent:function(_4d6){when(this.getCurrentContent(),lang.hitch(this,function(_4d7){this.onToggleContentDisplay(_4d7.assetsFolderLink,!_4d6);this._setSelection(null);}));},_setSelection:function(_4d8){var _4d9=this.roots.length>0?this.roots[0].toString():(!_4d8?null:_4d8.assetsFolderLink),_4da=_4d8!=null?_4d8.contentLink:_4d9,_4db=this.get("previousSelection"),_4dc=this.get("previousContextualSelection"),_4dd=_4dc&&_4dc.selectedContent,_4de=new _4ad();if(!(_4da&&_4db)){_4de.resolve();return _4de.promise;}var _4df=false,_4e0=_4db.selectedContent,_4e1=_4db.selectedAncestors,_4e2=_4e0.item&&!_4e0.item.contentLink;var _4e3=function(){_4de.resolve();};if(_4e2||this.hasContextual(_4e1)){this.onSelect(_4da,_4df,_4e3);}else{if(_4e0.item.contentLink===_4d9&&_4dd&&_4dd.item&&_4dd.item.contentLink){this.onSelect(_4dd.item.contentLink,_4df,_4e3);}else{_4de.resolve();}}return _4de.promise;},getRoots:function(_4e4){var def=new _4ad();var _4e5=this._getPseudoContextualContent().toString();var _4e6=function(_4e7){if(!_4e4){return true;}return _4e7!==_4e5;};var _4e8=function(_4e9){return _4e9.contentLink;};when(this._getRootItems(),function(_4ea){def.resolve(_4ea.map(_4e8).filter(_4e6));},def.reject);return def.promise;},_getRootItems:function(){var self=this,_4eb=self.store,_4ec=_4aa.map(self.roots,function(item){return _4eb.get(item);});var _4ed=when(_4ae([self.getCurrentContent(),self.getCurrentContext()]),function(_4ee){var _4ef=_4ee[0],_4f0=_4ee.length>1?_4ee[1]:null;var _4f1=new _4b2(_4ef.contentLink).createVersionUnspecificReference().toString();return when(_4eb.get(_4f1),function(_4f2){var _4f3=_4f0&&_4f0.currentMode==="create";if((_4f3&&self.get("view")==="contentselector")||!self.canHaveContextualContent(_4f2)){return null;}var _4f4=_4f2.assetsFolderLink;if(_4f4){var _4f5=function(_4f6){return when(_4eb.get(_4f6),function(_4f7){var _4f8={id:_4f7.contentLink,typeIdentifiers:self.typeIdentifiers,allLanguages:self.showAllLanguages};return when(_4eb.query(_4f8),function(_4f9){if(typeof self.isSupportedType==="function"&&!self.isSupportedType(_4f9.typeIdentifier)){return null;}if(!self.isPseudoContextualRoot(_4f9)){return self.getContextualRoot(_4f9);}else{return when(self.onRefreshRoots(_4f9),function(){return self._modifyContentAccess(_4f9,_4f2);});}});});};if(_4f4===self._getPseudoContextualContent().toString()){return when(_4eb.refresh(_4f1),function(_4fa){return _4f5(_4fa.assetsFolderLink);});}else{return _4f5(_4f4);}}return null;});},function(){return null;});_4ec.push(_4ed);return when(_4ae(_4ec),function(_4fb){return _4aa.filter(_4fb,Boolean);});},_aroundPasteItem:function(_4fc){var self=this;return function(_4fd,_4fe,_4ff,copy,_500){var _501=_4ff,_502=self.get("createAsLocalAsset");return when(self.getCurrentContent()).then(function(_503){if(!_502){_502=self.isPseudoContextualRoot(_501);self.set("createAsLocalAsset",_502);}_502&&(_501=_503);}).always(function(){return when(_4fc.apply(self,[_4fd,_4fe,_501,copy,_500]),function(_504){if(_502){self.set("createAsLocalAsset",false);return when(self.refreshRoots(),function(){_4af.publish("/epi/cms/action/createlocalasset",self);return _504;});}else{return _504;}});});};},_afterStoreGet:function(_505){var self=this;return when(_505,function(_506){return when(self.getCurrentContent(),function(_507){return self._modifyContentAccess(_506,_507);},function(_508){return _506;});});},_modifyContentAccess:function(_509,_50a){if(this.isContextualContent(_509)){var _50b=this.getContextualRoot(_509);return this.isPseudoContextualRoot(_509)?lang.mixin(_50b,{isPreferredLanguageAvailable:_50a.isPreferredLanguageAvailable,hasTranslationAccess:_50a.hasTranslationAccess,accessMask:_50a.accessRights}):_50b;}return _509;}});});},"epi-cms/widget/SearchBox":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/json","dojo/_base/lang","dojo/when","dojo/dom-construct","dijit/_Widget","epi/shell/SearchManager","epi-cms/widget/ContentSearchBox"],function(_50c,_50d,json,lang,when,_50e,_50f,_510,_511){return _50c([_50f],{area:null,searchRoots:null,filterOnCulture:null,triggerContextChange:true,_searchBox:null,_searchManager:null,innerSearchBoxClass:"",parameters:null,postCreate:function(){this.inherited(arguments);this._searchManager=new _510();when(this._searchManager.getStore(),lang.hitch(this,function(_512){this._searchBox=new _511({baseClass:this.innerSearchBoxClass,searchAttr:"searchQuery",store:_512});var _513=lang.mixin({filterOnDeleted:true},this.parameters);lang.mixin(this._searchBox.query,{parameters:json.toJson(_513)});this._searchBox.on("select",lang.hitch(this,function(_514){this._searchBox.set("value","");this._searchBox.focus();this._searchBox.toggleClearButton();this.onItemAction(_514);}));this.set("filterOnCulture",false);_50e.place(this._searchBox.domNode,this.domNode);}));},_setAreaAttr:function(_515){this._set("area",_515);if(this._searchBox){when(this._searchManager.getProviderQuery(_515),lang.hitch(this,function(_516){lang.mixin(this._searchBox.query,_516);}));}},_setSearchRootsAttr:function(_517){this._set("searchRoots",_517);if(this._searchBox){lang.mixin(this._searchBox.query,{searchRoots:_517});}},_setFilterOnCultureAttr:function(_518){this._set("filterOnCulture",_518);if(this._searchBox){lang.mixin(this._searchBox.query,{filterOnCulture:_518});}},onItemAction:function(item){if(this.triggerContextChange){var _519={uri:"epi.cms.contentdata:///"+item.metadata.id};if(item.metadata.isUntranslatedContent==="false"){_519.epslanguage=item.metadata.languageBranch;}_50d.publish("/epi/shell/context/request",[_519,{sender:null}]);}}});});},"epi/shell/SearchManager":function(){define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/_base/lang","dojo/DeferredList","epi/dependency"],function(_51a,_51b,_51c,lang,_51d,_51e){return _51a(null,{_providersStore:null,_resultsStore:null,constructor:function(){this._setupStores();},getProviderQuery:function(area){var _51f=new _51b();_51b.when(this.getProviders(area),lang.hitch(this,function(_520){if(_520&&_520.length>0){_51f.resolve(this._getQuery(_520[0],{}));}else{_51f.resolve();}}));return _51f;},getProviders:function(area){var _521=new _51b();_51b.when(this._providersStore.query({searchArea:area}),function(_522){if(_522&&_522.length>0){_521.resolve(_522);}else{_521.resolve();}});return _521;},getStore:function(){return this._resultsStore;},search:function(area,_523){var _524=new _51b();_51b.when(this.getProviders(area),lang.hitch(this,function(_525){if(_525&&_525.length>0){var _526=[];_51c.forEach(_525,function(_527,_528){_526.push(this._getData(_527,_523));},this);var _529=new _51d(_526),data=[];_529.then(function(_52a){_51c.forEach(_52a,function(item){if(lang.isArray(item[1])){data=data.concat(item[1]);}});_524.resolve(data);});}}));return _524;},_setupStores:function(){var _52b=_51e.resolve("epi.storeregistry");this._providersStore=_52b.get("epi.shell.searchproviders");this._resultsStore=_52b.get("epi.shell.searchresults");},_getQuery:function(_52c,_52d){var _52e={providerId:_52c.id};lang.mixin(_52e,_52d||{});return _52e;},_getData:function(_52f,_530){var _531=new _51b();_51b.when(this._resultsStore.query(this._getQuery(_52f,_530)),function(_532){if(_532&&_532.length>0){_531.resolve(_532);}else{_531.resolve();}});return _531;}});});},"epi-cms/widget/ContentSearchBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/Evented","dojo/keys","dojo/dom-attr","dojo/dom-style","epi/shell/widget/SuggestionBox","epi-cms/widget/SearchResultList","epi/i18n!epi/cms/nls/episerver.cms.widget.contentlist"],function(_533,lang,_534,_535,_536,keys,_537,_538,_539,_53a,_53b){return _533([_539,_536],{res:_53b,autoComplete:false,dropDownClass:_53a,queryExpr:"${0}",minimumNumberOfChar:1,postCreate:function(){this.inherited(arguments);this.searchDelay=this.defaultDelay;this.on("beforeSearch",lang.hitch(this,function(){if(this.dropDown){this.dropDown.showStandby(true);}}));this.on("searchComplete",lang.hitch(this,function(_53c){if(this.dropDown){this.dropDown.showStandby(false);}}));_535.before(this,"_startSearch",function(_53d,args){this.emit("beforeSearch",{});return [_53d,args];});},_openResultList:function(_53e,_53f,_540){this.emit("searchComplete",_53e);this._fetchHandle=null;this.dropDown.clearResultList();var _541=_53e.length>0||_540.start!==0;this.dropDown.showErrorMessage(!_541,this.res.contentnotfound);this.dropDown.showGrid(_541);if(_541){this.dropDown.createOptions(_53e,_540,lang.hitch(this,"_getMenuLabelFromItem"));}this._showResultList();},_onDropDownMouseDown:function(e){e.stopPropagation();},_onKey:function(evt){switch(evt.keyCode){case keys.ENTER:if(this.dropDown&&this.dropDown.selected){this.dropDown.handleKey(evt);this.closeDropDown();}else{if(!this._fetchHandle){this._startSearchFromInput();_534.stop(evt);}}break;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this.dropDown){this.dropDown.handleKey(evt);}_534.stop(evt);break;case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:this.inherited(arguments);}},_startSearchFromInput:function(){var key=this.focusNode.value;if(!key||key.length<this.minimumNumberOfChar){this.closeDropDown();return;}if(!this.dropDown){var _542=this.id+"_popup",_543=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _543({id:_542,dir:this.dir,textDir:this.textDir});_537.remove(this.textbox,"aria-activedescendant");_537.set(this.textbox,"area-owns",_542);this.dropDown.on("select",lang.hitch(this,function(_544){this.closeDropDown();this.emit("select",_544);}));_538.set(this.dropDown.domNode,"width",this.textbox.clientWidth+"px");}this._showResultList();this._startSearch(key);},_startSearchAll:function(){}});});},"epi/shell/widget/SuggestionBox":function(){define("epi/shell/widget/SuggestionBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dijit/_HasDropDown","dijit/form/_ComboBoxMenu","dijit/form/_AutoCompleterMixin","epi/shell/widget/SearchBox"],function(_545,lang,_546,_547,_548,_549,_54a){return _545([_54a,_547,_549],{dropDownClass:_548,buildRendering:function(){this.inherited(arguments);_546.set(this.textbox,"autocomplete","off");_546.set(this.textbox,"aria-haspopup","true");},postCreate:function(){this.inherited(arguments);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.closeDropDown();}));}});});},"epi/shell/widget/SearchBox":function(){require({cache:{"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>"}});define("epi/shell/widget/SearchBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/keys","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/TextBox","dojox/html/entities","dgrid/util/misc","epi","dojo/text!./templates/SearchBox.html","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.SearchBox"],function(_54b,lang,_54c,_54d,_54e,keys,_54f,_550,_551,_552,_553,_554,_555,epi,_556,_557){return _54b([_553],{templateString:_556,placeHolder:epi.resources.action.search,commonRes:epi.resources,defaultDelay:500,encodeSearchText:false,triggerChangeOnEnter:true,postCreate:function(){this.inherited(arguments);_54c.set(this.clearButton,"title",_557.clear);this.connect(this.clearButton,"onclick",lang.hitch(this,this.clearValue));this.toggleClearButton();this.connect(this,"_onInput",_555.debounce(lang.hitch(this,function(_558){this.toggleClearButton();this._valueChanged(_558);}),null,this.defaultDelay));},clearValue:function(){this.set("value","");this.focus();this.toggleClearButton();this._valueChanged();},toggleClearButton:function(){_54e.set(this.clearButton,"visibility",this.textbox.value?"visible":"hidden");},focus:function(){_552.focus(this.textbox);},_valueChanged:function(_559){if(_559&&_559.charOrCode){switch(_559.charOrCode){case keys.ESCAPE:this.clearValue();return;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.TAB:return;}if(!this.triggerChangeOnEnter&&_559.charOrCode===keys.ENTER){return;}}this.onSearchBoxChange(this.encodeSearchText?_554.encode(this.textbox.value):this.textbox.value);},onSearchBoxChange:function(_55a){}});});},"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\r\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\r\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\r\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\r\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\r\n    </div>\r\n</div>","epi-cms/widget/SearchResultList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/widget/Standby","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/_ListMouseMixin","dijit/form/_ComboBoxMenuMixin","epi/dependency","epi-cms/widget/_ContentListKeyMixin","epi-cms/widget/_ContentListMouseMixin","epi-cms/dgrid/formatters","epi/shell/dgrid/Formatter","dgrid/OnDemandList","dgrid/Selection","dgrid/Keyboard","dojo/text!./templates/SearchResultList.html"],function(_55b,lang,_55c,_55d,_55e,_55f,_560,_561,_562,_563,_564,_565,_566,_567,_568,_569,_56a,_56b,_56c,_56d){return _55b([_561,_562,_55c,_563,_564,_566,_567],{templateString:_56d,_standby:null,_messages:{nextMessage:"",previousMessage:""},postCreate:function(){this.inherited(arguments);var self=this,_56e=_565.resolve("epi.shell.Profile"),_56f=_55b([_56a,_56b,_56c,_569]),_570=function(item){return item.title;},_571=function(item){return item.metadata.typeIdentifier;},_572=function(item){var _573=self.grid.domNode,_574="epi-thumbnailContentList";(item.metadata.thumbnailUrl&&!_55e.contains(_573,_574))&&_55e.add(_573,_574);return item.metadata.thumbnailUrl;},_575=function(item){if(item.metadata&&item.metadata.languageBranch!==_56e.contentLanguage){return {language:item.metadata.languageBranch};}};this.grid=new _56f({formatters:[_568.contentItemFactory("title",_570,_571,null,_572,_575,false)],selectionMode:"single",cellNavigation:false});this.grid.set("showHeader",false);_55d.place(this.grid.domNode,this.containerNode);this.grid.on(".dgrid-row:click",lang.hitch(this,function(_576){var row=this.grid.row(_576);if(row){this._onSelect(row.data);}}));this._standby=new _560({target:this.domNode,color:"#fff"}).placeAt(document.body);this.own(this._standby);this.containerNode=this._getGridContainer();},startup:function(){this.inherited(arguments);this._standby.startup();},showStandby:function(show){if(!this._standby){return;}if(show){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},showGrid:function(show){_55f.set(this.grid.domNode,"display",show?"block":"none");},_onSelect:function(_577){this.emit("select",_577);},_getGridContainer:function(){return this.grid.contentNode;},createOptions:function(_578,_579,_57a){this.grid.renderArray(_578);return this.containerNode.childNodes;},clearResultList:function(){this.grid.refresh();},getHighlightedOption:function(){return null;},showErrorMessage:function(show,_57b){this.clearResultList();this.showStandby(false);if(show&&_57b){this.errorMessage.innerHTML=_57b;}_55f.set(this.errorMessage,"display",show?"block":"none");}});});},"epi-cms/widget/_ContentListKeyMixin":function(){define(["dojo/_base/declare","dojo/keys"],function(_57c,keys){return _57c(null,{handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.ENTER:if(this.selected&&this.grid.row(this.selected)){this._onSelect(this.grid.row(this.selected).data);}return false;default:return true;}}});});},"epi-cms/widget/_ContentListMouseMixin":function(){define(["dojo/_base/declare","dojo/dom-class"],function(_57d,_57e){return _57d(null,{onHover:function(node){},onUnhover:function(node){},onSelect:function(node){_57e.add(node,"dgrid-selected ui-state-active dgrid-focus");},onDeselect:function(node){_57e.remove(node,"dgrid-selected ui-state-active dgrid-focus");}});});},"url:epi-cms/widget/templates/SearchResultList.html":"<div class=\"epi-searchResultList\">\r\n    <div data-dojo-attach-point=\"containerNode\">\r\n        <div data-dojo-attach-point=\"errorMessage\" class=\"epi-searchResultListEmptyMessage\"></div>\r\n    </div>\r\n    <div class=\"dijitReset epi-searchResultListNavigation\">\r\n        <div data-dojo-attach-point=\"previousButton\" role=\"option\"></div>\r\n        <div data-dojo-attach-point=\"nextButton\" role=\"option\"></div>\r\n    </div>\r\n</div>","epi-cms/component/command/_GlobalToolbarCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/Button","epi/shell/command/_CommandProviderMixin"],function(_57f,lang,_580,_581){return _57f([_581],{addToLeading:function(_582,_583){this.addCommand(_582,_583);},addToCenter:function(_584,_585){_585=lang.mixin({category:"center"},_585);this.addCommand(_584,_585);},addToTrailing:function(_586,_587){_587=lang.mixin({category:"trailing"},_587);this.addCommand(_586,_587);},addCommand:function(_588,_589){_589=lang.mixin({iconClass:_588.iconClass,category:"leading",label:_588.label,tooltip:_588.tooltip,showLabel:false,widget:_580,model:_588},_589);_588=lang.delegate(_588,{settings:_589});this.add("commands",_588);}});});},"epi-cms/compare/command/CompareCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","./CompareSettingsModel","./CompareViewSelection","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.compare.command"],function(_58a,_58b,_58c,_58d,_58e,_58f,_590){var _591=_58a([_58e,_58f]);return _58a([_58b],{postscript:function(){this.inherited(arguments);var _592=new _58c();var _593={category:"compare"};this.add("commands",new _591({category:"compare",settings:_593,label:_590.togglecompare.label,iconClass:"epi-iconCompare",model:_592,property:"enabled"}));this.add("commands",new _58d({category:"compare",settings:_593,model:_592,label:_590.compareviewselection.label,optionsLabel:_590.compareviewselection.label,optionsProperty:"modeOptions",property:"mode"}));}});});},"epi-cms/compare/command/CompareSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi-cms/nls/episerver.cms.compare.mode"],function(_594,lang,_595,_596,when,_597,_598,res){return _594([_596,_597],{enabled:false,mode:"allpropertiescompare",_selectedCompareModeProfileKey:"epi.selected-comparemode-id",modeOptions:[{label:res.allpropertiescompare,value:"allpropertiescompare",iconClass:"epi-iconForms"},{label:res.sidebysidecompare,value:"sidebysidecompare",iconClass:"epi-iconLayout"}],constructor:function(){var self=this;this.profile=this.profile||_598.resolve("epi.shell.Profile");when(this._loadSelectedModeFromProfile(),lang.hitch(this,function(mode){if(mode){this.set("mode",mode);}}));this.own(_595.subscribe("/epi/shell/action/viewchanged",function(type,args,data){var view=data&&(data.viewName||(data.sender&&data.sender.viewName));var _599=self.modeOptions.some(function(_59a){return _59a.value===view;});self.set("enabled",_599,false);}),_595.subscribe("/epi/cms/action/switcheditmode",function(){self.set("enabled",false,false);}),_595.subscribe("/epi/cms/action/eyetoggle",function(_59b){if(_59b){self.set("enabled",false,false);_595.publish("/epi/shell/action/changeview/updatestate",{viewName:null});}}));},_enabledSetter:function(_59c,_59d){if(this.enabled!==_59c){this.enabled=_59c;(_59d!==false)&&this._onChange();}},_modeSetter:function(_59e){if(this.mode!==_59e){this.mode=_59e;this.get("enabled")&&this._onChange();this.profile.set(this._selectedCompareModeProfileKey,_59e,{location:"server"});}},_onChange:function(){_595.publish("/epi/shell/action/changeview",this.get("enabled")?this.get("mode"):null,null,{forceReload:true});},_loadSelectedModeFromProfile:function(){return when(this.profile.get(this._selectedCompareModeProfileKey),function(mode){if(!mode){return null;}return mode;});}});});},"epi-cms/compare/command/CompareViewSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand"],function(_59f,_5a0){return _59f([_5a0],{_selectedSetter:function(_5a1){this.inherited(arguments);this.get("options").some(function(_5a2){if(_5a2.value===_5a1){this.set("iconClass",_5a2.iconClass);return true;}},this);}});});},"epi/shell/command/OptionCommand":function(){define("epi/shell/command/OptionCommand",["dojo/_base/declare","epi/shell/command/_Command","dijit/Destroyable"],function(_5a3,_5a4,_5a5){return _5a3([_5a4,_5a5],{options:null,optionsLabel:"",optionsProperty:null,selected:null,property:null,_execute:function(){this.model.set(this.property,this.selected);},_onModelChange:function(){var self=this,_5a6=this.model;this.set("canExecute",!!_5a6);if(_5a6){this.set("selected",this.model.get(this.property));this.own(_5a6.watch(this.property,function(name,_5a7,_5a8){self.set("selected",_5a8);}));}},_optionsGetter:function(){return this.options||(this.model&&this.optionsProperty&&this.model.get(this.optionsProperty));},_selectedSetter:function(_5a9){var _5aa=this.selected;this.selected=_5a9;if(_5aa!==_5a9){this.execute();}}});});},"epi-cms/command/_NonEditViewCommandMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable"],function(_5ab,lang,_5ac,_5ad){return _5ab([_5ad],{constructor:function(){this.own(_5ac.subscribe("/epi/shell/action/viewchanged",lang.hitch(this,"_viewChanged")));},_viewChanged:function(type,args,data){this.set("isAvailable",type==="epi-cms/contentediting/PageDataController"||type==="epi-cms/compare/views/CompareView");}});});},"epi-cms/notification/command/NotificationCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","epi-cms/notification/NotificationButton","epi-cms/notification/command/ViewNotifications"],function(_5ae,_5af,_5b0,_5b1){return _5ae([_5af],{postscript:function(){this.inherited(arguments);var _5b2={widget:_5b0,"class":"epi-chromeless"};this.addToTrailing(new _5b1(),_5b2);}});});},"epi-cms/notification/NotificationButton":function(){define(["dojo/_base/declare","dojo/on","epi/shell/widget/DeferredDropDownButton","epi/shell/widget/_ButtonBadgeMixin","./NotificationList"],function(_5b3,on,_5b4,_5b5,_5b6){return _5b3([_5b4,_5b5],{dropDownPosition:["below-alt","below"],showLabel:false,postMixInProperties:function(){this.inherited(arguments);if(this.modelBindingMap){this.modelBindingMap.badgeValue=["badgeValue"];}this.dropDown=this.dropDown||new _5b6();this.own(on(this.dropDown,"change",function(){this.closeDropDown(true);}.bind(this),true));}});});},"epi/shell/widget/DeferredDropDownButton":function(){define("epi/shell/widget/DeferredDropDownButton",["dojo/_base/declare","dijit/form/DropDownButton","epi/shell/widget/_HasDeferredDropDown"],function(_5b7,_5b8,_5b9){return _5b7([_5b8,_5b9]);});},"epi/shell/widget/_HasDeferredDropDown":function(){define("epi/shell/widget/_HasDeferredDropDown",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dijit/_HasDropDown"],function(_5ba,lang,_5bb,on,_5bc){return _5ba([_5bc],{_loaded:false,loadEvent:"loaded",isLoaded:function(){return this._loaded&&!!this.dropDown;},loadDropDown:function(){var self=this,_5bd=this.dropDown,_5be=new _5bb();on.once(_5bd,this.loadEvent,function(){self._loaded=true;_5be.resolve();});_5bd.startup();return _5be.promise;},loadAndOpenDropDown:function(){var self=this,_5bf=this.dropDown;if(this.isLoaded()){return new _5bb().resolve(this.openDropDown());}return this.loadDropDown().then(function(){self.openDropDown();if(_5bf.focus){self.defer(lang.hitch(_5bf,"focus"),1);}});}});});},"epi/shell/widget/_ButtonBadgeMixin":function(){define("epi/shell/widget/_ButtonBadgeMixin",["dojo/_base/declare","dojo/dom-class","dojo/dom-attr"],function(_5c0,_5c1,_5c2){return _5c0(null,{badgeClass:"epi-badge-node",badgeValue:null,_setBadgeValueAttr:function(_5c3){this._set("badgeValue",_5c3);if(_5c3||_5c3===0){_5c1.add(this.iconNode,this.badgeClass);_5c2.set(this.iconNode,"badge-value",_5c3);}else{_5c1.remove(this.iconNode,this.badgeClass);}}});});},"epi-cms/notification/NotificationList":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/keys","dojo/on","./viewmodels/NotificationListViewModel","./notificationFormatter","dojo/text!./templates/NotificationList.html","epi/i18n!epi/cms/nls/episerver.cms.notification.list","dgrid/OnDemandList","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi-cms/dgrid/WithContextMenu","epi-cms/ApplicationSettings","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Toolbar"],function(_5c4,_5c5,keys,on,_5c6,_5c7,_5c8,res,_5c9,_5ca,_5cb,_5cc,_5cd,_5ce,_5cf,_5d0,_5d1,_5d2,_5d3,_5d4){return _5c5([_5d2,_5d3,_5d4],{templateString:_5c8,_listClass:_5c5([_5c9,_5cd,_5cb,_5ca,_5ce,_5cc]),_list:null,res:res,postMixInProperties:function(){this.inherited(arguments);_5c7.contentLanguage=_5cf.currentContentLanguage;if(!this.model){this.own(this.model=new _5c6());}},buildRendering:function(){this.inherited(arguments);this._setupToolbar();this._setupList();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize().then(function(){this._list.startup();this._list.set("store",this.model.store,this.model.query,this.model.queryOptions);this.own(on(this.model,"notification-allread",this._list.refresh.bind(this._list)),on(this.domNode,_5c4._keypress,this._onKeypress.bind(this)));this.emit("loaded");}.bind(this));},focus:function(){var _5d5;if(this._list){_5d5=this._list.getScrollPosition();this._list.focus();this._list.scrollTo(_5d5);}},layout:function(){this.inherited(arguments);this._list.resize();},_setupList:function(){var _5d6=this._readNotification.bind(this);this._list=new this._listClass({className:"epi-notification-list__item-list epi-card-list epi-grid-max-height--300",cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,formatters:_5c7.card,keepScrollPosition:true,noDataMessage:res.nodatamessage,stopPropagation:true,sort:this.model.queryOptions&&this.model.queryOptions.sort},this.listNode);this._list.contextMenu.addProvider(this.model);this.own(this._list,this._list.on("dgrid-select",this._selected.bind(this)),this._list.on(".dgrid-row:click",_5d6),this._list.addKeyHandler(keys.ENTER,_5d6),on.once(this._list,"dgrid-refresh-complete",this.focus.bind(this)));},_readNotification:function(){this.model.readSelectedNotification();this.emit("change",{});},_selected:function(e){var _5d7=e&&e.rows&&e.rows[0].data;this.model.set("selectedNotification",_5d7);},_setupToolbar:function(){var _5d8=new _5d0({settings:{"class":"epi-chromeless epi-visibleLink"}});var _5d9=[{builder:_5d8,category:"toolbarContext",target:this.toolbarGroupNode}];this.own(new _5d1({configuration:_5d9,commandSource:this.model}));},_onKeypress:function(e){if(e.charOrCode!==keys.TAB){return;}this.toolbar.focused?this._list.focus():this.toolbar.focus();e.preventDefault();e.stopPropagation();}});});},"epi-cms/notification/viewmodels/NotificationListViewModel":function(){define(["dojo/_base/declare","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/dependency","../command/MarkNotificationAsRead","../command/MarkAllNotificationsAsRead"],function(_5da,_5db,_5dc,_5dd,when,_5de,_5df,_5e0,_5e1){return _5da([_5dc,_5db,_5de],{store:null,service:null,query:null,queryOptions:null,commands:null,selectedNotification:null,postscript:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"posted",descending:true}]};this.store=this.store||_5df.resolve("epi.storeregistry").get("epi.cms.notification");this.service=this.service||_5df.resolve("epi.cms.NotificationService");this.query=this.query||{};this._createCommands();},initialize:function(){return when(null);},readSelectedNotification:function(){this.markSelectedNotificationAsRead();this.gotoSelectedNotificationOrigin();},getCommands:function(){return this.commands;},gotoSelectedNotificationOrigin:function(){if(!this.selectedNotification||!this.selectedNotification.link){return;}var _5e2=this.selectedNotification.link;_5dd.publish("/epi/shell/context/request",{uri:_5e2},{sender:this});},markSelectedNotificationAsRead:function(){if(!this.selectedNotification){return;}this.service.markAsRead(this.selectedNotification.id).then(this.set.bind(this,"selectedNotification"));},markAllAsRead:function(){this.service.markAllAsRead().then(this.emit.bind(this,"notification-allread",{}));},_createCommands:function(){var _5e3=[new _5e0({model:this,order:10}),new _5e1({model:this})];this.own.apply(this,_5e3);this.set({commands:_5e3});}});});},"epi-cms/notification/command/MarkNotificationAsRead":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command","dijit/Destroyable","epi/i18n!epi/cms/nls/episerver.cms.notification.command"],function(_5e4,lang,_5e5,_5e6,res){return _5e4([_5e5,_5e6],{category:"itemContext",label:res.markasread,canExecute:false,modelPropertyToWatch:"selectedNotification",_execute:function(){return this.model.markSelectedNotificationAsRead();},_onModelChange:function(){var _5e7=this.model;this.set("canExecute",!!_5e7);if(_5e7){this.own(_5e7.watch(this.modelPropertyToWatch,lang.hitch(this,"_setCanExecute")));this._setCanExecute();}},_setCanExecute:function(){var _5e8=this.model.selectedNotification;var _5e9=!!_5e8&&!_5e8.hasRead;this.set("canExecute",_5e9);}});});},"epi-cms/notification/command/MarkAllNotificationsAsRead":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.notification.list"],function(_5ea,_5eb,res){return _5ea(_5eb,{showLabel:true,isAvailable:true,canExecute:true,category:"toolbarContext",label:res.markallasread,_execute:function(){this.model.markAllAsRead();}});});},"epi-cms/notification/notificationFormatter":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi/shell/TypeDescriptorManager","epi-cms/dgrid/formatters","epi/shell/dgrid/util/misc","dojo/text!./templates/card.html","epi/i18n!epi/nls/episerver.shared"],function(_5ec,_5ed,_5ee,_5ef,_5f0,misc,_5f1,_5f2){var _5f3;function _5f4(){function _5f5(item){if(!item.contentLanguage){return "";}return item.contentLanguage!==_5f3.contentLanguage?item.contentLanguage:"";};function _5f6(_5f7){if(_5f7.subject){return _5ee.encode(_5f7.subject);}return "";};function _5f8(_5f9){if(_5f9&&_5f9!=="projectIcon"){var _5fa=_5ef.getValue(_5f9,"iconClass");if(_5fa){return misc.icon(_5fa+" epi-objectIcon");}else{return "";}}else{if(_5f9==="projectIcon"){return misc.icon("epi-iconObjectProject epi-objectIcon");}}return "";};return function formatter(_5fb,_5fc,node,_5fd){var _5fe=_5f5(_5fc);var map={title:_5f6(_5fc),languageBranch:_5ee.encode(_5fe),languageBranchClass:_5fe?"epi-card__language-branch":"epi-card__language-branch--hidden",contentIcon:_5f8(_5fc.iconKey),message:_5fc.content,postedAt:_5f0.localizedDate(_5fc.posted),menu:_5f0.menu({title:_5f2.action.options})};var _5ff=(_5fc.hasRead?"":" epi-card--unread");_5ec.add(node,"epi-card epi-card--compact"+_5ff);return _5ed.substitute(_5f1,map);};};_5f3={card:[_5f4()]};return _5f3;});},"url:epi-cms/notification/templates/card.html":"<div class=\"epi-event\">\n    ${contentIcon}${menu}<span class=\"dijitInline epi-floatRight epi-lozenge ${languageBranchClass}\">${languageBranch}</span><h3 class=\"epi-event__title dojoxEllipsis\">${title}</h3>\n    <div class=\"epi-event__message\">${message}</div>\n    <div class=\"epi-event__timestamp\">${postedAt}</div>\n</div>\n","url:epi-cms/notification/templates/NotificationList.html":"<div class=\"epi-notification-list epi-menu--inverted\">\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\n        <div class=\"epi-tooltipDialogTop\">\n            <span data-dojo-attach-point=\"headerNode\">${res.header}</span>\n            <div class=\"dijitTooltipConnector\"></div>\n        </div>\n        <div data-dojo-type=\"dijit/Toolbar\"\n             data-dojo-attach-point=\"toolbar\"\n             class=\"epi-flatToolbar\">\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </div>\n        <div data-dojo-attach-point=\"listNode\"></div>\n    </div>\n</div>\n","epi/shell/dgrid/Focusable":function(){define("epi/shell/dgrid/Focusable",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/focus"],function(_600,lang,_601,_602){return _600([],{postCreate:function(){this.inherited(arguments);this._listeners.push(_601.around(this,"_restoreFocus",function(_603){return function(row){var _604=this._removedFocus;_603.apply(this,arguments);if(!this._focusedNode){row=row&&this.row(row);var _605=row&&row.element&&row.id===_604.rowId?row:typeof _604.siblingId!=="undefined"&&this.row(_604.siblingId);if(_605){this._focusedNode=_605.element;}}};}));},hasFocus:function(){return this._focusedNode&&this._focusedNode===_602.curNode;},isFocusable:function(){return !!this._focusedNode;},focus:function(_606){if(typeof _606=="string"){_606=null;}this.inherited(arguments,[_606]);},refresh:function(_607){var _608=_607&&_607.refocus,_609=function(_60a){if(this._refocusNode){this.focus(this.row(this._refocusNode).element);this._refocusNode=null;}return _60a;};if(typeof _608==="undefined"){_608=this.refocusOnRefresh;}if(_608&&this.hasFocus()){this._refocusNode=this.row(this._focusedNode).id;}var _60b=this.inherited(arguments);if(_60b){return _60b.then(_609.bind(this));}}});});},"epi-cms/notification/command/ViewNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/dependency","dijit/Destroyable","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.notification.command"],function(_60c,lang,on,_60d,_60e,_60f,res){return _60c([_60f,_60e],{iconClass:"epi-iconBell epi-icon--medium",label:"",isAvailable:true,canExecute:true,badgeValue:"",_unreadCount:0,postscript:function(){this.inherited(arguments);this.service=this.service||_60d.resolve("epi.cms.NotificationService");this.own(this.service.on("notification-updated",function(_610){if(!_610.hasRead){this.set("_unreadCount",this._unreadCount+1);}}.bind(this)));this._updateUnreadCount();},_execute:function(){this.set("_unreadCount",0);},_updateUnreadCount:function(){this.service.getUnreadNotificationCount().then(function(_611){this.set("_unreadCount",_611);}.bind(this));},__unreadCountSetter:function(_612){var _613=_612>0?"("+_612+")":"";this._unreadCount=_612;this.set({badgeValue:_612>0?_612:null,label:lang.replace(res.viewnotifications,{unreadcount:_613})});}});});},"epi-cms/command/ViewSettingsCommandProvider":function(){define(["dojo/_base/declare","epi/dependency","epi-cms/command/TogglePreviewMode","epi-cms/command/ToggleViewSettings","epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand","epi-cms/project/ProjectPreviewButton","epi-cms/contentediting/command/LanguageSelection","epi-cms/contentediting/viewmodel/LanguageSettingsModel","./DeviceSelection","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode"],function(_614,_615,_616,_617,_618,_619,_61a,_61b,_61c,_61d,_61e){return _614([_61d],{postscript:function(){this.inherited(arguments);var _61f={category:"view"};this.projectService=this.projectService||_615.resolve("epi.cms.ProjectService");var _620=new _61b();this.add("commands",new _617({settings:_61f,category:_61f.category}));this.add("commands",new _61a({category:_61f.category,showLabel:true,settings:_61f,optionsProperty:"availableLanguages",property:"selectedLanguage",model:_620}));this.add("commands",new _618({category:_61f.category,settings:_61f}));this.add("commands",new _61c({settings:_61f,category:_61f.category}));if(!this.projectService.isProjectModeEnabled){this.add("commands",{settings:_61f,category:_61f.category,widget:new _619({showLabel:false})});}this.add("commands",new _616({settings:_61f,category:_61f.category,innerText:_61e.message}));}});});},"epi-cms/command/TogglePreviewMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi-cms/_SidePanelsToggleMixin","dijit/Destroyable"],function(_621,lang,_622,_623,_624,_625,_626,_627){return _621([_624,_625,_626,_627],{iconClass:"epi-iconPreview",tooltip:_623.label,label:_623.label,canExecute:true,constructor:function(){this.own(_622.subscribe("/epi/cms/action/disablepreview",lang.hitch(this,"_deactivate")));},_execute:function(){this.set("active",!this.active);if(this.active){_622.publish("/epi/shell/action/changeview","view");this._hideSidePanels();}else{this._restoreSidePanels();_622.publish("/epi/shell/action/changeview",null);}},_deactivate:function(){if(this.active){this.set("active",false);this._restoreSidePanels();}},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(view!=="view"){this._deactivate();}}});});},"epi-cms/_SidePanelsToggleMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojo/topic","epi/dependency"],function(_628,lang,all,when,_629,_62a){return _628([],{_profile:null,_isNavigationVisible:null,_isToolsVisible:null,constructor:function(){if(!this._profile){this._profile=_62a.resolve("epi.shell.Profile");}this._storePanelVisibility();},_restoreSidePanels:function(){_629.publish("/epi/layout/pinnable/navigation/toggle",this._isNavigationVisible);_629.publish("/epi/layout/pinnable/tools/toggle",this._isToolsVisible);},_hideSidePanels:function(){this._storePanelVisibility().then(function(){_629.publish("/epi/layout/pinnable/navigation/toggle",false);_629.publish("/epi/layout/pinnable/tools/toggle",false);});},_storePanelVisibility:function(){return all([when(this._profile.get("navigation"),lang.hitch(this,function(_62b){this._isNavigationVisible=_62b?_62b.visible:false;})),when(this._profile.get("tools"),lang.hitch(this,function(_62c){this._isToolsVisible=_62c?_62c.visible:false;}))]);}});});},"epi-cms/command/ToggleViewSettings":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.viewsetting","epi/shell/command/ToggleCommand","epi/dependency","epi-cms/command/_NonEditViewCommandMixin"],function(_62d,_62e,_62f,_630,_631,_632){return _62d([_630,_632],{iconClass:"epi-iconEye",canExecute:true,property:"enabled",label:_62f.viewsettingbutton,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",_631.resolve("epi.viewsettingsmanager"));}},_execute:function(){this.inherited(arguments);_62e.publish("/epi/cms/action/eyetoggle",this.model.get(this.property));},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(this.active&&view&&view.indexOf("compare")!==-1){this.execute();}}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/OptionCommand","./VisitorGroupViewSettingsModel","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_633,_634,_635,_636,res){return _633([_635,_634],{iconClass:"epi-iconUsers",model:null,optionsProperty:"options",property:"selectedGroup",optionsLabel:res.header,postscript:function(){this.inherited(arguments);this.set("model",this.model||new _636());this.set("label",this.model.tooltip);this.set("active",!!this.model.selectedGroup);var self=this;this.own(this.model.watch("tooltip",function(_637,_638,_639){self.set("label",_639);}));this.own(this.model.watch("selectedGroup",function(_63a,_63b,_63c){self.set("active",!!_63c);}));}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_63d,lang,_63e,_63f,when,_640,_641,_642,res){return _63d([_63f,_640],{selectedGroup:null,tooltip:_642.defaulttooltip,defaultItem:{value:null,label:res.defaultitem},options:[],postscript:function(){this.inherited(arguments);if(!this._store){var _643=_641.resolve("epi.storeregistry");this._store=_643.get("epi.cms.visitorgroup");}if(!this._viewSettingsManager){this._viewSettingsManager=_641.resolve("epi.viewsettingsmanager");}var _644=this._viewSettingsManager.getSettingProperty("visitorgroup");var self=this;when(this._store.query()).then(function(_645){if(!(_645 instanceof Array)){_645=[];}var _646=_645.map(function(item){return {label:item.name,value:item.id};});_646.unshift(self.defaultItem);self.set("options",_646);self.set("selectedGroup",_644,false);});},_selectedGroupSetter:function(_647,_648){if(this.selectedGroup===_647){return;}this.selectedGroup=_647;this._setTooltip();if(_648===false){return;}_63e.publish("/epi/cms/action/viewsettingvaluechanged","visitorgroup",this.selectedGroup);},_setTooltip:function(){var _649=this._getGroup(this.selectedGroup);if(_649){this.set("tooltip",lang.replace(_642.tooltip,{visitorgroup:_649.label}));}else{this.set("tooltip",_642.defaulttooltip);}},_getGroup:function(id){if(id===this.defaultItem.value){return null;}for(var idx in this.options){if(this.options[idx].value===id){return this.options[idx];}}return null;}});});},"epi-cms/project/ProjectPreviewButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/topic","epi/dependency","epi/i18n!epi/nls/episerver.cms.components.project.preview","epi/shell/widget/DeferredDropDownButton","epi-cms/project/ProjectSelectorList"],function(_64a,lang,_64b,_64c,_64d,_64e,_64f,_650,_651){return _64a([_650],{iconClass:"epi-icon--medium epi-iconProject",baseClass:"",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_64e.resolve("epi.storeregistry").get("epi.cms.project");},buildRendering:function(){this.inherited(arguments);_64b.add(this.domNode,["epi-chromeless","epi-mediumButton"]);if(!this.dropDown){this.dropDown=new _651({baseClass:"dijitMenu",enableDefaultValue:true,defaultValueText:_64f.defaultoption,store:this.store,header:_64f.header});}},postCreate:function(){this.inherited(arguments);var self=this,_652=_64e.resolve("epi.viewsettingsmanager").getSettingProperty("project"),_653=_652?this.store.get(parseInt(_652)):new _64c().resolve();_653.then(function(_654){self.dropDown.set("selectedProject",_654);self._updateButtonState(_654);}).always(function(){self.own(self.dropDown.watch("selectedProject",lang.hitch(self,"_selectedProjectChanged")));});},loadAndOpenDropDown:function(){if(this.isLoaded()){return this.inherited(arguments).then(lang.hitch(this,function(){return this.dropDown.refresh();}));}return this.inherited(arguments);},_selectedProjectChanged:function(name,_655,_656){var _657=_656?_656.id:null;_64d.publish("/epi/cms/action/viewsettingvaluechanged","project",_657);this._updateButtonState(_656);},_updateButtonState:function(_658){var _659=_64f.defaulttooltip;if(_658){_659=lang.replace(_64f.tooltip,{project:_658.name});}this.set("title",_659);_64b.toggle(this.iconNode,"epi-icon--active",!!_658);}});});},"epi-cms/project/ProjectSelectorList":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","dijit/form/RadioButton","dijit/Menu","epi/epi","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ExpandoMenuBuilder","epi/shell/command/builder/OptionsBuilderMixin","epi/datetime","epi/username","./viewmodels/ProjectSelectorListViewModel","dojo/text!./templates/ProjectSelectorList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","dijit/Toolbar"],function(_65a,_65b,lang,keys,when,_65c,_65d,_65e,Menu,epi,_65f,_660,_661,_662,_663,_664,_665,_666,_667,res,_668,_669,_66a,_66b,_66c,put,_66d,_66e,misc,_66f,_670,_671,_672){return _65a([_66f,_670,_671,_672,_65f],{templateString:_666,store:null,query:null,selectedProject:null,enableDefaultValue:false,defaultValueText:res.preview.defaultoption,header:res.title,_setHeaderAttr:{node:"headerNode",type:"innerText"},_optionsMenuClass:_65a([Menu,_662]),postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _665());}},buildRendering:function(){this.inherited(arguments);this._setupProjectSortMenu();this.list=new (_65a([_668,_669,_66b,_66a,_66d,_66e]))({sort:[{attribute:"created",descending:true}],className:"epi-project-selector-list__item-list epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionMode:"exclusive",selectionEvents:"click",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.own(this.list,this.list.on("dgrid-select",lang.hitch(this,"_projectSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.ENTER,lang.hitch(this,"_listEnterKeypress")),this.model.watch("projectSortOrder",lang.hitch(this,"_sortChanged")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(_66c.enterRow,lang.hitch(this,"_listMouseover")),this.defaultOption.on("click",lang.hitch(this,"_defaultOptionSelected")),this.defaultOption.on("keypress",lang.hitch(this,"_defaultOptionKeypress")),this.defaultOption.on("mouseover",lang.hitch(this,"_defaultOptionMouseover")));if(this.enableDefaultValue){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_65c.add(this.defaultOption.domNode,"dijitHidden");}this.defaultOption.set({iconClass:"epi-radio-icon--secondary",label:_65d.encode(this.defaultValueText)});},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();this.list.startup();this.list.set("store",this.store);},focus:function(){if(this.enableDefaultValue){this.defaultOption.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_673){var _674=put("label",[put("span.dijitInline.dijitIcon.epi-radio-icon--secondary"),put("span.project-item--name.dojoxEllipsis",item.name)]);var _675=put("div.project-item--status",_663.toUserFriendlyString(new Date(item.created))+", "+_664.toUserFriendlyString(item.createdBy));return put("div",[_674,_675]);},refresh:function(){if(!this._started){return;}return this.list.refresh().then(lang.hitch(this,function(_676){var _677=this.get("selectedProject"),_678=_677&&_676.some(function(item){if(item.id===_677.id){_677=item;return true;}return false;},this);this.set("selectedProject",_678?_677:null);}));},_projectSelected:function(e){var _679=e&&e.rows&&e.rows[0].data;if(!epi.areEqual(_679,this.get("selectedProject"))){this.set("selectedProject",_679);this.emit("change",{value:_679});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(_67a){this.emit("loaded");_65c.toggle(this.separatorNode,"dijitHidden",!_67a||!this.enableDefaultValue);}));},_defaultOptionSelected:function(){this.set("selectedProject",null);this.emit("change",null);},_defaultOptionKeypress:function(e){var _67b;switch(e.keyCode){case keys.DOWN_ARROW:_67b=_66a.moveFocusHome;break;case keys.PAGE_DOWN:_67b=_66a.moveFocusPageDown;break;case keys.END:_67b=_66a.moveFocusEnd;break;default:return;}_67b.apply(this.list,[e]);},_defaultOptionMouseover:function(){this.defaultOption.focus();},_listEnterKeypress:function(e){this.list.clearSelection();this.list.select(e);},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_67c=list.up(row,1,true);if(row.id===_67c.id){this.defaultOption.focus();}},_listNavigateHome:function(){this.defaultOption.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_sortChanged:function(evt){var _67d=this.model[evt];if(this.list.get("sort")!==_67d){this.list.set("sort",_67d);}},_setSelectedProjectAttr:function(_67e){this._set("selectedProject",_67e);this.list.clearSelection();if(_67e){this.list.select(_67e.id);}this._updateView();},_updateView:function(){this.defaultOption.set("checked",!this.selectedProject);},_setupProjectSortMenu:function(){var _67f=[{builder:new _661({settings:{"class":"epi-flat epi-chromeless",iconClass:"epi-iconSort",showLabel:false,label:res.command.sort.label}}),category:"context",target:this.toolbarGroupNode}];this.own(new _660({configuration:_67f,commandSource:this.model}));}});});},"epi/shell/command/_WidgetCommandBinderMixin":function(){define("epi/shell/command/_WidgetCommandBinderMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin"],function(_680,_681){return _680(null,{commandProvider:null,_consumerHandle:null,startup:function(){if(this._started){return;}this.inherited(arguments);var _682=this.getConsumer();if(!_682){return;}this._consumerHandle=_682.addProvider(this.commandProvider||this);this.commandProvider.initializeCommandProviders&&this.commandProvider.initializeCommandProviders();},getConsumer:function(){if(this.isInstanceOf(_681)){return this;}var _683=this.getParent();while(_683){if(_683.isInstanceOf(_681)){return _683;}_683=_683.getParent();}},destroy:function(){this._consumerHandle&&this._consumerHandle.removeProvider();this.inherited(arguments);}});});},"epi/shell/command/builder/ExpandoMenuBuilder":function(){define("epi/shell/command/builder/ExpandoMenuBuilder",["dojo/_base/declare","dojo/_base/lang","../_CommandModelBindingMixin","./ButtonBuilder","epi/shell/widget/ExpandoMenuButton"],function(_684,lang,_685,_686,_687){return _684([_686],{_expandoClass:_684([_687,_685]),_expandoMenu:null,_create:function(_688){var _689,_68a;if(_688.widget){return _688.widget;}_689=_688.get("options") instanceof Array;_68a=typeof _688.active==="boolean";if(!_689&&_68a){return this._expandoMenu=new this._expandoClass(this._createOptions(_688));}return this.inherited(arguments);},_createOptions:function(_68b){return lang.mixin({innerText:_68b.innerText,showLabel:!!_68b.showLabel},this.inherited(arguments));},_addToContainer:function(_68c,_68d){if(!(_68c instanceof _687)&&this._expandoMenu){_68d=this._expandoMenu;}this.inherited(arguments,[_68c,_68d]);}});});},"epi/shell/widget/ExpandoMenuButton":function(){require({cache:{"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\n--></span>\n"}});define("epi/shell/widget/ExpandoMenuButton",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/has","dojo/text!./templates/ExpandoMenuButton.html","dijit/registry","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","dijit/_TemplatedMixin","dgrid/util/has-css3","dijit/form/ToggleButton"],function(_68e,lang,_68f,on,_690,_691,_692,_693,has,_694,_695,_696,_697,_698){return _68e([_696,_698,_697],{templateString:_694,label:"",innerText:"",iconClass:"",postCreate:function(){this.inherited(arguments);if(has("css-transitions")){this.own(on(this.expandoNode,has("transitionend"),lang.hitch(this,this._onTransitionEnd)));}},_setLabelAttr:function(_699){this.toggleButton.set("label",_699);this._set("label",_699);},_setInnerTextAttr:function(_69a){this._set("innerText",_69a);if(_69a){this.innerTextNode.textContent=_69a;}_690.toggle(this.innerTextContainerNode,"dijitHidden",!_69a);},_setIconClassAttr:function(_69b){this._set("iconClass",_69b);this._updateToggleButtonIcon();},_setCheckedAttr:function(_69c){this.toggleButton.set("checked",_69c);this._set("checked",_69c);this._updateToggleButtonIcon();this._showChildren(_69c);},addChild:function(_69d){if(this.innerTextContainerNode){_690.add(this.innerTextContainerNode,"dijitHidden");}var li=_693.create("li",{},this.expandoNode);_69d.placeAt(li);},onClick:function(){},onChange:function(val){},getChildren:function(){return _695.findWidgets(this.expandoNode);},_toggleButtonClick:function(){this.onClick();},_toggleButtonChange:function(val){this.set("checked",val);this.onChange(val);},_updateToggleButtonIcon:function(){var _69e=["epi-icon--medium"];if(this.iconClass){_69e.push(this.iconClass);}if(this.checked){_69e.push("epi-icon--active");}this.toggleButton.set("iconClass",_69e.join(" "));},_showChildren:function(show){var node=this.expandoNode;if(show){_690.toggle(node,"dijitHidden",false);_692.set(node,"width",this._childrenWidth()+"px");}else{_692.set(node,"width",this._childrenWidth()+"px");node.offsetWidth;_692.set(node,"width","0px");}},_onTransitionEnd:function(){var _69f=this.get("checked");_690.toggle(this.expandoNode,"dijitHidden",!_69f);if(_69f){_692.set(this.expandoNode,"width","");}},_childrenWidth:function(){var _6a0=0;_68f.forEach(this.expandoNode.childNodes,function(_6a1){_6a0+=_691.getMarginBox(_6a1).w;});return _6a0;}});});},"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\n--></span>\n","epi-cms/project/viewmodels/ProjectSelectorListViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort"],function(_6a2,lang,_6a3,_6a4,when,_6a5,_6a6,_6a7,_6a8){return _6a2([_6a4,_6a5,_6a3],{namedCommands:null,profile:null,projectSortOrder:null,_commands:null,_sortOrderProfileKey:"epi.project-sort-order",constructor:function(){this.projectSortOrder=[{attribute:"name",descending:false}];},postscript:function(){this.inherited(arguments);this.profile=this.profile||_6a6.resolve("epi.shell.Profile");this._createCommands();},initialize:function(){return when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _6a9=this._findSortOption("key",sort)||this.namedCommands.sortProject.options[0];this._changeAttrValue("projectSortOrder",_6a9.value);}));},getCommands:function(){return this._commands;},_projectSortOrderSetter:function(_6aa){var _6ab,key;if(_6aa===null||(_6aa&&_6aa===this.projectSortOrder)){return;}this.projectSortOrder=_6aa;_6ab=this._findSortOption("value",_6aa);key=_6ab&&_6ab.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_findSortOption:function(key,term){var _6ac=this.namedCommands.sortProject.options,_6ad=null;term&&_6ac.some(function(item){if(term===item[key]){_6ad=item;return true;}});return _6ad;},_createCommands:function(){var _6ae=new _6a7({model:this,category:"context",label:"label",property:"projectSortOrder",options:[{label:_6a8.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_6a8.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_6a8.createddescending,key:"-DateCreated",value:[{attribute:"created",descending:true},{attribute:"name",descending:false}]},{label:_6a8.createdascending,key:"+DateCreated",value:[{attribute:"created",descending:false},{attribute:"name",descending:false}]}]});this.set("_commands",[_6ae]);this.set("namedCommands",{sortProject:_6ae});}});});},"url:epi-cms/project/templates/ProjectSelectorList.html":"<div class=\"epi-project-selector-list epi-menu--inverted\">\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\n        <div class=\"epi-tooltipDialogTop\">\n            <span data-dojo-attach-point=\"headerNode\"></span><div class=\"dijitTooltipConnector\"></div>\n        </div>\n        <div data-dojo-type=\"dijit/Toolbar\"\n             data-dojo-attach-point=\"toolbar\"\n             class=\"epi-flatToolbar epi-project-selector-list__toolbar\">\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </div>\n        <button class=\"epi-chromeless epi-project-selector-list__default-option\" data-dojo-attach-point=\"defaultOption\" data-dojo-type=\"dijit/form/ToggleButton\"></button>\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-project-selector-list__separator dijitHidden\"></div>\n        <div data-dojo-attach-point=\"listNode\"></div>\n    </div>\n</div>\n","dgrid/util/mouse":function(){define(["dojo/on","dojo/dom","dojo/query"],function(on,dom){function _6af(_6b0,type){return function(node,_6b1){return on(node,_6b0+":"+type,function(evt){if(!dom.isDescendant(evt.relatedTarget,this)){return _6b1.call(this,evt);}});};};return {enterRow:_6af(".dgrid-content .dgrid-row","mouseover"),enterCell:_6af(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:_6af(".dgrid-header .dgrid-cell","mouseover"),leaveRow:_6af(".dgrid-content .dgrid-row","mouseout"),leaveCell:_6af(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:_6af(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:_6af};});},"epi/shell/dgrid/selection/Exclusive":function(){define("epi/shell/dgrid/selection/Exclusive",["dojo/_base/declare"],function(_6b2){return _6b2([],{_exclusiveSelectionHandler:function(_6b3,_6b4){if(this._lastSelected!==_6b4){this.clearSelection();this.select(_6b4);this._lastSelected=_6b4;}}});});},"epi-cms/contentediting/command/LanguageSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_6b5,_6b6,_6b7){return _6b5([_6b6],{optionsLabel:_6b7.contentdetails.existinglanguages,active:false,selected:"",_selectedSetter:function(_6b8){this.inherited(arguments);if(typeof (_6b8)=="string"&&_6b8!==""){this.set("label",_6b8.toUpperCase());if(_6b8!==this.model.get("documentLanguage")){this.set("active",true);}else{this.set("active",false);}}}});});},"epi-cms/contentediting/viewmodel/LanguageSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dojo/Deferred","epi/dependency","epi-cms/component/SiteTreeModel","dijit/Destroyable"],function(_6b9,lang,_6ba,_6bb,when,_6bc,_6bd,_6be,_6bf){return _6b9([_6bb,_6bf],{enabled:false,documentLanguage:"",selectedLanguage:"",availableLanguages:[],profile:null,siteTreeModel:null,postscript:function(){this.inherited(arguments);var self=this;if(!this.siteTreeModel){var _6c0=_6bd.resolve("epi.storeregistry"),_6c1=_6c0.get("epi.cms.sitestructure");this.siteTreeModel=new _6be({store:_6c1});}this.profile=this.profile||_6bd.resolve("epi.shell.Profile");this.siteTreeModel.getCurrentSite().then(lang.hitch(this,"_setAvailableLanguages")).then(lang.hitch(this,function(){when(this.profile.getContentLanguage(),lang.hitch(this,function(_6c2){this.set("documentLanguage",_6c2);this.set("selectedLanguage",_6c2,false);}));}));},_setAvailableLanguages:function(site){if(site){var def=new _6bc();this.siteTreeModel.getChildren({url:site.currentSite},lang.hitch(this,function(_6c3){var obj=_6c3.filter(function(item){return (item.languageId&&item.name);}).map(function(item){return {label:item.name,value:item.languageId};});this.set("availableLanguages",obj);def.resolve();}));return def.promise;}else{return new _6bc().resolve();}},_enabledSetter:function(_6c4){if(this.enabled!==_6c4){this.enabled=_6c4;_6ba.publish("/epi/cms/action/eyetoggle",_6c4);}},_selectedLanguageSetter:function(_6c5,_6c6){if(_6c6!==false){_6ba.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_6c5);}}});});},"epi-cms/component/SiteTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Deferred","dojo/when","dojo/_base/lang","dojo/_base/connect","dojo/cookie","epi/dependency","epi/string"],function(_6c7,_6c8,_6c9,_6ca,when,lang,_6cb,_6cc,_6cd,_6ce){return _6c8([_6c9],{query:null,showAllLanguages:true,location:document.location,profile:null,store:null,constructor:function(){this.query={allLanguages:this.showAllLanguages};},postscript:function(){this.inherited(arguments);this.profile=this.profile||_6cd.resolve("epi.shell.Profile");_6cb.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){when(this.getCurrentSite(),lang.hitch(this,function(_6cf){this.onItemChildrenReload({siteUrl:_6cf.currentSite});}));}));},getRoot:function(_6d0,_6d1){_6d0({});},getIdentity:function(item){var id=this.store.getIdentity(item);if(!id&&!item.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_6d2){},mayHaveChildren:function(item){if(!item.isLanguageNode){return true;}return false;},getLabel:function(item){return item.name;},getChildren:function(_6d3,_6d4){when(this.store.query(lang.mixin({siteUrl:_6d3.url},this.query)),_6d4);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_showAllLanguagesSetter:function(_6d5){this.showAllLanguages=_6d5;this._setQuery({allLanguages:_6d5});},getCurrentSite:function(){var def=new _6ca();when(this.profile.getContentLanguage(),lang.hitch(this,function(_6d6){if(_6d6){when(this.store.get(),lang.hitch(this,function(_6d7){var _6d8=null;var _6d9=null;_6c7.some(_6d7,function(site){return _6c7.some(site.hosts,function(host){if(host==="*"){_6d9=site;return true;}});});var _6da=this.location.host.toLowerCase();var _6db=_6c7.some(_6d7,function(site){return _6c7.some(site.hosts,function(host){if(_6da===host.toLowerCase()){_6d8={currentSite:site.url,currentEditLanguageId:site.url+_6d6};return true;}});});if(!_6db&&_6d9){_6d8={currentSite:_6d9.url,currentEditLanguageId:_6d9.url+_6d6};}if(_6d8){def.resolve(_6d8);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}}));return def;},getAllLanguagesForSite:function(_6dc){var def=new _6ca();when(this.store.query({siteUrl:_6dc,allLanguages:true}),function(_6dd){def.resolve(_6dd);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _6ca();when(this.getCurrentSite(),lang.hitch(this,function(_6de){this.getAllLanguagesForSite(_6de.currentSite).then(function(_6df){def.resolve(_6df);});}),function(_6e0){def.reject(_6e0);});return def;}});});},"epi-cms/command/DeviceSelection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/DestroyableByKey","epi/shell/command/OptionCommand","epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel"],function(_6e1,lang,_6e2,_6e3,_6e4){return _6e1([_6e3,_6e2],{iconClass:"epi-iconDevice",optionsProperty:"options",canExecute:true,active:false,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",new _6e4());}},_updateFromModel:function(){this.set("label",this.model.get("label"));this.set("active",!!(this.model.get("resolution")||this.model.get("channel")));},_onModelChange:function(){this.inherited(arguments);var _6e5="_ChannelCommandModelWatch";this.destroyByKey(_6e5);if(this.model){this._updateFromModel();this.ownByKey(_6e5,this.model.watch(lang.hitch(this,function(name,_6e6,_6e7){if(["label","resolution","channel"].indexOf(name)!==-1){this._updateFromModel();}})));}}});});},"epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/topic","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/OptionGroup","epi/i18n!epi/cms/nls/episerver.cms.widget"],function(_6e8,lang,_6e9,_6ea,_6eb,_6ec,_6ed,_6ee){return _6e8([_6e9],{resolution:null,channel:null,postscript:function(){this.inherited(arguments);this._updateLabel();if(!this.get("viewSettingsManager")){this.set("viewSettingsManager",_6eb.resolve("epi.viewsettingsmanager"));}if(!this.get("channelStore")){var _6ef=_6eb.resolve("epi.storeregistry");this.set("channelStore",_6ef.get("epi.cms.displaychannels"));}},_resolutionSetter:function(_6f0){if(_6f0!==this.resolution){this.resolution=_6f0;this._onChange();}},_channelSetter:function(_6f1){if(_6f1!==this.channel){this.channel=_6f1;this.set("resolution",this._getDefaultResolutionForChannel(_6f1));this._onChange();}},_viewSettingsManagerSetter:function(_6f2){this.viewSettingsManager=_6f2;this.set("resolution",_6f2.getSettingProperty("resolution"));this.set("channel",_6f2.getSettingProperty("epichannel"));},_channelStoreSetter:function(_6f3){this.channelStore=_6f3;this._initialize();},_onChange:function(){this._updateLabel(this.get("resolution"),this.get("channel"));var _6f4=[{key:"resolution",value:this.get("resolution")},{key:"epichannel",value:this.get("channel")}];_6ea.publish("/epi/cms/action/viewsettingvaluechanged",_6f4);},_updateLabel:function(_6f5,_6f6){var _6f7=_6ee.channelbutton.defaulttooltip;if(_6f5||_6f6){_6f7=lang.replace(_6ee.channelbutton.tooltip,{channel:this._getOptionLabel(this._availableChannels,_6f6),resolution:this._getOptionLabel(this._availableResolutions,_6f5)});}this.set("label",_6f7);},_getOptionLabel:function(_6f8,_6f9){var _6fa=this._find(_6f8,function(item){return item.value===_6f9;});return _6fa&&_6fa.label||"";},_initialize:function(){this.channelStore.query({query:"getallregistered"}).then(lang.hitch(this,function(_6fb){this._availableResolutions=this._getAvailableResolutions();this._availableChannels=[{value:null,label:_6ee.channelselector.defaultitem}].concat(_6fb.map(function(_6fc){return {value:_6fc.channelName,label:_6fc.name,resolutionId:_6fc.resolutionId};}));this.set("options",[new _6ed({property:"channel",model:this,label:_6ee.channelselector.header,options:this._availableChannels}),new _6ed({property:"resolution",model:this,label:_6ee.resolutionselector.header,options:this._availableResolutions})]);}));},_getAvailableResolutions:function(){var _6fd=[{value:null,label:_6ee.channelselector.defaultitem}];if(_6ec.displayResolutions){_6fd=_6fd.concat(_6ec.displayResolutions.map(function(r){return {value:r.width+"x"+r.height,label:r.name,id:r.id};}));}return _6fd;},_getDefaultResolutionForChannel:function(_6fe){var _6ff=this._availableResolutions;if(!(_6fe&&lang.isArray(_6ff))){return null;}_6fe=this._find(this._availableChannels,function(c){return c.value===_6fe;});var _700=this._find(_6ff,function(r){return (r.id===_6fe.resolutionId);});return _700?_700.value:null;},_find:function(_701,_702){var _703=null;if(!lang.isArray(_701)){return null;}_701.some(function(_704){if(_702(_704)){_703=_704;return true;}});return _703;}});});},"epi-cms/contentediting/EditorFactory":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","epi-cms/ApplicationSettings"],function(_705,_706,lang,_707){return _705(null,{defaultWrapperType:null,_registeredEditorWrappers:null,onEditorCreated:function(_708){},onEditorResolved:function(data,_709){},constructor:function(){var _70a=_707.uiDefaults;this._registeredEditorWrappers={};this.defaultWrapperType=(_70a&&_70a.defaultEditorWrapper)||"floating";},registerEditorWrapper:function(_70b,_70c,_70d){this._registeredEditorWrappers[_70b]={wrapperClassType:_70c,initializer:_70d};},_getWrapperAndEditor:function(_70e){var type=_70e.type;var name=_70e.name;var _70f=_70e.wrapperType;var _710=_70e.editorParams||{};var _711=_70e.editorWidgetType;if(!_70f){if(_70e.metadata.customEditorSettings&&_70e.metadata.customEditorSettings.uiWrapperType){_70f=_70e.metadata.customEditorSettings.uiWrapperType;}else{_70f=this.defaultWrapperType;}}if(!_711){if(_70e.metadata.customEditorSettings&&_70e.metadata.customEditorSettings.uiType){_711=_70e.metadata.customEditorSettings.uiType;}else{if(_70e.metadata.uiType){_711=_70e.metadata.uiType;}else{_711="epi/shell/widget/FormContainer";lang.mixin(_710,{metadata:_70e.metadata,onFieldCreated:function(_712,_713){}});}}}if(!_711){throw ("Could not resolve editor widget for property: "+_70e.name);}if(_70e.metadata.customEditorSettings&&_70e.metadata.customEditorSettings.uiParams){lang.mixin(_710,_70e.metadata.customEditorSettings.uiParams);}var _714=this._registeredEditorWrappers[_70f];if(!_714){throw ("No suitable editor wrapper found for type: "+_70f);}var data={wrapperInitializer:_714.initializer,wrapperType:_714.wrapperClassType,editorWidgetType:_711,editorParams:_710};this.onEditorResolved(data,_70e);if(_70f){return data;}throw ("No suitable editor found");},createEditor:function(_715,node,_716,_717){var def=new _706();var _718=this._getWrapperAndEditor(_715);var _719=_718.wrapperType;var _71a=_718.editorWidgetType;require([_719,_71a],lang.hitch(this,function(_71b){var _71c=_717||{};if(_715.metadata){lang.mixin(_71c,_715.metadata.settings);lang.mixin(_71c,_718.editorParams);_71c.selections=_715.metadata.selections;}var _71d={wrapperType:_718.wrapperType,editorWidgetType:_718.editorWidgetType,editorParams:_71c,blockDisplayNode:node,overlayItem:_71c.overlayItem,property:_715,propertyName:_715.name,propertyDisplayName:_715.metadata.displayName,value:_716,contentModel:_715.contentModel};var _71e=new _71b(_71d);var _71f=_718.wrapperInitializer;if(_71f){lang.mixin(_71d.editorParams,{parent:_71e});_71f(_71e,_71d);}this.onEditorCreated(_71e.getEditorWidget());def.resolve(_71e);}));return def;}});});},"epi-cms/contentediting/InUseNotificationManager":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/when","dojo/date","dojo/aspect","epi","epi/username","epi/dependency","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(lang,_720,_721,when,_722,_723,epi,_724,_725,_726,_727,res){return _721([],{contextTypeName:"",_postFlag:false,_inUseNotificationStore:null,_currentUsername:null,_messageService:null,currentModel:null,_eventHandlers:null,ignoreOthersNotifications:null,constructor:function(_728){this.inherited(arguments);lang.mixin(this,_728);this._inUseNotificationStore=this.store||_725.resolve("epi.storeregistry").get("epi.cms.inusenotification");this._currentUsername=this.username||_726.userName;this._messageService=this.messageService||_725.resolve("epi.shell.MessageService");this._eventHandlers=[];},updateCommandModel:function(_729){this.inherited(arguments);if(this.currentModel&&!_727.compareIgnoreVersion(this.currentModel.contentData.contentLink,_729.contentData.contentLink)){this.ignoreOthersNotifications=false;}this.currentModel=_729;_720.forEach(this._eventHandlers,function(_72a){_72a.remove();});this.updateMessageService(this.currentModel.contentData);this._eventHandlers=[_723.after(_729,"suspend",lang.hitch(this,this._onViewModelSuspended)),_723.after(_729,"destroyed",lang.hitch(this,this._onViewModelSuspended)),_723.after(_729,"onPropertyEdited",lang.hitch(this,this._onPropertyEdited)),_723.around(_729,"canChangeContent",lang.hitch(this,this._canChangeContentAdvisor))];},_canChangeContentAdvisor:function(_72b){return lang.hitch(this,function(){if(!this.ignoreOthersNotifications){var _72c=this.getOtherUsersInUseNotifications(this.currentModel.contentData.inUseNotifications);if(_72c&&_72c.length){return false;}}return _72b.apply(this.currentModel,arguments);});},_onViewModelSuspended:function(){var _72d=this.currentModel.contentData;this.removeAutomaticInUseNotification(_72d);},_onPropertyEdited:function(){var _72e=this.currentModel.contentData;this.ensureAutomaticInUseNotification(_72e);},ensureAutomaticInUseNotification:function(_72f){var _730;_720.some(_72f.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_730=item;return true;}},this);if(!_730){return this.put(this._createNotification(_72f,false),_72f.inUseNotifications);}else{if(_730.addedManually){return;}else{var _731=new Date(_730.modified);if(_722.difference(_731,new Date(),"minute")>30){return this.put(_730,_72f.inUseNotifications);}}}},removeAutomaticInUseNotification:function(_732){_720.forEach(_732.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&!item.addedManually){this.remove(item,_732.inUseNotifications);}},this);},_createNotification:function(_733,_734){var _735=(new Date()).toISOString();return {contentLink:_733.contentLink,languageBranch:_733.currentLanguageBranch&&_733.currentLanguageBranch.languageId,addedManually:_734,created:_735,modified:_735};},put:function(_736,_737){_736.modified=(new Date()).toISOString();if(!this._postFlag){this._postFlag=true;return when(this._inUseNotificationStore.put(_736),lang.hitch(this,function(_738){var _739;var _73a=_720.some(_737,function(item,_73b){if(_738.id===item.id){_739=_73b;return true;}return false;});if(_73a&&_739>=0){_737[_739]=_738;}else{_737.push(_738);}this._updateDependentStores(_736.contentLink,_737);this._postFlag=false;}));}},remove:function(_73c,_73d){return when(this._inUseNotificationStore.remove(_73c.id),lang.hitch(this,function(){var _73e=_720.indexOf(_73d,_73c);_73d.splice(_73e,1);this._updateDependentStores(_73c.contentLink,_73d);}));},_updateDependentStores:function(_73f,_740){var _741={contentLink:_73f,inUseNotifications:_740};this._inUseNotificationStore.updateDependentStores(_741);},togglePermanentEditIndication:function(_742,_743){var _744;var _745=_720.some(_742.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_744=item;if(item.addedManually){return true;}}},this);if(_745){if(_743&&_744.convertedFromAutomaticNotification){_744.addedManually=false;return this.put(_744,_742.inUseNotifications);}else{return this.remove(_744,_742.inUseNotifications);}}else{if(_744&&_743){_744.convertedFromAutomaticNotification=true;_744.addedManually=true;}else{_744=this._createNotification(_742,true);}return this.put(_744,_742.inUseNotifications);}},updateMessageService:function(_746){var _747=_746.contentLink+"_permanentEdit";this._messageService.remove({externalItemId:_747});var _748=this._getManualInUseNotification(_746.inUseNotifications);if(_748){this._notificationHandlerId=this._messageService.put("note",res.permanenteditison,this.contextTypeName,_746.contentLink,_747,null);}},_getManualInUseNotification:function(_749){var _74a;var _74b=_720.forEach(_749,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&item.addedManually){_74a=item;}},this);return _74a;},currentUserHasInUseNotification:function(_74c,_74d){return _720.some(_74c,function(item){return item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&(!_74d||item.addedManually);},this);},getOtherUsersInUseNotifications:function(_74e){var _74f=[];_720.forEach(_74e,function(item){if(item.userName.toLowerCase()!==this._currentUsername.toLowerCase()){var _750=_724.toUserFriendlyString(item.userName,this._currentUsername);_74f.push(_750);}},this);return _74f;},hasInUseNotificationWarning:function(_751){if(this.ignoreOthersNotifications){return false;}return this.getOtherUsersInUseNotifications(_751).length;}});});},"epi-cms/contentediting/ViewSettingsManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/Stateful","epi/epi","epi/dependency","epi/UriParser"],function(_752,_753,lang,_754,_755,epi,_756,_757){return _752([_755],{_hashWrapper:null,viewSettings:null,_viewSettingsMap:null,viewSettingsHashValue:null,_activeKey:"active",enabled:false,previewParams:null,postscript:function(){this.inherited(arguments);this._hashWrapper=this._hashWrapper||_756.resolve("epi.shell.HashWrapper");this.previewParams={};this.viewSettingsHashValue=[];this._viewSettingsMap={};_753.forEach(this.viewSettings,lang.hitch(this,function(_758){if(!this._viewSettingsMap[_758.key]){this._viewSettingsMap[_758.key]=_758;}else{throw "Duplicated view settings key.";}}));_754.subscribe("/epi/cms/action/viewsettingvaluechanged",lang.hitch(this,this._viewSettingChanged));_754.subscribe("/epi/cms/action/eyetoggle",lang.hitch(this,this._viewSettingEnabledChanged));var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);}this.enabled=this._loadProperty(this._activeKey)==="true";_753.forEach(this.viewSettingsHashValue,lang.hitch(this,function(item){var _759=this._viewSettingsMap[item.type];if(_759){_759.set("enabled",this.get("enabled"));_759.value=item.id;_759.beforePreviewLoad(this.previewParams,this.get("enabled"));}}));},onPreviewReady:function(_75a){this._preview=_75a;_753.forEach(this.viewSettings,lang.hitch(this,function(_75b){_75b.afterPreviewLoad(_75a,this.get("enabled"));}));},getSettingProperty:function(_75c){var _75d=_753.filter(this.viewSettingsHashValue,function(_75e){return _75e.type===_75c;});return _75d.length>0?_75d[0].id:null;},hasVisitorGroup:function(){return this.getSettingProperty("visitorgroup")!==null&&this.getSettingProperty("visitorgroup").id!==null;},_enabledGetter:function(){return this.enabled;},_enabledSetter:function(_75f){this.enabled=_75f;var _760={};_753.forEach(this.viewSettings,lang.hitch(this,function(_761){_761.set("enabled",_75f);_761.beforePreviewLoad(_760,_75f);}));if(!epi.areEqual(this.previewParams,_760)){this.previewParams=_760;}else{_753.forEach(this.viewSettings,lang.hitch(this,function(_762){_762.afterPreviewLoad(this._preview,_75f);}));}},_applyViewSettingValue:function(key,_763){var _764,_765=this._viewSettingsMap[key];if(_765){_764=lang.clone(this.previewParams);_765.value=_763;_765.beforePreviewLoad(_764,true);if(!epi.areEqual(this.previewParams,_764)){this.previewParams=_764;}else{_765.afterPreviewLoad(this._preview,true);}}},_viewSettingChanged:function(key,_766){var self=this;this._commitToHash(function(){var _767=key;if(!(key instanceof Array)){_767=[{key:key,value:_766}];}_767.forEach(function(_768){self._saveProperty(_768.key,_768.value);self._applyViewSettingValue(_768.key,_768.value);});});},_viewSettingEnabledChanged:function(_769){var self=this;this._commitToHash(function(){var _76a=self._hasSetting();if(_769){self._saveProperty(self._activeKey,"true");}else{self._saveProperty(self._activeKey,_76a?false:null);}self.set("enabled",_769);});},_addProperty:function(_76b,_76c){this.viewSettingsHashValue.push({type:_76b,id:_76c});},_updateProperty:function(_76d,_76e){var _76f=-1;_753.forEach(this.viewSettingsHashValue,function(item,_770){if(item.type===_76d){_76f=_770;return;}});if(_76f>-1){this.viewSettingsHashValue[_76f].id=_76e;}else{this._addProperty(_76d,_76e);}},_toObjects:function(url){var _771=[];_753.forEach(url.split("|"),function(item,_772){var uri=new _757(item);_771.push({type:uri.getType(),id:uri.getId()});});return _771;},_deleteProperty:function(_773){var _774=-1;_753.forEach(this.viewSettingsHashValue,function(item,_775){if(item.type===_773){_774=_775;return;}});if(_774>-1){this.viewSettingsHashValue.splice(_774,1);}},_commitToHash:function(_776){var obj=this._hashWrapper.getHash();var _777=[];if(obj&&obj.viewsetting){this.set("viewSettingsHashValue",this._toObjects(obj.viewsetting));}else{this.set("viewSettingsHashValue",[]);}_776();_753.forEach(this.viewSettingsHashValue,function(item,_778){_777.push(item.type+":///"+item.id);});if(_777.length>0){obj.viewsetting=_777.join("|");}else{delete obj.viewsetting;}this._hashWrapper.setHash(obj);},_saveProperty:function(_779,_77a){if(this.get("viewSettingsHashValue")){if(_77a!=null){this._updateProperty(_779,_77a);}else{this._deleteProperty(_779);}}else{if(_77a!=null){this._updateProperty(_779,_77a);}}},_loadProperty:function(_77b){var obj=this._hashWrapper.getHash();var _77c=null;if(obj&&obj.viewsetting){var _77d=this._toObjects(obj.viewsetting);var _77e=_753.filter(_77d,function(item){return item.type===_77b;})[0];if(_77e){_77c=_77e.id;}}return _77c;},_hasSetting:function(){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){if(obj.viewsetting.split("|").length>1){return true;}}return false;},getRenderingViewSettings:function(){return _753.filter(this.viewSettings,lang.hitch(this,function(_77f){return _77f.usedForRendering;}));}});});},"epi-cms/project/ProjectService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojo/promise/all","dojo/Evented","dojo/aspect","dijit/Destroyable","epi/dependency","epi/shell/xhr/errorHandler","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_780,lang,when,_781,all,_782,_783,_784,_785,_786,_787,_788){return _780([_782,_784],{isProjectModeEnabled:false,projectItemStore:null,projectStore:null,_currentProjectProfileKey:"epi.current-project-id",constructor:function(_789){_780.safeMixin(this,_789);this.projectItemStore=this.projectItemStore||_785.resolve("epi.storeregistry").get("epi.cms.project.item");this.projectStore=this.projectStore||_785.resolve("epi.storeregistry").get("epi.cms.project");this.profile=this.profile||_785.resolve("epi.shell.Profile");this.isProjectModeEnabled=_787.isProjectModeEnabled;this.own(this.projectItemStore.on("update",this._onProjectItemUpdated.bind(this)),this.projectItemStore.on("delete",this._onProjectItemRemoved.bind(this)),this.projectStore.on("update",this._onProjectUpdated.bind(this)),this.projectStore.on("delete",this._onProjectRemoved.bind(this)));},hasScheduledProjectItems:function(_78a){return _786.wrapXhr(this.projectStore.refresh(_78a)).then(function(_78b){return _78b.itemStatusCount.delayedpublish>0||_78b.itemStatusCount.delayedpublish_nopublishaccess>0;}.bind(this));},getProjectItemsForContent:function(_78c){if(!(_78c instanceof Array)){_78c=[_78c];}return when(this.projectItemStore.query({contentLinks:_78c}));},getProjectItemForContent:function(_78d){var _78e=new _788(_78d);if(_78e.workId===0){return new _781().reject("The content link needs to be version specific");}return this.getProjectItemsForContent(_78d).then(function(_78f){for(var i=0;i<_78f.length;i++){if(_78f[i].contentLink===_78d){return _78f[i];}}return null;});},getProjectsForContent:function(_790){var self=this;if(!(_790 instanceof Array)){_790=[_790];}return this.getProjectItemsForContent(_790).then(function(_791){if(_791.length===0){return new _781().resolve([]);}return self.getProjects(_791);});},canAddContent:function(_792,_793){var _794=_793.filter(function(elem,pos){return _793.indexOf(elem)===pos;});return this.projectStore.executeMethod("CanAddContent",_792,{contentReferences:_794});},getProjects:function(_795){var _796=this.projectStore;var _797=_795.map(function(_798){return _796.get(_798.projectId);});return all(_797);},exists:function(_799){return _786.wrapXhr(this.projectStore.executeMethod("exists",_799));},addProjectItems:function(_79a,_79b){_79b=_79b.filter(function(_79c,pos){if(_788.isContentReference(_79c)&&_79b.indexOf(_79c)===pos){return true;}});var _79d=this.projectItemStore,_79e=_79b.map(function(_79f){return _79d.add({contentLink:_79f,projectId:_79a});});return _786.wrapXhr(all(_79e));},removeProjectItems:function(_7a0){var _7a1=_7a0.map(function(item){return item.id;});return _786.wrapXhr(this.projectItemStore.removeRange(_7a1));},markAsReadyToPublish:function(_7a2){return _786.wrapXhr(this.projectItemStore.executeMethod("ReadyToPublish","",_7a2));},isPartOfDelayedPublishedProject:function(_7a3){return this.getProjectsForContent([_7a3]).then(function(_7a4){return _7a4.some(function(_7a5){return _7a5.status==="delayedpublished";});});},publishProject:function(_7a6,_7a7){var _7a8=this.projectStore;if(isNaN(_7a6)){throw new Error("projectId is not a number");}return _786.wrapXhr(_7a8.executeMethod("Publish",_7a6,{delayPublishUntil:_7a7})).then(_7a8.patchCache.bind(_7a8));},reactivateProject:function(_7a9){var _7aa=this.projectStore;if(isNaN(_7a9)){throw new Error("The given project ID is not a number.");}return _786.wrapXhr(_7aa.executeMethod("Reactivate",_7a9)).then(_7aa.patchCache.bind(_7aa));},getCurrentProjectId:function(){if(!this.isProjectModeEnabled){return new _781().resolve(null);}return when(this.profile.get(this._currentProjectProfileKey));},getCurrentProject:function(){var _7ab=this.projectStore;var that=this;return this.getCurrentProjectId().then(function(_7ac){if(!_7ac){return null;}return when(_7ab.get(_7ac)).otherwise(function(ex){if(ex.status===404){that.setCurrentProject(null);}return null;});});},setCurrentProject:function(_7ad){this.emit("currentProjectChanged",_7ad);return this.profile.set(this._currentProjectProfileKey,_7ad&&_7ad.id,{location:"server"});},_onProjectItemUpdated:function(_7ae){this.emit("project-item-updated",_7ae.target);},_onProjectItemRemoved:function(_7af){this.emit("project-item-removed",_7af.id);},_onProjectUpdated:function(_7b0){this.emit("project-updated",_7b0.target);},_onProjectRemoved:function(_7b1){this.emit("project-removed",_7b1.id);}});});},"epi/shell/xhr/errorHandler":function(){define("epi/shell/xhr/errorHandler",["dojo/_base/declare","dojo/when","dojo/_base/json","dgrid/List","dgrid/extensions/DijitRegistry","../widget/dialog/Alert","../widget/dialog/ErrorDialog"],function(_7b2,when,json,List,_7b3,_7b4,_7b5){var _7b6=_7b2([List,_7b3]),_7b7;function _7b8(_7b9){if(typeof _7b9==="string"){try{return json.fromJson(_7b9);}catch(e){console.warn("Failed to parse responseText as json",e);}}return {};};_7b7={forXhr:function(_7ba){var data,_7bb,list;if(_7ba.status>=500){_7b5.showXmlHttpError(_7ba,_7ba);}else{data=_7b8(_7ba.responseText);_7bb={description:data.message||_7ba.message};if(data.additionalInformation instanceof Array){list=new _7b6({className:"epi-grid-max-height--300"});list.renderArray(data.additionalInformation);list.startup();_7bb.content=list;}new _7b4(_7bb).show();}},wrapXhr:function(_7bc){_7bc=when(_7bc);_7bc.otherwise(_7b7.forXhr);return _7bc;}};return _7b7;});},"epi/shell/widget/dialog/ErrorDialog":function(){define("epi/shell/widget/dialog/ErrorDialog",["dojo","dijit/Dialog"],function(dojo,_7bd){return function(){var _7be=null;var _7bf="/shell/cms/errordialog/";var _7c0={title:"A background request has failed",reloadtext:"Reload",heading:"An unhandled error has occured in a background request.",description:"The page may not function properly unless it's reloaded. Press the button below to reload the page now."};var _7c1="        <div style=\"padding-bottom:10px; width:600px\">             <h1>${heading}</h1>             <div style=\"background-color:#FFF; border:1px solid #000; padding:3px\">${errorMessage}</div>             <p>${description}</p>             <input type=\"button\" onclick=\"document.location.reload()\" value=\"${reloadtext}\" />         </div>     ";function _7c2(){if(!_7be){_7be=new _7bd();}return _7be;};function _7c3(_7c4,_7c5){var _7c6=dojo.create("div",{innerHTML:dojo.string.substitute(_7c1,dojo.mixin({errorMessage:_7c4},_7c0))});var _7c7=dojo.create("iframe",{style:"width:100%; height:400px; border:inset 1px #CCC",frameborder:"0",width:"600",height:"400",src:"about:blank"});if(_7c7.attachEvent){var _7c8=function(){_7c7.detachEvent("onload",_7c8);_7c7.contentWindow.document.write(_7c5);};_7c7.attachEvent("onload",_7c8);}else{var _7c9=dojo.connect(_7c7,"load",null,function(){dojo.disconnect(_7c9);_7c7.contentWindow.document.write(_7c5);});}dojo.place(_7c7,_7c6);return _7c6;};var pub={getTextResourceKeys:function(){var _7ca=[];for(var p in _7c0){_7ca.push(_7bf+p);}return _7ca;},setTextResources:function(keys){if(!dojo.isArray(keys)){return;}dojo.forEach(keys,function(item){if(dojo.isString(item.key)&&dojo.isString(item.text)){_7c0[item.key.replace(_7bf,"")]=item.text;}});},showXmlHttpError:function(_7cb,_7cc){var _7cd=_7c2();var _7ce="";var _7cf="";if(_7cc&&_7cc.xhr){_7ce=_7cc.xhr.responseText;}if(dojo.isObject(_7cb)&&dojo.isString(_7cb.message)){_7cf=_7cb.message;}else{_7cf=_7cb;}var _7d0=_7c3(_7cf,_7ce);_7cd.set("title",_7c0.title);_7cd.set("content",_7d0);_7cd.show();}};return pub;}();});},"epi-cms/project/ActivityService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dijit/Destroyable","epi/dependency"],function(_7d1,lang,_7d2,_7d3,_7d4){return _7d1([_7d2,_7d3],{activityStore:null,activityCommentStore:null,constructor:function(_7d5){_7d1.safeMixin(this,_7d5);this.activityStore=this.activityStore||_7d4.resolve("epi.storeregistry").get("epi.cms.activities");this.activityCommentStore=this.activityCommentStore||_7d4.resolve("epi.storeregistry").get("epi.cms.activities.comments");this.own(this.activityCommentStore.on("update",this._onActivityCommentUpdated.bind(this)));},addMessage:function(_7d6,_7d7,_7d8){var obj={projectId:_7d6,contentLink:_7d7,message:_7d8};return this.activityStore.add(obj);},saveMessage:function(_7d9,_7da){var obj={id:_7d9,message:_7da};return this.activityStore.put(obj);},addComment:function(_7db,_7dc){var obj={activityId:_7db,message:_7dc};return this.activityCommentStore.add(obj);},saveComment:function(_7dd,_7de){var obj={id:_7dd,message:_7de};return this.activityCommentStore.put(obj);},_onActivityCommentUpdated:function(_7df){this.emit("activity-comment-updated",_7df.target);}});});},"epi-cms/notification/NotificationService":function(){define(["dojo/_base/declare","dojo/when","dojo/Deferred","dojo/Stateful","dojo/Evented","dijit/Destroyable","epi/shell/xhr/errorHandler","epi/dependency"],function(_7e0,when,_7e1,_7e2,_7e3,_7e4,_7e5,_7e6){return _7e0([_7e2,_7e3,_7e4],{notificationStore:null,postscript:function(){this.inherited(arguments);this.notificationStore=this.notificationStore||_7e6.resolve("epi.storeregistry").get("epi.cms.notification");this.own(this.notificationStore.on("add",this._onNotificationUpdated.bind(this)),this.notificationStore.on("update",this._onNotificationUpdated.bind(this)));},_onNotificationUpdated:function(_7e7){this.emit("notification-updated",_7e7.target);},getUnreadNotificationCount:function(){return _7e5.wrapXhr(this.notificationStore.executeMethod("GetUnreadCount"));},markAsRead:function(_7e8){if(!_7e8){return new _7e1().reject();}return _7e5.wrapXhr(this.notificationStore.executeMethod("MarkAsRead",_7e8)).then(this.notificationStore.refresh.bind(this.notificationStore,_7e8));},markAllAsRead:function(){return _7e5.wrapXhr(this.notificationStore.executeMethod("MarkAllAsRead"));}});});},"epi-cms/project/request/projectMode":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_7e9,when,_7ea){return {_getCurrentProjectId:function(){var _7eb="epi.cms.ProjectService";if(_7ea.exists(_7eb)){var _7ec=_7ea.resolve(_7eb);return _7ec.getCurrentProjectId();}return when(null);},beforeSend:function(_7ed){var _7ee=_7ed.options;if(_7ee.isProfileRequest){return when(_7ed);}var _7ef=new _7e9();this._getCurrentProjectId().then(function(_7f0){if(_7f0){_7ee.headers["X-EPiCurrentProject"]=_7f0;}}).otherwise(function(err){console.error("Failed to get current project id from project service",err);}).always(function(){_7ef.resolve(_7ed);});return _7ef.promise;}};});},"epi-cms/request/contentLanguage":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_7f1,when,_7f2){return {beforeSend:function(_7f3){var _7f4=new _7f1();var _7f5=_7f3.options;if(!(_7f5.preventLocalizationHeader||_7f5.isProfileRequest)){var _7f6=_7f2.resolve("epi.shell.Profile");when(_7f6.getContentLanguage()).then(function(_7f7){if(_7f7){_7f5.headers["X-EPiContentLanguage"]=_7f7;}_7f4.resolve(_7f3);});return _7f4.promise;}_7f4.resolve(_7f3);return _7f4.promise;}};});},"epi-cms/project/ProjectModeRequestInterceptor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi/dependency"],function(_7f8,lang,_7f9,_7fa,_7fb){return _7f8([_7fa],{constructor:function(_7fc){_7f8.safeMixin(this,_7fc);this.projectService=this.projectService||_7fb.resolve("epi.cms.ProjectService");this.contextService=this.contextService||_7fb.resolve("epi.shell.ContextService");this.own(this.contextService.registerRequestInterceptor(lang.hitch(this,this._onInterceptRequest)));},_onInterceptRequest:function(_7fd){var dfd=new _7f9();if(!this.projectService.isProjectModeEnabled){dfd.resolve();}else{this.projectService.getCurrentProject().then(function(_7fe){if(_7fe){_7fd.epiprojects=_7fe.id;_7fd.epieditmode=true;}}).always(dfd.resolve);}return dfd.promise;}});});},"epi-cms/project/ProjectItemQueryEngine":function(){define(["epi-cms/core/ContentReference","epi-cms/store/queryUtils"],function(_7ff,_800){return function(_801,_802){_802=_802||{};_802.comparers={contentLinks:function(_803,_804){return _803.some(function(link){return _7ff.compareIgnoreVersion(link,_804.contentLink);});}};return _800.createEngine(_801,_802);};});},"epi-cms/contentediting/command/Editing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/shell/command/withConfirmation","epi/shell/_StatefulGetterSetterMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/Reject","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ManageExpiration","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_805,lang,_806,_807,_808,_809,_80a,_80b,_80c,_80d,_80e,_80f,_810,_811){var _812=_805([_806,_808],{model:null,revertToPublished:null,reject:null,translate:null,createDraft:null,sendForReview:null,publish:null,withdraw:null,manageExpiration:null,constructor:function(_813){lang.mixin(this,_813);this.revertToPublished=_807(new _80a(),null,{title:_811.reverttopublishconfirmation.dialogtitle,heading:_811.reverttopublishconfirmation.confirmquestion,description:_811.reverttopublishconfirmation.description});this.reject=new _80b();this.translate=new _809();this.createDraft=new _80e();this.sendForReview=new _80c();this.publish=new _80d();this.withdraw=new _80f();this.manageExpiration=new _810();},_setModelAttr:function(_814){this._set("model",_814);this.revertToPublished.set("model",_814);this.reject.set("model",_814);this.translate.set("model",_814);this.createDraft.set("model",_814);this.sendForReview.set("model",_814);this.publish.set("model",_814);this.withdraw.set("model",_814);this.manageExpiration.set("model",_814);}});return new _812();});},"epi/shell/command/withConfirmation":function(){define("epi/shell/command/withConfirmation",["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","epi/shell/widget/dialog/Confirmation"],function(_815,lang,when,_816,_817){function _818(_819){var _81a=new _816(),_81b=new _817(_819);_81b.connect(_81b,"onAction",function(_81c){if(_81c){_81a.resolve();}else{_81a.cancel();}});_81b.show();return _81a.promise;};return function(_81d,_81e,_81f){var _820=_81d._execute;_81d._execute=function(){var _821=new _816();function _822(){when(_820.apply(_81d,arguments),_821.resolve,_821.cancel);};_81e=_81e||_818;when(_81e(_81f),_822,_821.cancel);return _821;};return _81d;};});},"epi-cms/command/TranslateContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command"],function(_823,_824,_825,_826){return _823([_826],{label:_825.label,executingLabel:_825.executinglabel,tooltip:_825.title,category:"context",_execute:function(){var _827=this._getNormalizedModel();if(typeof this.executeDelegate==="function"){this.executeDelegate(this.model);}else{var data={contentData:_827.content,languageBranch:_827.language.preferredLanguage};_824.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);}},_onModelChange:function(){var _828=this._getNormalizedModel(),_829=_828&&_828.language,_82a=_828&&_828.content.isDeleted,_82b=_829&&_829.isTranslationNeeded&&!_82a,_82c=_82b&&_829.hasTranslationAccess&&_829.isPreferredLanguageAvailable;if(_828&&typeof _828.content.canTranslateContent==="function"){var _82d=_828.content.canTranslateContent();_82b=_82b&&_82d;_82c=_82c&&_82d;}this.set("isAvailable",!!_82b);this.set("canExecute",!!_82c);},_getNormalizedModel:function(){var _82e=this.model;if(_82e){return {content:_82e.contentData||_82e,language:_82e.languageContext||_82e.missingLanguageBranch};}}});});},"epi-cms/contentediting/command/RevertToPublished":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_82f,lang,_830,_831,_832){return _82f([_830],{name:"reverttopublished",tooltip:_832.reverttopublished.title,label:_832.reverttopublished.label,iconClass:"epi-iconRevert",_hasPendingChangeWatch:null,_execute:function(){this.model.revertToPublished();},_onModelChange:function(){this.inherited(arguments);var _833=this.model.contentData,_834=_833.status,_835=_831.versionStatus;var _836=(_834===_835.CheckedOut)||(_834===_835.Rejected)||((_834===_835.Published||_834===_835.Expired)&&_833.isCommonDraft);this.set("isAvailable",_836);if(this._hasPendingChangeWatch){this._hasPendingChangeWatch.unwatch();}this._hasPendingChangeWatch=this.model.watch("hasPendingChanges",lang.hitch(this,function(name,_837,_838){var _839=this._getCanExecute(_833,_835);this.set("canExecute",!_838&&_839);}));this.set("canExecute",_836&&this._getCanExecute(_833,_835));},_getCanExecute:function(_83a,_83b){return _83a.publishedBy!==null&&_83a.publishedBy!==undefined&&_83a.status!==_83b.Published&&_83a.status!==_83b.Expired&&this.model.canChangeContent()&&_831.hasAccess(_83a.accessMask,_831.accessLevel.Delete);}});});},"epi-cms/contentediting/command/_ContentCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_83c,lang,_83d){return _83c([_83d],{_isChangingContentStatusHandle:null,checkDeleted:true,destroy:function(){if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}this.inherited(arguments);},_canExecuteGetter:function(){if(!this.model||!this.model.contentData){return false;}var _83e=this.model.contentData;return this.canExecute&&(!this.checkDeleted||(_83e&&!_83e.isDeleted));},_onModelChange:function(){this.inherited(arguments);if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}var _83f;this._isChangingContentStatusHandle=this.model.watch("isChangingContentStatus",lang.hitch(this,function(name,_840,_841){if(_841){_83f=this.canExecute;this.set("canExecute",false);}else{this.set("canExecute",_83f);}}));}});});},"epi-cms/contentediting/command/Reject":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_842,_843,_844,_845,_846){return _842([_845],{name:"reject",label:_846.reject.label,tooltip:_846.reject.title,iconClass:"epi-iconStop",action:_844.action.Reject,_execute:function(){return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _847=this.model.contentData,_848=_847.status,_849=_844.versionStatus,_84a=(_848===_849.CheckedIn)&&this.model.canChangeContent(_844.action.Publish);this.set("canExecute",_84a);this.set("isAvailable",_84a);}});});},"epi-cms/contentediting/command/_ChangeContentStatus":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/topic","epi-cms/core/ContentReference","epi-cms/contentediting/command/_ContentCommandBase"],function(_84b,lang,_84c,_84d,_84e,_84f){return _84b([_84f],{action:null,forceReload:false,viewName:null,_execute:function(){return this._changeContentStatus();},_changeContentStatus:function(){var def=new _84c(),_850=lang.hitch(this,function(_851){this._requestContextChange(_851.id,true);def.resolve(_851);}),_852=function(){def.cancel();};_84c.when(this.model.changeContentStatus(this.action),_850,_852);return def;},_requestContextChange:function(id,_853){var _854={uri:"epi.cms.contentdata:///"+id};var _855={sender:this,trigger:"internal",forceContextChange:_853,forceReload:this.forceReload};if(this.viewName){lang.mixin(_855,{viewName:this.viewName});}_84d.publish("/epi/shell/context/request",_854,_855);}});});},"epi-cms/contentediting/command/SendForReview":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_856,_857,_858,_859,_85a){return _856([_859],{name:"sendforreview",label:_85a.sendforreview.label,executingLabel:_85a.sendforreview.executinglabel,tooltip:_85a.sendforreview.title,iconClass:"epi-iconCheckmark",action:_858.action.CheckIn,_execute:function(){_857.publish("/epi/cms/action/disableundoredoactions");return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _85b=this.model.contentData,_85c=((_85b.status===_858.versionStatus.CheckedOut)||(_85b.status===_858.versionStatus.Rejected)||(_85b.status===_858.versionStatus.Published&&_85b.isCommonDraft))&&this.model.canChangeContent(this.action),_85d=_85c&&(_85b.status!==_858.versionStatus.Published);this.set("canExecute",_85d);this.set("isAvailable",_85c);}});});},"epi-cms/contentediting/command/Publish":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/topic","epi/datetime","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_85e,_85f,_860,_861,_862,_863,_864,_865,_866,_867){return _85e([_866],{name:"publish",label:_867.publish.label,executingLabel:_867.publish.executinglabel,tooltip:_867.publish.title,action:_865.action.Publish,forceReload:true,_execute:function(){var def=new _85f();_85f.when(this.inherited(arguments),function(_868){var _869=new _864(_868.oldId).createVersionUnspecificReference().toString();_860.publish("/epi/cms/contentdata/childrenchanged",_869);def.resolve();},function(){def.reject();});return def;},_onModelChange:function(){this.inherited(arguments);var _86a=this.model.contentData,_86b=_86a.status,_86c=this.model.canChangeContent(_865.action.Publish),_86d=_86c&&!(_86b===_865.versionStatus.Published&&!_86a.isCommonDraft),res=null;switch(_86b){case _865.versionStatus.CheckedIn:res=_867.approveandpublish;break;case _865.versionStatus.PreviouslyPublished:res=_867.republish;break;case _865.versionStatus.CheckedOut:if(_86a.isMasterVersion){res=_867.publish;}else{res=_867.publishchanges;}break;default:res=_867.publishchanges;}var _86e=_863.getValue(_86a.typeIdentifier,"publishView");this.set("label",res.label);this.set("title",res.title);this.set("executingLabel",res.executinglabel);this.set("canExecute",_86d);this.set("isAvailable",_86c);this.set("viewName",_86e);}});});},"epi-cms/contentediting/command/CreateDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_86f,_870,_871,_872){return _86f([_870],{name:"createdraft",label:_872.createdraft.label,tooltip:_872.createdraft.title,iconClass:"epi-iconPage",ignoreContentStatus:false,_execute:function(){this.model.createDraft();},_onModelChange:function(){var _873=this.model.contentData,_874=_873.status,_875=_871.versionStatus,_876,_877;this.inherited(arguments);_876=_871.hasAccessToAction(_873,_871.action.Edit,_871.providerCapabilities.Edit);_877=this.ignoreContentStatus||_874===_875.DelayedPublish||(_874===_875.Published||_874===_875.PreviouslyPublished)&&!_873.isCommonDraft;this.set({canExecute:_876&&_877,isAvailable:_876&&_877});}});});},"epi-cms/contentediting/command/Withdraw":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_878,_879,_87a,_87b){return _878([_87a],{name:"withdraw",label:_87b.withdraw.label,tooltip:_87b.withdraw.title,iconClass:"epi-iconPen",action:_879.saveAction.CheckOut|_879.saveAction.ForceCurrentVersion,contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_879;},_execute:function(){return this.inherited(arguments);},_onModelChange:function(){this.inherited(arguments);var _87c=this.model.contentData,_87d=_87c.status,_87e=_879.versionStatus,_87f=this.contentActionSupport.isActionAvailable(_87c,_879.action.Create)&&!this.contentActionSupport.isActionAvailable(_87c,_879.action.Publish),_880=_87f&&(_87d===_87e.CheckedIn);this.set("canExecute",_880);this.set("isAvailable",_880);}});});},"epi-cms/contentediting/command/ManageExpiration":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi","epi/datetime","epi-cms/contentediting/ExpirationDialog","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_881,_882,_883,lang,epi,_884,_885,_886,_887,_888,_889,_88a,_88b){return _882([_888],{label:_88a.dialogtitle,tooltip:_88a.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",_execute:function(){var _88c=this.createDialog();_88c.on("execute",lang.hitch(this,this._onExecute));_88c.show();},createDialog:function(){var _88d=this.get("viewModel");var _88e=new _885({model:_88d});return new _889({defaultActionsVisible:false,confirmActionText:_88b.action.save,content:_88e,title:_88a.dialogtitle});},_onModelChange:function(){var _88f=this.get("model");if(!_88f||!_88f.contentData){this.set("canExecute",false);return;}var _890=_88f.contentData.properties,_891=_890.iversionable_expire;var _892=_88f.canChangeContent()&&_887.hasAccess(_88f.contentData.accessMask,_887.accessLevel.Publish);this.set("canExecute",false);_883.when(_88f.getPropertyMetaData("iversionable_expire"),lang.hitch(this,function(_893){this.set("viewModel",new _886({metadata:_893,contentLink:_88f.contentLink,contentName:_88f.contentData.name,value:_891,minimumExpireDate:_890.iversionable_startpublish}));this.set("canExecute",_892);}));},_onExecute:function(_894){var _895=this.get("model");_895.saveAndPublishProperty("iversionable_expire",_894);}});});},"epi-cms/contentediting/ExpirationDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ExpirationDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_896,lang,_897,_898,_899,_89a,_89b,_89c,_89d,_89e,res,_89f){return _896([_89b,_89d,_89a,_898,_89c],{templateString:_89e,res:res,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],infoText:["infoText"],state:["state"],enableSaveButton:["enableSaveButton"],showRemoveButton:["showRemoveButton"]},postMixInProperties:function(){this.inherited(arguments);this.set("metadata",this.model.metadata);this.set("value",this.model.value);this.doLayout=false;},_archiveLinkSelector:null,_setContentLinkAttr:function(_8a0){this.breadcrumb.set("contentLink",_8a0);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setInfoTextAttr:{node:"infoTextNode",type:"innerText"},_setEnableSaveButtonAttr:function(_8a1){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_8a1);}},_setShowRemoveButtonAttr:function(_8a2){_897.set(this.removeButton.domNode,"display",_8a2?"":"none");},_onRemoveButtonClick:function(){var _8a3={stopPublish:null,archiveLink:null};this.set("value",_8a3);this.onChange(_8a3);},onFieldCreated:function(_8a4,_8a5){if(_8a4==="stopPublish"){_8a5.set("minimumValue",this.model.get("minimumExpireDate"));_8a5.set("minimumValueMessage",this.model.get("minimumExpireDateMessage"));}else{if(_8a4==="archiveLink"){this._archiveLinkSelector=_8a5;if(this._archiveLinkSelector.readOnly){this._archiveLinkSelector._keepReadOnly=true;}this._archiveLinkSelector.set("contentLink",this.model.get("contentLink"));}}},onChange:function(_8a6){this.inherited(arguments);this.model.set("intermediateValue",_8a6);},getActions:function(){this._actions=[{name:"save",label:_89f.action.save,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){if(this.validate()){this.model.save();this.executeDialog(this.model.get("value"));}})},{name:"cancel",label:_89f.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.model.reset();this.cancelDialog();})}];return this._actions;}});});},"epi-cms/widget/Breadcrumb":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dojo/query","dojo/NodeList-manipulate","dojo/topic","dijit/_Widget","dijit/layout/_LayoutWidget","epi/dependency","epi-cms/core/ContentReference","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/_HierarchicalModelMixin"],function(_8a7,_8a8,lang,_8a9,_8aa,_8ab,_8ac,_8ad,_8ae,on,when,_8af,_8b0,_8b1,_8b2,_8b3,_8b4,_8b5,_8b6,_8b7){return _8a8([_8b3,_8b7,_8b6],{contentLink:null,store:null,showCurrentNode:true,showLastBracket:false,displayAsText:true,minimumItemCount:null,baseClass:"epi-breadCrumbs",_resizeListener:null,_visibleItems:[],_currentContent:null,_ancestors:null,postMixInProperties:function(){var _8b8=_8b4.resolve("epi.storeregistry");this.store=this.store||_8b8.get("epi.cms.content.light");this.minimumItemCount=this.minimumItemCount||2;},buildRendering:function(){this.domNode=this.ownerDocument.createElement("ul");this.inherited(arguments);},startup:function(){this._addResizeListener();},destroy:function(){if(this._resizeListener){this._resizeListener.remove();}this.destroyDescendants();this.inherited(arguments);},_addResizeListener:function(){if(this._resizeListener){return;}var _8b9=this.getParent(),_8ba=_8b9;while(_8ba&&!_8ba.isLayoutContainer&&_8ba.getParent()){_8ba=_8ba.getParent();}if(_8ba&&_8ba!==_8b9){this._resizeListener=_8a9.after(_8ba,"resize",lang.hitch(this,function(){var _8bb=_8ad.getMarginBox(this.domNode);this.resize(_8bb);}));}},resize:function(_8bc){if(!_8bc&&this._resizeListener){return;}else{this.layout();}},layout:function(){this._visibleItems=[];when(this._buildPath(),lang.hitch(this,function(){var _8bd=_8ad.getContentBox(this.domNode).w;if(_8bd>this._availableWidth){var _8be=this._leadingItem?_8ad.getMarginBox(this._leadingItem.domNode).w:0;var _8bf=this._availableWidth-_8be;this._ellipsisize(0,_8bf);}}));},_setContentLinkAttr:function(_8c0){this._set("contentLink",_8c0);this._currentContent=null;this._ancestors=null;this.layout();},_buildPath:function(){var _8c1=this.get("contentLink"),def=new _8aa(),path="";if(this._currentContent&&this._ancestors){this._createAllItems();def.resolve(path);}else{if(_8c1){var _8c2=new _8b5(_8c1);var _8c3=_8c2.createVersionUnspecificReference().toString();when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this.store.get(_8c3),lang.hitch(this,function(_8c4){this.getAncestors(_8c3,lang.hitch(this,function(_8c5){this._currentContent=_8c4;this._ancestors=_8c5;this._createAllItems();def.resolve(path);}));}));}));}else{def.resolve(path);}}return def.promise;},_createAllItems:function(){this._cleanUp();if(!this.isTypeOfRoot(this._currentContent)){var _8c6=[],_8c7=null;for(var i=this._ancestors.length-1;i>=0;i--){_8c7=this._ancestors[i];if(!_8c7.parentLink){continue;}_8c6.push(_8c7);if(this.isTypeOfRoot(_8c7)){break;}}_8c6.reverse();var _8c8=_8ad.getContentBox(this.domNode).w;this._availableWidth=_8c8>=0?_8c8:0;_8a7.forEach(_8c6,lang.hitch(this,function(_8c9){this._createItem(_8c9,true);}));}if(this.showCurrentNode){this._createItem(this._currentContent,this.showLastBracket);}},_cleanUp:function(){this.destroyDescendants();this._leadingItem=null;this._visibleItems=[];},_createItem:function(_8ca,_8cb){var node,_8cc=_8ac.create("li"),_8cd=this.displayAsText||!_8ca.hasTemplate;if(_8cd){node=_8ac.create("span",null,_8cc);}else{node=_8ac.create("a",{href:"#"},_8cc);this.own(on(node,"click",lang.hitch(this,function(e){this.onNodeClick(e,_8ca);})));}node.textContent=this.isContextualContent(_8ca)?this.getContextualRootName(_8ca):_8ca.name;if(_8cb){_8ac.create("span",{innerHTML:"&gt;","class":"epi-breadCrumbsSeparator"},_8cc);}this._addAndLayout(_8cc);},onNodeClick:function(e,_8ce){e.preventDefault();_8b1.publish("/epi/shell/context/request",{uri:_8ce.uri},{sender:this});},_addAndLayout:function(node){var _8cf=new _8b2({},node);this._visibleItems.push(_8cf);this.addChild(_8cf);var _8d0=this._getTotalVisibleItemsSize();if(_8d0>this._availableWidth){this._ensureLeadingItem();while(_8d0>this._availableWidth&&this._visibleItems.length>this.minimumItemCount){var _8d1=this._visibleItems.splice(0,1)[0];_8ae.set(_8d1.domNode,"display","none");_8d0=this._getTotalVisibleItemsSize();}}},_getTotalVisibleItemsSize:function(){var _8d2=0;if(this._leadingItem){_8d2+=_8ad.getMarginBox(this._leadingItem.domNode).w;}_8a7.forEach(this._visibleItems,function(item){_8d2+=_8ad.getMarginBox(item.domNode).w;});return _8d2;},_ensureLeadingItem:function(){if(this._leadingItem){return;}var _8d3=_8ac.create("li"),_8d4=_8ac.create("span",{innerHTML:"..."}),_8d5=_8ac.create("span",{innerHTML:" &gt; ","class":"epi-breadCrumbsSeparator"});_8ac.place(_8d4,_8d3,"last");_8ac.place(_8d5,_8d3,"last");this._leadingItem=new _8b2({},_8d3);this.addChild(this._leadingItem,0);},_ellipsisize:function(_8d6,_8d7){if(_8d6>=this._visibleItems.length){return;}var _8d8=this._visibleItems.length-_8d6,_8d9=Math.floor(_8d7/_8d8),item=this._visibleItems[_8d6],_8da=_8ad.getMarginBox(item.domNode).w;if(_8da<=_8d9){this._ellipsisize(_8d6+1,_8d7-_8da);}else{var _8db=_8af(this.displayAsText?"span":"a",item.domNode)[0],_8dc=_8af("span.epi-breadCrumbsSeparator",item.domNode)[0],_8dd=_8d9-_8ad.getMarginBox(_8dc).w;if(_8dd<0){_8dd=0;}_8ae.set(_8db,"width",_8dd+"px");_8ab.add(_8db,"dojoxEllipsis");this._ellipsisize(_8d6+1,_8d7-_8d9);}}});});},"dojo/NodeList-manipulate":function(){define("dojo/NodeList-manipulate",["./query","./_base/lang","./_base/array","./dom-construct","./NodeList-dom"],function(_8de,lang,_8df,_8e0){var _8e1=_8de.NodeList;function _8e2(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_8e2(n);}else{text+=n.nodeValue;}}}return text;};function _8e3(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _8e4(html,_8e5){if(typeof html=="string"){html=_8e0.toDom(html,(_8e5&&_8e5.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};lang.extend(_8e1,{_placeMultiple:function(_8e6,_8e7){var nl2=typeof _8e6=="string"||_8e6.nodeType?_8de(_8e6):_8e6;var _8e8=[];for(var i=0;i<nl2.length;i++){var _8e9=nl2[i];var _8ea=this.length;for(var j=_8ea-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_8e8.unshift(item);}if(j==_8ea-1){_8e0.place(item,_8e9,_8e7);}else{_8e9.parentNode.insertBefore(item,_8e9);}_8e9=item;}}if(_8e8.length){_8e8.unshift(0);_8e8.unshift(this.length-1);Array.prototype.splice.apply(this,_8e8);}return this;},innerHTML:function(_8eb){if(arguments.length){return this.addContent(_8eb,"only");}else{return this[0].innerHTML;}},text:function(_8ec){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_8e0.empty(node);node.appendChild(node.ownerDocument.createTextNode(_8ec));}}return this;}else{var _8ed="";for(i=0;node=this[i];i++){_8ed+=_8e2(node);}return _8ed;}},val:function(_8ee){if(arguments.length){var _8ef=lang.isArray(_8ee);for(var _8f0=0,node;node=this[_8f0];_8f0++){var name=node.nodeName.toUpperCase();var type=node.type;var _8f1=_8ef?_8ee[_8f0]:_8ee;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_8df.indexOf(_8ee,opt.value)!=-1);}else{opt.selected=(opt.value==_8f1);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_8f1);}else{node.value=_8f1;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_8ee=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_8ee=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_8ee.push(opt.value);}}if(!_8ee.length){_8ee=null;}}return _8ee;}},append:function(_8f2){return this.addContent(_8f2,"last");},appendTo:function(_8f3){return this._placeMultiple(_8f3,"last");},prepend:function(_8f4){return this.addContent(_8f4,"first");},prependTo:function(_8f5){return this._placeMultiple(_8f5,"first");},after:function(_8f6){return this.addContent(_8f6,"after");},insertAfter:function(_8f7){return this._placeMultiple(_8f7,"after");},before:function(_8f8){return this.addContent(_8f8,"before");},insertBefore:function(_8f9){return this._placeMultiple(_8f9,"before");},remove:_8e1.prototype.orphan,wrap:function(html){if(this[0]){html=_8e4(html,this[0]);for(var i=0,node;node=this[i];i++){var _8fa=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_8fa,node);}var _8fb=_8e3(_8fa);_8fb.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_8e4(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _8fc=_8e3(html);for(var i=0,node;node=this[i];i++){_8fc.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_8e4(html,this[0]);for(var i=0;i<this.length;i++){var _8fd=this._cloneNode(html);this._wrap(lang._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_8fd);}}return this;},replaceWith:function(_8fe){_8fe=this._normalize(_8fe,this[0]);for(var i=0,node;node=this[i];i++){this._place(_8fe,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_8ff){var nl=_8de(_8ff);var _900=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_900,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_8e1.prototype.html){_8e1.prototype.html=_8e1.prototype.innerHTML;}return _8e1;});},"epi/shell/widget/dialog/_DialogContentMixin":function(){define("epi/shell/widget/dialog/_DialogContentMixin",["dojo/_base/declare"],function(_901){return _901(null,{executeDialog:function(){},cancelDialog:function(){}});});},"url:epi-cms/contentediting/templates/ExpirationDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"stateNode\" class=\"epi-notificationBar epi-notificationBarItem\">\r\n        <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"infoTextNode\"></div>\r\n        <div class=\"epi-notificationBarButtonContainer\">\r\n            <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"removeButton\" data-dojo-attach-event=\"onClick: _onRemoveButtonClick\">${res.removebutton}</button>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\r\n</div>\r\n","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/epi","epi/datetime","epi/shell/_StatefulGetterSetterMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_902,_903,_904,epi,_905,_906,_907,_908){return _902([_903,_906],{value:null,intermediateValue:null,contentLink:null,contentName:null,enableSaveButton:null,showRemoveButton:null,infoText:null,state:null,postscript:function(){this.inherited(arguments);this.set("intermediateValue",this.value);this.set("minimumExpireDate",this.minimumExpireDate);},_setIntermediateValueAttr:function(_909){this._set("intermediateValue",_909);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.value));if(_909&&_909.stopPublish){var _90a=_909.stopPublish instanceof Date?_909.stopPublish:new Date(_909.stopPublish);this.set("showRemoveButton",true);this.set("infoText",_90a<_905.serverTime()?_908.expired:_904.substitute(_907.expiretimetext,[_905.timeToGo(_90a)]));this.set("state","Expiring");}else{this.set("showRemoveButton",false);this.set("infoText",_907.neverexpiretext);this.set("state","NotExpiring");}},_setValueAttr:function(_90b){this._set("value",_90b);this.set("enableSaveButton",false);},_setMinimumExpireDateAttr:function(_90c){var date=new Date(_90c);this._set("minimumExpireDate",_905.isDateValid(date)?date:null);this._set("minimumExpireDateMessage",_907.minimumdatevalidation);},save:function(){this.set("value",this.intermediateValue);},reset:function(){this.set("intermediateValue",this.value);}});});},"epi-cms/contentediting/commandproviders/ContentDetails":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","../command/PermanentInUseToggle"],function(dojo,_90d,_90e,_90f){return _90d([_90e],{constructor:function(){this.inherited(arguments);this.add("commands",new _90f());}});});},"epi-cms/contentediting/command/PermanentInUseToggle":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(_910,_911,_912,_913){return _910([_912],{name:"PermanentInUseNotification",label:_913.title,tooltip:_913.tooltip,inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_911.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inherited(arguments);var _914=this.model.contentData;this.inUseNotificationManager.togglePermanentEditIndication(_914,true);this._updateCanExecute();},_onModelChange:function(){var _915=this.model.contentData,_916=this.model.canChangeContent(),_917=this.inUseNotificationManager.currentUserHasInUseNotification(_915.inUseNotifications,true);this.set("active",_917);this._updateCanExecute();},_updateCanExecute:function(){this.set("canExecute",this.active||this.model.canChangeContent());}});});},"epi-cms/contentediting/commandproviders/PublishMenu":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/IgnoreInUseNotification"],function(dojo,_918,_919,_91a,_91b){return _918([_919],{constructor:function(){this.inherited(arguments);this.add("commands",_91a(new _91b(),{priority:10000}));}});});},"epi-cms/contentediting/command/ForPublishMenu":function(){define(["dojo/_base/lang"],function(lang){return function(_91c,_91d){_91d=lang.mixin({isMain:false,priority:0,resetLabelAfterExecution:true,mainButtonClass:null,keepMenuOpen:false,successStatus:null},_91d);_91c.options=_91d;return _91c;};});},"epi-cms/contentediting/command/IgnoreInUseNotification":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_91e,_91f,_920,_921,_922){return _91e([_921],{name:"IgnoreInUseNotification",label:_922.ignoreinusenotification.label,tooltip:_922.ignoreinusenotification.title,iconClass:"epi-iconPen",inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_920.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inUseNotificationManager.ignoreOthersNotifications=true;this.model.viewName=null;this._requestContextChange(this.model.contentData.uri,true);},_onModelChange:function(){var _923=this.model.contentData,_924=this.inUseNotificationManager.hasInUseNotificationWarning(_923.inUseNotifications),_925,_926;_925=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_926=this.model.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_925;this.set("isAvailable",_924&&_926);},_requestContextChange:function(uri,_927){var _928={uri:uri};var _929={sender:this,forceContextChange:_927};_91f.publish("/epi/shell/context/request",_928,_929);}});});},"epi-cms/contentediting/commandproviders/PublishMenuGlobal":function(){define(["dojo","dojo/_base/declare","epi/shell/command/withConfirmation","epi/shell/command/_CommandProviderMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/Reject","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/EditCommonDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ScheduleForPublish","epi-cms/contentediting/command/CancelAndEdit","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(dojo,_92a,_92b,_92c,_92d,_92e,_92f,_930,_931,_932,_933,_934,_935,_936,_937,res){return _92a([_92c],{constructor:function(){this.inherited(arguments);this.add("commands",_92e(new _932(),{resetLabelAfterExecution:true,isMain:true,priority:9000,mainButtonClass:"epi-success",keepMenuOpen:true,successStatus:res.successfullypublished}));this.add("commands",_92e(new _92d(),{isMain:true,priority:10000,mainButtonClass:"epi-primary"}));this.add("commands",_92e(new _936()));this.add("commands",_92e(new _937()));this.add("commands",_92e(new _931(),{isMain:true,priority:8000,mainButtonClass:"epi-success",keepMenuOpen:true}));this.add("commands",_92e(new _930(),{resetLabelAfterExecution:false,keepMenuOpen:true}));this.add("commands",_92e(new _935(),{resetLabelAfterExecution:false,keepMenuOpen:true}));this.add("commands",_92e(new _934()));this.add("commands",_92e(new _933()));this.add("commands",_92e(_92b(new _92f(),null,{title:res.reverttopublishconfirmation.dialogtitle,heading:res.reverttopublishconfirmation.confirmquestion,description:res.reverttopublishconfirmation.description})));}});});},"epi-cms/contentediting/command/EditCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_938,_939,_93a,_93b){return _938([_939],{name:"editcommondraft",label:_93b.editcommondraft.label,tooltip:_93b.editcommondraft.title,iconClass:"epi-iconPen",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_93a;},_execute:function(){this.model.editCommonDraft();},_onModelChange:function(){this.inherited(arguments);var _93c=this.model.contentData,_93d=_93c.status,_93e=_93a.versionStatus,_93f=this.contentActionSupport.hasAccess(_93c.accessMask,_93a.accessLevel.Edit),_940=(_93d===_93e.Published||_93d===_93e.PreviouslyPublished)&&!_93c.isCommonDraft&&_93f&&this.contentActionSupport.hasProviderCapability(_93c.providerCapabilityMask,_93a.providerCapabilities.Edit);this.set("canExecute",_940&&this.model.canEditCurrentLanguage());this.set("isAvailable",_940);}});});},"epi-cms/contentediting/command/ScheduleForPublish":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/command/_ChangeContentStatus","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/ScheduledPublishSelector","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_941,_942,_943,_944,_945,_946,_947,_948,_949,_94a){return _941([_945],{name:"reject",label:_949.scheduleforpublish.label,tooltip:_949.scheduleforpublish.title,iconClass:"epi-iconClock",postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_943.resolve("epi.cms.ProjectService");},_execute:function(){var _94b=new _948();_94b.set("contentData",this.model.contentData);var _94c=new _947({model:_94b});var self=this,_94d=_946.saveAction;self.set("action",_94d.CheckIn|_94d.DelayedPublish|_94d.ForceCurrentVersion);var _94e=new _944({content:_94c,title:_94a.title,defaultActionsVisible:false});_94e.on("execute",function(){self.model.setProperty("iversionable_startpublish",_94b.dateValue);self._changeContentStatus();});_94e.show(true);},_onModelChange:function(){this.inherited(arguments);var self=this,_94f=this.model.contentData,_950=(_94f.status===_946.versionStatus.CheckedOut)||(_94f.status===_946.versionStatus.Rejected)||(_94f.status===_946.versionStatus.Published&&_94f.isCommonDraft),_951=_950&&this.model.canChangeContent(_946.action.Publish);this.set("canExecute",false);this.set("isAvailable",_950);this.projectService.isPartOfDelayedPublishedProject(_94f.contentLink).then(function(_952){self.set("canExecute",_951&&!_952);});}});});},"epi-cms/contentediting/ScheduledPublishSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/_DialogContentMixin","./ScheduledPublishSelectorViewModel","dojo/text!./templates/ScheduledPublishSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector","epi/i18n!epi/nls/episerver.shared","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/project/ContentReferenceGrid","epi-cms/widget/Breadcrumb"],function(_953,lang,_954,_955,_956,_957,_958,_959,_95a,_95b,_95c,_95d,_95e){return _953([_955,_956,_957,_959,_958,_95a],{templateString:_95c,modelData:null,_setTitleAttr:{node:"contentNameNode",type:"innerText"},_setDateLabelAttr:{node:"publishChangesCaptionNode",type:"innerHTML"},_setDateValueAttr:function(date){this.dateTimeSelector.set("value",date);},_setBreadcrumbModelAttr:function(_95f){this.breadcrumbNode.set("contentLink",_95f);},_setScheduleButtonEnabledAttr:function(_960){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_960);}},_setModelAttr:function(_961){this.inherited(arguments);this.referenceGrid.set("model",_961);if(_961){this.own(_961.watch("totalItems",lang.hitch(this,"_onGridItemsChange")));}},modelBindingMap:{title:["title"],dateLabel:["dateLabel"],dateValue:["dateValue"],breadcrumbModel:["breadcrumbModel"],scheduleButtonEnabled:["scheduleButtonEnabled"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _95b(this.modelData);},postCreate:function(){this.inherited(arguments);this.connect(this.dateTimeSelector,"onChange","dateTimeSelectorChanged");this.addActions([{name:"save",label:_95d.confirmtext,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.dateTimeSelector.validate()){this.executeDialog();}})},{name:"cancel",label:_95e.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}]);},_onGridItemsChange:function(_962,_963,_964){var _965=_964>0;if(this.referenceGrid){_954.toggle(this.referenceGrid.domNode,"dijitHidden",!_965);}this.setActionProperty("save","label",_965?_95d.scheduleanyway:_95d.confirmtext);this.setActionProperty("save","class",_965?"":"Salt");},dateTimeSelectorChanged:function(_966){this.model.set("dateValue",_966);}});});},"epi-cms/contentediting/ScheduledPublishSelectorViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_967,_968,_969){return _967([_968],{breadcrumbModel:null,title:"",dateLabel:"",dateValue:null,scheduleButtonEnabled:false,constructor:function(){var _96a=new Date();_96a.setDate(_96a.getDate()+1);_96a.setHours(12,0,0,0);this.set("dateValue",_96a);},_isPublishedSetter:function(_96b){this.set("dateLabel",_96b?_969.publishchangeson:_969.publishon);},_contentDataSetter:function(_96c){this.set("title",_96c.name);this.set("isPublished",!_96c.isPendingPublish);this.set("breadcrumbModel",_96c.contentLink);var _96d=new Date(_96c.properties.iversionable_startpublish);if(!isNaN(_96d)&&_96d>new Date()){this.set("dateValue",_96d);}},_dateValueSetter:function(_96e){this.dateValue=_96e;this.set("scheduleButtonEnabled",!!(_96e&&_96e>new Date()));}});});},"url:epi-cms/contentediting/templates/ScheduledPublishSelector.html":"<div>\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumbNode\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-attach-point=\"publishChangesCaptionNode\"></div>\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\" data-dojo-props=\"required:true\"></div>\r\n    <div data-dojo-attach-point=\"referenceGrid\" data-dojo-type=\"epi-cms/project/ContentReferenceGrid\" class=\"dijitHidden push-margin--top\"></div>\r\n</div>","epi-cms/project/ContentReferenceGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/keys","dojo/on","dojo/when","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/OnDemandGrid","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ContentReferenceGrid.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_96f,lang,_970,keys,on,when,_971,_972,_973,_974,_975,_976,_977,_978,_979,_97a){function _97b(prop){return function(_97c){if(this._grid){this._grid.set(prop,_97c);}};};return _96f([_971,_972,_973,_978],{res:_97a,templateString:_979,model:null,_gridClass:_96f([_974,_975,_976,_977]),_grid:null,_loadCompleteEmitted:false,modelBindingMap:{query:["query"],store:["store"],columns:["columns"],notificationText:["notificationText"],resultSummary:["resultSummary"]},_setResultSummaryAttr:{node:"resultSummaryNode",type:"innerText"},_setQueryAttr:_97b("query"),_setColumnsAttr:_97b("columns"),_setStoreAttr:_97b("store"),_setNotificationTextAttr:function(text){var _97d=text&&text.length;_970.toggle(this.notificationBar,"dijitHidden",!_97d);this.notificationNode.textContent=text||"";},_onRowClicked:function(e){if(this.model&&typeof this.model.onItemClicked==="function"){var data=this._grid.row(e).data;this.model.onItemClicked(data);}},buildRendering:function(){this.inherited(arguments);var _97e=this.model&&this.model.get("columns");this._grid=new this._gridClass({"class":"epi-plain-grid epi-plain-grid--no-border epi-plain-grid--no-header epi-plain-grid--margin-bottom",columns:_97e,showHeader:false,cellNavigation:false,selectionMode:"single"},this.gridNode);this._grid.addKeyHandler(keys.ENTER,lang.hitch(this,"_onRowClicked"));this._grid.addKeyHandler(keys.SPACE,lang.hitch(this,"_onRowClicked"));this._grid.on(".dgrid-cell a:click",lang.hitch(this,"_onRowClicked"));this.own(this._grid,on(this._grid,"dgrid-refresh-complete",lang.hitch(this,"_onGridRefreshComplete")));},startup:function(){this.inherited(arguments);this._grid.startup();if(!this._grid.store){this._emitLoadComplete();}},_onGridRefreshComplete:function(data){var _97f=data.results;when(_97f.total,lang.hitch(this,function(_980){this.model.set("totalItems",_980);this._emitLoadComplete();}));},_emitLoadComplete:function(){if(!this._loadCompleteEmitted){this.emit("contentreferencegrid-loading-complete",{});this._loadCompleteEmitted=true;}},_refresh:function(){this._grid.refresh();}});});},"url:epi-cms/project/templates/ContentReferenceGrid.html":"<div class=\"epi-contentReferences\">\n    <div data-dojo-attach-point=\"notificationBar\" class=\"dijitHidden epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\n        <div data-dojo-attach-point=\"notificationNode\" class=\"epi-notificationBarText\"></div>\n    </div>\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\n        <strong data-dojo-attach-point=\"resultSummaryNode\"></strong>\n        <div class=\"epi-floatRight\">\n            <button class=\"epi-chromelessButton\"\n                    data-dojo-type=\"dijit/form/Button\"\n                    data-dojo-attach-event=\"onClick:_refresh\"\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\n        </div>\n    </div>\n    <div data-dojo-attach-point=\"gridNode\"></div>\n</div>\n","epi-cms/contentediting/command/CancelAndEdit":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/date","epi/dependency","epi/shell/command/_Command","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.cancelandedit"],function(_981,_982,lang,_983,_984,_985,_986,_987,_988,_989){return _981([_988],{name:"cancelAndEdit",label:_989.label,tooltip:_989.title,iconClass:"epi-iconPen",action:_987.action.Reject,postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_984.resolve("epi.cms.ProjectService");},_execute:function(){this.inherited(arguments).then(lang.hitch(this,function(){var _98a=this.model.contentData;this.model.setProperty("iversionable_startpublish",_98a.isPendingPublish?_98a.created:_98a.lastPublished);}));},_onModelChange:function(){this.inherited(arguments);var self=this,_98b=this.model.contentData,_98c=_987.hasAccess(_98b.accessMask,_987.accessLevel.Edit)&&_98b.status===_987.versionStatus.DelayedPublish&&!_98b.isPartOfAnotherProject;this.set("canExecute",false);this.set("isAvailable",_98c);if(!_98c){return;}this.projectService.isPartOfDelayedPublishedProject(_98b.contentLink).then(function(_98d){self.set("canExecute",_98c&&!_98d);});}});});},"epi-cms/contentediting/viewsettings/ChannelViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_98e,lang,_98f){return _98e([_98f],{key:"epichannel",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_990,_991){this.inherited(arguments);if(_991&&this.value){_990.epichannel=this.value;}else{delete _990.epichannel;}}});});},"epi-cms/contentediting/_ViewSetting":function(){define(["dojo/_base/declare","epi/shell/_StatefulGetterSetterMixin"],function(_992,_993){return _992(_993,{key:null,value:null,enabled:null,beforePreviewLoad:function(_994,_995){},afterPreviewLoad:function(_996,_997){}});});},"epi-cms/contentediting/viewsettings/ResolutionViewSetting":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ViewSetting"],function(_998,_999){return _998([_999],{key:"resolution",usedForRendering:false,afterPreviewLoad:function(_99a,_99b){this.inherited(arguments);if(_99a){var size=_99b?this._getPreviewResolution():null;_99a.set("previewSize",size);_99a.set("devicePreviewClass",this.value?"epi-editorViewport--device-preview epi-viewPort-"+this.value:"");}return null;},_getPreviewResolution:function(){var size=null;var _99c=this.value;if(_99c){var _99d=_99c.split("x");if(_99d.length===2){size={w:_99d[0],h:_99d[1]};}}return size;}});});},"epi-cms/contentediting/viewsettings/ViewLanguageViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_99e,lang,_99f,_9a0,_9a1){return _99e([_9a0,_9a1],{key:"viewlanguage",usedForRendering:true,isTagItem:false,constructor:function(_9a2){this.own(_9a2.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},_onContextChange:function(_9a3,_9a4){var dfd=new _99f();dfd.resolve();if(this.get("enabled")&&this.value){_9a3.epslanguage=this.value;}return dfd;}});});},"epi-cms/contentediting/viewsettings/VisitorGroupViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_9a5,lang,_9a6){return _9a5([_9a6],{key:"visitorgroup",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_9a7,_9a8){this.inherited(arguments);if(_9a8&&this.value){_9a7.visitorgroupsByID=this.value;}else{delete _9a7.visitorgroupsByID;}}});});},"epi-cms/project/ProjectViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_9a9,lang,_9aa,_9ab,_9ac){return _9a9([_9ab,_9ac],{key:"project",usedForRendering:true,isTagItem:false,constructor:function(_9ad){this.own(_9ad.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},beforePreviewLoad:function(_9ae,_9af){this.inherited(arguments);if(_9af&&this.value){_9ae.epiprojects=this.value;}else{delete _9ae.epiprojects;}},_onContextChange:function(_9b0,_9b1){var dfd=new _9aa();if(this.get("enabled")&&this.value){_9b0.epiprojects=this.value;_9b0.epieditmode=true;}dfd.resolve();return dfd.promise;}});});},"epi-cms/widget/ContentTypeService":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/when","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(_9b2,_9b3,lang,when,all,_9b4,_9b5){return _9b2(null,{contentTypeStore:null,_getavailabletypesQuery:"getavailablecontenttypes",constructor:function(){this.contentTypeStore=this.contentTypeStore||_9b4.resolve("epi.storeregistry").get("epi.cms.contenttype");},getAcceptedChildTypes:function(_9b6,_9b7,_9b8,_9b9,_9ba){var _9bb=this.contentTypeStore.query({query:this._getavailabletypesQuery,localAsset:_9b7,parentReference:_9b6,requestedTypes:_9b8});return this.filterQueryResult(_9bb,_9b9,_9ba);},filterQueryResult:function(_9bc,_9bd,_9be){return when(_9bc).then(function(_9bf){var _9c0=_9b3.map(_9bf,function(type){return type.typeIdentifier;});_9c0=_9b5.getValidAcceptedTypes(_9c0,_9bd,_9be);_9bf=_9b3.filter(_9bf,function(type){return _9b3.some(_9c0,function(_9c1){return type.typeIdentifier===_9c1;});});return _9bf;});}});});},"epi-cms/Profile":function(){define("epi-cms/Profile",["dojo/_base/lang","dojo/Deferred","dojo/when","epi/dependency","epi/shell/Profile","epi-cms/ApplicationSettings"],function(lang,_9c2,when,_9c3,_9c4,_9c5){var _9c6=function(host){return "editlanguage_"+host.replace(":","");};lang.extend(_9c4,{getContentLanguage:function(host){host=host||window.location.host;return when(this.get(_9c6(host)),function(_9c7){return _9c7||_9c5.currentContentLanguage;});},setContentLanguage:function(_9c8,host){return this.set(_9c6(host),_9c8,{location:"server"});}});return _9c4;});},"epi-cms/compare/views/CompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi-cms/contentediting/PageDataController","epi-cms/compare/CompareToolbar","epi-cms/compare/viewmodels/CompareViewModel"],function(_9c9,lang,_9ca,_9cb,_9cc,_9cd){return _9c9([_9cb],{buildRendering:function(){this.inherited(arguments);var _9ce=new _9cd(),_9cf=this.mainLayoutContainer,_9d0=new _9cc({region:"top",splitter:false,model:_9ce.compareToolbarViewModel});_9cf.addChild(_9d0);this.set("compareModel",_9ce);this.own(_9ce,_9ce.watch("leftVersionUri",lang.hitch(this,function(name,_9d1,uri){this._changeContext(uri);})),_9d0,_9d0.on("versionInformationUpdated",function(){_9cf.layout();}));},setView:function(_9d2,_9d3){_9d3=lang.mixin({model:this.compareModel},_9d3);return this.inherited(arguments,[_9d2,_9d3]);},_changeContext:function(uri){if(uri&&this._currentViewModel&&uri!==this._currentViewModel.contentData.uri){_9ca.publish("/epi/shell/context/request",{uri:uri},{sender:this});}},_refreshModel:function(_9d4,_9d5){this.inherited(arguments);this.compareModel.set({contentLink:_9d4.contentLink,typeIdentifier:_9d4.typeIdentifier,languages:_9d4.existingLanguageBranches});},_switchEditMode:function(){if(this.isActive){_9ca.publish("/epi/shell/action/changeview","formedit");}}});});},"epi-cms/contentediting/PageDataController":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/Deferred","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","epi/dependency","epi/Url","epi/shell/layout/CardContainer","epi/shell/layout/PreserveRatioBorderContainer","epi/shell/widget/IframeWithOverlay","epi-cms/_ContentContextMixin","epi-cms/contentediting/EditNotifications","epi-cms/contentediting/ContentViewModel","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/ShortcutNotification","epi-cms/contentediting/ViewSettingsNotification","epi-cms/project/ProjectNotification","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting","dojo/text!./templates/PageDataController.html"],function(_9d6,_9d7,lang,_9d8,_9d9,_9da,_9db,when,_9dc,_9dd,_9de,_9df,_9e0,Url,_9e1,_9e2,_9e3,_9e4,_9e5,_9e6,_9e7,_9e8,_9e9,_9ea,_9eb,_9ec,res,_9ed){return _9d7([_9dd,_9dc,_9de,_9e4],{templateString:_9ed,contextTypeName:"epi.cms.contentdata",pendingNotificationTimeOutId:null,isActive:true,defaultEditCssRules:[{selector:".epi-injected-minSize",css:"min-height: 30px;"},{selector:".epi-injected-minSize-inline",css:"min-height: 30px; min-width: 100px; display: inline-block !important;"},{selector:"[contenteditable=true]:focus",css:"outline: 3px #b4c600 solid;"}],_currentViewComponent:null,_viewModels:null,_notificationHandlerId:null,_messageService:null,_editingCommands:null,_currentViewModel:null,_pageDataStore:null,_shortcutNotification:null,_projectNotification:null,_availableViews:null,_previewQueryParameters:null,_viewSettingsManager:null,_inUseNotificationManager:null,_ensurePreviewReadyPromise:null,postMixInProperties:function(){this.inherited(arguments);var _9ee=_9e0.resolve("epi.storeregistry");this._viewSettingsManager=_9e0.resolve("epi.viewsettingsmanager");this._messageService=this._messageService||_9e0.resolve("epi.shell.MessageService");this._profile=this._profile||_9e0.resolve("epi.shell.Profile");this._pageDataStore=_9ee.get("epi.cms.contentdata");this._editingCommands=_9ec;if(!this._viewModels){this._viewModels=[];}this._inUseNotificationManager=this.inUseNotificationManager||_9e0.resolve("epi.cms.contentediting.inUseNotificationManager");this._shortcutNotification=new _9e9();this._viewSettingsNotification=new _9ea();this._projectNotification=new _9eb();this._editNotifications=this._editNotifications||new _9e5();this.own(this._editNotifications,this._editNotifications.on("changed",function(e){this._defaultNotificationWatchHandler("",e.oldValue,e.newValue);}.bind(this)));},postCreate:function(){var cs;this.inherited(arguments);this.subscribe("/epi/cms/action/switcheditmode",lang.hitch(this,this._switchEditMode));cs=_9e0.resolve("epi.shell.ContextService");this._interceptorHandle=cs.registerRequestInterceptor(lang.hitch(this,this._interceptRequestContext));this.notificationBar.on("notificationsChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();}));this.own(_9db.subscribe("/epi/cms/action/undo",this._undoAction.bind(this)),_9db.subscribe("/epi/cms/action/redo",this._redoAction.bind(this)),_9db.subscribe("/epi/cms/action/save",this._saveAction.bind(this)),this._shortcutNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._viewSettingsNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._projectNotification.watch("notification",lang.hitch(this,this._projectNotificationWatchHandler)));},startup:function(){if(this._started){return;}this.inherited(arguments);var url=new Url(window.location.href),_9ef=url.getQueryParameterValue("view");this.iFrame=this.iframeWithOverlay.iframe;this.connect(this.iFrame,"onLoad","_iFrameLoaded");this.connect(this.iFrame,"onUnload","_iFrameUnLoaded");_9d8.add(this.toolbar.domNode,"epi-localToolbar epi-viewHeaderContainer");this._injectCssRules();when(this.getCurrentContext(),lang.hitch(this,function(_9f0){this.contextChanged(_9f0);}));},destroy:function(){this._interceptorHandle.remove();this._destroyCurrentViewComponent();this._viewModels=null;this.inherited(arguments);},_defaultNotificationWatchHandler:function(name,_9f1,_9f2){if(_9f1){this.notificationBar.remove(_9f1);}if(_9f2&&_9f2.content){this.notificationBar.add(_9f2);}},_projectNotificationWatchHandler:function(name,_9f3,_9f4){if(_9f3){this.notificationBar.remove(_9f3);}if(_9f4&&_9f4.content){this.notificationBar.add(_9f4,"first");}},_switchEditMode:function(_9f5,_9f6){var _9f7,_9f8=this._currentViewModel.viewName,_9f9=false,_9fa="view",_9fb="onpageedit",_9fc="formedit";if(!this.isActive){return;}if(_9f8===_9fa){_9db.publish("/epi/cms/action/disablepreview");}if(_9f8===_9fc){_9f7=_9fb;_9f9=true;}else{_9f7=_9fc;}return this._ensurePreviewReady(this.setView(_9f7,_9f6),_9f9,true,_9f7);},_iFrameLoaded:function(url,_9fd){if(!!url&&!_9fd){this._requestContextChangeByUrl(url,true,true);}},_iFrameUnLoaded:function(url){this.iframeWithOverlay.overlay.set("enabled",false);},_destroyCurrentViewComponent:function(){if(this._currentViewComponentReloadRequireHandle){this._currentViewComponentReloadRequireHandle.remove();this._currentViewComponentReloadRequireHandle=null;}if(this._currentViewComponent){this._currentViewComponent.destroyRecursive();this._currentViewComponent=null;}},_getViewModelIndex:function(id){var _9fe=-1;_9d6.some(this._viewModels,function(item,idx){if(item.contentLink===id){_9fe=idx;return true;}});return _9fe;},_getViewModel:function(id){var _9ff=this._getViewModelIndex(id);if(_9ff>=0){return this._viewModels[_9ff];}else{return null;}},_removeViewModel:function(id){var _a00=this._getViewModelIndex(id);if(_a00>=0){var _a01=this._viewModels.splice(_a00,1)[0];_a01.clear();}},_createViewModel:function(_a02,ctx){var _a03=new _9e6({contentLink:_a02.contentLink,contextTypeName:this.contextTypeName});_a03.set("contentData",_a02);_a03.set("languageContext",ctx.languageContext);this._viewModels.push(_a03);return _a03;},contentContextUpdated:function(ctx,_a04){var _a05=ctx.id;this._pageDataStore.refresh(_a05).then(lang.hitch(this,function(_a06){if(this._currentViewModel){this._updateContentViewModel(_a06,ctx.languageContext);this._refreshModel(_a06,ctx);this._onViewRequireReload();}}));},updateView:function(_a07,ctx,_a08){when(this._ensurePreviewReadyPromise,lang.hitch(this,function(){if(_a07&&_a07.skipUpdateView&&_a07.viewName===this._currentViewModel.viewName){return;}if(_a08&&_a08.widgetResumed){_9d9.set(this.domNode,"visibility","hidden");}if(_a07&&_a07.contextIdSyncChange){this._pageDataStore.refresh(ctx.id).then(lang.hitch(this,function(_a09){var _a0a=this._currentViewModel.contentData.contentLink;this._updateContentViewModel(_a09,ctx.languageContext);this._currentViewComponent.onContentLinkSyncChange(_a0a,_a09.contentLink);this._refreshModel(_a09,ctx);}));}else{if(this._currentViewModel){this._currentViewModel.suspend();}var _a0b;if(_a07&&_a07.viewName){if(_a07.availableViews){this._availableViewsLookup={};_9d6.forEach(_a07.availableViews,lang.hitch(this,function(_a0c){this._availableViewsLookup[_a0c.key]=_a0c;}));}_a0b=_a07.viewName;}this.toolbar.update({currentContext:ctx,viewConfigurations:{availableViews:_a07.availableViews,viewName:_a07.viewName}});if(this._currentViewComponent&&this._currentViewComponent.isSticky){_a0b=this._currentViewModel.viewName;}var _a0d=this._getPreviewUrl(ctx,_a0b);return this._ensurePreviewReady(this._loadContentDataAndSetView(ctx.id,_a0b,ctx),true,_a07.forceReload,_a0b);}}));},_getPreviewUrl:function(_a0e){return when(this.getCurrentContext(),function(_a0f){return (_a0e==="view"&&_a0f.previewUrl)?_a0f.previewUrl:_a0f.editablePreviewUrl;});},_ensurePreviewReady:function(_a10,_a11,_a12,_a13){var def=new _9da();if(_a10){def=_a10;}else{def.resolve();}if(_a11&&_a13!=="formedit"){def=def.then(lang.hitch(this,function(_a14){return when(this._getPreviewUrl(_a13),lang.hitch(this,function(url){return when(this._changeUrl(url,_a12),function(){return _a14;});}));}));}this._ensurePreviewReadyPromise=when(def,lang.hitch(this,function(_a15){var doc=this.iframeWithOverlay.iframe.getDocument();var _a16=this.connect(this._currentViewComponent,"onPrepareOverlayComplete",function(){this.disconnect(_a16);_a16=null;this.iframeWithOverlay.overlay.set("enabled",this._currentViewModel.get("showOverlay")&&this.iframeWithOverlay.iframe.isInspectable());if(this._viewSettingsManager.get("enabled")&&this._viewSettingsManager.getSettingProperty("project")){this.iframeWithOverlay.overlay.set("enabled",false);}this.iframeWithOverlay.layout(true);});_9d9.set(this.domNode,"visibility","visible");this._viewSettingsManager.onPreviewReady(this.iframeWithOverlay);this._currentViewComponent.onPreviewReady(this._currentViewModel,doc,!!_a15);this._viewSettingsNotification.set("value",{viewModel:this._currentViewModel,viewSetting:this._viewSettingsManager});}));return this._ensurePreviewReadyPromise;},_loadContentDataAndSetView:function(_a17,_a18,ctx){var def=new _9da();when(this._pageDataStore.refresh(_a17),lang.hitch(this,function(_a19){if(!_a19){return;}if(this._currentViewModel&&this._currentViewModel.contentLink!==_a17){this.notificationBar.clear();}this._currentViewModel=this._getViewModel(_a19.contentLink);if(!this._currentViewModel){this._currentViewModel=this._createViewModel(_a19,ctx);}else{this._updateContentViewModel(_a19,ctx.languageContext);}this._currentViewModel.set("viewLanguage",this._viewSettingsManager.get("enabled")?this._viewSettingsManager.getSettingProperty("viewlanguage"):null);this._refreshModel(_a19,ctx);when(this.setView(_a18),function(){def.resolve(true);},function(){def.cancel();});}),function(){def.reject();});return def;},_updateContentViewModel:function(_a1a,_a1b){this._currentViewModel.wakeUp();this._currentViewModel.set("contentData",_a1a);this._currentViewModel.set("languageContext",_a1b);},_refreshModel:function(_a1c,_a1d){var _a1e=this._currentViewModel;if(_a1e){this.toolbar.set("contentViewModel",_a1e);this._inUseNotificationManager.updateCommandModel(_a1e);this._editingCommands.set("model",_a1e);this._shortcutNotification.set("value",_a1e);this._projectNotification.set("value",_a1e);this._editNotifications.update(_a1c,_a1d);}},itemChanged:function(id,item){},setView:function(_a1f,_a20){var def=new _9da();if(_a1f==="onpageedit"&&(!this._currentViewModel.contentData.hasTemplate||!(_a1f in this._availableViewsLookup))){_a1f="formedit";}if(_a1f&&!(_a1f in this._availableViewsLookup)){return;}var _a21=lang.hitch(this,function(){when(this._setView(_a1f,_a20),function(){def.resolve();},function(){def.cancel();});});var _a22=lang.hitch(this,function(){_9db.publish("/epi/cms/action/showerror");def.cancel();});when(this._savePendingChanges(),_a21,_a22);return def;},_setView:function(_a23,_a24){var def=new _9da(),_a25=this._currentViewComponent,_a26=_a25&&_a25.viewModel&&_a25.viewModel.viewName===_a23;var _a27=lang.hitch(this,function(def){if(this.editLayoutContainer.leftOver&&!this._currentViewComponent.canHandleLeftOver){when(this.editLayoutContainer.selectedChildWidget===this.editLayoutContainer.leftOver?this.editLayoutContainer.selectChild(this.iframeWithOverlay):null,lang.hitch(this,function(){this.editLayoutContainer.removeChild(this.editLayoutContainer.leftOver);this.editLayoutContainer.leftOver.destroyRecursive();this.editLayoutContainer.leftOver=null;}));}def.resolve();});_9db.publish("/epi/shell/action/changeview/updatestate",{viewName:_a23});if(_a26){this._currentViewModel.viewName=_a23;this.toolbar.set("contentViewModel",this._currentViewModel);_a27(def);}else{this._destroyCurrentViewComponent();var _a28=this._availableViewsLookup[_a23].viewType;require([_a28],lang.hitch(this,function(_a29){this._currentViewComponent=new _a29(lang.mixin({mainLayoutContainer:this.mainLayoutContainer,editLayoutContainer:this.editLayoutContainer,iframeWithOverlay:this.iframeWithOverlay,contextTypeName:this.contextTypeName,toolbar:this.toolbar},_a24));this._currentViewComponentReloadRequireHandle=this.connect(this._currentViewComponent,"onReloadRequired",this._onViewRequireReload);this._currentViewComponent.startup();this._currentViewModel.viewName=_a23;this.toolbar.set("contentViewModel",this._currentViewModel);_a27(def);}));}return def;},_onViewRequireReload:function(){return this._ensurePreviewReady(null,true,true,this._currentViewModel.viewName);},resize:function(size){this.inherited(arguments);this.mainLayoutContainer.resize(size);},onShow:function(){this.iframeWithOverlay.overlay.set("enabled",true);this.iframeWithOverlay.overlay.set("readOnly",false);},onHide:function(){this.iframeWithOverlay.overlay.set("enabled",false);if(this._currentViewModel){this._currentViewModel.resetNotifications();}},_requestContextChangeByUrl:function(url,_a2a,_a2b,_a2c,_a2d){var _a2e=new Url(url,_a2c,_a2d),_a2f={url:_a2e.toString()},_a30={sender:this,forceContextChange:_a2a,suppressFailure:_a2b,viewName:this._currentViewModel&&this._currentViewModel.viewName};_9db.publish("/epi/shell/context/request",_a2f,_a30);},_changeUrl:function(url,_a31){var _a32=lang.mixin(this._previewQueryParameters,this._viewSettingsManager.get("previewParams"));return this.iframeWithOverlay.iframe.load(url,{query:_a32},true,_a31);},_interceptRequestContext:function(_a33,_a34){if(!(_a34&&_a34.sender&&_a34.sender===this)){return this._savePendingChanges();}else{var def=new _9da();def.resolve();return def;}},_savePendingChanges:function(){if(this._saveDeferred&&!this._saveDeferred.isFulfilled()){return this._saveDeferred.promise;}else{this._saveDeferred=new _9da();}if(this._currentViewModel&&this._currentViewModel.get("hasPendingChanges")){var _a35=this._currentViewModel.watch("hasPendingChanges",lang.hitch(this,function(name,_a36,_a37){if(!_a37){_a35.remove();_a35=null;this._saveDeferred.resolve();}}));this._currentViewModel.save();}else{this._saveDeferred.resolve();}return this._saveDeferred.promise;},savePendingChanges:function(){return this._savePendingChanges();},_injectCssRules:function(){this.iFrame.addCssRules(this.defaultEditCssRules);},_undoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.undo();}},_redoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.redo();}},_saveAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.save();}},_setIsActiveAttr:function(_a38){this._set("isActive",_a38);if(_a38){this._currentViewModel&&this._currentViewModel.wakeUp();this._editNotifications.wakeUp();}else{this._viewModels.forEach(function(_a39){_a39.suspend();});this._editNotifications.suspend();}}});});},"epi/shell/layout/CardContainer":function(){define("epi/shell/layout/CardContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/fx","dojo/aspect","dojo/has","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/Deferred","dojo/when","dijit/_TemplatedMixin","dijit/layout/StackContainer","dgrid/util/has-css3"],function(_a3a,lang,fx,_a3b,has,on,_a3c,_a3d,_a3e,_a3f,when,_a40,_a41,_a42){return _a3a([_a41,_a40],{doLayout:false,transitionClass:"epi-transition",transitionDirection:"vertical",baseClass:"epi-cardContainer",templateString:"<div><div class='dijitContainer' style='position: relative;' data-dojo-attach-point='containerNode'></div></div>",layout:function(){var _a43=this.selectedChildWidget;var _a44=this.getChildren(),_a45=_a44[_a44.length-1];if(_a43&&_a43.resize){if(_a43.fitContainer){_a43.resize(this._containerContentBox||this._contentBox);}else{_a43.resize();}}if(_a43!==_a45&&!_a43.fitContainer){_a3c.replace(_a45.domNode,"dijitVisible","dijitHidden");if(_a45&&_a45!==_a43&&_a45.resize){if(_a45.fitContainer){_a45.resize(this._containerContentBox||this._contentBox);}else{_a45.resize();}}}},addChild:function(_a46,_a47){if(this._started){var _a48=this.getChildren(),_a49=_a48[_a48.length-1];if(_a47>=_a48.length){_a3c.replace(_a49.domNode,"dijitHidden","dijitVisible");}}this.inherited(arguments);},_transition:function(_a4a,_a4b){var _a4c=this.getChildren(),_a4d=_a4c[_a4c.length-1];if(!_a4b||_a4b._destroyed){return;}if(_a4b.fitContainer&&_a4b!==_a4d){_a3c.replace(_a4d.domNode,"dijitVisible","dijitHidden");}return when(_a4a===_a4d?this._hideTransition(_a4b,_a4d):null,lang.hitch(this,function(n){var _a4e=0;if(_a4b&&!_a4b._destroyed&&_a4b!==_a4d){_a4e=_a3e.getMarginBox(_a4b.domNode).h;this._hideChild(_a4b);}if(!_a4a||_a4a._destroyed){return;}this._showChild(_a4a);if(_a4a.resize){if(_a4a.fitContainer){_a4a.resize(this._containerContentBox||this._contentBox);}else{_a4a.resize(null);}return when(this._showTransition(_a4a,_a4d,_a4e),function(){if(_a4a.fitContainer&&_a4a!==_a4d){_a3c.replace(_a4d.domNode,"dijitHidden","dijitVisible");}});}else{return;}}));},_hideTransition:function(_a4f,_a50){return this._doTransition(_a4f,_a50,false);},_showTransition:function(_a51,_a52,_a53){return this._doTransition(_a51,_a52,true,_a53);},_doTransition:function(page,_a54,_a55,_a56){if(page!==_a54){var _a57=_a3e.getMarginBox(page.domNode),_a58=this._getAnimationNode(page,_a54);var _a59=this.transitionDirection==="vertical"?"top":"left",size=this.transitionDirection==="vertical"?_a57.h:_a57.w,from=_a55?-(size-_a56)+"px":"0px",to=_a55?"0px":-size+"px",_a5a=!_a55;return this._animate(_a58,_a59,from,to,_a5a);}},_getAnimationNode:function(page,_a5b){return page.transitionMode==="slideIn"?this.containerNode:((page.transitionMode==="reveal")?_a5b.domNode:null);},_animate:function(node,_a5c,from,to,_a5d){var dfd=new _a3f();if(node&&has("css-transitions")&&from!==to){_a3d.set(node,_a5c,from);setTimeout(lang.hitch(this,function(){_a3c.add(node,this.transitionClass);var _a5e=on(node,has("transitionend"),lang.hitch(this,function(){_a5e.remove();_a3c.remove(node,this.transitionClass);if(_a5d){_a3d.set(node,_a5c,from);}dfd.resolve();}));setTimeout(function(){_a3d.set(node,_a5c,to);},1);}),1);}else{dfd.resolve();}return dfd.promise;}});});},"epi/shell/layout/PreserveRatioBorderContainer":function(){define("epi/shell/layout/PreserveRatioBorderContainer",["dojo/_base/declare","dijit/layout/BorderContainer","epi/shell/layout/_PreserveRatioMixin"],function(_a5f,_a60,_a61){return _a5f([_a60,_a61],{});});},"epi/shell/layout/_PreserveRatioMixin":function(){define("epi/shell/layout/_PreserveRatioMixin",["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dijit/Destroyable"],function(_a62,lang,_a63,_a64,_a65){return _a62([_a65],{postCreate:function(){this.inherited(arguments);this.own(_a64.before(this,"resize",lang.hitch(this,this._adjustSplitter)));},_adjustSplitter:function(){if(typeof (this.getChildren==="function")){var _a66=this.getChildren();if(_a66.length===0){return;}var _a67=_a66.filter(function(obj){return (obj.splitter===true);});var _a68=_a66.filter(function(obj){return (obj.splitter!==true);});var _a69=_a67.length;var max=0;for(var _a6a in _a67){max=this._calcTrueMax(_a68,_a67[_a6a],_a69);_a67[_a6a].set("style",this._getStyle(_a67[_a6a],max));}}},_getStyle:function(_a6b,max){var _a6c=null;switch(_a6b.region){case "top":case "bottom":_a6c="height: "+this._calcRatio(_a6b.get("h"),max)+"%;";break;case "left":case "right":_a6c="width: "+this._calcRatio(_a6b.get("w"),max)+"%;";break;}return _a6c;},_calcRatio:function(_a6d,max){return (_a6d/max)*100;},_calcTrueMax:function(_a6e,_a6f,_a70){var _a71="w";if(_a6f.region==="bottom"||_a6f.region==="top"){_a71="h";}var max=_a6f.get(_a71);var _a72=_a6e.filter(function(_a73){return _a73.region==="center";})[0].get(_a71);var _a74=_a6f._splitterWidget.get(_a71);for(var _a75 in _a6e){if(_a71==="w"&&(_a6e[_a75].region==="right"||_a6e[_a75].region==="left")){max+=_a6e[_a75].get("w");}else{if(_a71==="h"&&(_a6e[_a75].region==="bottom"||_a6e[_a75].region==="top")){max+=_a6e[_a75].get("h");}}}return max+_a72+(_a74*_a70);}});});},"epi-cms/contentediting/EditNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/plugin-area/edit-notifications"],function(_a76,lang,_a77,_a78,_a79){return _a76([_a78,_a77],{_notificationChangedKey:"_EditingNotificationHandles",_notificationsKey:"_notifications",_notifications:null,postscript:function(){this.inherited(arguments);this.own(_a79.on("added, removed",this._watchNotifications.bind(this)));this._watchNotifications();},update:function(_a7a,_a7b){this._notifications.forEach(function(_a7c){_a7c.set("value",{contentData:_a7a,context:_a7b});});},suspend:function(){this._notifications.forEach(function(_a7d){_a7d.set("isSuspended",true);});},wakeUp:function(){this._notifications.forEach(function(_a7e){_a7e.set("isSuspended",false);});},_watchNotifications:function(){this.destroyByKey(this._notificationsKey);this._notifications=_a79.get().map(function(_a7f){this.ownByKey(this._notificationsKey,_a7f);return _a7f;},this);this.destroyByKey(this._notificationChangedKey);this._notifications.forEach(function(_a80){this.ownByKey(this._notificationChangedKey,_a80.watch("notification",function(name,_a81,_a82){this.emit("changed",{notification:_a80,oldValue:_a81,newValue:_a82});}.bind(this)));},this);}});});},"epi-cms/plugin-area/edit-notifications":function(){define(["epi/PluginArea","epi-cms/contentediting/ContentReferencesNotification","epi-cms/contentediting/LanguageNotification","epi-cms/contentediting/ExpirationNotification","epi-cms/contentediting/FuturePublishingDateNotification"],function(_a83,_a84,_a85,_a86,_a87){var _a88=new _a83("epi-cms/edit/notifications[]");_a88.add(_a84);_a88.add(_a85);_a88.add(_a86);_a88.add(_a87);return _a88;});},"epi/PluginArea":function(){define("epi/PluginArea",["dojo/_base/declare","dojo/Evented","epi/locator"],function(_a89,_a8a,_a8b){return _a89([_a8a],{constructor:function(_a8c){if(typeof _a8c!=="string"||_a8c===""){throw new Error("The argument 'identifier' must be a non-empty string.");}this._identifier=_a8c;_a8b.add(_a8c,[]);_a8b.on(_a8c,this.emit.bind(this));},add:function(_a8d){return _a8b.add(this._identifier,_a8d);},get:function(){return _a8b.get(this._identifier);}});});},"epi/locator":function(){define("epi/locator",["dojo/Evented","dojo/has","dojo/string"],function(_a8e,has,_a8f){var _a90=/.+\[\]$/,_a91={},_a92=new _a8e();return {add:function(_a93,_a94){if(typeof _a93!=="string"||_a93===""){throw new Error("The argument 'identifier' must be a non-empty string.");}var _a95=_a90.test(_a93);if(!_a95&&_a91[_a93]){throw new Error(_a8f.substitute("A service with the identifier '${0}' has already been registered.",[_a93]));}_a91[_a93]=_a95?(_a91[_a93]||[]).concat(_a94):_a94;_a92.emit(_a93,"added");return {remove:this.remove.bind(this,_a93,_a94)};},get:function(_a96){var _a97=_a91[_a96];if(_a97===undefined){if(has("epi-ignore-undefined-dependencies")){return;}throw new Error(_a8f.substitute("No service has been registered for the identifier '${0}'.",[_a96]));}var _a98=function(_a99){return (typeof _a99==="function")?new _a99():_a99;};if(_a90.test(_a96)){return _a97.map(_a98);}return _a98(_a97);},on:_a92.on.bind(_a92),remove:function(_a9a,_a9b){var _a9c=_a91[_a9a];if(_a9c===undefined){return;}if(_a90.test(_a9a)){var _a9d=_a9c.indexOf(_a9b);if(_a9d>-1){_a9c.splice(_a9d,1);}}else{delete _a91[_a9a];}_a92.emit(_a9a,"removed");}};});},"epi-cms/contentediting/ContentReferencesNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/Stateful","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/DestroyableByKey","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(_a9e,_a9f,_aa0,_aa1,_aa2,on,when,epi,_aa3,_aa4,_aa5,_aa6,_aa7,_aa8){return _a9f([_aa2,_aa5],{_backCommand:null,_clickHandleKey:"clickHandle",constructor:function(){this._backCommand=new _aa6();},postscript:function(){this.inherited(arguments);this._store=this._store||_aa3.resolve("epi.storeregistry").get("epi.cms.contentreferences");},_valueSetter:function(_aa9){this.value=_aa9;var _aaa=_aa4.getValue(_aa9.contentData.typeIdentifier,"actAsAnAsset");if(!_aaa){this.set("notification",null);return;}when(this._store.get(_aa9.contentData.contentLink)).then(this._updateNotification.bind(this));},_updateNotification:function(_aab){if(!_aab){this.set("notification",null);return;}var _aac=_aa1.create("div");if(_aab.length>0){_aac.innerHTML+=_aa8.affect;var _aad=_aab.length+" "+(_aab.length===1?epi.resources.text.item:epi.resources.text.items),self=this,_aae=_aa1.create("a",{href:"#",innerHTML:_aad,title:_aa8.referencestooltip},_aac);this.destroyByKey(this._clickHandleKey);this.ownByKey(this._clickHandleKey,on(_aae,"click",function(evt){_aa0.stop(evt);self._showReferenceDialog();}));}else{_aac.innerHTML+=epi.resources.messages.notinuse;}this._backCommand.set("model",{});this.set("notification",{content:_aac,commands:[this._backCommand]});},_showReferenceDialog:function(){_aa7({contentData:this.get("value").contentData,showToolbar:true,mode:_aa7.mode.show});}});});},"epi-cms/command/BackCommand":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_aaf,_ab0,_ab1,_ab2,_ab3){return _aaf([_ab2],{label:_ab3.backtoprevious,tooltip:_ab3.backtoprevious,category:"leftAligned",iconClass:"epi-iconLeft",cssClass:"epi-chromelessButton epi-visibleLink",_previousContent:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_ab1.resolve("epi.cms.BackContextHistory");},_execute:function(){_ab0.publish("/epi/shell/context/request",{uri:this._previousContent.uri},{trigger:"back",sender:this});},_onModelChange:function(){this._previousContent=this.contextHistory.getPrevious();this.set("canExecute",this._previousContent!=null);}});});},"epi-cms/contentediting/LanguageNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/Stateful","dojo/dom-construct","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting.languagenotification"],function(_ab4,lang,_ab5,Url,_ab6,_ab7,_ab8,_ab9,_aba,_abb){return _ab4([_ab6],{_valueSetter:function(data){var _abc=data.context;if(!_abc.languageContext){this.set("notification",null);return;}var _abd=_ab8.resolve("epi.storeregistry").get("epi.cms.language");_abd.query().then(lang.hitch(this,function(_abe){var _abf={};_ab5.forEach(_abe,function(_ac0){_abf[_ac0.languageId]=_ac0.name;},this);var _ac1=_abc.languageContext.warning;var _ac2=_ab9.currentContentLanguage;var _ac3=_abc.languageContext;var _ac4;if(_ac2!==_ac3.preferredLanguage&&_ac3.isTranslationNeeded){_ac1=lang.replace(_abb.nottranslatedswitchto,[_abf[_ac3.language],_abf[_ac3.preferredLanguage]]);_ac4=_ac3.preferredLanguage;}else{if(_ac2!==_ac3.language&&!_ac3.isTranslationNeeded){_ac1=lang.replace(_abb.workinginwrongsite,[_abf[_ac2],_abf[_ac3.language]]);_ac4=_ac3.language;}}if(!_ac1){this.set("notification",null);return;}var html=_ab7.create("div",{innerHTML:_ac1});if(_ac4){var url=new Url(window.top.location.href);var text=lang.replace(_abb.switchto,[_abf[_ac4]]);_ab7.create("a",{href:[url.scheme,"://",url.authority,url.path,"?language=",_ac4,"#context=",_abc.versionAgnosticUri].join(""),innerHTML:text,title:text},html);}this.set("notification",{content:html,commands:_ac3.isTranslationNeeded&&_ac2===_ac3.preferredLanguage?[_aba.translate]:[]});}));}});});},"epi-cms/contentediting/ExpirationNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_ac5,_ac6,_ac7,_ac8,_ac9,_aca,_acb,_acc){return _ac5([_ac6],{postscript:function(){this.inherited(arguments);this._notificationPeriod=_aca.expirationNotificationPeriod;this._setupCommands();},_valueSetter:function(_acd){var _ace=_acd.contentData.properties.iversionable_expire;this._updateNotification(_ace);},_updateNotification:function(_acf){var _ad0=_ac8.serverTime();var _ad1=_acf?_acf.stopPublish:null,_ad2=new Date(_ad1);var text=null;if(_ad1&&_ac8.isDateValid(_ad2)){if(new Date(_ad0.getTime()+this._notificationPeriod*1000)>_ad2){text=_ad2<_ad0?_acc.expired:_ac7.substitute(_acb.expiretimetext,[_ac8.timeToGo(_ad2)]);}}if(!text){this.set("notification",null);}else{this.set("notification",{content:text,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_ac9.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var self=this;self._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(name,_ad3,_ad4){if(self._viewModelValueHandler){self._viewModelValueHandler.unwatch();}self._viewModelValueHandler=_ad4.watch("value",function(name,_ad5,_ad6){self._updateNotification(_ad6);});});}});});},"epi-cms/contentediting/FuturePublishingDateNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.futurepublishingdate"],function(_ad7,_ad8,_ad9,_ada,_adb,_adc){return _ad7([_ad8],{notification:null,_valueSetter:function(_add){var _ade=_add&&_add.contentData;if(_ade.status===_adb.versionStatus.Published){var _adf=new Date(_ade.properties.iversionable_startpublish);_adf.setSeconds(0,0);if(_adf.getTime()>_ada.serverTime()){var _ae0=_ad9.substitute(_adc.message,[_ada.toUserFriendlyHtml(_adf)]);this.set("notification",{content:_ae0});return;}}this.set("notification",null);}});});},"epi-cms/contentediting/ContentViewModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/topic","dojo/on","dojo/when","dojo/promise/all","dojo/Stateful","dijit/Destroyable","dgrid/List","dgrid/extensions/DijitRegistry","epi","epi/dependency","epi/shell/UndoManager","epi/shell/conversion/ObjectConverterRegistry","epi/shell/widget/dialog/Alert","epi/shell/Stateful","../ApplicationSettings","./ContentActionSupport","./ContentEditingValidator","./ContentModelServerSync","./Operation","epi/i18n!epi/cms/nls/episerver.cms.contentediting","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(_ae1,_ae2,_ae3,_ae4,lang,_ae5,on,when,all,_ae6,_ae7,List,_ae8,epi,_ae9,_aea,_aeb,_aec,_aed,_aee,_aef,_af0,_af1,_af2,res,_af3){return _ae3([_ae6,_ae7],{contentModel:null,metadata:null,syncService:null,editorFactory:null,validator:null,contentDataStore:null,profileHandler:null,languageContext:null,enableAutoSave:true,_converterRegistry:null,_contentVersionStore:null,_syncRetryTimeout:60000,undoManager:null,contextTypeName:"",contentLink:null,contentData:null,viewName:null,isCreatingNewVersion:false,hasUndoSteps:false,hasRedoSteps:false,isValid:true,hasPendingChanges:false,lastSaved:null,isSaved:true,isSaving:false,isOnline:true,hasErrors:false,isChangingContentStatus:false,isSuspended:false,constructor:function(){this.contentModel=new _aed();},postscript:function(){this.inherited(arguments);this.profileHandler=this.profileHandler||_ae9.resolve("epi.shell.Profile");this.metadataManager=this.metadataManager||_ae9.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_ae9.resolve("epi.cms.ProjectService");this.currentContentLanguage=this.currentContentLanguage||_aee.currentContentLanguage;this.contentDataStore=this.contentDataStore||_ae9.resolve("epi.storeregistry").get("epi.cms.contentdata");if(!this._contentVersionStore){this._contentVersionStore=_ae9.resolve("epi.storeregistry").get("epi.cms.contentversion");}this.undoManager=this.undoManager||new _aea();this.validator=this.validator||new _af0({contextId:this.get("contentLink"),contextTypeName:this.contextTypeName});if(!this.syncService){this._createSyncService();}var _af4=lang.hitch(this,function(name,_af5,_af6){this.set(name,_af6);});this._operation=new _af2();this.own(this.syncService.watch("hasPendingChanges",_af4),this.validator.watch("isValid",_af4),this.validator.watch("hasErrors",_af4),this.undoManager.watch("hasUndoSteps",_af4),this.undoManager.watch("hasRedoSteps",_af4),on(this._operation,"commit",lang.hitch(this,this._commitChanges)));},setActiveProperty:function(name){this.onSetActiveProperty(name);},suspend:function(){this.set("isSuspended",true);this.onContentChange();this.onSuspend();},onSuspend:function(){},wakeUp:function(){this.set("isSuspended",false);},destroy:function(){this.clear();this.inherited(arguments);},clear:function(){this.undoManager.clear();},_createSyncService:function(){var _af7=new _af1({contentLink:this.get("contentLink"),contentDataStore:this.contentDataStore});this.syncService=_af7;},connectLocal:function(_af8,obj,evt,_af9){if(!lang.isArray(_af8)){throw Error("First argument to connectLocal must be an Array");}return _af8.push(_ae2.connect(obj,evt,this,_af9));},disconnectLocal:function(_afa){if(lang.isArray(_afa)){var _afb;while((_afb=_afa.pop())){_ae2.disconnect(_afb);}}},resetNotifications:function(){this.validator.clearErrorsBySource(this.validator.validationSource.client);},beginOperation:function(){this._operation.begin();},endOperation:function(){this._operation.end();},abortOperation:function(){this._operation.abort();},getProperty:function(_afc){return this.contentModel.get(_afc);},setProperty:function(_afd,_afe,_aff){this._setModelProperty(_afd,_afe,_aff);},saveAndPublishProperty:function(_b00,_b01){return when(this.syncService.saveAndPublishProperty(_b00,_b01),lang.hitch(this,function(_b02){this.contentModel.set(_b00,_b01);return when(all([this.contentDataStore.refresh(_b02.contentLink),_b02.publishedContentLink?this.contentDataStore.refresh(_b02.publishedContentLink):null]),lang.hitch(this,function(_b03){var _b04=_b03[0];this.set("contentData",_b04);return _b02;}));}));},_commitChanges:function(_b05){var _b06=[];_b05.forEach(function(_b07){_b06.push({propertyName:_b07.propertyName,value:_b07.oldValue,oldValue:_b07.value});},this);this.undoManager.createStep(this,this._saveProperties,[_b06],"Edit properties");},_saveProperties:function(_b08){this.beginOperation();_ae1.forEach(_b08,function(p){this._setModelProperty(p.propertyName,p.value,p.oldValue);},this);this.endOperation();},_setModelProperty:function(_b09,_b0a,_b0b){_b0b=_b0b===undefined?this.contentModel.get(_b09):_b0b;this.set("isSaved",false);this.contentModel.set(_b09,_b0a);this._operation.save({propertyName:_b09,value:_b0a,oldValue:_b0b});this.syncService.scheduleForSync(_b09,_b0a);this.enableAutoSave&&this.save();this.onPropertyEdited(_b09,_b0a);},onPropertyEdited:function(_b0c,_b0d){},onPropertySaved:function(_b0e,_b0f){},onPropertyReverted:function(_b10,_b11){this.contentModel.set(_b10,_b11);},_onSynchronizeSuccess:function(_b12,_b13,_b14){_ae1.forEach(_b13,lang.hitch(this,function(_b15){this.validator.clearPropertyErrors(_b15.name,this.validator.validationSource.server);this._patchContentDataStore(_b12,_b15.name,null,_b15.value);this.onPropertySaved(_b15.name,_b15.value);}));this.validator.setGlobalErrors(_b14.validationErrors,this.validator.validationSource.server);},_onSynchronizeFailure:function(_b16,_b17,_b18,_b19){var _b1a=[];_ae1.forEach(_b17,function(_b1b){if("successful" in _b1b){if(_b1b.successful){this.validator.clearPropertyErrors(_b1b.name,this.validator.validationSource.server);}else{if(_b1b.committed){this.validator.setPropertyErrors(_b1b.name,[{errorMessage:_b1b.validationErrors,severity:this.validator.severity.error}],this.validator.validationSource.server);}else{_b1a.push(_b1b);}}}},this);if(_b1a.length){var _b1c=_ae1.map(_b1a,function(_b1d){return _b1d.validationErrors;});this._showErrorsDialog(res.autosave.title,res.autosave.error,_b1c,lang.hitch(this,function(){_ae1.forEach(_b1a,function(_b1e){this.onPropertyReverted(_b1e.name,_b1e.value);},this);}));}if(_b19){if(_b19.validationErrors){this.validator.setGlobalErrors(_b19.validationErrors,this.validator.validationSource.server);}else{this.validator.clearGlobalErrors(this.validator.validationSource.server);}}},_showErrorsDialog:function(_b1f,_b20,_b21,_b22){var list=new (_ae3([List,_ae8]))({className:"epi-grid-max-height--300"});list.renderArray(_b21);list.startup();new _aec({title:_b1f,description:_b20,content:list,onAction:_b22}).show();},_contentLinkChanged:function(_b23,_b24){this.set("contentLink",_b24);this.syncService.contentLink=_b24;this.validator.setContextId(_b24);if(!this.get("isSuspended")){var _b25={uri:"epi.cms.contentdata:///"+_b24};_ae5.publish("/epi/shell/context/request",_b25,{sender:this,contextIdSyncChange:true,trigger:"internal"});}},ensureWritableVersion:function(){var _b26=this.get("contentLink");if(!this.contentData.isNewVersionRequired){return _b26;}if(this._isCreatingNewVersionDeferred&&!this._isCreatingNewVersionDeferred.isFulfilled()){return this._isCreatingNewVersionDeferred.promise;}else{this._isCreatingNewVersionDeferred=new _ae4();}this.isCreatingNewVersion=true;when(this._contentVersionStore.put({originalContentLink:_b26}),lang.hitch(this,function(_b27){this.contentDataStore.refresh(_b27.contentLink).then(lang.hitch(this,function(_b28){this.set("contentData",_b28);})).always(lang.hitch(this,function(){this.isCreatingNewVersion=false;this._contentLinkChanged(_b26,_b27.contentLink);this._isCreatingNewVersionDeferred.resolve(_b27);}));}),lang.hitch(this,function(_b29){console.error(_b29);this.isCreatingNewVersion=false;this._isCreatingNewVersionDeferred.reject(_b29);}));return this._isCreatingNewVersionDeferred.promise;},validate:function(){var def;if(!this.validator){def=new _ae4();def.resolve();}else{def=this.validator.validate();}return def;},revertToPublished:function(){var _b2a=this.get("contentLink");when(this._contentVersionStore.remove(_b2a),lang.hitch(this,function(){this._loadPublishedVersion(_b2a);}),lang.hitch(this,function(_b2b){var _b2c;if(_b2b.status===403){_b2c=_af3.deleteversion.cannotdeletepublished;}else{if(_b2b.status===404){_b2c=res.versionstatus.versionnotfound;}}if(_b2c){new _aec({description:_b2c,onAction:lang.hitch(this,function(){this._loadPublishedVersion(_b2a);})}).show();}}));},_loadPublishedVersion:function(_b2d){when(this._contentVersionStore.query({contentLink:_b2d,language:this.languageContext?this.languageContext.language:"",query:"getpublishedversion"}),lang.hitch(this,function(_b2e){if(_b2e!==null){var _b2f={uri:"epi.cms.contentdata:///"+_b2e.contentLink,context:this};_ae5.publish("/epi/shell/context/request",_b2f,{sender:this,forceReload:true});}}));},createDraft:function(){var _b30=this.get("contentLink"),_b31=this.contentData.isCommonDraft&&this.contentData.status===_aef.versionStatus.DelayedPublish&&!this.projectService.isProjectModeEnabled;return when(this._contentVersionStore.put({originalContentLink:_b30,isCommonDraft:_b31}),lang.hitch(this,function(_b32){var _b33={uri:"epi.cms.contentdata:///"+_b32.contentLink,context:this};_ae5.publish("/epi/shell/context/request",_b33,{sender:this});_ae5.publish("/epi/cms/content/statuschange/","common-draft",{id:_b32.contentLink});}));},editCommonDraft:function(){var _b34=this.get("contentLink");return when(this._contentVersionStore.query({contentLink:_b34,query:"getcommondraftversion"}),lang.hitch(this,function(_b35){var _b36={uri:"epi.cms.contentdata:///"+_b35.contentLink,context:this};_ae5.publish("/epi/shell/context/request",_b36,{sender:this});}));},_populateContentModel:function(data,_b37){var _b38={},_b39,_b3a;for(var _b3b in data){var _b3c=_b37.getPropertyMetadata(_b3b);var _b3d=data[_b3b];if(_b3c.hasSubProperties()){_b38[_b3b]=this._populateContentModel(_b3d,_b3c);}else{_b38[_b3b]=_b3d;_b39=_b3c.customEditorSettings.converter;if(_b39){_b3a=_aeb.getConverter(_b39,"runtimeType");if(_b3a){_b38[_b3b]=_b3a.convert(_b39,"runtimeType",_b3d);}}}}return _b38;},getPropertyMetaData:function(_b3e){return when(this._getMetadata(),function(_b3f){return _b3f.getPropertyMetadata(_b3e);});},reload:function(){return when(all([this.contentDataStore.get(this.get("contentLink")),this._getMetadata(true)]),lang.hitch(this,function(data){var _b40=data[0],_b41=data[1];this.set("contentData",_b40);var _b42=this.get("contentModel");var _b43=this._populateContentModel(_b40.properties,_b41);for(var name in _b43){if(_b43.hasOwnProperty(name)&&!epi.areEqual(_b42.get(name),_b43[name])){_b42.set(name,_b43[name]);}}}));},_getMetadata:function(_b44){var _b45=this.get("metadata");if(!_b44&&_b45){return _b45;}var self=this;return when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.get("contentLink")}),function(_b46){self.set("metadata",_b46);return _b46;});},save:function(){if(!this.isOnline){var def=new _ae4();def.resolve(true);return def;}return this._save();},_save:function(){var def=new _ae4(),_b47=lang.hitch(this,function(_b48){if(_b48){if(_b48.successful){this._onSynchronizeSuccess(_b48.contentLink,_b48.properties,_b48);}else{this._rescheduleProperties(_b48.properties);this._onSynchronizeFailure(_b48.contentLink,_b48.properties,_b48.validationErrors,_b48);}if(_b48&&_b48.hasContentLinkChanged){this._contentLinkChanged(_b48.contentLink,_b48.oldContentLink);}}this.set("isOnline",true);this.set("lastSaved",new Date());this.set("isSaving",false);this.set("isSaved",true);def.resolve(true);}),_b49=lang.hitch(this,function(_b4a){this.set("hasErrors",true);this.set("isSaving",false);this.set("isSaved",false);this.set("isOnline",false);if(_b4a){this._rescheduleProperties(_b4a.properties);}setTimeout(lang.hitch(this,function(){this.set("isOnline",true);this._save();}),this._syncRetryTimeout);def.reject(_b4a);});if(!this.hasPendingChanges){_b47();}else{when(this.ensureWritableVersion()).then(lang.hitch(this,function(){this.set("isSaving",true);return this.syncService.save();})).then(_b47).otherwise(_b49);}return def;},_rescheduleProperties:function(_b4b){_ae1.forEach(_b4b,lang.hitch(this,function(_b4c){if(!this.syncService.pendingSync(_b4c.name)){this.syncService.scheduleForSync(_b4c.name,_b4c.value);}}));},undo:function(){!this.get("isSuspended")&&this.undoManager.undo();},redo:function(){!this.get("isSuspended")&&this.undoManager.redo();},_patchContentDataStore:function(_b4d,_b4e,_b4f,_b50){var _b51={};lang.setObject(_b4e,_b50,_b51);return this.contentDataStore.patchCache({contentLink:_b4d,changedBy:this.profileHandler.userName,saved:(new Date()).toISOString(),properties:_b51});},changeContentStatus:function(_b52){var _b53=this.get("contentLink");var def=new _ae4();this.set("isChangingContentStatus",true);var _b54=lang.hitch(this,function(_b55){var _b56=_b55&&_b55.success;var _b57=this.validator;if(_b56){if(_b52===_aef.action.Publish||_b52===_aef.action.CheckIn||_b52===(_aef.saveAction.CheckIn|_aef.saveAction.DelayedPublish|_aef.saveAction.ForceCurrentVersion)){this.set("lastSaved",null);}if(_b57){_b57.clearGlobalErrors(_b57.validationSource.server);}var _b58={id:_b55.id,oldId:_b53};_ae5.publish("/epi/cms/content/statuschange/",_b52,_b58);def.resolve(_b58);}else{if(_b55&&_b55.validationErrors){if(_b57){_b57.setGlobalErrors(_b55.validationErrors,_b57.validationSource.server);_b57.validate();}def.reject(null);}else{def.reject((_b55&&_b55.errorMessage)?_b55.errorMessage:res.publish.error);}}this.set("isChangingContentStatus",false);});var _b59=lang.hitch(this,function(_b5a){_ae5.publish("/epi/cms/action/showerror");def.reject((_b5a&&_b5a.errorMessage)?_b5a.errorMessage:res.publish.error);this.set("isChangingContentStatus",false);});this.onContentChange();when(this.validate(),lang.hitch(this,function(){when(this.save(),lang.hitch(this,function(){when(this.contentDataStore.executeMethod("ChangeStatus",this.get("contentLink"),{action:_b52}),_b54,_b59);}),_b59);}),_b59);return def;},onContentChange:function(){},hasEditAccess:function(){return _aef.hasAccess(this.contentData.accessMask,_aef.accessLevel.Edit);},hasAccess:function(_b5b){var _b5c=!this.languageContext||!this.languageContext.isTranslationNeeded;return _b5c&&_aef.isActionAvailable(this.contentData,_b5b||_aef.action.Edit,_aef.providerCapabilities.Edit);},canTranslateContent:function(){if(this.viewLanguage&&this.languageContext&&this.viewLanguage!==this.currentContentLanguage){return false;}return true;},canChangeContent:function(_b5d){var _b5e=this.projectService.isProjectModeEnabled&&this.contentData.isPartOfAnotherProject;return !_b5e&&this.canEditCurrentLanguage()&&this.hasAccess(_b5d);},canEditCurrentLanguage:function(){if(!this.languageContext){return true;}return this.languageContext.language===this.currentContentLanguage;},_contentDataSetter:function(_b5f){this.contentData=_b5f;if(_b5f.contentLink!==undefined){this.set("contentLink",_b5f.contentLink);}},_showOverlayGetter:function(){var _b60=this.getProperty("iversionable_shortcut");if(_b60&&_b60.pageShortcutType){return _b60.pageShortcutType!==4;}return true;}});});},"epi-cms/contentediting/ContentEditingValidator":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(dojo,_b61,_b62,_b63,lang,_b64,_b65,_b66,_b67){return _b62([_b66],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{none:0,info:1,warn:2,error:3},validationSource:{server:1,client:2},_errorLevels:{},constructor:function(_b68){_b62.safeMixin(this,_b68);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _b69=this.severity[p];this._errorLevels[_b69]=p;}this.messageService=this.messageService||_b67.resolve("epi.shell.MessageService");this._store=new _b65({idAttribute:"id",data:[]});},setContextId:function(_b6a){var _b6b=this.contextId;this.contextId=_b6a;var _b6c=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_b6b});_b6c.forEach(lang.hitch(this,function(item){item.contextId=this.contextId;this.messageService.put(item);}));},clearPropertyErrors:function(_b6d,_b6e){if(!_b6d){return;}this._clearErrors(_b6d,_b6e);},setPropertyErrors:function(_b6f,_b70,_b71){if(!_b6f){return;}this._setErrors(_b70,_b6f,_b71);},clearGlobalErrors:function(_b72){this._clearErrors(null,_b72);},clearErrorsBySource:function(_b73){this._clearErrors(undefined,_b73);},setGlobalErrors:function(_b74,_b75){this._setErrors(_b74,null,_b75);},_clearErrors:function(_b76,_b77){var _b78;if(_b76){_b78={propertyName:_b76};}else{if(_b76===null){_b78={global:true};}else{_b78={};}}if(_b77){_b78.source=_b77;}var _b79=this._store.query(_b78);_b79.forEach(lang.hitch(this,function(item){this.messageService.remove({id:item.messageId});this._store.remove(item.id);}));this._updateFlags();},_setErrors:function(_b7a,_b7b,_b7c){this._clearErrors(_b7b,_b7c);_b61.forEach(_b7a,function(item){this._putStoreItem(item,_b7b,_b7c);},this);this._updateFlags();},_putStoreItem:function(item,_b7d,_b7e){var _b7f="";if(this._errorLevels[item.severity]){_b7f=this._errorLevels[item.severity];}var _b80=this.messageService.put(_b7f,item.errorMessage,this.contextTypeName,this.contextId);var _b81={id:this._storeId++,item:item,severity:item.severity,messageId:_b80};if(_b7d){_b81.propertyName=_b7d;}else{_b81.global=true;}if(_b7e!==undefined){_b81.source=_b7e;}return this._store.put(_b81);},_updateFlags:function(){var _b82=this._store.query({severity:this.severity.error});var _b83=this._store.query({severity:this.severity.warn});var _b84=_b82.length===0&&_b83.length===0;var _b85=_b82.length>0;this.set("isValid",_b84);this.set("hasErrors",_b85);},validate:function(){var _b86=this.severity.error,_b87=this.severity.warn,_b88=new _b63();_b63.when(this._validate(_b86),function(_b89){if(_b89){_b64.publish("/epi/cms/action/showerror");}_b88.resolve(_b89);},function(){_b64.publish("/epi/cms/action/showerror");_b88.reject();});return _b88;},_validate:function(_b8a){var _b8b=new _b63();if(!this._isBlocking){_b63.when(this._store.query({severity:_b8a}),lang.hitch(this,function(_b8c){var _b8d=_b61.filter(_b8c,function(item){return item.source===this.validationSource.client;},this);var _b8e=_b8d.length>0;var _b8f=_b8c.length>_b8d.length;if(_b8e){_b8b.reject();}else{_b8b.resolve(_b8f);}}));}return _b8b;}});});},"epi-cms/contentediting/ContentModelServerSync":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/json","dojo/_base/lang","dojo/Stateful","epi/datetime","epi/string"],function(_b90,_b91,_b92,when,json,lang,_b93,_b94,_b95){return _b91([_b93],{_queue:null,_isSynchronizing:false,hasPendingChanges:false,contentLink:null,contentDataStore:null,processInterval:200,_processIntervalId:0,_saveDeferred:null,constructor:function(_b96){_b91.safeMixin(this,_b96);this._queue=[];},scheduleForSync:function(_b97,_b98){if(_b98===undefined){return;}this.set("hasPendingChanges",true);_b98=_b94.transformDate(_b98);var _b99=this._propertyIndexInQueue(_b97);if(_b99<0){this._queue.push({name:_b97,value:_b98});}else{this._queue[_b99].value=_b98;}},saveAndPublishProperty:function(_b9a,_b9b){this.scheduleForSync(_b9a,_b9b);return this._startSynchronizeInterval({delay:0,publish:true});},_propertyIndexInQueue:function(_b9c){var _b9d=-1;_b90.some(this._queue,function(item,i){if(item.name===_b9c){_b9d=i;return true;}});return _b9d;},save:function(){return this._startSynchronizeInterval();},_startSynchronizeInterval:function(_b9e){var _b9f;if(!this._saveDeferred){this._saveDeferred=new _b92();_b9f=_b9e&&_b9e.delay||this.processInterval;setTimeout(this._synchronizeItem.bind(this,_b9e),_b9f);}return this._saveDeferred.promise;},_synchronizeItem:function(_ba0){var _ba1=this._queue,_ba2=this.contentLink,_ba3=this._saveDeferred;this._queue=[];this._saveDeferred=null;this.set("hasPendingChanges",false);var _ba4=function(_ba5){var _ba6={},_ba7;if(_ba5){_b90.forEach(_ba5.properties,lang.hitch(this,function(_ba8){_ba8.name=_b95.pascalToCamel(_ba8.name);}));_ba7=_ba5.savedContentLink;_ba6=lang.mixin({successful:false,contentLink:_ba5.savedContentLink,hasContentLinkChanged:_ba5.savedContentLink&&_ba7!==this.contentLink},_ba5);if(_ba7&&_ba7!==this.contentLink){_ba6.oldContentLink=this.contentLink;this.contentLink=_ba7;}_ba3.resolve(_ba6);}else{_ba3.reject({contentLink:_ba2,properties:_ba1,error:"Unexpected result returned from the server."});}}.bind(this);var _ba9=function(_baa){var _bab={contentLink:_ba2,properties:_ba1,error:_baa};_ba3.reject(_bab);}.bind(this);if(_ba1.length===0){_ba3.resolve();return;}when(this._saveProperties(_ba1,_ba0)).then(_ba4).otherwise(_ba9);},pendingSync:function(_bac){return this._propertyIndexInQueue(_bac)!==-1;},_saveProperties:function(_bad,_bae){var _baf=this.contentLink,_bb0={},_bb1=!!_bae&&_bae.publish;_b90.forEach(_bad,lang.hitch(this,function(item){_bb0[item.name]=json.toJson(item.value);}));var _bb2={id:_baf,properties:_bb0,publishChanges:_bb1};return this.contentDataStore.patch(_bb2,{id:_bb2.id});}});});},"epi-cms/contentediting/Operation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful"],function(_bb3,_bb4,lang,_bb5,_bb6){return _bb4([_bb6,_bb5],{inProgress:false,changes:null,constructor:function(){this.changes=[];},begin:function(){this.set("inProgress",true);},save:function(data){if(this.inProgress){this.changes=_bb3.filter(this.changes,function(_bb7){if(_bb7.propertyName===data.propertyName){data.oldValue=_bb7.oldValue;return false;}return true;});this.changes.push(data);return;}if(!lang.isArray(data)){data=[data];}this.emit("commit",data);},end:function(){this.set("inProgress",false);if(this.changes.length>0){this.save(this.changes);}this.changes=[];},abort:function(){this.set("inProgress",false);this.changes=[];}});});},"epi-cms/contentediting/EditToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dojo/topic","dojo/when","epi","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_bb8,lang,_bb9,_bba,_bbb,when,epi,_bbc,_bbd,_bbe,res,_bbf){return _bb8([_bbe],{res:res,_editActionViewModel:null,_commands:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_bbc;this._commands.revertToPublished.watch("canExecute",lang.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _bbd();this.own(this._editActionViewModel);},resize:function(_bc0){this.inherited(arguments);if(_bc0){_bba.toggle(this.domNode,"epi-editToolbarNarrow",_bc0.w<620);_bba.toggle(this.domNode,"epi-editToolbarMedium",_bc0.w>=620&&_bc0.w<1000);this._editActionViewModel.set("expanded",_bc0.w>=1000);this.setItemProperty("autosave","isInNarrowToolbar",_bc0.w<1000);}},setupChildren:function(_bc1,_bc2){var _bc3=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:epi.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_bbb.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:epi.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_bbb.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:lang.hitch(this,function(){this._commands.revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:epi.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit/form/ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-modeButton"},action:function(){if(this.get("state")==="Loading"){return;}this.set("state","Loading");setTimeout(function(){_bbb.publish("/epi/cms/action/switcheditmode");},0);}}];var _bc4=_bc1?_bc1:[];_bc3=_bc2?_bc2.concat(_bc3):_bc3;return this.inherited(arguments,[_bc4,_bc3]);},_setContentViewModelAttr:function(_bc5){this._set("contentViewModel",_bc5);when(this.isSetup(),lang.hitch(this,function(){this._updateToolbarItemsModel(_bc5);}));},_updateToolbarItemsModel:function(_bc6){this.setItemProperty("autosave","label","");this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _bc7=_bc6.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_bc7.contentLink});var _bc8="",_bc9="";if(_bc6.viewName==="formedit"){this.setItemProperty("editmodeswitch","checked",true);_bc8=this.res.onpageedit.title;_bc9=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_bc8=this.res.formedit.title;_bc9=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_bc8);this.setItemProperty("editmodeswitch","label",_bc9);var _bca=this._hasCustomViews(this.viewConfigurations.availableViews);var _bcb=this._hasBuiltInViews(this.viewConfigurations.availableViews);this.setItemVisibility("editmodeswitch",!_bca&&_bcb&&_bc7.hasTemplate);this.setItemVisibility("viewselect",_bca);this._editActionViewModel.set("dataModel",_bc6);},_hasCustomViews:function(_bcc){return _bb9.filter(_bcc,function(view){return !view.hideFromViewMenu&&view.key!=="onpageedit"&&view.key!=="formedit";}).length;},_hasBuiltInViews:function(_bcd){return _bb9.filter(_bcd,function(view){return view.key==="onpageedit"||view.key==="formedit";}).length===2;}});});},"epi-cms/contentediting/viewmodel/EditActionPanelViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(_bce,_bcf,lang,_bd0,_bd1,_bd2,_bd3,_bd4,_bd5,_bd6,_bd7,res){return _bcf([_bd4],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10},_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_watchers:null,_statusMap:{},postscript:function(){this.res=this.res||res;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_bd7.resolve("epi.cms.contentediting.inUseNotificationManager");if(this._virtualStatusCssState.length===0){for(var _bd8 in this._virtualStatusEnum){this._virtualStatusCssState.push(_bd8);this._virtualStatusLocalization.push(this.res["status"][_bd8.toLowerCase()]);}this._statusMap[_bd3.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_bd3.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_bd3.versionStatus.Rejected]=this._virtualStatusEnum.ChangesToPublish;this._statusMap[_bd3.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_bd3.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_bd3.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_bd3.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusIcon[_bd3.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_bd3.versionStatus.Rejected]="epi-iconStop";}if(!this.skipChildModels){this.publishMenuViewModel=new _bd5({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}this.inherited(arguments);},_setDataModelAttr:function(_bd9){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",_bd9);}},onDataModelChange:function(name,_bda,_bdb){var _bdc=this.dataModel.contentData,_bdd=this._getVirtualStatus(_bdc);this.set("state",this._virtualStatusCssState[_bdd]);this.set("additionalClass",_bdd===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this._setStatusText(_bdd,_bdc);this.set("buttonText",this._getButtonText(_bdd,_bdc));this.set("statusIcon",this._statusIcon[_bdc.versionStatus]||"");var _bde=this.dataModel.canChangeContent(_bd3.action.Edit);this.set("nonEditableIndicator",!_bde);this.set("visible",!_bdc.isWastebasket);},_setStatusText:function(_bdf,_be0){if(_be0.status===_bd3.versionStatus.DelayedPublish){this.set("statusText",_bd1.substitute(this._virtualStatusLocalization[_bdf],[_bd6.toUserFriendlyHtml(_be0.properties.iversionable_startpublish)]));}else{if(_bdf===this._virtualStatusEnum.InUse){var _be1=this.inUseNotificationManager.getOtherUsersInUseNotifications(_be0.inUseNotifications);_be1=_be1.map(function(item){return _bd2.encode(item);}).join(",");this.set("statusText",_bd1.substitute(this._virtualStatusLocalization[_bdf],[_be1]));}else{this.set("statusText",this._virtualStatusLocalization[_bdf]);}}},_getButtonText:function(_be2,_be3){if((_be2===this._virtualStatusEnum.NotPublishedYet||_be2===this._virtualStatusEnum.ChangesToPublish||_be2===this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_bd3.action.Publish)){return this.res.buttonlabel.publish;}else{return this.res.buttonlabel.option;}},_getVirtualStatus:function(_be4){if(_be4.isDeleted){return this._virtualStatusEnum.Deleted;}var _be5,_be6,_be7;_be5=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_be6=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_be5;_be7=this.inUseNotificationManager.hasInUseNotificationWarning(_be4.inUseNotifications);if(_be7&&_be6){return this._virtualStatusEnum.InUse;}if(_be4.isCommonDraft){if(_be4.status===_bd3.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_be4.status===_bd3.versionStatus.CheckedOut){return _be4.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}return this._statusMap[_be4.status];}});});},"epi-cms/contentediting/viewmodel/_ContentViewModelObserver":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(_be8,_be9,lang,_bea,_beb){return _be8([_bea,_beb],{dataModel:null,_watchers:null,destroy:function(){this._unbindDataModel();this.inherited(arguments);},_bindDataModel:function(){this._watchers.push(this.dataModel.watch("status",lang.hitch(this,this.onDataModelChange)));this._watchers.push(this.dataModel.watch("contentData",lang.hitch(this,this.onDataModelChange)));},_unbindDataModel:function(){_be9.forEach(this._watchers,function(w){w.unwatch();});this._watchers=[];},_setDataModelAttr:function(_bec){this._unbindDataModel();this._set("dataModel",_bec);this.onDataModelChange();this._bindDataModel();},onDataModelChange:function(name,_bed,_bee){}});});},"epi-cms/contentediting/viewmodel/PublishMenuViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojox/html/entities","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_bef,lang,when,_bf0,_bf1,epi,_bf2,_bf3,_bf4,_bf5,_bf6,_bf7,_bf8,res){return _bef([_bf6,_bf7,_bf8],{commandKey:"epi.cms.publishmenu",contentActionSupport:null,inUseNotificationManager:null,_currentUser:null,commands:null,mainButtonCommand:null,lastExecutedCommand:null,mainButtonSectionVisible:null,lastChangeStatus:null,topInfoSectionVisible:null,publishInfoSectionVisible:null,lastPublishedText:null,lastPublishedViewLinkVisible:null,lastPublishedViewLinkHref:null,additionalInfoSectionVisible:null,additionalInfoText:null,isOpen:null,typeIdentifier:null,postscript:function(){this.inherited(arguments);this.res=this.res||res;this.projectService=this.projectService||_bf3.resolve("epi.cms.ProjectService");this.contentActionSupport=this.contentActionSupport||_bf5;this.initializeCommandProviders();},_setDataModelAttr:function(_bf9){this.updateCommandModel(_bf9);this.inherited(arguments);},_setIsOpenAttr:function(_bfa){if(_bfa){this._setLastChangeStatus(this.dataModel.contentData);}},onDataModelChange:function(name,_bfb,_bfc){var _bfd=this.dataModel.contentData,_bfe=(_bfd.publishedBy!==null&&_bfd.publishedBy!==undefined);this._updateCommands();this._setLastChangeStatus(this.dataModel.contentData);this.set("topInfoSectionVisible",this._getTopInfoSectionVisible(_bfd));this.set("publishInfoSectionVisible",this._getPublishInfoSectionVisible(_bfd));this.set("lastPublishedTitle",this._getLastPublishedTitle(_bfd));this.set("lastPublishedTitleVisible",_bfe);this.set("lastPublishedText",this._getLastPublishedText(_bfd));this.set("lastPublishedViewLinkVisible",this._getLastPublishedViewLinkVisible(_bfd,_bfe));this.set("lastPublishedViewLinkHref",_bfd.publicUrl);this.set("typeIdentifier",_bfd.typeIdentifier);this._setAdditionalInfo(_bfd);},_lastChangeStatusSetter:function(_bff){this.lastChangeStatus=_bff;return when(_bff);},_updateCommands:function(){var _c00=this.getCommands(),_c01=null;_c00.forEach(function(_c02){if(_c02.canExecute&&_c02.options&&_c02.options.isMain&&_c02.options.priority&&(!_c01||_c01.options.priority<_c02.options.priority)){_c01=_c02;}});this.set("mainButtonCommand",_c01);this.set("commands",_c00);this.set("mainButtonSectionVisible",_c01!==null);},_getTopInfoSectionVisible:function(_c03){return this.mainButtonCommand||!((_c03.status===_bf5.versionStatus.Published||_c03.status===_bf5.versionStatus.Expired)&&!_c03.isCommonDraft);},_getPublishInfoSectionVisible:function(_c04){var _c05=this.inUseNotificationManager.hasInUseNotificationWarning(_c04.inUseNotifications),_c06=this._isOriginallyEditable();return !(_c05&&_c06);},_getLastPublishedViewLinkVisible:function(_c07,_c08){return _c08&&!!_c07.publicUrl;},_setLastChangeStatus:function(_c09){var _c0a,_c0b,self=this;_c0b=_c0a=this._getTemplatedText(this.res.lastchangestatus,_c09.changedBy,_c09.saved);if(this.lastExecutedCommand&&this.lastExecutedCommand.options&&this.lastExecutedCommand.options.successStatus){var _c0c=this.lastExecutedCommand.options.successStatus;this.lastExecutedCommand=this.mainButtonCommand;_c0b=_c0c;}if(_c09.missingLanguageBranch&&_c09.missingLanguageBranch.isTranslationNeeded){_c0b=lang.replace(this.res.nottranslated,{languageName:epi.resources.language[_c09.missingLanguageBranch.languageId],languageId:_c09.missingLanguageBranch.languageId});}if(_c09.status===_bf5.versionStatus.Published||_c09.status===_bf5.versionStatus.Expired){_c0b=this.res.notmodifiedsincelastpublish;}if(_c09.status===_bf5.versionStatus.PreviouslyPublished){_c0b=this._getTemplatedText(this.res.previouslypublished,_c09.versionCreatedBy,_c09.versionCreatedTime);}if(_c09.status===_bf5.versionStatus.CheckedIn){_c0b=this._getTemplatedText(this.res.pendingapproval,_c09.versionCreatedBy,_c09.versionCreatedTime);}if(_c09.status===_bf5.versionStatus.DelayedPublish){_c0b=this.projectService.getProjectsForContent(_c09.contentLink).then(function(_c0d){_c0d=_c0d.filter(function(_c0e){return _c0e.status==="delayedpublished";});if(_c0d.length){return lang.replace(self.res.projectdelayedpublish,{date:_bf2.toUserFriendlyHtml(_c09.properties.iversionable_startpublish),project:_bf1.encode(_c0d[0].name)});}return _c0a;});}when(_c0b,lang.hitch(this,"set","lastChangeStatus"));},_getLastPublishedTitle:function(_c0f){return _c0f.status===_bf5.versionStatus.PreviouslyPublished?this.res.currentlypublished:this.res.lastpublishedby;},_getLastPublishedText:function(_c10){return (_c10.publishedBy===null||_c10.publishedBy===undefined)?this.res.notpublishedbefore:this._getTemplatedText(this.res.publishedtime,_c10.publishedBy,_c10.lastPublished,true);},_setAdditionalInfo:function(_c11){var _c12=this.inUseNotificationManager.hasInUseNotificationWarning(_c11.inUseNotifications),_c13=this._isOriginallyEditable(),_c14=_c12&&_c13;this.set("additionalInfoSectionVisible",_c14);if(_c14){var _c15=this.inUseNotificationManager.getOtherUsersInUseNotifications(_c11.inUseNotifications);this.set("additionalInfoText",this._getTemplatedText(this.res.inusewarning,_c15.join(",")));}},_isOriginallyEditable:function(){var _c16=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;var _c17=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_c16;return _c17;},_getFriendlyUsername:function(name,_c18){return _bf4.toUserFriendlyHtml(name,null,_c18);},_getTemplatedText:function(_c19,_c1a,_c1b,_c1c){var date=new Date(_c1b);return lang.replace(_c19,{username:this._getFriendlyUsername(_c1a,_c1c),time:_bf2.toUserFriendlyHtml(date),timepassed:_bf2.timePassed(date)});}});});},"epi/shell/command/_GlobalCommandProviderMixin":function(){define("epi/shell/command/_GlobalCommandProviderMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/command/_CommandProviderMixin","epi/dependency"],function(_c1d,_c1e,lang,_c1f,_c20){return _c1e([_c1f],{commandKey:null,commandProviders:null,_consumer:null,_currentCommandModel:null,_providerWatch:null,_initialized:false,initializeCommandProviders:function(){if(this.initialized||!this.commandKey||!this.getConsumer){return;}this._consumer=this.getConsumer();if(!this._consumer){return;}this.commandRegistry=this.commandRegistry||_c20.resolve("epi.globalcommandregistry");this.commandProviders=this.commandRegistry.get(this.commandKey,true);_c1d.forEach(this.commandProviders.providers,function(_c21){this._consumer.addProvider(_c21);},this);this._providerWatch=this.commandProviders.watch("providers",lang.hitch(this,this.onProvidersChanged));this.initialized=true;},updateCommandModel:function(_c22){this._currentCommandModel=_c22;_c1d.forEach(this.commandProviders.providers,function(_c23){if(_c23.updateCommandModel){_c23.updateCommandModel(_c22);}},this);},onProvidersChanged:function(name,_c24,_c25){if(_c24){_c1d.forEach(_c24,this._consumer.removeProvider,this._consumer);}if(_c25){_c1d.forEach(_c25,function(item){this._consumer.addProvider(item);if(item.updateCommandModel){item.updateCommandModel(this._currentCommandModel);}},this);}},destroy:function(){if(this._consumer&&this.commandProviders){_c1d.forEach(this.commandProviders.providers,this._consumer.removeProvider,this);}this._providerWatch&&this._providerWatch.unwatch();this.inherited(arguments);}});});},"epi-cms/contentediting/StandardToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/form/DropDownButton","epi/shell/layout/ToolbarContainer","epi/shell/widget/ToolbarLabel","epi/shell/widget/ToolbarSet","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/ViewSelectorDropDownButton"],function(_c26,lang,all,when,_c27,_c28,_c29,_c2a,_c2b,_c2c,_c2d){return _c26([_c2a],{currentContext:null,availableViews:null,viewName:null,_setupPromise:null,constructor:function(){this.viewConfigurations={};},buildRendering:function(){this.inherited(arguments);when(this._setupPromise=this.setupChildren(),lang.hitch(this,function(){this.updateChildren();}));},isSetup:function(){return this._setupPromise;},setupChildren:function(_c2e,_c2f){var _c30=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"center",type:"toolbargroup",settings:{region:"center"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _c31=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{displayAsText:false,showCurrentNode:false}},{parent:"trailing",name:"viewselect",widgetType:"epi-cms/widget/ViewSelectorDropDownButton",settings:{showLabel:false,"class":"epi-mediumButton epi-trailingContainer"}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"}];_c30=_c2e?_c2e.concat(_c30):_c30;_c31=_c2f?_c2f.concat(_c31):_c31;return this.add(_c30).then(lang.hitch(this,function(){return this.add(_c31);}));},updateChildren:function(){var _c32=this.currentContext,_c33=_c32&&_c32.id;this.setItemProperty("breadcrumbs","contentLink",_c33);this.setItemProperty("viewselect","viewConfigurations",this.viewConfigurations);if(_c32){this.setItemProperty("currentcontent","currentItemInfo",{name:_c32.name,dataType:_c32.dataType});}},update:function(data){if(!data){return;}this.currentContext=data.currentContext;this.viewConfigurations=data.viewConfigurations;when(this.isSetup(),lang.hitch(this,this.updateChildren));}});});},"epi-cms/widget/BreadcrumbCurrentItem":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/Evented","dojo/topic","dojo/dom-construct","dijit/_TemplatedMixin","dijit/_WidgetBase","epi/string","epi/shell/TypeDescriptorManager","dojo/text!./templates/BreadcrumbCurrentItem.html"],function(_c34,_c35,_c36,_c37,_c38,_c39,_c3a,_c3b,_c3c,_c3d){return _c34([_c3a,_c39],{templateString:_c3d,_currentIconClass:null,_setCurrentItemInfoAttr:function(_c3e){if(!_c3e){return;}this.heading.innerHTML=_c3b.encodeForWebString(_c3e.name);if(_c3e.dataType){var _c3f=_c3c.getValue(_c3e.dataType,"iconClass");if(_c3f&&_c3f!==this._currentIconClass){_c35.remove(this.iconNode,this._currentIconClass);_c35.add(this.iconNode,_c3f);this._currentIconClass=_c3f;}}}});});},"url:epi-cms/widget/templates/BreadcrumbCurrentItem.html":"<div>\r\n    <div class=\"epi-breadCrumbs-title-wrapper\"><span data-dojo-attach-point=\"iconNode\" class=\"dijitInline dijitIcon epi-breadCrumbsCurrentItem-icon\"></span><h1 data-dojo-attach-point=\"heading\" class=\"epi-breadcrumbContentItem dojoxEllipsis\"></h1></div>\r\n</div>","epi-cms/widget/ViewSelectorDropDownButton":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/form/DropDownButton","epi-cms/widget/ViewSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector"],function(_c40,_c41,lang,_c42,_c43,_c44){return _c41([_c42],{buildRendering:function(){this.inherited(arguments);this.set("title",_c44.title);this.own(this.dropDown=new _c43());},_setViewConfigurationsAttr:function(_c45){if(!_c45){return;}_c40.some(_c45.availableViews,lang.hitch(this,function(view){if(view.key===_c45.viewName){this.set("iconClass",view.iconClass);return true;}}));this.dropDown.set("viewConfigurations",_c45);}});});},"epi-cms/widget/ViewSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dijit/MenuSeparator","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector","epi-cms/widget/SelectorMenuBase","epi/shell/widget/CheckedMenuItem"],function(_c46,_c47,lang,_c48,when,_c49,_c4a,_c4b,_c4c){return _c47([_c4b],{viewConfigurations:null,headingText:_c4a.title,_setViewConfigurationsAttr:function(_c4d){this._set("viewConfigurations",_c4d);this._setup();},onExecute:function(){},onCancel:function(){},_setup:function(){if(!this.viewConfigurations){return;}_c46.forEach(this.getChildren(),lang.hitch(this,this.removeChild));var _c4e=this.viewConfigurations.viewName,_c4f=this.viewConfigurations.availableViews;var _c50="";_c46.forEach(_c4f,function(view){if(view.hideFromViewMenu){return;}var _c51=view.category||"";if(_c51!==_c50){this.addChild(new _c49({baseClass:"epi-menuSeparator"}));}_c50=_c51;var item=new _c4c({label:view.name,title:view.description,iconClass:view.iconClass,checked:view.key===_c4e,onClick:lang.hitch(this,function(){this.onExecute();item.set("checked",!item.checked);if(_c4e==="view"){_c48.publish("/epi/cms/action/disablepreview");}_c48.publish("/epi/shell/action/changeview",view.key,null,null);})});this.addChild(item);},this);}});});},"epi-cms/widget/SelectorMenuBase":function(){define(["dojo/_base/declare","dojo/keys","dijit/_MenuBase","dojo/text!./templates/SelectorMenuBase.html"],function(_c52,keys,_c53,_c54){return _c52([_c53],{templateString:_c54,headingText:null,postCreate:function(){this.inherited(arguments);this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);}});});},"url:epi-cms/widget/templates/SelectorMenuBase.html":"<div class=\"epi-menu--inverted\">\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span>${headingText}</span>\r\n                <div class=\"dijitTooltipConnector\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <table class=\"dijitReset dijitMenu epi-tooltipDialogMenu epi-menuInverted epi-mediumMenuItem\" style=\"width: 100%\" cellspacing=\"0\">\r\n\t            <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi/shell/widget/CheckedMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n"}});define("epi/shell/widget/CheckedMenuItem",["dojo/_base/declare","dijit/CheckedMenuItem","dojo/text!./templates/CheckedMenuItem.html"],function(_c55,_c56,_c57){return _c55(_c56,{templateString:_c57});});},"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\r\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\r\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\r\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\r\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\r\n\t</td>\r\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\r\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\r\n</tr>\r\n","epi-cms/widget/NotificationStatusBar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","dojox/html/entities","epi/dependency","epi-cms/widget/NotificationStatusZone","epi-cms/widget/TooltipDialog","dojo/text!./templates/NotificationStatusBar.html","epi/i18n!epi/cms/nls/episerver.cms.widget.statusbar.notificationstatus"],function(_c58,_c59,_c5a,lang,_c5b,keys,_c5c,_c5d,_c5e,_c5f,_c60,_c61,_c62,_c63,_c64,_c65){return _c59([_c5c,_c5d,_c5e],{res:_c65,templateString:_c64,_itemTemplate:"<li>{message}</li>",_notificationTooltipDialogCssClass:"epi-notificationToolipDialog epi-notificationToolipDialogCompact",_dimmedOutCssClass:"epi-notificationIcon-DimmedOut",_notificationErrorClass:"epi-notificationIcon-Error",_notificationWarningClass:"epi-notificationIcon-Warning",_notificationNoteClass:"epi-notificationIcon-Note",_totalNotifications:0,messageContext:null,_tooltipDialog:null,messageService:null,_observeHandle:null,zoneContainer:null,notificationContext:null,baseClass:"epi-notificationIcon",postMixInProperties:function(){this.inherited(arguments);this.messageService=this.messageService||_c61.resolve("epi.shell.MessageService");},postCreate:function(){this.inherited(arguments);this._tooltipDialog=new _c63({connectorMargin:47,hideOnBlur:true,content:this.zoneLayoutNode});this._buildIconBlock();_c5b.add(this._tooltipDialog.domNode,this._notificationTooltipDialogCssClass);this.connect(this.domNode,"onclick",lang.hitch(this,this._show));this.connect(this.domNode,"onkeypress",lang.hitch(this,this._onKeyPress));this.connect(this.closeIcon,"onclick",lang.hitch(this,this._hideTooltip));},update:function(_c66){this._hideTooltip();this.messageContext=_c66;this._listenMessagePool();this._updateUI();},destroy:function(){this._unListenMessagePool();this.inherited(arguments);},focus:function(){this.domNode.focus();},show:function(){this._keepShowing=true;this._showTooltip();},getMessages:function(_c67){var _c68=(_c67)?lang.mixin({typeName:_c67},this.messageContext):this.messageContext;return this.messageService.query(_c68);},_onKeyPress:function(evt){if(evt.keyCode===keys.ENTER){this._show();}},_listenMessagePool:function(){this._unListenMessagePool();this._observeHandle=this.messageService.observe(this.messageContext,lang.hitch(this,function(){this._updateUI();}));},_unListenMessagePool:function(){if(this._observeHandle){this._observeHandle.cancel();delete this._observeHandle;}},_updateNotificationZone:function(zone,_c69,_c6a){if(_c6a&&_c6a.length>0){_c58.forEach(_c6a,function(item){zone.addRow(lang.replace(_c69,{message:_c60.encode(item.message)}),"last");});zone.show();}else{zone.hide();}},_updateUI:function(){this.errorZone.empty();this.warningZone.empty();this.infoZone.empty();var _c6b=this.getMessages("error");var _c6c=this.getMessages("warn");var _c6d=this.getMessages("info");this._totalNotifications=_c6b.length+_c6c.length+_c6d.length;this._buildIconBlock();this._updateNotificationZone(this.errorZone,this._itemTemplate,_c6b);this._updateNotificationZone(this.warningZone,this._itemTemplate,_c6c);this._updateNotificationZone(this.infoZone,this._itemTemplate,_c6d);this._updateIconStatus(_c6b.length,_c6c.length,_c6d.length);},_buildIconBlock:function(){this.domNode.innerHTML=this._totalNotifications;if(this._totalNotifications===0){_c5b.add(this.domNode,this._dimmedOutCssClass);_c5b.remove(this.domNode,this._notificationNoteClass);_c5b.remove(this.domNode,this._notificationWarningClass);_c5b.remove(this.domNode,this._notificationErrorClass);this._hideTooltip();}else{_c5b.remove(this.domNode,this._dimmedOutCssClass);}},_updateIconStatus:function(_c6e,_c6f,_c70){if(_c6e){_c5b.add(this.domNode,this._notificationErrorClass);_c5b.remove(this.domNode,this._notificationNoteClass);_c5b.remove(this.domNode,this._notificationWarningClass);}else{if(_c6f){_c5b.add(this.domNode,this._notificationWarningClass);_c5b.remove(this.domNode,this._notificationNoteClass);}else{if(_c70){_c5b.add(this.domNode,this._notificationNoteClass);}}}},_setNotificationContextAttr:function(_c71){this._set("notificationContext",_c71);this.update(_c71);},_show:function(e){if(e){_c5a.stop(e);}this._showTooltip();},_showTooltip:function(){if(this._totalNotifications===0){return;}this._tooltipDialog.showTooltipDialog(this.domNode,["below-alt"]);},_hideTooltip:function(){this._tooltipDialog.hideTooltipDialog();}});});},"epi-cms/widget/NotificationStatusZone":function(){define(["dojo","dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin"],function(dojo,_c72,_c73,_c74){return _c72([_c73,_c74],{templateString:"            <div>                <div class=\"epi-dijitTooltipNotificationBlock epi-dijitTooltipBlock${TypeName}\" data-dojo-attach-point=\"Zone\">                    <span class=\"epi-notificationTypeTitle\"><span class=\"dijitIcon dijitInline epi-dijitTooltip${TypeName}Icon\"></span>${title}</span>                    <ul data-dojo-attach-point=\"contentContainer\"></ul>                </div>            </div>",title:"",type:"",TypeName:"",_hiddenCssClass:"epi-dijitTooltipBlockHidden",postMixInProperties:function(){this.TypeName=this.type.charAt(0).toUpperCase()+this.type.slice(1);},empty:function(){dojo.empty(this.contentContainer);},addRow:function(_c75,_c76){dojo.place(_c75,this.contentContainer,_c76);},show:function(){dojo.removeClass(this.Zone,this._hiddenCssClass);},hide:function(){dojo.addClass(this.Zone,this._hiddenCssClass);}});});},"epi-cms/widget/TooltipDialog":function(){define(["dojo","dojo/number","dijit","dijit/TooltipDialog","dijit/_Widget","dijit/_TemplatedMixin","dojo/text!./templates/TooltipDialog.html"],function(dojo,_c77,_c78,_c79,_c7a,_c7b,_c7c){return dojo.declare([_c79],{templateString:_c7c,connectorMargin:25,_defaultConnectorMargin:25,hideOnBlur:false,_isFirstShow:false,_beforeCssClass:"epi-dijitTooltipBefore",_afterCssClass:"epi-dijitTooltipAfter",_pos:0,_defaultConnectorRight:0,_defaultConnectorLeft:0,_wrapperPosX:0,_availableSpace:0,_right:0,_left:0,onBlur:function(){this.inherited(arguments);if(this.hideOnBlur){this.hideTooltipDialog();}},postCreate:function(){this.inherited(arguments);if(!this.connectorMargin||!_c77.parse(this.connectorMargin)||this.connectorMargin===""||this.connectorMargin<this._defaultConnectorMargin){this.connectorMargin=this._defaultConnectorMargin;}},showTooltipDialog:function(_c7d,_c7e){_c78.popup.open({popup:this,around:_c7d,orient:_c7e});if(this.hideOnBlur){this.focus();}},hideTooltipDialog:function(){_c78.popup.close(this);},onOpen:function(pos){this._pos=pos;this.inherited(arguments);},_onShow:function(){this._setDefaultValues();this._updatePositions();this.inherited(arguments);},_setDefaultValues:function(){if(!this._isFirstShow){this._defaultConnectorRight=this._getConnectorSpace("right")||this._defaultConnectorMargin;this._defaultConnectorLeft=this._getConnectorSpace("left")||this._defaultConnectorMargin;this._isFirstShow=true;}this._wrapperPosX=_c77.parse(this._pos.x);this._availableSpace=dojo.body().clientWidth;if(this._pos.aroundCorner==="MR"||this._pos.aroundCorner==="ML"){var _c7f=_c77.round((this._pos.h-this.connectorNode.clientHeight)/2);dojo.style(this.connectorNode,"top",this._getNumberInPx(_c7f));}},_updatePositions:function(){switch(this._pos.aroundCorner){case "TR":case "BR":this._calculateConnectorMarginRight();this._calculateAvailableSpaceLeft();this._updateAlignedRightPositions();break;case "TL":case "BL":this._calculateConnectorMarginLeft();this._calculateAvailableSpaceRight();this._updateAlignedLeftPositions();break;case "MR":dojo.addClass(this.domNode,this._afterCssClass);break;case "ML":dojo.addClass(this.domNode,this._beforeCssClass);break;default:break;}},_updateAlignedRightPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"right",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._right)));}else{dojo.style(this.connectorNode,"right",this._getNumberInPx(this._defaultConnectorRight));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._right-this._defaultConnectorRight)));}},_updateAlignedLeftPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"left",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._left)));}else{dojo.style(this.connectorNode,"left",this._getNumberInPx(this._defaultConnectorLeft));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._left-this._defaultConnectorLeft)));}},_calculateAvailableSpaceRight:function(){this._wrapperPosX-=this._left+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateAvailableSpaceLeft:function(){this._wrapperPosX+=this._right+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateConnectorMarginRight:function(){this._right=this._getConnectorSpace("right");if(this._right<this.connectorMargin){this._right=this.connectorMargin;}},_calculateConnectorMarginLeft:function(){this._left=this._getConnectorSpace("left");if(this._left<this.connectorMargin){this._left=this.connectorMargin;}},_getConnectorSpace:function(_c80){if(!_c80){return 0;}if(_c80==="right"||_c80==="left"){var _c81=dojo.style(this.connectorNode,_c80);if(!_c81){return 0;}var _c82=/(px|em|%)/ig;return _c77.parse(_c81)||_c77.parse(_c81.replace(_c82,""));}return 0;},_getNumberInPx:function(_c83){return _c83+"px";},_getCenterHorizontalAroundNode:function(){return _c77.round((_c77.parse(this.connectorNode.clientWidth)-_c77.parse(this._pos.aroundNodePos.w))/2);}});});},"url:epi-cms/widget/templates/TooltipDialog.html":"<div class=\"epi-dijitTooltipDialog\" role=\"presentation\" tabindex=\"-1\">\r\n    <div class=\"dijitTooltipContainer epi-dijitTooltipContainer\" role=\"presentation\">\r\n        <div class=\"dijitTooltipContents dijitTooltipFocusNode epi-dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\r\n    </div>\r\n    <div class=\"dijitTooltipConnector epi-dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\" role=\"presentation\"></div>\r\n</div>","url:epi-cms/widget/templates/NotificationStatusBar.html":"<div>\r\n    <div class=\"epi-dijitTooltipTitleBar\">\r\n        <span class=\"epi-dijitTooltipTitle\">${res.title}</span>\r\n        <span class=\"epi-closeButton dijitDialogCloseIcon\" data-dojo-attach-point=\"closeIcon\" title=\"${res.title}\" role=\"button\"></span>\r\n    </div>\r\n    <div class=\"epi-dijitTooltipContent\" data-dojo-attach-point=\"zoneLayoutNode\">\r\n        <div data-dojo-attach-point=\"zoneContainer\">\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"errorZone\" data-dojo-props=\"title: '${res.errortitle}', type: 'error'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"warningZone\" data-dojo-props=\"title: '${res.warningtitle}', type: 'warning'\"></div>\r\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"infoZone\"  data-dojo-props=\"title: '${res.notetitle}', type: 'note'\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/EditActionPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/DropDownButton","epi","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PublishMenu","epi/shell/widget/_ModelBindingMixin","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel","dojo/text!./templates/EditActionPanel.html"],function(_c84,lang,_c85,_c86,_c87,_c88,_c89,_c8a,_c8b,_c8c,epi,_c8d,_c8e,_c8f,_c90,res,_c91){return _c84([_c8a,_c89,_c8b,_c88,_c8f],{templateString:_c91,commonRes:epi.resources,baseClass:"epi-statusIndicator",modelBindingMap:{state:["state"],statusText:["statusText"],visible:["visible"],buttonText:["buttonText"],nonEditableIndicator:["nonEditableIndicator"],statusIcon:["statusIcon"],publishMenuViewModel:["publishMenuViewModel"],additionalClass:["additionalClass"],expanded:["expanded"]},_setStatusTextAttr:function(_c92){this._set("statusText",_c92);this._setStatusNodeText(_c92);},_setStatusNodeText:function(_c93){this.statusTextNode.innerHTML=_c93;_c87.set(this.stateNode,"title",!this.expanded?_c90.stripHtmlTags(_c93):"");},_setButtonTextAttr:function(val){this.dropDownButton.set("label",val);},_setVisibleAttr:function(val){_c85.set(this.domNode,"visibility",val?"visible":"hidden");},_setExpandedAttr:function(_c94){this._set("expanded",_c94);this._setStatusNodeText(this.statusText);},_setNonEditableIndicatorAttr:function(val){if(val){_c86.add(this.statusNonEditableIcon,"epi-iconPenDisabled");}else{_c86.remove(this.statusNonEditableIcon,"epi-iconPenDisabled");}},_setStatusIconAttr:function(val){_c85.set(this.statusTextIcon,"class","dijitInline dijitReset dijitIcon "+val);},_setAdditionalClassAttr:function(val){var _c95=this.get("additionalClass");if(_c95){_c86.remove(this.stateNode,_c95);}this._set("additionalClass",val);_c86.add(this.stateNode,val);},focus:function(){this.dropDownButton.focus();},_setPublishMenuViewModelAttr:function(val){this.dropDownMenu.set("model",val);},postCreate:function(){this.inherited(arguments);this.dropDownButton.dropDownPosition=["below-alt"];}});});},"epi-cms/contentediting/PublishMenu":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_c96,_c97,_c98,lang,_c99,_c9a,_c9b,_c9c,html,on,_c9d,_c9e,when,_c9f,_ca0,_ca1,epi,_ca2,_ca3,_ca4,_ca5,_ca6,_ca7,res){return _c97([_c9f,_ca1,_ca3],{templateString:_ca7,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _ca4();},modelBindingMap:{commands:["commands"],mainButtonCommand:["mainButtonCommand"],mainButtonSectionVisible:["mainButtonSectionVisible"],lastChangeStatus:["lastChangeStatus"],topInfoSectionVisible:["topInfoSectionVisible"],publishInfoSectionVisible:["publishInfoSectionVisible"],lastPublishedTitle:["lastPublishedTitle"],lastPublishedTitleVisible:["lastPublishedTitleVisible"],lastPublishedText:["lastPublishedText"],lastPublishedViewLinkVisible:["lastPublishedViewLinkVisible"],lastPublishedViewLinkHref:["lastPublishedViewLinkHref"],additionalInfoSectionVisible:["additionalInfoSectionVisible"],additionalInfoText:["additionalInfoText"],typeIdentifier:["typeIdentifier"]},_setCommandsAttr:function(_ca8){this.focusedChild=null;this.destroyDescendants();this._addCommandsToMenu(_ca8);this.focusFirstChild();},_setMainButtonCommandAttr:function(_ca9){this._set("mainButtonCommand",_ca9);if(_ca9){this.mainButton.set("label",_ca9.label);this.mainButton.set("disabled",!_ca9.get("canExecute"));_c9b.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_c9b.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_ca9.options&&_ca9.options.mainButtonClass){this._addedMainButtonClass=_ca9.options.mainButtonClass;_c9b.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_caa){_c99.set(this.mainButtonSection,"display",_caa?"":"none");_c99.set(this.mainButton.domNode,"display",_caa?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_cab){_c99.set(this.topInfoSection,"display",_cab?"":"none");},_setPublishInfoSectionVisibleAttr:function(_cac){_c99.set(this.publishInfoSection,"display",_cac?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_cad){_c99.set(this.lastPublishedTitleNode,"display",_cad?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_cae){_c99.set(this.lastPublishedViewLinkNode,"display",_cae?"":"none");},_setLastPublishedViewLinkHrefAttr:function(_caf){_c9a.set(this.lastPublishedViewLinkNode,"href",_caf);},_setAdditionalInfoSectionVisibleAttr:function(_cb0){_c99.set(this.additionalInfoSection,"display",_cb0?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_cb1){var _cb2=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_cb3=_cb2&&_cb2.downloadUrl,_cb4=_cb1&&_ca2.getValue(_cb1,"actAsAnAsset");if(!_cb4||!_cb3){_c9a.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);html.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_c9a.set(this.lastPublishedViewLinkNode,"title",res.download);html.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",lang.hitch(this,function(e){_c98.stop(e);var _cb5=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_cb5&&_cb5.downloadUrl,name=_cb5.name;_ca5.download(url,name);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(name,_cb6,_cb7){if(_cb6){this._removeCommandsFromMenu(lang.isArray(_cb6)?_cb6:[_cb6]);}if(_cb7){this._addCommandsToMenu(lang.isArray(_cb7)?_cb7:[_cb7]);}},_addCommandsToMenu:function(_cb8){_c96.forEach(_cb8,function(_cb9){if(_cb9!==this.model.mainButtonCommand){this._menuBuilder.create(_cb9,this);}},this);},_removeCommandsFromMenu:function(_cba){var _cbb=this.menu.getChildren();_c96.forEach(_cba,function(_cbc){for(var i=_cbb.length-1;i>=0;i--){var item=_cbb[i];if(item._command===_cbc){this.removeChild(item);break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_c9b.add(this.mainButton.domNode,"epi-loading");var _cbd=lang.hitch(this,function(_cbe){if(_cbe||this.mainButtonCommand.options&&this.mainButtonCommand.options.resetLabelAfterExecution){this.mainButton.set("label",this.mainButtonCommand.label);}_c9b.remove(this.mainButton.domNode,"epi-loading");if(this.mainButtonCommand.options&&!this.mainButtonCommand.options.keepMenuOpen){this.onExecute();}}),_cbf=lang.hitch(this,function(){this.model.set("lastExecutedCommand",this.mainButtonCommand);});when(this.mainButtonCommand.execute(),function(){return when(_cbd(false),_cbf);},function(){return _cbd();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _cc0=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_cc0){this.focusedChild._setSelected(false);return _c99.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _cc1=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _c99.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_cc1){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_cc2){var _cc3=_c9c.getMarginBox(this.domNode),_cc4=_c9c.getPadExtents(this.topInfoSection),_cc5=_c9c.getMarginBox(this.mainButton.containerNode),_cc6=_c9c.getMarginBox(this.containerNode);var _cc7=Math.max(_cc5.w+_cc4.l+_cc4.r,_cc3.w);_cc7=Math.max(_cc6.w,_cc7);_cc2.w=_cc7;_c9c.setMarginBox(this.domNode,_cc2);}});});},"epi/shell/Downloader":function(){define("epi/shell/Downloader",["dojo/_base/lang","dojo/dom-construct"],function(lang,_cc8){return {_classicalDownload:function(url,name){var _cc9=document.getElementsByTagName("body")[0],_cca={href:url,download:name,target:"_blank",style:{display:"none;"}},_ccb=_cc8.create("a",_cca,_cc9,"last");_ccb.click();_cc8.destroy(_ccb);},download:function(url,name){if(url){return this._classicalDownload(url,name);}}};});},"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\r\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\r\n            <li data-dojo-attach-point=\"mainButtonSection\">\r\n                <button data-dojo-type=\"dijit/form/Button\"\r\n                        data-dojo-attach-point=\"mainButton\"\r\n                        data-dojo-attach-event=\"onClick: _onMainButtonClick\"\r\n                        class=\"epi-button--bold epi-button--full-width\"></button>\r\n            </li>\r\n        </ul>\r\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\r\n            <li>\r\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\r\n            </li>\r\n            <li>\r\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\r\n        <ul>\r\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\r\n        </ul>\r\n    </div>\r\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\r\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\r\n    </table>\r\n</div>\r\n","url:epi-cms/contentediting/templates/EditActionPanel.html":"<div style=\"display: inline-block\">\r\n    <div class=\"dijitInline dijitReset\" data-dojo-attach-point=\"stateNode\">\r\n        <span data-dojo-attach-point=\"statusNonEditableIcon\" class=\"dijitInline dijitReset dijitIcon\">&nbsp;</span>\r\n        <span class=\"epi-statusContainer dijitInline dijitReset\">\r\n            <span data-dojo-attach-point=\"statusTextIcon\" class=\"dijitInline dijitReset dijitIcon\"></span>\r\n            <span data-dojo-attach-point=\"statusTextNode\" class=\"epi-statusText\"></span>\r\n        </span><span class=\"epi-statusArrow dijitInline dijitReset\"></span><!-- These need to be on the same line. -->\r\n    </div>\r\n\r\n\r\n\r\n    <div data-dojo-attach-point=\"dropDownButton\" data-dojo-type=\"dijit/form/DropDownButton\"\r\n        data-dojo-props=\"label: '${commonRes.action.publish}', 'class': 'epi-mediumButton epi-button--bold'\">\r\n        <div data-dojo-attach-point=\"dropDownMenu\" data-dojo-type=\"epi-cms/contentediting/PublishMenu\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/NotificationBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/on","dijit/_TemplatedMixin","dijit/_Widget","dijit/_Container","dijit/_WidgetsInTemplateMixin","dojo/Evented","dijit/form/Button","dojox/html/ellipsis","dojo/text!./templates/NotificationBar.html","dojo/text!./templates/NotificationBarItem.html"],function(_ccc,lang,_ccd,_cce,_ccf,_cd0,on,_cd1,_cd2,_cd3,_cd4,_cd5,_cd6,_cd7,_cd8,_cd9){var _cda=_ccc([_cd2,_cd1,_cd4,_cd5],{templateString:_cd9,item:null,viewModel:null,postCreate:function(){this.inherited(arguments);if(this.item.content){this._addContent(this.item);}this._addCommands(this.item);},_onClose:function(e){e.preventDefault();this.emit("close",this);},_addContent:function(item){if(lang.isString(item.content)){this.textContainer.innerHTML=this.item.content;}else{_ccf.place(this.item.content,this.textContainer);}},_addCommands:function(item){if(lang.isArray(this.item.commands)){_cd0.forEach(this.item.commands,lang.hitch(this,function(_cdb){this._addButtonForCommand(_cdb);}));}},_addButtonForCommand:function(_cdc){var _cdd=new _cd6({label:_cdc.label,title:_cdc.tooltip,iconClass:_cdc.iconClass});if(_cdc.cssClass){_ccd.add(_cdd.domNode,_cdc.cssClass);}_cdd.set("disabled",!_cdc.canExecute);_cdd.on("click",function(){_cdc.execute();});this.own(_cdc.watch("canExecute",lang.hitch(this,function(){_cdd.set("disabled",!_cdc.canExecute);})));if(_cdc.category==="leftAligned"){_cdd.placeAt(this.contentContainer,"first");}else{_cdd.placeAt(this.buttonContainer,"first");}this.own(_cdd);}});var _cde=_ccc([_cd2,_cd3,_cd1,_cd4,_cd5],{templateString:_cd8,noBorderClass:"epi-notificationBarWithoutBorder",buildRendering:function(){this.inherited(arguments);this._hideIfEmpty();},clear:function(){this._hideIfEmpty();_cd0.forEach(this.getChildren(),function(_cdf){this.removeChild(_cdf);_cdf.destroy();_cdf=null;},this);this.emit("notificationsChanged");},destroy:function(){this.destroyDescendants();this.inherited(arguments);},add:function(_ce0,_ce1){var _ce2=new _cda({item:_ce0});this.own(on(_ce2,"close",lang.hitch(this,"_onCloseNotification")));this.addChild(_ce2,_ce1);this._hideIfEmpty();this.emit("notificationsChanged");},remove:function(_ce3){_cd0.forEach(this.getChildren(),lang.hitch(this,function(_ce4){if(_ce4.item&&_ce4.item===_ce3){this._onCloseNotification(_ce4);}}));this._hideIfEmpty();},_onCloseNotification:function(item){this.removeChild(item);item.destroy();item=null;this._hideIfEmpty();this.emit("notificationsChanged");},_hideIfEmpty:function(){var show=this.getChildren().length>0;_ccd.toggle(this.domNode,this.noBorderClass,!show);_cce.set(this.domNode,"display",show?"":"none");}});return _cde;});},"url:epi-cms/contentediting/templates/NotificationBar.html":"<div class=\"epi-notificationBar\">\r\n    <div data-dojo-attach-point=\"containerNode\"></div>\r\n</div>","url:epi-cms/contentediting/templates/NotificationBarItem.html":"<div class=\"epi-notificationBarItem\">\r\n    <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"contentContainer\">\r\n        <p data-dojo-attach-point=\"textContainer\"></p>\r\n    </div>\r\n    <div class=\"epi-notificationBarButtonContainer\" data-dojo-attach-point=\"buttonContainer\">\r\n        <button data-dojo-type=\"dijit/form/Button\" class=\"epi-chromelessButton\" data-dojo-props=\"iconClass:'epi-iconClose', showLabel:false\" data-dojo-attach-event=\"onClick:_onClose\"></button>\r\n    </div>\r\n</div>","epi-cms/contentediting/ShortcutNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.shortcutnotification"],function(_ce5,lang,_ce6,_ce7,_ce8){var _ce9=["normal","shortcut","external","inactive","fetchdata"];return _ce5([_ce6],{_valueSetter:function(_cea){var _ceb=_cea.contentModel.get("iversionable_shortcut");if(_ceb){this._updateNotification(_ceb.pageShortcutType);}if(this._contentModelWatch){this._contentModelWatch.unwatch();}this._contentModelWatch=_cea.contentModel.watch("iversionable_shortcut",lang.hitch(this,function(name,_cec,_ced){this._updateNotification(_ced&&_ced.pageShortcutType);}));},_updateNotification:function(_cee){var _cef,_cf0=null;if(_cee>0){_cef=_ce9[_cee];_cf0=_ce7.toHTML(_ce8[_cef]);}this.set("notification",{content:_cf0});}});});},"epi-cms/contentediting/ViewSettingsNotification":function(){define(["dojo/_base/declare","dojo/Stateful","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.viewsettingsnotification"],function(_cf1,_cf2,_cf3,_cf4){return _cf1([_cf2],{_valueSetter:function(_cf5){var _cf6=_cf5.viewModel.contentData&&_cf5.viewModel.contentData.accessMask<=_cf3.accessLevel.Read,_cf7=_cf6&&_cf5.viewSetting.get("enabled")&&_cf5.viewSetting.hasVisitorGroup();this.set("notification",_cf7?{content:_cf4.visitorgroups.noaccessright}:null);}});});},"epi-cms/project/ProjectNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/Stateful","dojox/html/entities","epi/dependency","epi/shell/DestroyableByKey","epi-cms/ApplicationSettings","epi-cms/contentediting/command/CreateDraft","epi-cms/core/ContentReference","dojo/text!./templates/ProjectNotification.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.notifications"],function(_cf8,lang,all,_cf9,_cfa,_cfb,_cfc,_cfd,_cfe,_cff,_d00,_d01){return _cf8([_cf9,_cfc],{_projectService:null,_createDraftCommand:null,constructor:function(_d02,_d03){this._projectService=_d03||_cfb.resolve("epi.cms.ProjectService");this._createDraftCommand=new _cfe({ignoreContentStatus:true});this.own(this._projectService.on("project-item-updated",lang.hitch(this,this._onItemUpdated)),this._projectService.on("project-item-removed",lang.hitch(this,this._onItemRemoved)),this._projectService.on("project-updated",function(){this._onModelChanged(this.value);}.bind(this)));},_valueSetter:function(_d04){this.value=_d04;if(!_d04||!_d04.contentLink){this.set("model",null);this._currentProjectItemId=0;return;}this._createDraftCommand.set("model",_d04);var _d05="contentLinkWatch";this.destroyByKey(_d05);this.ownByKey(_d05,_d04.watch("contentLink",lang.hitch(this,"_onModelChanged",_d04)));this._onModelChanged(_d04);},_onItemUpdated:function(item){this._onItemsAddedOrRemoved(item.id);},_onItemRemoved:function(id){this._onItemsAddedOrRemoved(id);},_onItemsAddedOrRemoved:function(_d06){if(!this.model){return;}if(this._currentProjectItemId===_d06){this._updateNotification(this.model.contentLink);}},_onModelChanged:function(_d07){if(_d07.get("isSuspended")){return;}this._projectService.getProjectItemForContent(_d07.contentLink).then(function(_d08){var _d09=_d07.languageContext,_d0a=_d09&&_d09.isTranslationNeeded&&_cfd.currentContentLanguage===_d09.preferredLanguage;this.set("model",_d07);this._currentProjectItemId=_d08&&_d08.id||0;this._updateNotification(_d07.contentLink,_d07.contentData.isPartOfAnotherProject,_d0a);}.bind(this)).otherwise(function(){this._currentProjectItemId=0;}.bind(this));},_updateNotification:function(_d0b,_d0c,_d0d){var self=this;all([this._projectService.getProjectsForContent(_d0b),this._projectService.getCurrentProject()]).then(function(_d0e){var _d0f=_d0e[0],_d10=_d0e[1];if(_d0f.length===0){self.set("notification",null);return;}var _d11=_d0f.map(function(_d12){return _cfa.encode(_d12.name);}).join(", ");var _d13="";if(_d0c){_d13=_d01.partofanotherproject+": "+_d11;}else{if(_d10){_d13=_d01.partofcurrentproject;}else{_d13=_d01.partofproject+": "+_d11;}}var _d14=lang.replace(_d00,{partOfProject:_d13});var _d15=_d0c&&self._projectService.isProjectModeEnabled&&!_d0d?[self._createDraftCommand]:[];self.set("notification",{content:_d14,commands:_d15});});}});});},"url:epi-cms/project/templates/ProjectNotification.html":"<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon epi-iconProject\"></span>\n<span class=\"dijitReset dijitInline epi-project-notification__content\">{partOfProject}</span>","url:epi-cms/contentediting/templates/PageDataController.html":"<div style=\"width: 100%; height: 100%;\">\r\n    <div data-dojo-attach-point=\"mainLayoutContainer\" data-dojo-type=\"epi/shell/layout/PreserveRatioBorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\" style=\"width: 100%; height: 100%\">\r\n        <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/EditToolbar\" data-dojo-props=\"region:'top'\"></div>\r\n        <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top', layoutPriority: 99\"></div>\r\n        <div data-dojo-attach-point=\"editLayoutContainer\" data-dojo-type=\"epi/shell/layout/CardContainer\" data-dojo-props=\"region: 'center', layoutPriority: 100\">\r\n            <div data-dojo-attach-point=\"iframeWithOverlay\" data-dojo-type=\"epi/shell/widget/IframeWithOverlay\" data-dojo-props=\"fitContainer: true\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/compare/CompareToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Evented","dojo/topic","dijit/Toolbar","epi/shell/widget/DeferredDropDownButton","epi","epi/username","epi-cms/version/VersionSelector","epi/shell/widget/_ModelBindingMixin","dojo/text!./template/CompareToolbar.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_d16,lang,_d17,_d18,_d19,_d1a,_d1b,epi,_d1c,_d1d,_d1e,_d1f,_d20,_d21){return _d16([_d1a,_d18,_d1e],{region:"top",baseClass:"epi-compare-toolbar epi-localToolbar epi-flatToolbar",templateString:_d1f,_leftVersionSelector:null,_rightVersionSelector:null,_resources:lang.mixin(_d20,_d21),modelBindingMap:{currentLanguage:["currentLanguage"],leftVersion:["leftVersion"],rightVersion:["rightVersion"],leftButtonLabel:["leftButtonLabel"],rightButtonLabel:["rightButtonLabel"],leftByText:["leftByText"],rightByText:["rightByText"],leftDateText:["leftDateText"],rightDateText:["rightDateText"],messageText:["messageText"],showsVersionSelectors:["showsVersionSelectors"]},buildRendering:function(){this.inherited(arguments);this._leftVersionSelector=this._createVersionSelector("leftVersion","left");this._rightVersionSelector=this._createVersionSelector("rightVersion","right");this._leftButton=new _d1b({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._leftVersionSelector,iconClass:"epi-iconVersions"},this.leftVersionSelector);this._rightButton=new _d1b({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._rightVersionSelector,iconClass:"epi-iconVersions"},this.rightVersionSelector);this.own(this._leftVersionSelector,this._rightVersionSelector,this._leftButton,this._rightButton);},_refreshSelectors:function(){this._leftVersionSelector.refresh();this._rightVersionSelector.refresh();},_setLeftVersionAttr:function(_d22){if(epi.areEqual(this.leftVersion,_d22)){return;}this._set("leftVersion",_d22);if(_d22){this._leftVersionSelector.set("contentLink",_d22.contentLink);this._rightVersionSelector.set("markedContentLink",_d22.contentLink);this._refreshSelectors();}},_setRightVersionAttr:function(_d23){this._set("rightVersion",_d23);if(_d23){this._rightVersionSelector.set("contentLink",_d23.contentLink);this._leftVersionSelector.set("markedContentLink",_d23.contentLink);}},_setLeftButtonLabelAttr:function(_d24){this._set("leftButtonLabel",_d24);this._leftButton.set("label",_d24);},_setRightButtonLabelAttr:function(_d25){this._set("rightButtonLabel",_d25);this._rightButton.set("label",_d25);},_setLeftByTextAttr:{node:"leftBy",type:"innerHTML"},_setRightByTextAttr:{node:"rightBy",type:"innerHTML"},_setLeftDateTextAttr:{node:"leftDate",type:"innerHTML"},_setRightDateTextAttr:{node:"rightDate",type:"innerHTML"},_setMessageTextAttr:{node:"messageSection",type:"innerHTML"},_setShowsVersionSelectorsAttr:function(_d26){_d17.toggle(this.leftVersionSection,"dijitHidden",!_d26);_d17.toggle(this.rightVersionSection,"dijitHidden",!_d26);_d17.toggle(this.messageSection,"dijitHidden",_d26);this.emit("versionInformationUpdated");},_createVersionSelector:function(_d27,_d28){var _d29=this.model,_d2a=new _d1d({store:_d29.contentVersionStore,region:_d28,languages:_d29.languages,currentLanguage:_d29.currentLanguage,name:_d27}),_d2b=function(name,_d2c,_d2d){_d2a.set(name,_d2d);};this.own(_d2a.on("change",function(e){_d29.set(_d27,e.version);}),_d29.watch("languages",_d2b),_d29.watch("currentLanguage",_d2b));return _d2a;}});});},"epi-cms/version/VersionSelector":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi-cms/core/ContentReference","dojo/text!./template/VersionSelector.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/extensions/ColumnHider","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","epi-cms/dgrid/formatters","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","epi/shell/widget/_FocusableMixin","epi-cms/version/LanguageSelector"],function(_d2e,_d2f,lang,_d30,_d31,keys,_d32,_d33,_d34,_d35,_d36,_d37,_d38,_d39,_d3a,_d3b,misc,_d3c,_d3d,_d3e,_d3f,_d40,_d41){return _d2e([_d3d,_d3e,_d3f,_d40,_d41],{baseClass:"epi-version-selector",templateString:_d33,contentLink:null,markedContentLink:null,languages:null,store:null,region:null,buildRendering:function(){this.inherited(arguments);this.grid=new (_d2e([_d35,_d36,_d37,_d38,_d3b,_d3a,_d39]))({columns:{selector:{label:"",formatter:function(){return misc.icon("epi-iconCheckmark");},sortable:false},icon:{label:"",formatter:function(){return misc.icon("");},sortable:false},language:{label:_d34.language,sortable:false},status:{label:_d34.status,renderCell:_d3c.commonDraft},savedDate:{label:_d34.saved,formatter:_d3c.localizedDate,className:"epi-grid--30"},savedBy:{label:_d34.by,formatter:_d3c.userName,sortable:false}},cellNavigation:false,selectionEvents:"click",selectionMode:"exclusive",sort:[{attribute:"savedDate",descending:true}]},this.gridNode);this.own(this.grid,this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.grid.on("dgrid-select",lang.hitch(this,"_versionSelected")),_d30.around(this.grid,"renderRow",lang.hitch(this,"_renderRow")),this.languageSelector.watch("value",lang.hitch(this,"_updateFilter")),this.on("keydown",lang.hitch(this,"_onKeydown")));},startup:function(){if(this._started){return;}this.inherited(arguments);this.grid.startup();this.grid.set("store",this.store,{contentLink:this.contentLink});},resize:function(){this.inherited(arguments);this.grid.resize();},refresh:function(){if(this._started){this.grid.refresh();}},_setContentLinkAttr:function(_d42){if(this.contentLink===_d42){return;}if(this._started&&!_d32.compareIgnoreVersion(this.contentLink,_d42)){this.languageSelector.set("value",this.languageSelector.defaultOption.value);this.grid.set("query",{contentLink:_d42});}this.contentLink=_d42;this.grid.clearSelection();this.grid.select(_d42);},_setCurrentLanguageAttr:function(_d43){this._set("currentLanguage",_d43);this.languageSelector.set("currentLanguage",_d43);},_setLanguagesAttr:function(_d44){this._set("languages",_d44);this.languageSelector.set("languages",_d44);var _d45=_d44&&_d44.length;this.languageSelector.set("disabled",!_d45);_d31.toggle(this.languageSelectorContainer,"dijitHidden",!_d45);this.grid.toggleColumnHiddenState("language",!_d45);},_setMarkedContentLinkAttr:function(_d46){var row=this._getRowElement(this.markedContentLink);if(row){_d31.remove(row,"dgrid-row--marked");}row=this._getRowElement(_d46);if(row){_d31.add(row,"dgrid-row--marked");}this.markedContentLink=_d46;},_setRegionAttr:function(_d47){var _d48=this.baseClass+"--"+_d47,_d49=this.baseClass+"--"+this.region;this.region=_d47;_d31.replace(this.domNode,_d48,_d49);},_refreshComplete:function(){this.grid.select(this.contentLink);this.emit("loaded");},_versionSelected:function(e){if(e.parentType){var _d4a=e.rows&&e.rows[0].data;this.contentLink=_d4a.contentLink;this.emit("change",{version:_d4a});}},_renderRow:function(_d4b){var self=this;return function(item){var row=_d4b.apply(this,arguments);if(item.contentLink===self.markedContentLink){_d31.add(row,"dgrid-row--marked");}return row;};},_getRowElement:function(_d4c){if(_d4c){return this.grid.row(_d4c).element;}},_updateFilter:function(name,_d4d,_d4e){if(this._started){if(_d4e!==this.languageSelector.defaultOption.value){this.grid.set("query",{contentLink:this.contentLink,language:_d4e});}else{this.grid.set("query",{contentLink:this.contentLink});}}this.refresh();},_onKeydown:function(evt){if(evt.ctrlKey||evt.altKey||evt.keyCode!==keys.TAB){return;}if(evt.shiftKey){this.focusPrev();}else{this.focusNext();}_d2f.stop(evt);}});});},"url:epi-cms/version/template/VersionSelector.html":"<div>\n    <div data-dojo-attach-point=\"languageSelectorContainer\" class=\"epi-flatToolbar\">\n        <select data-dojo-attach-point=\"languageSelector\" data-dojo-type=\"epi-cms/version/LanguageSelector\" class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\"></select>\n    </div>\n    <div data-dojo-attach-point=\"gridNode\" class=\"epi-plain-grid epi-grid-max-height--300\"></div>\n</div>\n","dgrid/extensions/ColumnHider":function(){define(["dojo/_base/declare","dojo/has","dojo/on","../util/misc","put-selector/put","dojo/i18n!./nls/columnHider","xstyle/css!../css/extensions/ColumnHider.css"],function(_d4f,has,_d50,_d51,put,i18n){var _d52,_d53,_d54=has("ie"),_d55=_d54&&has("quirks"),_d56=_d54<8||_d55?"htmlFor":"for";function _d57(cb,grid){return cb.id.substr(grid.id.length+18);};return _d4f(null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:i18n,_hiderMenuOpened:false,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var _d58=this.subRows,_d59=true,_d5a,_d5b,sr,c;delete this._columnHiderFirstCheckbox;for(sr=0,_d5a=_d58.length;sr<_d5a;sr++){for(c=0,_d5b=_d58[sr].length;c<_d5b;c++){this._renderHiderMenuEntry(_d58[sr][c]);if(_d59){_d59=false;this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[_d58[sr][c].id];}}}},_renderHiderMenuEntry:function(col){var id=col.id,_d5c=_d51.escapeCssIdentifier(id,"-"),div,_d5d,_d5e,_d5f;if(col.hidden){col.hidden=false;this._hideColumn(id);col.hidden=true;}if(col.unhidable){return;}div=put("div.dgrid-hider-menu-row");_d5d=this.domNode.id+"-hider-menu-check-"+_d5c;_d5e=this._columnHiderCheckboxes[id]=put(div,"input.dgrid-hider-menu-check.hider-menu-check-"+_d5c+"[type=checkbox]");_d5e.id=_d5d;_d5f=put(div,"label.dgrid-hider-menu-label.hider-menu-label-"+_d5c+"["+_d56+"="+_d5d+"]",col.label||col.field||"");put(this.hiderMenuNode,div);if(!col.hidden){_d5e.checked=true;}},renderHeader:function(){var grid=this,_d60=this.hiderMenuNode,_d61=this.hiderToggleNode,id;function _d62(_d63){_d63.stopPropagation();};this.inherited(arguments);if(!_d60){_d61=this.hiderToggleNode=put(this.domNode,"button.ui-icon.dgrid-hider-toggle[type=button][aria-label="+this.i18nColumnHider.popupTriggerLabel+"]");this._listeners.push(_d50(_d61,"click",function(e){grid._toggleColumnHiderMenu(e);}));_d60=this.hiderMenuNode=put("div.dgrid-hider-menu[role=dialog][aria-label="+this.i18nColumnHider.popupLabel+"]");_d60.id=this.id+"-hider-menu";this._listeners.push(_d50(_d60,"keyup",function(e){var _d64=e.charCode||e.keyCode;if(_d64===27){grid._toggleColumnHiderMenu(e);_d61.focus();}}));_d60.style.display="none";put(this.domNode,_d60);this._listeners.push(_d50(_d60,".dgrid-hider-menu-check:"+(_d54<9||_d55?"click":"change"),function(e){grid._updateColumnHiddenState(_d57(e.target,grid),!e.target.checked);}));this._listeners.push(_d50(_d60,"mousedown",_d62),_d50(_d61,"mousedown",_d62));if(!_d53){_d53=_d50.pausable(document,"mousedown",function(e){_d52&&_d52._toggleColumnHiderMenu(e);});_d53.pause();}}else{for(id in this._columnHiderRules){this._columnHiderRules[id].remove();}_d60.innerHTML="";}this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries();},destroy:function(){this.inherited(arguments);for(var id in this._columnHiderRules){this._columnHiderRules[id].remove();}},left:function(cell,_d65){return this.right(cell,-_d65);},right:function(cell,_d66){if(!cell.element){cell=this.cell(cell);}var _d67=this.inherited(arguments),_d68=cell;while(_d67.column.hidden){_d67=this.inherited(arguments,[_d67,_d66>0?1:-1]);if(_d68.element===_d67.element){return cell;}_d68=_d67;}return _d67;},isColumnHidden:function(id){return !!this._columnHiderRules[id];},_toggleColumnHiderMenu:function(){var _d69=this._hiderMenuOpened,_d6a=this.hiderMenuNode,_d6b=this.domNode,_d6c;_d6a.style.display=(_d69?"none":"");if(_d69){_d6a.style.height="";}else{if(_d6a.offsetHeight>_d6b.offsetHeight-12){_d6a.style.height=(_d6b.offsetHeight-12)+"px";}(_d6c=this._columnHiderFirstCheckbox)&&_d6c.focus();}_d53[_d69?"pause":"resume"]();_d52=_d69?null:this;this._hiderMenuOpened=!_d69;},_hideColumn:function(id){var grid=this,_d6d="#"+_d51.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",_d6e;if(this._columnHiderRules[id]){return;}this._columnHiderRules[id]=_d51.addCssRule(_d6d+_d51.escapeCssIdentifier(id,"-"),"display: none;");if((has("ie")===8||has("ie")===10)&&!has("quirks")){_d6e=_d51.addCssRule(".dgrid-row-table","display: inline-table;");window.setTimeout(function(){_d6e.remove();grid.resize();},0);}},_showColumn:function(id){if(this._columnHiderRules[id]){this._columnHiderRules[id].remove();delete this._columnHiderRules[id];}},_updateColumnHiddenState:function(id,_d6f){this[_d6f?"_hideColumn":"_showColumn"](id);this.columns[id].hidden=_d6f;_d50.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[id],hidden:_d6f,bubbles:true});this.resize();},toggleColumnHiddenState:function(id,_d70){if(typeof _d70==="undefined"){_d70=!this._columnHiderRules[id];}this._updateColumnHiddenState(id,_d70);this._columnHiderCheckboxes[id].checked=!_d70;}});});},"epi-cms/version/LanguageSelector":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.languageselector","dijit/form/Select"],function(_d71,_d72,_d73){return _d71([_d73],{defaultOption:null,languages:null,currentLanguage:null,constructor:function(){this.defaultOption={label:_d72.alllanguages,value:"all"};},_setLanguagesAttr:function(_d74){this._set("languages",_d74);if(!_d74||!_d74.length){this.set("options",[]);return;}this.set("options",this._convertLanguagesToOptions(_d74));},_setCurrentLanguageAttr:function(_d75){this._set("currentLanguage",_d75);var _d76=this.languages;if(_d76&&_d76.length){this.set("options",this._convertLanguagesToOptions(_d76));}},_convertLanguagesToOptions:function(_d77){var _d78=this.value,_d79=this.currentLanguage;var _d7a=_d77.map(function(item){var _d7b=item.languageId===_d79;return {label:item.name+(_d7b?" ("+_d72.currentlanguage+")":""),value:item.languageId};});_d7a=[this.defaultOption,{}].concat(_d7a);_d7a.forEach(function(item){item.selected=item.value===_d78;});return _d7a;}});});},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(_d7c,_d7d,_d7e,_d7f,_d80,_d81,i18n,lang,has,_d82,_d83,Menu,_d84,_d85,_d86,_d87){var _d88=_d7d("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){this.inherited(arguments);var o=(this.menuTableNode=this.domNode);var n=(this.domNode=this.ownerDocument.createElement("div"));n.style.cssText="overflow-x: hidden; overflow-y: scroll";if(o.parentNode){o.parentNode.replaceChild(n,o);}_d7f.remove(o,"dijitMenuTable");n.className=o.className+" dijitSelectMenu";o.className="dijitReset dijitMenuTable";n.setAttribute("role","listbox");o.setAttribute("role","presentation");n.appendChild(o);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_d81.stop);},focus:function(){var _d89=false,val=this.parentWidget.value;if(lang.isArray(val)){val=val[val.length-1];}if(val){_d7c.forEach(this.parentWidget._getChildren(),function(_d8a){if(_d8a.option&&(val===_d8a.option.value)){_d89=true;this.focusChild(_d8a,false);}},this);}if(!_d89){this.inherited(arguments);}},resize:function(mb){if(mb){_d80.setMarginBox(this.domNode,mb);if("w" in mb){this.menuTableNode.style.width="100%";}}}});var _d8b=_d7d("dijit.form.Select",[_d82,_d83],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_d87,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var si=this.srcNodeRef.selectedIndex||0;this.value=this.options[si>=0?si:0].value;}this.dropDown=new _d88({id:this.id+"_menu",parentWidget:this});_d7f.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));},_getMenuItemForOption:function(_d8c){if(!_d8c.value&&!_d8c.label){return new _d85({ownerDocument:this.ownerDocument});}else{var _d8d=lang.hitch(this,"_setValueAttr",_d8c);var item=new _d84({option:_d8c,label:_d8c.label||this.emptyLabel,onClick:_d8d,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_d8c.disabled||false});item.focusNode.setAttribute("role","option");return item;}},_addOptionItem:function(_d8e){if(this.dropDown){this.dropDown.addChild(this._getMenuItemForOption(_d8e));}},_getChildren:function(){if(!this.dropDown){return [];}return this.dropDown.getChildren();},_loadChildren:function(_d8f){if(_d8f===true){if(this.dropDown){delete this.dropDown.focusedChild;}if(this.options.length){this.inherited(arguments);}else{_d7c.forEach(this._getChildren(),function(_d90){_d90.destroyRecursive();});var item=new _d84({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(item);}}else{this._updateSelection();}this._isLoaded=false;this._childrenLoaded=true;if(!this._loadingStore){this._setValueAttr(this.value,false);}},_refreshState:function(){if(this._started){this.validate(this.focused);}},startup:function(){this.inherited(arguments);this._refreshState();},_setValueAttr:function(_d91){this.inherited(arguments);_d7e.set(this.valueNode,"value",this.get("value"));this._refreshState();},_setDisabledAttr:function(_d92){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(_d93){this._set("required",_d93);this.focusNode.setAttribute("aria-required",_d93);this._refreshState();},_setOptionsAttr:function(_d94){this._isLoaded=false;this._set("options",_d94);},_setDisplay:function(_d95){var lbl=_d95||this.emptyLabel;this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";},validate:function(_d96){var _d97=this.disabled||this.isValid(_d96);this._set("state",_d97?"":(this._hasBeenBlurred?"Error":"Incomplete"));this.focusNode.setAttribute("aria-invalid",_d97?"false":"true");var _d98=_d97?"":this._missingMsg;if(_d98&&this.focused&&this._hasBeenBlurred){_d86.show(_d98,this.domNode,this.tooltipPosition,!this.isLeftToRight());}else{_d86.hide(this.domNode);}this._set("message",_d98);return _d97;},isValid:function(){return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));},reset:function(){this.inherited(arguments);_d86.hide(this.domNode);this._refreshState();},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_d81.stop);this.domNode.setAttribute("aria-expanded","false");},_setStyleAttr:function(_d99){this.inherited(arguments);_d7f.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);},isLoaded:function(){return this._isLoaded;},loadDropDown:function(_d9a){this._loadChildren(true);this._isLoaded=true;_d9a();},closeDropDown:function(){this.inherited(arguments);if(this.dropDown&&this.dropDown.menuTableNode){this.dropDown.menuTableNode.style.width="";}},destroy:function(_d9b){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(_d9b);delete this.dropDown;}this.inherited(arguments);},_onFocus:function(){this.validate(true);this.inherited(arguments);},_onBlur:function(){_d86.hide(this.domNode);this.inherited(arguments);this.validate(false);}});_d8b._Menu=_d88;return _d8b;});},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(_d9c,_d9d,_d9e,_d9f,_da0,dom,_da1,_da2,lang,_da3,when,_da4,_da5){var _da6=_da0("dijit.form._FormSelectWidget",_da5,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_da7){var opts=this.options||[];if(_da7==null){return opts;}if(lang.isArray(_da7)){return _d9c.map(_da7,"return this.getOptions(item);",this);}if(lang.isString(_da7)){_da7={value:_da7};}if(lang.isObject(_da7)){if(!_d9c.some(opts,function(_da8,idx){for(var a in _da7){if(!(a in _da8)||_da8[a]!=_da7[a]){return false;}}_da7=idx;return true;})){_da7=-1;}}if(_da7>=0&&_da7<opts.length){return opts[_da7];}return null;},addOption:function(_da9){_d9c.forEach(lang.isArray(_da9)?_da9:[_da9],function(i){if(i&&lang.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_daa){var _dab=this.getOptions(lang.isArray(_daa)?_daa:[_daa]);_d9c.forEach(_dab,function(_dac){if(_dac){this.options=_d9c.filter(this.options,function(node){return (node.value!==_dac.value||node.label!==_dac.label);});this._removeOptionItem(_dac);}},this);this._loadChildren();},updateOption:function(_dad){_d9c.forEach(lang.isArray(_dad)?_dad:[_dad],function(i){var _dae=this.getOptions({value:i.value}),k;if(_dae){for(k in i){_dae[k]=i[k];}}},this);this._loadChildren();},setStore:function(_daf,_db0,_db1){var _db2=this.store;_db1=_db1||{};if(_db2!==_daf){var h;while((h=this._notifyConnections.pop())){h.remove();}if(!_daf.get){lang.mixin(_daf,{_oldAPI:true,get:function(id){var _db3=new _d9d();this.fetchItemByIdentity({identity:id,onItem:function(_db4){_db3.resolve(_db4);},onError:function(_db5){_db3.reject(_db5);}});return _db3.promise;},query:function(_db6,_db7){var _db8=new _d9d(function(){if(_db9.abort){_db9.abort();}});_db8.total=new _d9d();var _db9=this.fetch(lang.mixin({query:_db6,onBegin:function(_dba){_db8.total.resolve(_dba);},onComplete:function(_dbb){_db8.resolve(_dbb);},onError:function(_dbc){_db8.reject(_dbc);}},_db7));return new _da4(_db8);}});if(_daf.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_d9e.after(_daf,"onNew",lang.hitch(this,"_onNewItem"),true),_d9e.after(_daf,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_d9e.after(_daf,"onSet",lang.hitch(this,"_onSetItem"),true)];}}this._set("store",_daf);}if(this.options&&this.options.length){this.removeOption(this.options);}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}if(_db1.query){this._set("query",_db1.query);this._set("queryOptions",_db1.queryOptions);}if(_daf){this._loadingStore=true;this.onLoadDeferred=new _d9d();this._queryRes=_daf.query(this.query,this.queryOptions);when(this._queryRes,lang.hitch(this,function(_dbd){if(this.sortByLabel&&!_db1.sort&&_dbd.length){if(_daf.getValue){_dbd.sort(_d9f.createSortFunction([{attribute:_daf.getLabelAttributes(_dbd[0])[0]}],_daf));}else{var _dbe=this.labelAttr;_dbd.sort(function(a,b){return a[_dbe]>b[_dbe]?1:b[_dbe]>a[_dbe]?-1:0;});}}if(_db1.onFetch){_dbd=_db1.onFetch.call(this,_dbd,_db1);}_d9c.forEach(_dbd,function(i){this._addOptionForItem(i);},this);if(this._queryRes.observe){this._observeHandle=this._queryRes.observe(lang.hitch(this,function(_dbf,_dc0,_dc1){if(_dc0==_dc1){this._onSetItem(_dbf);}else{if(_dc0!=-1){this._onDeleteItem(_dbf);}if(_dc1!=-1){this._onNewItem(_dbf);}}}),true);}this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:_db0);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(_dbd);}this.onLoadDeferred.resolve(true);this.onSetStore();}),function(err){console.error("dijit.form.Select: "+err.toString());this.onLoadDeferred.reject(err);});}return _db2;},_setValueAttr:function(_dc2,_dc3){if(!this._onChangeActive){_dc3=null;}if(this._loadingStore){this._pendingValue=_dc2;return;}if(_dc2==null){return;}if(lang.isArray(_dc2)){_dc2=_d9c.map(_dc2,function(_dc4){return lang.isObject(_dc4)?_dc4:{value:_dc4};});}else{if(lang.isObject(_dc2)){_dc2=[_dc2];}else{_dc2=[{value:_dc2}];}}_dc2=_d9c.filter(this.getOptions(_dc2),function(i){return i&&i.value;});var opts=this.getOptions()||[];if(!this.multiple&&(!_dc2[0]||!_dc2[0].value)&&!!opts.length){_dc2[0]=opts[0];}_d9c.forEach(opts,function(opt){opt.selected=_d9c.some(_dc2,function(v){return v.value===opt.value;});});var val=_d9c.map(_dc2,function(opt){return opt.value;});if(typeof val=="undefined"||typeof val[0]=="undefined"){return;}var disp=_d9c.map(_dc2,function(opt){return opt.label;});this._setDisplay(this.multiple?disp:disp[0]);this.inherited(arguments,[this.multiple?val:val[0],_dc3]);this._updateSelection();},_getDisplayedValueAttr:function(){var ret=_d9c.map([].concat(this.get("selectedOptions")),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_setDisplayedValueAttr:function(_dc5){this.set("value",this.getOptions(typeof _dc5=="string"?{label:_dc5}:_dc5));},_loadChildren:function(){if(this._loadingStore){return;}_d9c.forEach(this._getChildren(),function(_dc6){_dc6.destroyRecursive();});_d9c.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var val=[].concat(this.value);if(val&&val[0]){_d9c.forEach(this._getChildren(),function(_dc7){var _dc8=_d9c.some(val,function(v){return _dc7.option&&(v===_dc7.option.value);});_da1.toggle(_dc7.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_dc8);_dc7.domNode.setAttribute("aria-selected",_dc8?"true":"false");},this);}},_getValueFromOpts:function(){var opts=this.getOptions()||[];if(!this.multiple&&opts.length){var opt=_d9c.filter(opts,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{opts[0].selected=true;return opts[0].value;}}else{if(this.multiple){return _d9c.map(_d9c.filter(opts,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(item,_dc9){if(!_dc9||!_dc9.parent){this._addOptionForItem(item);}},_onDeleteItem:function(item){var _dca=this.store;this.removeOption({value:_dca.getIdentity(item)});},_onSetItem:function(item){this.updateOption(this._getOptionObjForItem(item));},_getOptionObjForItem:function(item){var _dcb=this.store,_dcc=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:_dcb.getLabel(item),_dcd=(_dcc?_dcb.getIdentity(item):null);return {value:_dcd,label:_dcc,item:item};},_addOptionForItem:function(item){var _dce=this.store;if(_dce.isItemLoaded&&!_dce.isItemLoaded(item)){_dce.loadItem({item:item,onItem:function(i){this._addOptionForItem(i);},scope:this});return;}var _dcf=this._getOptionObjForItem(item);this.addOption(_dcf);},constructor:function(_dd0){this._oValue=(_dd0||{}).value||null;this._notifyConnections=[];},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.focusNode,false);},_fillContent:function(){if(!this.options){this.options=this.srcNodeRef?_da3("> *",this.srcNodeRef).map(function(node){if(node.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:(node.getAttribute("data-"+_da2._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this._set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);_d9e.after(this,"onChange",lang.hitch(this,"_updateSelection"));var _dd1=this.store;if(_dd1&&(_dd1.getIdentity||_dd1.getFeatures()["dojo.data.api.Identity"])){this.store=null;this.setStore(_dd1,this._oValue);}},startup:function(){this._loadChildren();this.inherited(arguments);},destroy:function(){var h;while((h=this._notifyConnections.pop())){h.remove();}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}this.inherited(arguments);},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions({selected:true});},_pseudoLoadChildren:function(){},onSetStore:function(){}});return _da6;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _dd2={};lang.setObject("dojo.data.util.sorter",_dd2);_dd2.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_dd2.createSortFunction=function(_dd3,_dd4){var _dd5=[];function _dd6(attr,dir,comp,s){return function(_dd7,_dd8){var a=s.getValue(_dd7,attr);var b=s.getValue(_dd8,attr);return dir*comp(a,b);};};var _dd9;var map=_dd4.comparatorMap;var bc=_dd2.basicComparator;for(var i=0;i<_dd3.length;i++){_dd9=_dd3[i];var attr=_dd9.attribute;if(attr){var dir=(_dd9.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_dd5.push(_dd6(attr,dir,comp,_dd4));}}return function(rowA,rowB){var i=0;while(i<_dd5.length){var ret=_dd5[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _dd2;});},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","url:epi-cms/compare/template/CompareToolbar.html":"<div class=\"dijit\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\n    <span data-dojo-attach-point=\"leftVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\n        <span>${_resources.comparing}</span>\n        <span data-dojo-attach-point=\"leftVersionSelector\"></span>\n\n        <span data-dojo-attach-point=\"leftDate\"></span>\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\n        <span data-dojo-attach-point=\"leftBy\"></span>\n    </span>\n    <span data-dojo-attach-point=\"rightVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\n        <span>${_resources.with}</span>\n        <span data-dojo-attach-point=\"rightVersionSelector\"></span>\n        <span data-dojo-attach-point=\"rightDate\"></span>\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\n        <span data-dojo-attach-point=\"rightBy\"></span>\n    </span>\n    <span data-dojo-attach-point=\"messageSection\" class=\"epi-compare-toolbar__text-wrapper epi-compare-toolbar__text-wrapper--text-only\"></span>\n</div>\n","epi-cms/compare/viewmodels/CompareViewModel":function(){define(["dojo/_base/declare","dojo/aspect","dojo/topic","dojo/_base/lang","dojo/Stateful","dojo/when","epi/shell/DestroyableByKey","epi/dependency","epi-cms/core/ContentReference","epi-cms/compare/viewmodels/CompareToolbarViewModel"],function(_dda,_ddb,_ddc,lang,_ddd,when,_dde,_ddf,_de0,_de1){return _dda([_ddd,_dde],{contentLink:null,languages:null,typeIdentifier:null,leftVersion:null,rightVersion:null,leftVersionUri:null,rightVersionUrl:null,hasAccess:true,contentDataStore:null,contentVersionStore:null,orientation:"vertical",compareToolbarViewModel:null,postscript:function(){this.inherited(arguments);this.contentDataStore=this.contentDataStore||_ddf.resolve("epi.storeregistry").get("epi.cms.contentdata");this.contentVersionStore=this.contentVersionStore||_ddf.resolve("epi.storeregistry").get("epi.cms.contentversion");this._setupCompareToolbarViewModel();this.own(_ddc.subscribe("/epi/cms/content/statuschange/",lang.hitch(this,"_refresh")));},_refresh:function(){var _de2=this.contentVersionStore;when(_de2.refresh(this.leftVersion.contentLink),lang.hitch(this,function(_de3){this.set("leftVersion",_de3);}));if(this.rightVersion){when(_de2.refresh(this.rightVersion.contentLink),lang.hitch(this,function(_de4){this.set("rightVersion",_de4);}));}},_contentLinkSetter:function(_de5){this.contentLink=_de5;var _de6=this.contentVersionStore;when(_de6.get(_de5),lang.hitch(this,function(_de7){this.set("leftVersion",_de7);if(!this.rightVersion||!_de0.compareIgnoreVersion(this.leftVersion.contentLink,this.rightVersion.contentLink)){var _de8={contentLink:_de5,language:this.leftVersion.language,query:"getcompareversion"};var _de9=_de6.query(_de8);when(_de9,lang.hitch(this,function(_dea){this.set("hasAccess",true);this.set("rightVersion",_dea&&_dea.length?_dea[0]:null);}),lang.hitch(this,function(_deb){this.set("hasAccess",_deb.status!==403);this.set("rightVersion",null);}));}}));},_leftVersionSetter:function(_dec){this.leftVersion=_dec;if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.leftVersion!==_dec){this.compareToolbarViewModel.set("leftVersion",_dec);}}this.set("leftVersionUri",_dec.uri);},_rightVersionSetter:function(_ded){var _dee="removeAfter";this.rightVersion=_ded;this.destroyByKey(_dee);if(_ded){this.ownByKey(_dee,_ddb.after(this.contentVersionStore,"remove",lang.hitch(this,function(_def){if(_ded.contentLink===_def){this.set("rightVersion",null);}}),true));}if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.rightVersion!==_ded){this.compareToolbarViewModel.set("rightVersion",_ded);}}if(_ded===null){this.set("rightVersionUrl","about:blank");return;}when(this.contentDataStore.get(_ded.contentLink),lang.hitch(this,function(_df0){if(this.leftVersion===this.rightVersion){this.set("rightVersionUrl","about:blank");}this.set("rightVersionUrl",_df0.editablePreviewUrl);}));},_typeIdentifierSetter:function(_df1){this.typeIdentifier=_df1;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("typeIdentifier",_df1);}},_languagesSetter:function(_df2){this.languages=_df2;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("languages",_df2);}},_hasAccessSetter:function(_df3){this.hasAccess=_df3;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("hasAccess",_df3);}},_setupCompareToolbarViewModel:function(){this.compareToolbarViewModel=this.compareToolbarViewModel||new _de1({contentVersionStore:this.contentVersionStore,leftVersion:this.leftVersion,rightVersion:this.rightVersion,typeIdentifier:this.typeIdentifier,hasAccess:this.hasAccess,languages:this.languages});this.own(this.compareToolbarViewModel.watch("leftVersion",lang.hitch(this,function(_df4,_df5,_df6){if(this.leftVersion!==_df6){this.set("leftVersion",_df6);}})));this.own(this.compareToolbarViewModel.watch("rightVersion",lang.hitch(this,function(_df7,_df8,_df9){if(this.rightVersion!==_df9){this.set("rightVersion",_df9);}})));}});});},"epi-cms/compare/viewmodels/CompareToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","epi/dependency","epi/datetime","epi/username","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_dfa,lang,_dfb,when,_dfc,_dfd,_dfe,_dff,_e00,_e01){return _dfa([_dfb],{contentVersionStore:null,leftVersion:null,rightVersion:null,leftButtonLabel:null,rightButtonLabel:null,leftByText:null,rightByText:null,leftDateText:null,rightDateText:null,messageText:null,showsVersionSelectors:null,hasAccess:true,typeIdentifier:null,languages:null,currentLanguage:null,postscript:function(){this.inherited(arguments);var _e02=this._profile||_dfc.resolve("epi.shell.Profile");when(_e02.getContentLanguage(),lang.hitch(this,function(_e03){this.set("currentLanguage",_e03);}));},_leftVersionSetter:function(_e04){this.leftVersion=_e04;if(_e04){this.set("leftButtonLabel",this._createButtonLabel(_e04));this.set("leftByText",_dfe.toUserFriendlyString(_e04.savedBy,null,false));this.set("leftDateText",_dfd.toUserFriendlyString(_e04.savedDate));}},_rightVersionSetter:function(_e05){this.rightVersion=_e05;if(_e05){this.set("rightButtonLabel",this._createButtonLabel(_e05));this.set("rightByText",_dfe.toUserFriendlyString(_e05.savedBy,null,false));this.set("rightDateText",_dfd.toUserFriendlyString(_e05.savedDate));}this.set("showsVersionSelectors",_e05!==null);},_typeIdentifierSetter:function(_e06){this.typeIdentifier=_e06;this._updateMessageText();},_hasAccessSetter:function(_e07){this.hasAccess=_e07;this._updateMessageText();},_updateMessageText:function(){this.set("messageText",this.hasAccess?_dff.getResourceValue(this.typeIdentifier,"compare.onlyoneversion"):_e01.insufficientpermission);},_createButtonLabel:function(_e08){var _e09=_e08.language?" ("+_e08.language+")":"";var _e0a=_e00.getVersionStatus(_e08.status);return _e0a+_e09;}});});},"epi-cms/compare/views/SideBySideCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/shell/widget/Iframe","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/OnPageEditing"],function(_e0b,lang,_e0c,_e0d,_e0e,_e0f){return _e0b([_e0f,_e0e],{createOverlays:true,modelBindingMap:{rightVersionUrl:["rightVersionUrl"]},_rightIframe:null,buildRendering:function(){this.inherited(arguments);this._setupComparePanes();},destroy:function(){this._removeAndDestroyComparePanes();this.inherited(arguments);},_setRightVersionUrlAttr:function(url){if(url){this._rightIframe.load(url);}},_setupComparePanes:function(){var _e10=this.model.orientation;this._rightIframe=new _e0d({region:_e10==="vertical"?"right":"bottom",layoutPriority:100,style:_e10==="vertical"?"width: 50%;":"height: 50%",splitter:true,"class":"epi-iframe--overflow epi-editorViewport"});this.own(this._rightIframe.on("load",lang.hitch(this,this._onRightIframeLoad)));this.mainLayoutContainer.addChild(this._rightIframe);},_onRightIframeLoad:function(url,_e11){if(!!url&&!_e11&&url!==this.model.rightVersionUrl){_e0c.publish("/epi/shell/context/request",{url:url},{sender:this,forceContextChange:true,suppressFailure:true});}},_removeAndDestroyComparePanes:function(){if(this._rightIframe){this.mainLayoutContainer.removeChild(this._rightIframe);this._rightIframe.destroyRecursive();this._rightIframe=null;}}});});},"epi-cms/contentediting/OnPageEditing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/when","dojo/topic","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_e12,lang,_e13,on,when,_e14,_e15,_e16,_e17,_e18){return _e12([_e18,_e16,_e17],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_e19,_e1a){return _e1a.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_e1b){if(_e1b&&_e1b.editorWidget){var _e1c=_e1b.editorWidget;if(_e1c.onFieldCreated){var _e1d=_e13.after(_e1c,"onFieldCreated",lang.hitch(this,function(_e1e,_e1f){_e1d.remove();_e1d=null;this._addStateWatch(_e1f);}),true);}else{_e1c.set("name",_e1b.get("propertyName"));this._addStateWatch(_e1c);}_e1c.validate&&_e1c.validate();}},onSetActiveProperty:function(_e20){var _e21=this._mappingManager.findOne("propertyName",_e20);if(!_e21){_e14.publish("/epi/cms/action/switcheditmode",null,{activePropertyOnStartup:_e20});}else{if(_e21.wrapper){_e21.wrapper.startEdit();}else{if(_e21.overlayItem){this._onOverlayItemClick(_e21.overlayItem);}}}},_onOverlayItemClick:function(_e22,e){var _e23=this._activeEditorWrapper;var _e24=this._mappingManager.find().filter(function(item){return (item.overlayItem&&item.wrapper);}).map(function(item){return item.wrapper;});if(_e24.length>0){_e24.forEach(function(item){item.tryToStopEditing();});var _e25=_e24.some(function(item){return (item.editing);});if(_e25||(_e23&&_e22.name===_e23.overlayItem.name)){return;}}this.inherited(arguments);},onReadySetupEditMode:function(){this.inherited(arguments);var self=this,_e26=function(){var _e27=self._activeEditorWrapper;if(_e27&&_e27.closeOnViewportClick){_e27.tryToStopEditing(false);}};this.own(on(this._form,"mousedown",_e26),on(this.iframeWithOverlay.iframe,"mousedown",_e26));},placeForm:function(form){form.set("fitContainer",false);form.set("transitionMode","slideIn");this.editLayoutContainer.addChild(form,0);this._setupPullDownGesture(form);},_setupPullDownGesture:function(form){var _e28=this;this._pullDownGesture=_e15(_e28.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;when(_e28.editLayoutContainer.selectChild(form),lang.hitch(this,function(){this.isShown=true;_e28.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=false;_e28.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;when(_e28.editLayoutContainer.selectChild(_e28.iframeWithOverlay),lang.hitch(this,function(){this.isShown=false;_e28.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=true;_e28.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(form.domNode);if(_e28.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _e29=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_e29=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_e29&&_e29.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while((c=this._iframeConnects.pop())){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},_destroyOverlay:function(){this.inherited(arguments);this._removeViewModelWatches();},removeForm:function(form){this._removePullDownGesture();this.editLayoutContainer.leftOver=form;return false;}});});},"epi/shell/gesture/ScrollPullDown":function(){define("epi/shell/gesture/ScrollPullDown",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/mouse","dojo/on","dijit/Destroyable"],function(_e2a,_e2b,lang,_e2c,on,_e2d){return _e2a([_e2d],{_delegate:null,_scrollTarget:null,_isScrolling:false,_pullDownInertia:100,_ts:null,_tb:null,destroy:function(){this._delegate=null;},constructor:function(_e2e,_e2f){this._delegate=_e2f;this._scrollTarget=_e2e;this.addMouseWheelListener(_e2e);},addMouseWheelListener:function(_e30){if(_e30){return this.own(on(_e30,_e2c.wheel,lang.hitch(this,this._onMouseWheel)))[0];}},_blockShowEvent:function(){if(this._scrollTarget.scrollTop>0){this._isScrolling=true;}this._ts&&clearTimeout(this._ts);this._ts=setTimeout(lang.hitch(this,function(){this._isScrolling=false;}),this._pullDownInertia);return this._isScrolling;},_initiateScrollBlock:function(){this._scrollBlock=true;},_blockScrollEvent:function(){this._tb&&clearTimeout(this._tb);this._tb=setTimeout(lang.hitch(this,function(){this._scrollBlock=false;}),this._pullDownInertia);return (this._delegate.isShown==null)||this._scrollBlock;},_raiseShow:function(evt){if(this._delegate.isShown===false){_e2b.stop(evt);this._delegate.show();this._initiateScrollBlock();}},_raiseHide:function(evt){if(this._delegate.isShown===true){_e2b.stop(evt);this._delegate.hide();this._initiateScrollBlock();}},_onMouseWheel:function(evt){if(!evt.wheelDelta){this._blockScrollEvent();return;}if(this._blockScrollEvent()){_e2b.stop(evt);return;}if(evt.wheelDelta<0||(this._delegate.isShown&&this._scrollTarget.scrollTop>0)){this._raiseHide(evt);}else{if(!this._blockShowEvent()){this._raiseShow(evt);}}}});});},"epi-cms/contentediting/_FormEditingMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi-cms/contentediting/SideBySideEditorWrapper","epi/shell/widget/FormContainer"],function(_e31,_e32,lang,_e33,when,_e34,_e35){return _e32(null,{_form:null,_formWidgets:null,canHandleLeftOver:true,selectFormOnCreation:false,formSettings:null,connectOverlayItemsToFormWidgets:false,_formConnects:null,destroy:function(){this._removeAndDestroyForm();this._formWidgets=null;this.inherited(arguments);},_removeAndDestroyForm:function(){if(this._form){if(this.removeForm(this._form)){this._form.destroyRecursive();this._form=null;}var _e36;while((_e36=this._formConnects.pop())){this.disconnect(_e36);_e36=null;}this._formConnects=null;this._form=null;}for(var p in this._formWidgets){this._formWidgets[p]=null;}},_setupForm:function(){var _e37=new _e33();this._formWidgets={};this._form=this._createForm();this._formConnects=[this.connect(this._form,"onFieldCreated",this.onFieldCreated),this.connect(this._form,"onGroupCreated",this.onGroupCreated),this.connect(this._form,"onFormCreated",function(){_e37.resolve();})];this.placeForm(this._form);when(_e37,lang.hitch(this,function(){this._finishFormCreation();}));},_createForm:function(){return new _e35(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,baseClass:"epi-cmsEditingForm",useDefaultValue:false},this.formSettings));},_createFormEditorWrappers:function(){for(var _e38 in this._formWidgets){var _e39={name:_e38,metadata:this.viewModel.getPropertyMetaData(_e38)};var _e3a=lang.clone(this.viewModel.getProperty(_e39.name));var _e3b=new _e34({property:_e39,propertyName:_e38,value:_e3a,editorWidget:this._formWidgets[_e38],contentModel:this.viewModel.contentModel,operation:this.viewModel._operation});_e3b.editorWidget.set("parent",_e3b);_e3b.editorWidget.set("editMode","formedit");this.connect(_e3b,"onValueChange","_onWrapperValueChange");this.connect(_e3b,"onCancel","_onWrapperCancel");this.connect(_e3b,"onStopEdit","_onWrapperStopEdit");this._createMapping(_e38,_e3b);_e39=null;_e3a=null;_e3b=null;}},_createMapping:function(_e3c,_e3d){var _e3e=_e3c.split(".");var _e3f=false;if(this.connectOverlayItemsToFormWidgets){while(_e3e.length>0){var _e40=_e3e.join(".");var _e41=this._mappingManager.find("propertyName",_e40);_e31.forEach(_e41,function(_e42){_e3f=true;_e42.propertyName=_e3c;_e42.wrapper=_e42.wrapper||_e3d;});_e3e.pop();}}if(!_e3f){this._mappingManager.add({propertyName:_e3c,wrapper:_e3d});}},onSetActiveProperty:function(_e43){var _e44=this._mappingManager.find("propertyName",_e43).filter(function(_e45){return !!_e45.wrapper;})[0];if(_e44){_e44.wrapper.startEdit();}},placeForm:function(form){},removeForm:function(form){},onFieldCreated:function(_e46,_e47){this._formWidgets[_e46]=_e47;if(this._addStateWatch){this._addStateWatch(_e47);}},onGroupCreated:function(_e48,_e49,_e4a){if(_e49.contentViewModel!==undefined){_e49.set("contentViewModel",this.viewModel);}},_finishFormCreation:function(){when(this.selectFormOnCreation?this.editLayoutContainer.selectChild(this._form):null,lang.hitch(this,this._removeLeftOver));this.toolbar.setItemProperty("editmodeswitch","state","");this._createFormEditorWrappers(this._form);this.onSetupEditModeComplete();},_removeLeftOver:function(){var _e4b=this.editLayoutContainer,_e4c;if(_e4b.leftOver){_e4c=_e4b.selectedChildWidget===_e4b.leftOver;when(_e4c?_e4b.selectChild(this.iframeWithOverlay):null,function(){var _e4d=_e4b.leftOver;if(_e4d){_e4b.removeChild(_e4d);_e4d.destroyRecursive();_e4b=_e4b.leftOver=null;}});}},onReadySetupEditMode:function(){this.inherited(arguments);this._removeAndDestroyForm();this._setupForm();},remapEditMode:function(){this.inherited(arguments);this._form&&this._form.set("readOnly",!this.viewModel.canChangeContent());}});});},"epi-cms/contentediting/SideBySideEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/window","epi-cms/contentediting/_EditorWrapperBase"],function(_e4e,lang,_e4f,_e50){return _e4e([_e50],{_grabFocusOnStartEdit:true,postCreate:function(){this.inherited(arguments);if(this.editorWidget){this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onFocus",lang.hitch(this,function(){this._tryToStartEditing(false);}));this.connect(this.editorWidget,"onBlur",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this.tryToStopEditing(true);}),0);}));this.connect(this.editorWidget,"onDropping",lang.hitch(this,function(){this._tryToStartEditing(true);}));}},contentModelChanged:function(name,_e51,_e52){this.set("value",_e52);},_tryToStartEditing:function(_e53){if(this.editing){return;}this._grabFocusOnStartEdit=_e53;this.startEdit();this._grabFocusOnStartEdit=true;},_onChange:function(val){if(this._preventChangeEvent){return;}var _e54=this.editing;if(this.operation&&this.operation.inProgress&&!this.editing){this.editing=true;this._lastSavedValue=this._resetValue=this.value;}this.inherited(arguments);this.editing=_e54;},_setValueAttr:function(_e55){this._preventChangeEvent=true;this.inherited(arguments);this._preventChangeEvent=false;},startEdit:function(){if(this._grabFocusOnStartEdit){this.editorWidget.focus();_e4f.scrollIntoView(this.editorWidget.domNode);}this.inherited(arguments);},stopEdit:function(_e56){this.set("value",this.getEditorValue());this.inherited(arguments);}});});},"epi-cms/contentediting/_EditorWrapperBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/keys","dijit/_Widget","dijit/form/_TextBoxMixin","epi/epi"],function(_e57,lang,_e58,keys,_e59,_e5a,epi){return _e57([_e59],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,closeOnViewportClick:true,onStartEdit:function(_e5b,data){},onValueChange:function(_e5c,_e5d,_e5e){},onCancel:function(_e5f){},onStopEdit:function(_e60,_e61,_e62){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,lang.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.remove();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(name,_e63,_e64){if(!this.editing){this.set("value",_e64);}},startEdit:function(_e65){this._startEdit(_e65);},_startEdit:function(_e66){lang.mixin(this.editorParams,_e66);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=lang.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_e67){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_e67);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=lang.clone(val);},hasBeenEdited:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_e68){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_e68);}else{this.cancel(_e68);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){this.set("editing",false);this._removeEditingFeatures();},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===keys.ESCAPE){_e58.stop(e);this.cancel();}else{if(e.keyCode===keys.ENTER&&e.target.tagName==="INPUT"){_e58.stop(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(!this.editing&&ew&&!epi.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(_e69){this.setEditorValue(_e69);this._set("value",this.getEditorValue()||_e69);},_setBlockDisplayNodeAttr:function(node){this.blockDisplayNode=null;this._set("blockDisplayNode",node);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(lang.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName==="INPUT"){_e5a.selectInputText(this.editorWidget.focusNode);}}),0);}});});},"epi-cms/contentediting/_ValidationMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(_e6a,_e6b,lang){return _e6b(null,{_watchHandles:null,constructor:function(){this._watchHandles=[];},destroy:function(){this._removeViewModelWatches();this.inherited(arguments);},_removeViewModelWatches:function(){_e6a.forEach(this._watchHandles,function(_e6c){_e6c.remove();});this._watchHandles=[];},_addStateWatch:function(_e6d){var _e6e=_e6d.get("name"),_e6f=this.viewModel;var _e70=function(){var _e71=_e6d.get("state");if(_e71!=="Error"){_e6f.validator.clearPropertyErrors(_e6e,_e6f.validator.validationSource.client);}else{if(_e71==="Error"){var _e72=_e6d.get("message")||_e6d.getErrorMessage()||"";_e6f.validator.setPropertyErrors(_e6e,[{severity:_e6f.validator.severity.error,errorMessage:_e72}],_e6f.validator.validationSource.client);}}};this._watchHandles.push(_e6d.watch("state",_e70));this._watchHandles.push(_e6d.watch("message",_e70));}});});},"epi-cms/contentediting/EditingBase":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/_base/json","dojo/_base/lang","dojo/aspect","dojo/date/stamp","dojo/dom-attr","dojo/query","dojo/topic","dojo/when","epi/dependency","epi/datetime","epi/string","epi/shell/DestroyableByKey","epi-cms/contentediting/_View","epi-cms/contentediting/AutoSaveButton","epi-cms/contentediting/MappingManager","epi-cms/contentediting/RenderManager","epi-cms/contentediting/UpdateController","epi-cms/widget/overlay/overlayFactory","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_e73,_e74,_e75,_e76,_e77,json,lang,_e78,date,_e79,_e7a,_e7b,when,_e7c,_e7d,_e7e,_e7f,_e80,_e81,_e82,_e83,_e84,_e85,res){return _e75([_e80,_e7f],{toolbar:null,editorFactory:null,activePropertyOnStartup:null,createOverlays:true,_renderManager:null,_mappingManager:null,_activeEditorWrapper:null,_autoSaveButton:null,_deferredReloadHandle:null,_eventHandlers:null,_isCreatingWrapper:null,constructor:function(){this.defaultQueryParameters={epieditmode:true};},postMixInProperties:function(){this.inherited(arguments);this.editorFactory=this.editorFactory||_e7c.resolve("epi.cms.contentediting.EditorFactory");this._mappingManager=new _e82();this._eventHandlers=[];},postCreate:function(){this.inherited(arguments);this.subscribe("/epi/cms/action/disableundoredoactions",this._toggleUndoRedoActions);},destroy:function(){this._stopActiveEditorWrapper();if(this._renderManager){this._renderManager.destroy();}if(this._autoSaveButton){this._autoSaveButton.destroyRecursive();}this._mappingManager.clear();if(this.toolbar){this.toolbar=null;}this.overlay.destroyDescendants();this.inherited(arguments);},_setCommandEnabled:function(_e86,_e87){if(this.toolbar){this.toolbar.setItemProperty(_e86,"disabled",!_e87);}},onContentLinkSyncChange:function(){this.inherited(arguments);this._setButtonState();},onReloadRequired:function(){this.inherited(arguments);setTimeout(function(){this._renderManager.suspend();this._renderManager.clear();}.bind(this),0);},_setViewModelAttr:function(_e88){if(_e88===this.viewModel){return;}this.inherited(arguments);this.destroyByKey("viewModel");this.ownByKey("viewModel",_e74.connect(this.viewModel,"onContentChange",this,this._stopActiveEditorWrapper));this.ownByKey("viewModel",_e74.connect(this.viewModel,"onSetActiveProperty",this,this.onSetActiveProperty));this.ownByKey("viewModel",_e74.connect(this.viewModel,"onPropertyReverted",this,this._onPropertyReverted));this.ownByKey("viewModel",_e7b.subscribe("/dnd/start",lang.hitch(this.viewModel,"beginOperation")));this.ownByKey("viewModel",_e7b.subscribe("/dnd/stop",lang.hitch(this,function(){if(this._activeEditorWrapper){return;}this.viewModel.endOperation();})));},_stopActiveEditorWrapper:function(){if(this._activeEditorWrapper!=null){when(this._activeEditorWrapper.tryToStopEditing(),lang.hitch(this,function(){this._activeEditorWrapper=null;}));}},onSetActiveProperty:function(_e89){},onPreviewReady:function(_e8a,doc,_e8b){if(_e8b||_e8a!==this.viewModel){this.set("viewModel",_e8a);this.setupEditMode(doc);}else{if(_e8a){this.remapEditMode(doc);}}},_setButtonState:function(){this._setCommandEnabled("reverttopublished",this.viewModel&&!this.viewModel.contentData.isPendingPublish);},setupEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._mappingManager.clear();if(this._renderManager){this._renderManager.destroy();}this._renderManager=new _e83();if(this.toolbar&&!this._autoSaveButton){this._autoSaveButton=new _e81({button:this.toolbar._getWidget("autosave")});this.own(_e78.after(this._autoSaveButton,"onLayoutChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();})));}this._autoSaveButton.set("model",this.viewModel);var _e8c=lang.hitch(this,function(){this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);});this.viewModel.resetNotifications();this._destroyOverlay();this.ownByKey("viewModel",this.viewModel.watch("hasUndoSteps",_e8c),this.viewModel.watch("hasRedoSteps",_e8c));_e8c();this.onReadySetupEditMode(doc);doc=null;this._setButtonState();this.onPrepareOverlayComplete();}));},remapEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._renderManager.resume();if(doc){setTimeout(lang.hitch(this,function(){this._remapUpdateControllers(doc);this.onPrepareOverlayComplete();this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);this._autoSaveButton.set("model",this.viewModel);}),1);}}));},_destroyOverlay:function(){this.destroyByKey("overlay");},onReadySetupEditMode:function(doc){this._createUpdateControllers(doc);},onSetupEditModeComplete:function(){if(this.activePropertyOnStartup){this.onSetActiveProperty(this.activePropertyOnStartup);this.activePropertyOnStartup=null;}},_getPropertyNodes:function(doc){var _e8d=_e7a("[data-epi-property-name]",doc);var _e8e=_e7a("[data-epi-property-name] [data-epi-property-name]",doc);return _e73.filter(_e8d,function(node){return _e8e.indexOf(node)===-1;});},_getEditableNodes:function(doc){if(!doc||!this.viewModel.canChangeContent()){return [];}var _e8f=this._getPropertyNodes(doc);var _e90=[];_e73.forEach(_e8f,function(node){var _e91=_e7e.pascalToCamel(_e79.get(node,"data-epi-property-name"));var _e92=this.viewModel.getPropertyMetaData(_e91);if(!_e92){return;}if(_e92.settings&&_e92.settings.readOnly){return;}var _e93=_e7e.pascalToCamel(_e92.getName());var _e94=_e79.get(node,"data-epi-property-display-name");if(_e94){_e92=lang.delegate(_e92,{displayName:_e94});}if(_e92!=null&&_e92.showForEdit){var _e95={cacheResults:true,rerenderOnCancel:false,propertyRenderSettings:_e79.get(node,"data-epi-property-rendersettings")||undefined,useMvc:_e79.has(node,"data-epi-use-mvc")?_e79.get(node,"data-epi-use-mvc").toLowerCase()==="true":false};_e95=lang.mixin(_e95,_e92.additionalValues.renderSettings);var _e96=_e79.has(node,"data-epi-property-editorsettings")?json.fromJson(_e79.get(node,"data-epi-property-editorsettings")):null;var _e97=_e79.has(node,"data-epi-property-overlaysettings")?json.fromJson(_e79.get(node,"data-epi-property-overlaysettings")):null;_e97=lang.mixin(_e97,_e92.overlaySettings);_e90.push({node:node,disabled:(_e79.get(node,"data-epi-disabled")==="true"),useOverlay:(_e79.get(node,"data-epi-useoverlay")==="true"),overlayZIndex:parseInt(_e79.get(node,"data-epi-overlay-z-index"),10)||0,property:{name:_e93,contentLink:this.viewModel.contentLink,contentModel:this.viewModel.contentModel,type:_e79.get(node,"data-epi-property-type"),wrapperType:_e79.get(node,"data-epi-property-edittype"),editorParams:_e96,overlayParams:_e97,editorWidgetType:_e79.get(node,"data-epi-property-editor"),renderSettings:_e95,rendererClass:(_e79.get(node,"data-epi-property-render")==="client")?"epi-cms/contentediting/ClientRenderer":_e92.customEditorSettings.rendererClass,metadata:_e92,propertyNodeName:_e91}});}},this);_e90.sort(function(a,b){if(a.overlayZIndex<b.overlayZIndex){return -1;}else{if(a.overlayZIndex>b.overlayZIndex){return 1;}else{return 0;}}});return _e90;},_createUpdateControllers:function(doc){var _e98=this._createFullPageUpdateController(doc);if(_e98){this._connectUpdateControllerAndOverlayEvents(_e98,null);this._mappingManager.add({updateController:_e98});}var _e99=this._getEditableNodes(doc);_e73.forEach(_e99,function(_e9a){var _e9b=_e9a.property;var _e9c=_e9a.node.innerHTML;var _e9d=this._createNodeUpdateController(_e9a);when(this._createNodeOverlay(_e9a),lang.hitch(this,function(_e9e){this._connectUpdateControllerAndOverlayEvents(_e9d,_e9e);this._mappingManager.add({blockPropertyInfo:_e9b,node:_e9a.node,updateController:_e9d,overlayItem:_e9e});}));this._renderManager.cacheRender(_e9b.name,_e9b.renderSettings,this.viewModel.getProperty(_e9b.name),_e9c);},this);},_createNodeOverlay:function(_e9f){var _ea0=new _e76();if(!this.createOverlays){_ea0.resolve(null);return _ea0;}when(_e85.create(_e9f),lang.hitch(this,function(_ea1){this.overlay.addChild(_ea1);_ea0.resolve(_ea1);}));return _ea0;},_createNodeUpdateController:function(_ea2){var _ea3=_ea2.property;var _ea4=_ea3.metadata;var _ea5=new _e84({displayName:_ea4.displayName,renderManager:this._renderManager,contentModel:_ea3.contentModel,contentLink:_ea3.contentLink,modelPropertyName:_ea3.name,nodePropertyName:_ea3.propertyNodeName,renderSettings:_ea3.renderSettings,rendererClass:_ea3.rendererClass,displayNode:_ea2.node});return _ea5;},_createFullPageUpdateController:function(doc){var _ea6=[];if(doc){var _ea7=_e7a("input[data-epi-full-refresh-property-names][type='hidden']",doc);_e73.forEach(_ea7,function(tag){_e73.forEach(_e79.get(tag,"data-epi-full-refresh-property-names").split(","),function(_ea8){if(!_e73.some(_ea6,function(p){return p===_ea8;})){_ea6.push(_e7e.pascalToCamel(_ea8));}});});}_e73.forEach(this.viewModel.metadata.properties,function(_ea9){if(_ea9.additionalValues["reloadOnChange"]===true){_ea6.push(_e7e.pascalToCamel(_ea9.name));}});if(!_ea6.length){return null;}var _eaa=new _e84({displayName:"",renderManager:this._renderManager,contentModel:this.viewModel.contentModel,modelPropertyName:_ea6,renderSettings:{isFullReload:true}});return _eaa;},_remapUpdateControllers:function(doc){var _eab=this._getEditableNodes(doc);var _eac=this._mappingManager.remap(_eab);_e73.forEach(_eac,function(_ead){var _eae=_ead.property;var _eaf=this._createNodeUpdateController(_ead);var _eb0=this._mappingManager.find(function(m){return (!m.updateController)&&(m.propertyName.indexOf(_eae.name)===0);});when(this._createNodeOverlay(_ead),lang.hitch(this,function(_eb1){this._connectUpdateControllerAndOverlayEvents(_eaf,_eb1);if(_eb0&&_eb0.length){this._mappingManager.update(_eb0[0],{updateController:_eaf,overlayItem:_eb1,node:_ead.node,wrapper:null});}else{this._mappingManager.add({blockPropertyInfo:_eae,node:_ead.node,updateController:_eaf,overlayItem:_eb1});}}));this._renderManager.cacheRender(_eae.name,_eae.renderSettings,this.viewModel.getProperty(_eae.name),_ead.node.innerHTML);},this);var _eb2=this._createFullPageUpdateController(doc);if(_eb2){this._connectUpdateControllerAndOverlayEvents(_eb2,null);this._mappingManager.add({updateController:_eb2});}},_connectUpdateControllerAndOverlayEvents:function(_eb3,_eb4){if(_eb3){this.ownByKey("overlay",_e78.after(_eb3,"onReloadRequired",lang.hitch(this,this._onBlockReloadRequired),true),_e78.after(_eb3,"onRender",lang.hitch(this,this._onBlockRender),true));}if(_eb4){this.ownByKey("overlay",_e78.after(_eb4,"onClick",lang.hitch(this,this._onOverlayItemClick),true),_e78.after(_eb4,"onValueChange",lang.hitch(this,function(_eb5){this._onOverlayValueChange(_eb4,_eb5);}),true));}},_getEditor:function(_eb6){var _eb7=this._mappingManager.findOne("overlayItem",_eb6);return (_eb7.wrapper&&_eb7.wrapper.editorWidget)?_eb7.wrapper.editorWidget:null;},onEditorWrapperCreated:function(_eb8){},_onOverlayItemClick:function(_eb9){if(this._isCreatingWrapper){return;}this._isCreatingWrapper=true;var _eba=this._mappingManager.findOne("overlayItem",_eb9);var _ebb=_eba.blockPropertyInfo;var val=this.viewModel.getProperty(_eba.propertyName);var _ebc=lang.clone(val,true);var _ebd;var _ebe=lang.hitch(this,function(_ebf){_eba.wrapper=_ebf;this._activeEditorWrapper=_ebf;_e7b.publish("/epi/layout/pinnable/propertyEditor/show",null);_e73.forEach(this._mappingManager.find(),function(m){if(m.overlayItem){m.overlayItem.set("active",false);}});_eba.overlayItem.set("active",true);var _ec0={value:_ebc,parent:_ebf};when(_ebf.startEdit(_ec0)).always(lang.hitch(this,function(){this._isCreatingWrapper=null;}));this.overlay.set("readOnly",_ebf.isOverlayDisabled);this.viewModel.set("disableUndo",_ebf.isUndoDisabled);});if(_eba.wrapper){_ebd=_eba.wrapper;if(_ebd&&_ebd.editorWidget&&!_ebd.editorWidget.overlayItem){_ebd.editorWidget.overlayItem=_eb9;}_ebd.set("blockDisplayNode",_eba.node);_ebe(_ebd);}else{when(this._createEditorWrapper(_ebb,_eb9,_eba.node,_ebc),lang.hitch(this,function(_ec1){_ebe(_ec1);this.onEditorWrapperCreated(_ec1);}));}},_createEditorWrapper:function(_ec2,_ec3,node,_ec4){var def=new _e76(),_ec5={overlayItem:_ec3};when(this.editorFactory.createEditor(_ec2,node,_ec4,_ec5),lang.hitch(this,function(_ec6){this.ownByKey("overlay",_e78.after(_ec6,"onValueChange",lang.hitch(this,this._onWrapperValueChange),true),_e78.after(_ec6,"onCancel",lang.hitch(this,this._onWrapperCancel),true),_e78.after(_ec6,"onStopEdit",lang.hitch(this,this._onWrapperStopEdit),true));def.resolve(_ec6);}),def.reject);return def;},_onBlockReloadRequired:function(_ec7){var _ec8=function(){if(this._activeEditorWrapper&&this._activeEditorWrapper.hasInlineEditor){return;}if(this._deferredReloadHandle){this._deferredReloadHandle.remove();this._deferredReloadHandle=null;}this._toggleUndoRedoActions(false,false);this.onReloadRequired();}.bind(this);if(this.viewModel.isSaved){_ec8();}else{if(!this._deferredReloadHandle){this.own(this._deferredReloadHandle=_e78.after(this.viewModel,"onPropertySaved",_ec8,true));}}},_onBlockRender:function(_ec9){var _eca=this._mappingManager.findOne("updateController",_ec9);if(_eca&&_eca.overlayItem){_eca.overlayItem.refresh();}},_saveEditorChanges:function(_ecb,data){var _ecc=this._getEditor(_ecb);if(_ecc&&!_ecc.overlayItem){_ecc.overlayItem=_ecb;}if(_ecc&&_ecc.saveChanges){_ecc.saveChanges(_ecc,data);}},_onOverlayValueChange:function(_ecd,data){this._saveEditorChanges(_ecd,data.value);this.viewModel.setProperty(data.propertyName,data.value);},_onWrapperValueChange:function(_ece,_ecf,_ed0){var _ed1=this._mappingManager.findOne("wrapper",_ece),_ed2=_ed1.propertyName;if(_ed1.overlayItem){_ed1.overlayItem.set("updated",true);}this.viewModel.beginOperation();this.viewModel.setProperty(_ed2,_ecf,_ed0);},_onWrapperStopEdit:function(_ed3,_ed4,_ed5,_ed6){var _ed7=this._mappingManager.findOne("wrapper",_ed3);this.viewModel.endOperation();if(_ed7.overlayItem){_ed7.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onWrapperCancel:function(_ed8,_ed9){var _eda=this._mappingManager.findOne("wrapper",_ed8),_edb=_eda.updateController;this.viewModel.abortOperation();if(_edb&&_edb.renderSettings&&_edb.renderSettings.rerenderOnCancel){_edb.render();}if(_eda.overlayItem){_eda.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onPropertyReverted:function(_edc,_edd){this._mappingManager.find("propertyName",_edc).forEach(function(_ede){var _edf=_ede.wrapper,_ee0;if(_edf){_ee0=_edf.get("editing");_edf.set("editing",false);_edf.set("value",_edd);_edf.set("editing",_ee0);}});},_toggleUndoRedoActions:function(_ee1,_ee2){this._setCommandEnabled("undo",!!_ee1);this._setCommandEnabled("redo",!!_ee2);}});});},"epi-cms/contentediting/_View":function(){define(["dojo/_base/declare","dijit/_Widget"],function(_ee3,_ee4){return _ee3([_ee4],{iframeWithOverlay:null,overlay:null,iFrame:null,layoutContainer:null,contextTypeName:null,viewModel:null,postMixInProperties:function(){this.inherited(arguments);if(this.iframeWithOverlay){this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;}this._viewConnections=[];},_setViewModelAttr:function(_ee5){this._set("viewModel",_ee5);},_setIframeWithOverlayAttr:function(_ee6){this._set("iframeWithOverlay",_ee6);this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;},onPreviewReady:function(_ee7,doc){this.set("viewModel",_ee7);this.onPrepareOverlayComplete();},onPrepareOverlayComplete:function(){},onContentLinkSyncChange:function(_ee8,_ee9){},onReloadRequired:function(){}});});},"epi-cms/contentediting/AutoSaveButton":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.autosave"],function(_eea,_eeb,_eec,lang,_eed,_eee,_eef,_ef0,_ef1,res){var _ef2={Saving:0,Offline:1,Saved:2};return _eec([_ef0],{_state:null,button:undefined,lastSaved:undefined,model:null,_currentlySavingClass:"epi-autosave-saving",_errorClass:"epi-autosave-error",_savedClass:"epi-autosave-saved",_hoverClass:"epi-autosave-hover",_modelHandles:null,postMixInProperties:function(){this.inherited(arguments);this._modelHandles=[];},postCreate:function(){this.inherited(arguments);if(!this.button){return;}this.connect(this.button.domNode,"onmouseover",this._addHoverClass);this.connect(this.button.domNode,"onmouseout",this._removeHoverClass);},destroy:function(){_eea.forEach(this._modelHandles,function(_ef3){_ef3.unwatch();});this.inherited(arguments);},_setModelAttr:function(_ef4){_eea.forEach(this._modelHandles,function(_ef5){_ef5.unwatch();});this._set("model",_ef4);if(_ef4){this._modelHandles=[_ef4.watch("isOnline",lang.hitch(this,"_isOnlineChanged")),_ef4.watch("lastSaved",lang.hitch(this,"_lastSavedChanged")),_ef4.watch("isSaved",lang.hitch(this,"_isSavedChanged")),_ef4.watch("isSaving",lang.hitch(this,"_isSavingChanged")),_ef4.watch("hasErrors",lang.hitch(this,"_hasErrorsChanged")),_ef4.watch("disableUndo",lang.hitch(this,this._disableUndo))];this.set("lastSaved",_ef4.lastSaved);if(this.lastSaved){this.updateButton();}else{this._setVisibility(false);}}},_setLastSavedAttr:function(_ef6){this._set("lastSaved",_ef6);this.updateLastSaveTime();},_disableUndo:function(_ef7,_ef8,_ef9){this._isUndoDisabled=_ef9;this.updateButton();},_isOnlineChanged:function(name,_efa,_efb){if(_efb===_efa){return;}if(_efb){this.revertToLastAutoSaveTime();}else{this.showOfflineStatus();}},_lastSavedChanged:function(name,_efc,_efd){this.set("lastSaved",_efd);},_isSavedChanged:function(name,_efe,_eff){if(_eff){this.updateLastSaveTime();}},_isSavingChanged:function(name,_f00,_f01){if(_f01){this.showSavingStatus();}else{if(!this.model.isSaved){this.revertToLastAutoSaveTime();}}},_hasErrorsChanged:function(name,_f02,_f03){if(_f02===_f03){return;}if(!_f03){this.revertToLastAutoSaveTime();}else{_eeb.publish("/epi/cms/action/showerror");}},_animateSaving:function(){_eed.replace(this.button.domNode,this._currentlySavingClass,[this._errorClass,this._savedClass]);this._removeHoverClass();},_animateOffline:function(){_eed.replace(this.button.domNode,this._errorClass,[this._currentlySavingClass,this._savedClass]);this._removeHoverClass();},_animateSaved:function(){_eed.replace(this.button.domNode,this._savedClass,[this._currentlySavingClass,this._errorClass]);this._removeHoverClass();},_addHoverClass:function(){if(this._state==null||this._state===_ef2.Saving||this._hasDropDownOpen()){return;}if(this._state===_ef2.Saved){_eed.add(this.button.domNode,this._hoverClass);}},_removeHoverClass:function(){if(!this._hasDropDownOpen()){_eed.remove(this.button.domNode,this._hoverClass);}},_updateState:function(text){this.button.set("label",text);this.button.set("disabled",this._isUndoDisabled||this._state!==_ef2.Saved);},_setVisibility:function(_f04){if(_f04!==this._visible){this._visible=_f04;if(this.button){_eee.set(this.button.domNode,{display:_f04?"":"none"});this.button.set("itemVisibility",_f04&&!this.button.disabled);if(this.button.isInNarrowToolbar){this.onLayoutChanged();}}}},onLayoutChanged:function(){},_hasDropDownOpen:function(){return this.button._popupStateNode?_eed.contains(this.button._popupStateNode,"dijitHasDropDownOpen"):false;},revertToLastAutoSaveTime:function(){if(this.lastSaved===undefined){this._setVisibility(false);return;}this.updateLastSaveTime();},updateLastSaveTime:function(){if(!this.lastSaved){return;}if(!this.model.isOnline){return;}setTimeout(lang.hitch(this,function(){if(this.model.isOnline){this.updateButton();this._animateSaved();}}),1000);this._setVisibility(true);},showSavingStatus:function(){this._state=_ef2.Saving;this._updateState(res.savinglabel);this._animateSaving();},showOfflineStatus:function(){this._state=_ef2.Offline;this._updateState(res.offlinelabel);this._animateOffline();},updateButton:function(){if(!this.lastSaved||!this.model.canChangeContent()||(this.model.contentData&&this.model.contentData.isDeleted)){this._setVisibility(false);return;}this._state=_ef2.Saved;var _f05="<span class=\"dijitReset dijitInline clearfix\">${autosavelabel} ${timestamp}</span>&nbsp;<span class=\"epi-inlineButtonLink\">${undolabel}</span>";var _f06={autosavelabel:res.autosavelabel,undolabel:this.model.undoManager.get("hasUndoSteps")&&!this._isUndoDisabled?res.undolabel:"",timestamp:_ef1.toUserFriendlyHtml(this.lastSaved,null,true)};this._updateState(_eef.substitute(_f05,_f06));}});});},"epi-cms/contentediting/MappingManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/dom-attr","dojox/encoding/digests/SHA1"],function(_f07,lang,_f08,json,_f09,_f0a,SHA1){return _f07(null,{_mappings:null,domUtils:null,attrNames:["data-epi-property-name","data-epi-property-display-names","data-epi-property-customsettings-customtag","data-epi-use-mvc","data-epi-disabled","data-epi-useoverlay","data-epi-overlay-z-index","data-epi-property-type","data-epi-property-edittype","data-epi-property-editorsetting","data-epi-property-editor","data-epi-property-render"],constructor:function(){this._mappings=[];this.domUtils=_f0a;},clear:function(){var _f0b;try{while((_f0b=this._mappings.pop())){for(var prop in _f0b){if(_f0b[prop]){if(prop!=="node"){if(lang.isFunction(_f0b[prop].destroyRecursive)){_f0b[prop].destroyRecursive();}else{if(lang.isFunction(_f0b[prop].destroy)){_f0b[prop].destroy();}else{if(lang.isFunction(_f0b[prop].remove)){_f0b[prop].remove();}}}}_f0b[prop]=null;}}}}catch(ex){console.error(ex);}},_calculateNodeHash:function(node){if(!node){return "";}var _f0c=_f08.map(this.attrNames,lang.hitch(this,function(n){return this.domUtils.get(node,n)||"";}));return SHA1(json.toJson(_f0c));},update:function(_f0d,_f0e){lang.mixin(_f0d,_f0e);if(_f0e.node){_f0d.nodeHash=this._calculateNodeHash(_f0e.node);}},add:function(item){if(item.node){item.nodeHash=this._calculateNodeHash(item.node);}if(item.blockPropertyInfo&&!item.propertyName){item.propertyName=item.blockPropertyInfo.name;}this._mappings.push(item);},_tryRemapNode:function(item,_f0f){if(this._calculateNodeHash(_f0f.node)===item.nodeHash){item.node=_f0f.node;item.updateController.displayNode=_f0f.node;item.updateController.checkEmptyHtml();if(item.overlayItem){item.overlayItem.set("disabled",false);item.overlayItem.set("sourceItemNode",_f0f.node);item.overlayItem.refresh();}return {success:true,mappedNode:_f0f};}return {success:false};},remap:function(_f10){var _f11=[];var _f12=(_f10!=null?_f10.slice(0):[]);_f08.forEach(this._mappings,lang.hitch(this,function(item){if(!item.updateController){return;}var _f13=null;var _f14=_f08.some(_f12,lang.hitch(this,function(_f15){var _f16=this._tryRemapNode(item,_f15);_f13=_f13||_f16.mappedNode;return _f16.success;}));if(_f14){if(_f13){_f12.splice(_f08.indexOf(_f12,_f13),1);}}else{item.updateController.destroy();delete item.updateController;if(item.overlayItem){item.overlayItem.destroy();delete item.overlayItem;}delete item.node;delete item.nodeHash;}if(this._isEmpty(item)){_f11.push(item);}if(item.wrapper&&item.node){item.wrapper.set("blockDisplayNode",item.node);}}));var _f17;while((_f17=_f11.pop())){this._mappings.splice(_f08.indexOf(this._mappings,_f17),1);}return _f12;},_isEmpty:function(_f18){for(var _f19 in _f18){if(_f18.hasOwnProperty(_f19)){return false;}}return true;},findOne:function(_f1a,_f1b){var _f1c;_f08.some(this._mappings,function(m){if(m[_f1a]===_f1b){_f1c=m;return true;}});return _f1c;},find:function(){var _f1d;if(arguments[0]===undefined){return this._mappings;}else{if(lang.isFunction(arguments[0])){_f1d=arguments[0];}else{var _f1e=arguments[0],_f1f=arguments[1];_f1d=function(m){return m[_f1e]===_f1f;};}}return _f08.filter(this._mappings,_f1d);}});});},"dojox/encoding/digests/SHA1":function(){define("dojox/encoding/digests/SHA1",["./_base"],function(dxd){var _f20=8,mask=(1<<_f20)-1;function R(n,c){return (n<<c)|(n>>>(32-c));};function FT(t,b,c,d){if(t<20){return (b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return (b&c)|(b&d)|(c&d);}return b^c^d;};function KT(t){return (t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;};function core(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d,olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=R(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=dxd.addWords(dxd.addWords(R(a,5),FT(j,b,c,d)),dxd.addWords(dxd.addWords(e,w[j]),KT(j)));e=d;d=c;c=R(b,30);b=a;a=t;}a=dxd.addWords(a,olda);b=dxd.addWords(b,oldb);c=dxd.addWords(c,oldc);d=dxd.addWords(d,oldd);e=dxd.addWords(e,olde);}return [a,b,c,d,e];};function hmac(data,key){var wa=_f21(key);if(wa.length>16){wa=core(wa,key.length*_f20);}var ipad=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){ipad[i]=wa[i]^909522486;opad[i]=wa[i]^1549556828;}var hash=core(ipad.concat(_f21(data)),512+data.length*_f20);return core(opad.concat(hash),512+160);};function _f21(s){var wa=[];for(var i=0,l=s.length*_f20;i<l;i+=_f20){wa[i>>5]|=(s.charCodeAt(i/_f20)&mask)<<(32-_f20-i%32);}return wa;};function _f22(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((3-i%4)*8+4))&15),h.charAt((wa[i>>2]>>((3-i%4)*8))&15));}return s.join("");};function _f23(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_f20){s.push(String.fromCharCode((wa[i>>5]>>>(32-_f20-i%32))&mask));}return s.join("");};function _f24(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(3-i%4))&255)<<16)|(((wa[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};dxd.SHA1=function(data,_f25){var out=_f25||dxd.outputTypes.Base64;var wa=core(_f21(data),data.length*_f20);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _f22(wa);case dxd.outputTypes.String:return _f23(wa);default:return _f24(wa);}};dxd.SHA1._hmac=function(data,key,_f26){var out=_f26||dxd.outputTypes.Base64;var wa=hmac(data,key);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _f22(wa);case dxd.outputTypes.String:return _f23(wa);default:return _f24(wa);}};return dxd.SHA1;});},"dojox/encoding/digests/_base":function(){define("dojox/encoding/digests/_base",["dojo/_base/lang"],function(lang){var d=lang.getObject("dojox.encoding.digests",true);d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.addWords=function(a,b){var l=(a&65535)+(b&65535);var m=(a>>16)+(b>>16)+(l>>16);return (m<<16)|(l&65535);};var _f27=8;var mask=(1<<_f27)-1;d.stringToWord=function(s){var wa=[];for(var i=0,l=s.length*_f27;i<l;i+=_f27){wa[i>>5]|=(s.charCodeAt(i/_f27)&mask)<<(i%32);}return wa;};d.wordToString=function(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_f27){s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));}return s.join("");};d.wordToHex=function(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));}return s.join("");};d.wordToBase64=function(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};return d;});},"epi-cms/contentediting/RenderManager":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/json","dojo/_base/array","epi","epi/dependency","epi/datetime","dojox/encoding/digests/SHA1","dojo/Stateful","epi-cms/contentediting/PropertyRenderer"],function(dojo,_f28,lang,_f29,json,_f2a,epi,_f2b,_f2c,SHA1,_f2d,_f2e){return _f28([_f2d],{_cache:null,_queue:null,defaultRenderer:null,_rendererPool:{},rendering:false,processQueueOnRenderValue:true,numberOfItemsInQueue:0,numberOfItemsRendering:0,concurrentProcessedItems:2,processInterval:200,_processIntervalId:0,_itemsBeingRendered:null,viewSettingsManager:null,_viewSettingsToCopy:["visitorgroup"],constructor:function(_f2f){this._cache={};this._queue=[];this._itemsBeingRendered={};lang.mixin(this,_f2f);this.defaultRenderer=this.defaultRenderer||new _f2e();},postscript:function(){this.viewSettingsManager=this.viewSettingsManager||_f2b.resolve("epi.viewsettingsmanager");},destroy:function(){this._stopRenderingInterval();this._isDestroyed=true;for(var i in this._cache){delete this._cache[i];}for(var j in this._itemsBeingRendered){delete this._itemsBeingRendered[j];}this._cache=null;this._itemsBeingRendered=null;this._queue=null;this.inherited(arguments);},_getRenderer:function(_f30){var def=new _f29();if(_f30){if(this._rendererPool[_f30]){return this._rendererPool[_f30];}else{require([_f30],function(_f31){def.resolve(new _f31());});}}else{return this.defaultRenderer;}return def;},renderValue:function(_f32,_f33,_f34,_f35,_f36){var def;if(this._isSuspending){def=new _f29();def.cancel();return def;}_f34=_f2c.transformDate(_f34);_f35=this.cloneAndCompleteRenderSettings(_f35||{});var _f37=this._get(_f33,_f35,_f34);if(_f37){def=new _f29();def.resolve(_f37);}else{if(_f35&&_f35.isFullReload){def=new _f29();def.resolve({doReload:true});}else{def=new _f29();_f29.when(this._getRenderer(_f36),lang.hitch(this,function(_f38){if(!_f38){_f38=this.defaultRenderer;}_f29.when(this._queueItem(_f38,_f32,_f33,_f35,_f34),function(_f39){def.resolve(_f39);});if(this.processQueueOnRenderValue&&!this._isSuspending){this._startRenderingInterval();}}));}}return def;},cloneAndCompleteRenderSettings:function(_f3a){_f3a.propertyRenderSettings=_f3a.propertyRenderSettings||"";var _f3b=lang.clone(_f3a);if(this.viewSettingsManager.get("enabled")){_f2a.forEach(this.viewSettingsManager.getRenderingViewSettings(),lang.hitch(this,function(_f3c){if(_f3c.get("enabled")){var _f3d=this.viewSettingsManager.getSettingProperty(_f3c.key);if(_f3d){this.updateRenderSettings(_f3b,_f3d,_f3c.key,_f3c.isTagItem);}}}));}return _f3b;},updateRenderSettings:function(_f3e,_f3f,key,_f40){var _f41=[],_f42=[],_f43="",_f44=(_f40?"tag":key),_f45=!_f40,data=null;if(_f40){_f3e.propertyRenderSettings=_f3e.propertyRenderSettings||"";data=(_f3e.propertyRenderSettings?dojo.fromJson(_f3e.propertyRenderSettings):{});}else{data=(_f3e?_f3e:{});}if(!data[_f44]||_f45){_f43=_f3f;}else{_f41=data[_f44].split(",");_f2a.forEach(_f41,function(item,idx){item=lang.trim(item);if(item.toLowerCase()!==_f3f.toLowerCase()){_f42.push(item);}});_f42.push(_f3f);_f43=_f42.join(", ");}data[_f44]=_f43;if(_f40){_f3e.propertyRenderSettings=dojo.toJson(data);}},processQueue:function(){if(this._isSuspending){return;}if(this._queue.length===0){this._stopRenderingInterval();return;}if(this.numberOfItemsRendering>=this.concurrentProcessedItems){return;}var _f46=this._nextItemToProcessIndex();while(_f46>=0&&this.numberOfItemsRendering<this.concurrentProcessedItems){this._processItemInQueue(_f46);_f46=this._nextItemToProcessIndex();}},suspend:function(){if(this._isSuspending){return;}this._isSuspending=true;this._stopRenderingInterval();},clear:function(){this.set("numberOfItemsRendering",0);for(var key in this._itemsBeingRendered){this._itemsBeingRendered[key].deferred.cancel();delete this._itemsBeingRendered[key];}this._itemsBeingRendered={};this.set("numberOfItemsInQueue",0);for(var i=this._queue.length-1;i>=0;i--){delete this._queue[i];}this._queue=[];},resume:function(){if(!this._isSuspending){return;}this._isSuspending=false;this._startRenderingInterval();},_nextItemToProcessIndex:function(){var _f47=-1;var i=0;while(i<this._queue.length&&_f47===-1){var item=this._queue[i];var key=this._getRenderHash(item.propertyName,item.renderSettings);if(!(key in this._itemsBeingRendered)){_f47=i;}i++;}return _f47;},_processItemInQueue:function(_f48){var item=this._queue.splice(_f48,1)[0];this.set("numberOfItemsRendering",this.numberOfItemsRendering+1);this.set("numberOfItemsInQueue",this._queue.length);var key=this._getRenderHash(item.propertyName,item.renderSettings);this._itemsBeingRendered[key]=item;this.set("rendering",true);var _f49=lang.hitch(this,function(_f4a){if(this._isDestroyed){item.deferred.cancel();return;}if(_f4a&&_f4a.innerHtml){this._put(item.propertyName,item.renderSettings,item.value,{doReload:_f4a.doReload,innerHtml:_f4a.innerHtml});}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.resolve(_f4a);});var _f4b=lang.hitch(this,function(err){if(this._isDestroyed){item.deferred.cancel();return;}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.reject(err);});_f29.when(item.renderer.render(item.contentLink,item.propertyName,item.value,item.renderSettings),_f49,_f4b);},cacheRender:function(_f4c,_f4d,_f4e,_f4f){var data={innerHtml:_f4f,doReload:false};this._put(_f4c,_f4d,_f4e,data);},_queueItem:function(_f50,_f51,_f52,_f53,_f54){var key=this._getRenderHash(_f52,_f53);var _f55;var _f56=this._itemsBeingRendered[key];if(_f56&&!_f56.deferred.fired&&_f56.value===_f54){_f55=_f56.deferred;}else{var _f57=this._queueIndex(_f50,_f51,_f52,_f53,_f54);if(_f57<0){_f55=new _f29();this._queue.push({contentLink:_f51,renderer:_f50,propertyName:_f52,renderSettings:_f53,renderSettingsString:json.toJson(_f53),value:_f54,deferred:_f55});this.set("numberOfItemsInQueue",this._queue.length);}else{var item=this._queue[_f57];item.contentLink=_f51;item.renderer=_f50;item.value=_f54;_f55=item.deferred;}}return _f55;},_startRenderingInterval:function(){if(!this._processIntervalId){this.processQueue();this._processIntervalId=setInterval(lang.hitch(this,function(){this.processQueue();}),this.processInterval);}},_stopRenderingInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}this.set("rendering",false);},_getRenderHash:function(_f58,_f59){return SHA1(json.toJson({p:_f58,r:_f59}));},_queueIndex:function(_f5a,_f5b,_f5c,_f5d,_f5e){var _f5f=-1;var _f60=json.toJson(_f5d);_f2a.some(this._queue,function(item,i){if((item.propertyName===_f5c)&&(item.renderSettingsString===_f60)){_f5f=i;return true;}});return _f5f;},_put:function(_f61,_f62,_f63,data){if(!_f62.cacheResults){return;}var _f64=this._getCacheHash(_f61,_f62,_f63);if(!this._cache){this._cache={};}this._cache[_f64]={data:data};},_get:function(_f65,_f66,_f67){var _f68=this._getCacheHash(_f65,_f66,_f67);var _f69=this._cache[_f68];return (_f69?_f69.data:undefined);},_getCacheHash:function(_f6a,_f6b,_f6c){return SHA1(json.toJson({p:_f6a,r:_f6b,v:_f6c}));}});});},"epi-cms/contentediting/PropertyRenderer":function(){define(["dojo/_base/json","dojo/_base/declare","epi","epi/dependency","epi/shell/XhrWrapper","epi-cms/contentediting/_Renderer","epi-cms/core/ContentReference","epi/routes","dojo/string"],function(json,_f6d,epi,_f6e,_f6f,_f70,_f71,_f72,_f73){return _f6d([_f70],{_routes:_f72,_xhrHandler:null,_profile:null,constructor:function(){if(!this._routes){this._routes=epi.routes;}if(!this._xhrHandler){this._xhrHandler=new _f6f();}this._profile=this._profile||_f6e.resolve("epi.shell.Profile");},render:function(_f74,_f75,_f76,_f77){var _f78=_f71.toContentReference(_f74);var url=null;if(_f77.useMvc){url=this._routes.getActionPath({moduleArea:"CMS",controller:"PropertyRender",action:"Render",epieditmode:true,visitorgroupsByID:_f77.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}else{url=this._routes.getActionPath({moduleArea:"LegacyCMS",path:"edit/RenderProperty.aspx",id:_f78.toString(),epieditmode:true,visitorgroupsByID:_f77.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}var _f79={propertyName:_f75,propertyValue:json.toJson(_f76),id:_f78.toString(),renderSettings:""};if(_f77&&_f77.propertyRenderSettings){_f79.renderSettings=_f77.propertyRenderSettings;}return this._xhrHandler.xhrPost({url:url,handleAs:"json",content:_f79});}});});},"epi-cms/contentediting/_Renderer":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{constructor:function(_f7a){dojo.mixin(this,_f7a);},render:function(_f7b,_f7c,_f7d,_f7e){throw new Error("Abstract method _render must be overridden in a derived class");}});});},"epi-cms/contentediting/UpdateController":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(dojo,_f7f,_f80,lang,_f81,_f82,_f83,_f84,_f85){return _f80(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_f86){dojo.mixin(this,_f86);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];dojo.forEach(dojo.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],dojo.hitch(this,function(_f87){this._modelWatchHandle.push(this.contentModel.watch(_f87,dojo.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){_f7f.forEach(this._modelWatchHandle,function(_f88){_f88.remove();});dojo.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_f89){},onRender:function(_f8a){},_renderNode:function(_f8b,_f8c,_f8d){var _f8e=this.contentLink;var _f8f=this.renderSettings;var _f90=this.rendererClass;var _f91=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_f8e,_f91,_f8d,_f8f,_f90);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;dojo.when(def,dojo.hitch(this,function(_f92){if(this._lastRenderDeferred){if(_f92.doReload!==undefined&&_f92.doReload){this.onReloadRequired(this);}else{if(dojo.isString(_f92)){this._updateRendering(_f92);}else{if(_f92.innerHtml!==undefined){this._updateRendering(_f92.innerHtml,_f92.attributes);}else{if(_f92.error!==undefined){this._handleValidationError(_f92.error);}}}}if(def===this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_f93){var html="";if(!_f93){return false;}if(_f93.tagName==="IMG"){html=dojo.attr(_f93,"src")||"";}else{html=_f93.innerHTML;}html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof html=="string")&&(html.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _f94;if(!this._showEmptyNode){return;}_f94=this._isEmptyHtml(this.displayNode);if(_f94){this.displayNode.innerHTML=dojo.string.substitute(this.emptyValue,this);}this._ensureSize();},_ensureSize:function(){try{this._clearComputedStyle();this._computeStyle();}catch(e){console.warn("Could not get or set domStyle for displayNode",e);}},_clearComputedStyle:function(){var _f95=this._originalStyle;if(_f95){for(var prop in _f95){if(_f95.hasOwnProperty(prop)){_f82.set(this.displayNode,prop,this._originalStyle[prop]);}}this._originalStyle=null;}},_computeStyle:function(){var node=this.displayNode,_f96=node&&_f82.get(node);if(!_f96){return;}var _f97={minWidth:_f82.toPixelValue(node,_f96.minWidth),minHeight:_f82.toPixelValue(node,_f96.minHeight),display:_f96.display},_f98={},_f99=_f97.minHeight===0,_f9a=_f97.minWidth===0,_f9b=_f97.display==="inline",_f9c=_f83.getMarginBox(node,_f96);if(_f9c.h<(_f99?this.minHeight:_f97.minHeight)||_f9c.w<(_f9a?this.minWidth:_f97.minWidth)){if(_f99){_f98.minHeight=this.minHeight+"px";}if(_f9a){_f98.minWidth=this.minWidth+"px";}if(_f9b){_f98.display="inline-block";}if(_f9b||_f99||_f9a){this._originalStyle=_f97;_f82.set(node,_f98);}}},_updateRendering:function(_f9d,_f9e){this.displayNode.innerHTML=_f9d;if(_f9e){_f7f.forEach(_f9e,lang.hitch(this,function(_f9f){this._updateAttribute(_f9f);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_f82.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_fa0){if(_fa0.name.toLowerCase()==="class"){_f81.add(this.displayNode,_fa0.value);}else{_f84.set(this.displayNode,_fa0.name,_fa0.value);}},_handleValidationError:function(_fa1){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){_f85.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});},"epi-cms/widget/overlay/overlayFactory":function(){define(["dojo/_base/lang","dojo/_base/Deferred","epi-cms/widget/overlay/Property"],function(lang,_fa2){return {defaultType:"epi-cms/widget/overlay/Property",create:function(_fa3){var _fa4=new _fa2();var _fa5=_fa3.property.metadata.overlaySettings&&_fa3.property.metadata.overlaySettings.customType;var _fa6=_fa3.property,_fa7=_fa5||this.defaultType,_fa8={},_fa9=_fa6.metadata&&_fa6.metadata.settings||{};_fa8.allowedTypes=_fa9.allowedTypes||[];_fa8.restrictedTypes=_fa9.restrictedTypes||[];require([_fa7],lang.hitch(this,function(_faa){var _fab=lang.mixin({name:_fa6.name,contentModel:_fa6.contentModel,displayName:_fa6.metadata.displayName,disabled:_fa3.disabled,sourceItemNode:_fa3.node},_fa6.overlayParams,_fa8);var _fac=new _faa(_fab);_fa4.resolve(_fac);}));return _fa4;}};});},"epi-cms/widget/overlay/Property":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/widget/overlay/Item"],function(_fad,lang,_fae,Item){return _fad([Item],{onValueChange:function(_faf){},_getRightProperty:function(){var _fb0=this.name;if(this.dndTargetPropertyName){_fb0+=("."+_fae.pascalToCamel(this.dndTargetPropertyName));}return _fb0;},onDrop:function(_fb1,_fb2){var _fb3=this._getRightProperty();function _fb4(_fb5){if(!_fb5){return [];}if(!(_fb5 instanceof Array)){return [_fb5];}return _fb5;};if(this.dndTargetPropertyName&&this.dndTargetPropertyAllowMultiple===true){var _fb6=_fb4(lang.clone(this.contentModel.get(_fb3)));_fb4(_fb2).forEach(function(item){_fb6.push(item);});_fb2=_fb6;}this.onValueChange({propertyName:_fb3,value:_fb2});}});});},"epi-cms/compare/views/AllPropertiesCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","../viewmodels/AllPropertiesCompareViewModel","../AllPropertiesTransformer","../FormField","epi/shell/widget/FormContainer","epi-cms/contentediting/FormEditing","epi/shell/widget/_ModelBindingMixin"],function(_fb7,lang,_fb8,when,_fb9,_fba,_fbb,_fbc,_fbd,_fbe){return _fb7([_fbd,_fbe],{modelBindingMap:{comparison:["comparison"],rightMetadata:["rightMetadata"]},postMixInProperties:function(){this.inherited(arguments);this._groupMap={};this.own(this.model=new _fb9({model:this.model}));},removeForm:function(form){var _fbf=form.containerLayout.selectedChildWidget;if(_fbf){this._selectedTabName=_fbf.name.toLowerCase();}this._groupMap={};this._mappingManager.clear();return this.inherited(arguments);},_createForm:function(){return new _fbc(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,metadataTransformer:new _fba({model:this.model}),baseClass:"epi-cmsEditingForm epi-form-container epi-form-container--compare"},this.formSettings));},_setupForm:function(){this.inherited(arguments);var _fc0=this._groupMap[this._selectedTabName];if(_fc0){this._form.containerLayout.selectChild(_fc0);}},_setComparisonAttr:function(_fc1){this._set("comparison",_fc1);for(var _fc2 in this._groupMap){var _fc3=this._groupMap[_fc2];var _fc4=(_fc1&&_fc1[_fc2]&&_fc1[_fc2].length)||0;this._setGroupTitleWithChanges(_fc3,_fc4);}},_setRightMetadataAttr:function(_fc5){this._set("rightMetadata",_fc5);if(!this._started){return;}this._removeAndDestroyForm();if(_fc5&&this.model.leftMetadata&&this.viewModel){this._setupForm();}},onGroupCreated:function(_fc6,_fc7,_fc8){this.inherited(arguments);if(_fc8){return;}var name=_fc6.toLowerCase(),_fc9=this.comparison;_fc7.groupName=_fc6;this._groupMap[name]=_fc7;this._setGroupTitleWithChanges(_fc7,_fc9&&_fc9[name]&&_fc9[name].length);},_setViewModelAttr:function(_fca){this.inherited(arguments);this.model.set("contentViewModel",this.viewModel);},_setGroupTitleWithChanges:function(_fcb,_fcc){var _fcd=_fcb.params.title;if(_fcc){_fcd=lang.replace("{0}<span class=\"epi-compare-tab--has-changes\">{1}</span>",[_fcd,_fcc]);}_fcb.set("title",_fcd);}});});},"epi-cms/compare/viewmodels/AllPropertiesCompareViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi","epi/dependency","epi/string","epi-cms/core/ContentReference","dojo/Stateful","dijit/Destroyable"],function(_fce,lang,_fcf,when,epi,_fd0,_fd1,_fd2,_fd3,_fd4){return _fce([_fd3,_fd4],{_metadataManager:null,contentViewModel:null,leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null,postscript:function(){this.inherited(arguments);this._metadataManager=this._metadataManager||_fd0.resolve("epi.shell.MetadataManager");this.initialize();},initialize:function(){var _fd5=lang.hitch(this,function(name,_fd6,_fd7){if(!_fd7||(_fd6&&_fd6.contentLink===_fd7.contentLink)){return;}when(this._metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:_fd7.contentLink}),lang.hitch(this,function(_fd8){this.set("rightMetadata",_fd8);}));});_fd5("rightVersion",null,this.model.rightVersion);this.own(this.model.watch("rightVersion",_fd5),this.model.watch("contentLink",lang.hitch(this,function(name,_fd9,_fda){if(!_fd2.compareIgnoreVersion(_fd9,_fda)){this.set({leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null});}})));},generateComparison:function(){var _fdb={},_fdc=this.rightMetadata;if(!this.leftPropertyMap||!this.rightPropertyMap){this.set("comparison",null);return;}_fdc.groups.forEach(function(_fdd){_fdb[_fdd.name.toLowerCase()]=[];});_fdc.properties.forEach(lang.hitch(this,function(_fde){this._addPropertyToComparison(_fdb,_fde,_fde.groupName);}));this.set("comparison",_fdb);},copy:function(_fdf){if(!_fdf){throw new Error("propertyName is required");}var _fe0=this.contentViewModel,_fe1=lang.getObject(_fdf,false,this.rightPropertyMap);if(_fe0&&_fe1!==undefined){_fe0.setProperty(_fdf,lang.clone(_fe1));_fe0.save();}},_addPropertyToComparison:function(_fe2,_fe3,_fe4,_fe5){var _fe6=_fd1.pascalToCamel((_fe5||"")+_fe3.name),_fe7=lang.getObject(_fe6,false,this.leftPropertyMap),_fe8=lang.getObject(_fe6,false,this.rightPropertyMap);if(_fe3.showForEdit&&!epi.areEqual(_fe7,_fe8)){if(_fe3.properties.length){_fe3.properties.forEach(lang.hitch(this,function(_fe9){this._addPropertyToComparison(_fe2,_fe9,_fe4,_fe6+".");}));}else{_fe2[_fe4.toLowerCase()].push(_fe6.toLowerCase());}}},_contentViewModelSetter:function(_fea){this.contentViewModel=_fea;this.set({leftMetadata:_fea.metadata,leftPropertyMap:_fea.contentData.properties});this.own(_fea.watch("contentData",lang.hitch(this,function(name,_feb,_fec){this.set("leftPropertyMap",_fec.properties);})),_fcf.after(_fea,"onPropertySaved",lang.hitch(this,"_onPropertySaved"),true));},_leftPropertyMapSetter:function(_fed){this.leftPropertyMap=lang.clone(_fed);this.generateComparison();},_rightPropertyMapSetter:function(_fee){this.rightPropertyMap=lang.clone(_fee);this.generateComparison();},_rightMetadataSetter:function(_fef){this.rightMetadata=_fef;if(this.rightMetadata){when(this.model.contentDataStore.get(this.model.rightVersion.contentLink)).then(lang.hitch(this,function(_ff0){this.set("rightPropertyMap",_ff0.properties);}));}},_onPropertySaved:function(_ff1,_ff2){var _ff3=this.comparison;if(this.leftPropertyMap){lang.setObject(_ff1,_ff2,this.leftPropertyMap);}if(!_ff3){return;}var _ff4=this.rightMetadata.getPropertyMetadata(_ff1.split(".")[0]),_ff5=this.rightMetadata.getPropertyMetadata(_ff1),_ff6=this.rightPropertyMap&&lang.getObject(_ff1,false,this.rightPropertyMap);if(!_ff5.showForEdit){return;}var _ff7=_ff3[_ff4.groupName.toLowerCase()],name=_ff1.toLowerCase(),_ff8=_ff7.indexOf(name),_ff9=epi.areEqual(_ff2,_ff6);if(_ff8>=0&&_ff9){_ff7.splice(_ff8,1);}else{if(_ff8<0&&!_ff9){_ff7.splice(0,0,name);}}this.set("comparison",_ff3);}});});},"epi-cms/compare/AllPropertiesTransformer":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/MetadataTransformer","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_ffa,lang,_ffb,_ffc,res){return _ffa([_ffc],{model:null,_map:null,_getProperty:function(_ffd){function _ffe(map,_fff,path){_fff.forEach(function(_1000){var name=(!path?_1000.name:path+"."+_1000.name).toLowerCase();map[name]=_1000;_1000.properties.length&&_ffe(map,_1000.properties,name);});return map;};if(!this.model.rightMetadata){return null;}if(!this._map){this._map=_ffe({},this.model.rightMetadata.properties);}return this._map[_ffd.toLowerCase()];},_getComponentDefinitions:function(_1001,_1002,_1003,_1004,_1005){if(_1002 instanceof Array){var _1006=this.defaultSingleGroupType;_1002.forEach(function(group){if(group.name==="EPiServerCMS_SettingsPanel"){delete group.options.region;group.options.title=res.settingspaneltabname;group.uiType=_1006;}});}return this.inherited(arguments);},_createPropertyWidget:function(_1007,_1008,_1009,_100a){var _100b=this.inherited(arguments),_100c=this._getProperty(_1008+_1007.name),_100d;_100b.settings._hint="compare";_100b.settings.groupName=_1007.groupName;if(_100c){var _100e=_ffb.pascalToCamel(_1008+_1007.name),value=this.model&&lang.getObject(_100e,false,this.model.rightPropertyMap);_100d=this.inherited(arguments,[_100c,"compare."+_1008,false,true]);_100d.settings._type="compare";_100d.settings.compareViewModel=this.model;_100d.settings.value=value;return [_100b,_100d];}return _100b;},_createGroupContainer:function(group,_100f){var _1010=this.inherited(arguments);_1010.settings._hint="compare";return _1010;},_createParentContainer:function(_1011){_1011.properties.forEach(function(_1012){_1012.groupName=_1011.groupName;});return this.inherited(arguments);}});});},"epi-cms/compare/FormField":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/form/Button","epi/shell/form/Field","epi/shell/form/formFieldRegistry","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_1013,lang,_1014,_1015,_1016,_1017,Field,_1018,res){var _1019=_1013([Field],{_copyButton:null,buildRendering:function(){this.inherited(arguments);this.own(this._copyButton=new _1017({"class":"epi-form-container__section__row__copy-button epi-chromeless",iconClass:"epi-icon-compare--copy",label:res.copy.label,title:res.copy.tooltip}).placeAt(this.domNode,"last"));this._copyButton.on("click",lang.hitch(this,function(){this.model.copy(this.params.name);}));},addChild:function(child,index){var _101a,_101b=_1015.create("div",{"class":"epi-form-container__section__row__editor--"+child._type},this.domNode);if(child.checkbox){_101a=(child._type==="compare")?_1015.create("label",{innerHTML:child.label},_101b):_1015.place(this.labelNode,_101b);this._addCheckboxChild(child,_101a);}else{child.placeAt(_101b);}},destroy:function(){this.inherited(arguments);if(this._comparisonWatch){this._comparisonWatch.remove();this._comparisonWatch=null;}},_setReadonlyIconDisplayAttr:function(_101c){this.inherited(arguments);if(this._copyButton){_1016.set(this._copyButton.domNode,"display",_101c?"none":"");}},_setModelAttr:function(model){this._set("model",model);if(this._comparisonWatch){this._comparisonWatch.remove();}this._updateChangedState();this._comparisonWatch=model.watch("comparison",lang.hitch(this,"_updateChangedState"));},_updateChangedState:function(){var _101d=this.model.comparison,group=_101d&&_101d[this.groupName],_101e=group&&group.indexOf(this.name.toLowerCase())>=0;_1014.toggle(this.domNode,"epi-form-container__section__row--has-changes",_101e);}});function _101f(_1020,_1021){var _1022=new _1019({labelTarget:_1020.checkbox?_1020.checkbox.id:_1020.id,label:_1020.label,tooltip:_1020.tooltip,name:_1020.name,groupName:_1020.groupName.toLowerCase(),readonlyIconDisplay:_1020.readOnly,hasFullWidthValue:_1020.useFullWidth});_1022.own(_1020.watch("readOnly",function(name,_1023,_1024){_1022.set("readonlyIconDisplay",_1024);}));return _1022;};function _1025(_1026,_1027){var _1028=_1027.getChildren().pop();_1028.set("model",_1026.compareViewModel);return _1028;};_1025.preventAdd=true;_1018.add([{type:_1018.type.field,hint:"compare",factory:_101f},{type:"compare",hint:"",factory:_1025}]);return _1019;});},"epi-cms/contentediting/FormEditing":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/layout/ContentPane","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_1029,_102a,_102b,_102c,_102d,_102e){return _1029([_102e,_102c,_102d],{createOverlays:false,selectFormOnCreation:true,placeForm:function(form){form.set("transitionMode","reveal");form.set("fitContainer",true);this.editLayoutContainer.addChild(form,0);},removeForm:function(form){this.editLayoutContainer.leftOver&&this._removeLeftOver();this.editLayoutContainer.leftOver=form;_102a.replace(this.iframeWithOverlay.domNode,"dijitVisible","dijitHidden");return false;},_reloadPropertyPreview:function(){}});});},"epi-cms/component/ContextHistory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/UriParser","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase"],function(array,_102f,lang,topic,_1030,_1031,_1032,_1033,_1034){return _102f([_1034],{ignoreVersionWhenComparingLinks:false,_sort:"dateAdded",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_1030.resolve("epi.shell.ContextHistory").store;},buildRendering:function(){this.inherited(arguments);var _1035=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)}},store:this.store,selectionMode:"single",dndFormatSuffix:this.dndFormatSuffix,sort:this._sort},this.defaultGridMixin);this.grid=new this._gridClass(_1035,this.domNode);this.grid.set("showHeader",false);},postCreate:function(){this.inherited(arguments);topic.subscribe("/epi/cms/trash/empty",lang.hitch(this,function(_1036){if(_1036){_1036.forEach(function(_1037){this.store.remove("epi.cms.contentdata:///"+_1037);},this);}}));},startup:function(){this.inherited(arguments);this.fetchData();},_dndNodeCreator:function(item,hint){var _1038=this.inherited(arguments);_1038.data.contentLink=new _1031(_1038.data.uri).getId();return _1038;},contextChanged:function(){this.inherited(arguments);this.grid.set("sort",this._sort,true);},fetchData:function(){var _1039=_1032.wastebasketPage;this.grid.set("query",{uri:new RegExp("epi\\.cms\\.contentdata:///([^"+_1039+"]|\\d{2,})")});this.grid.set("sort",this._sort,true);}});});},"epi-cms/component/GlobalToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/store/Memory","dijit/registry","dijit/Toolbar","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/_WidgetCommandConsumerMixin","epi/shell/command/builder/_Builder","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/ExpandoMenuBuilder","dojo/text!./templates/GlobalToolbar.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_103a,lang,_103b,_103c,_103d,_103e,_103f,_1040,_1041,_1042,_1043,_1044,_1045,_1046){var _1047=_103a([_1041],{_create:function(_1048){var _1049=_103a([_1048.settings.widget,_103f]);return new _1049(_1048.settings);}});var _104a=_103a([_1042],{_getBuildInfo:function(_104b){if(_104b.settings.category){var i=this.configuration.length-1;for(;i>0;i--){if(this.configuration[i].category===_104b.settings.category){return this.configuration[i];}}}return this.configuration[0];}});return _103a([_103e,_1040],{templateString:_1045,commandKey:"epi.cms.globalToolbar",postCreate:function(){this.inherited(arguments);var _104c=new _1047();var _104d=new _1043({settings:{title:_1046.createcontent.title,"class":"epi-mediumButton epi-disabledDropdownArrow",iconClass:"epi-iconPlus",showLabel:false},hideEmptyButton:true});var _104e=[{category:"leading",builder:_104c,target:this.leadingContainerNode},{category:"view",builder:new _1044({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.viewNode},{category:"center",builder:_104c,target:this.centerContainerNode},{category:"trailing",builder:_104c,target:this.trailingContainerNode},{category:"create",builder:_104d,target:this.leadingContainerNode},{category:"compare",builder:new _1044({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.compareNode}];var _104f=new _104a({configuration:_104e,commandSource:this});_104f.build();},_getNextFocusableChild:function(child,dir){var _1050=this.getChildren();var index=_1050.indexOf(child);index=(dir>0)?index+1:index-1;if(index<0){index=_1050.length-1;}else{if(index>=_1050.length){index=0;}}return _1050[index];}});});},"epi/shell/command/_WidgetCommandConsumerMixin":function(){define("epi/shell/command/_WidgetCommandConsumerMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_WidgetCommandProviderMixin"],function(_1051,_1052,_1053){return _1051([_1052,_1053],{});});},"epi/shell/command/_WidgetCommandProviderMixin":function(){define("epi/shell/command/_WidgetCommandProviderMixin",["dojo/_base/declare","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/_GlobalCommandProviderMixin"],function(_1054,_1055,_1056){return _1054([_1056,_1055],{postMixInProperties:function(){this.inherited(arguments);this.commandProvider=this.commandProvider||this;}});});},"url:epi-cms/component/templates/GlobalToolbar.html":"<div class=\"dijit epi-globalToolbar\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\r\n    <div class=\"epi-toolbarGroupContainer\">\r\n        <div class=\"epi-toolbarLeading epi-toolbarGroup\">\r\n            <span data-dojo-attach-point=\"leadingContainerNode\"></span\r\n            ><span data-dojo-attach-point=\"viewNode\"></span\r\n            ><span data-dojo-attach-point=\"compareNode\"></span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"centerContainerNode\" class=\"epi-toolbarCenter epi-toolbarGroup\"></div>\r\n        <div data-dojo-attach-point=\"trailingContainerNode\" class=\"epi-toolbarTrailing epi-toolbarGroup\"></div>\r\n    </div>\r\n</div>","epi-cms/component/MainNavigationComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi-cms/widget/SearchBox"],function(array,_1057,lang,_1058,_1059,_105a,_105b,_105c,_105d,_105e){return _1057([_1059,_105a,_105b],{templateString:"<div>                            <div data-dojo-type=\"epi-cms/widget/SearchBox\" data-dojo-attach-point=\"search\" class=\"epi-gadgetInnerToolbar\"></div>                            <div data-dojo-attach-point=\"navigation\" style=\"overflow:auto;\">                            </div>                        </div>",contentRepositoryDescriptors:null,postCreate:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_105c.resolve("epi.cms.contentRepositoryDescriptors");var _105f=this.contentRepositoryDescriptors[this.repositoryKey];var roots=this.roots?this.roots:_105f.roots;this.search.set("area",_105f.searchArea);this.search.set("searchRoots",roots);var _1060=_105f.customNavigationWidget||"epi-cms/component/ContentNavigationTree";require([_1060],lang.hitch(this,function(_1061){var _1062=new _1061({typeIdentifiers:_105f.mainNavigationTypes?_105f.mainNavigationTypes:_105f.containedTypes,containedTypes:_105f.containedTypes,settings:_105f,roots:roots,repositoryKey:this.repositoryKey});_1062.placeAt(this.navigation);this.tree=_1062;this.tree.resize();this.own(this.tree.watch("showAllLanguages",lang.hitch(this,function(){this.search.set("filterOnCulture",!this.tree.get("showAllLanguages"));})));}));},layout:function(){var cb=this._contentBox,ocb=this._oldContentBox;if(!cb){return;}if(!ocb||cb.w!==ocb.w||cb.h!==ocb.h){this._oldContentBox=cb;var sb=_1058.getMarginBox(this.search.domNode);_1058.setMarginBox(this.navigation,{w:cb.w,h:cb.h-sb.h});}}});});},"epi-cms/component/Media":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/topic","epi-cms/component/MediaViewModel","epi-cms/widget/HierarchicalList","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_1063,lang,_1064,_1065,on,topic,_1066,_1067,_1068,_1069){return _1063([_1067],{res:_1069,enableDndFileDropZone:true,showCreateContentArea:true,showThumbnail:true,modelClassName:_1066,noDataMessage:_1069.nocontent,hierarchicalListClass:"epi-mediaList",createContentText:_1069.dropareatitle,postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocontent);this.own(this.model.getCommand("upload").watch("canExecute",lang.hitch(this,function(name,_106a,_106b){this._toggleCreateContentArea(_106b);})));},_onCreateAreaClick:function(){this.inherited(arguments);this.model._commandRegistry.uploadDefault.command.execute();},_setupCreateContentArea:function(){this.inherited(arguments);var _106c=this.createContentAreaButton.domNode;_1064.remove(_106c,"epi-flat");_1064.add(_106c,"epi-button--full-width");}});});},"epi-cms/component/MediaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","epi","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/widget/viewmodel/HierarchicalListViewModel","epi-cms/widget/viewmodel/MultipleFileUploadViewModel","epi-cms/widget/MultipleFileUpload","epi-cms/command/UploadContent","epi-cms/command/EditImage","epi-cms/command/DownloadMedia","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(array,_106d,lang,_106e,when,epi,_106f,_1070,_1071,_1072,_1073,_1074,_1075,_1076,_1077){return _106d([_1071],{_dialog:null,_getTypesToCreate:function(){return [];},_setupCommands:function(){this.inherited(arguments);var _1078={selection:this.selection,model:this};var _1079={uploadDefault:{command:new _1074(lang.mixin({iconClass:"epi-iconPlus",label:_1077.command.label,resources:_1077,viewModel:this},_1078))},upload:{command:new _1074(lang.mixin({category:"context",iconClass:"epi-iconUpload",label:_1077.linktocreateitem,viewModel:this},_1078)),isAvailable:this.menuType.ROOT|this.menuType.TREE,order:2},editImage:{command:new _1075(lang.mixin({category:"context",forceContextChange:true,label:_1077.command.openineditor},_1078)),isAvailable:this.menuType.LIST,order:3},download:{command:new _1076(lang.mixin({category:"context",label:_1077.command.download},_1078)),isAvailable:this.menuType.LIST,order:4}};this._commandRegistry=lang.mixin(this._commandRegistry,_1079);this.pseudoContextualCommands.push(this._commandRegistry.uploadDefault.command);this.pseudoContextualCommands.push(this._commandRegistry.upload.command);},_updateTreeContextCommandModels:function(model){this.inherited(arguments);this._commandRegistry.uploadDefault.command.set("model",model);this._commandRegistry.upload.command.set("model",model);},upload:function(_107a,_107b,_107c){var _107d=new _1073({model:new _1072({store:this.get("store"),query:this.get("listQuery")})});_107d.on("beforeUploaderChange",lang.hitch(this,function(){this._uploading=true;}));_107d.on("close",lang.hitch(this,function(_107e){this._dialog&&(_107e?this._dialog.hide():this._dialog.destroy());}));_107d.on("uploadComplete",lang.hitch(this,function(_107f){if(_107d.createAsLocalAsset){when(this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"&&this.treeStoreModel.refreshRoots(this),lang.hitch(this,function(){_107d.set("createAsLocalAsset",false);_107d.set("uploadDirectory",this.get("currentTreeItem").id);_107d.model.set("query",this.get("listQuery"));}));}else{this.onListItemUpdated(_107f);this.set("currentTreeItem",this.get("currentTreeItem"));}if(this._dialog&&!this._dialog.open){this._dialog.destroy();}this._uploading=false;}));this._dialog=new _106f({title:_1077.linktocreateitem,dialogClass:"epi-dialog-upload",content:_107d,autofocus:true,defaultActionsVisible:false,closeIconVisible:false,destroyOnHide:false});this._dialog.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:function(){_107d.close();}});this._dialog.resize({w:700});this._dialog.show();var _1080=_107c?this.selection.data[0].data:this.store.get(_107b);when(_1080,lang.hitch(this,function(_1081){this._buildBreadcrumb(_1081,_107d);_107d.set("uploadDirectory",_107b||this.get("currentTreeItem").id);_107d.set("createAsLocalAsset",_107c);_107d.upload(_107a);}));},onListItemUpdated:function(_1082){var store=this.store;return when(this.getCurrentContext(),function(_1083){var _1084=(new _1070(_1083.id)).createVersionUnspecificReference().toString();return when(store.get(_1084),function(_1085){var _1086=array.filter(_1082,function(_1087){return _1085.name.toLowerCase()===_1087.fileName.toLowerCase();})[0];return _1086?_1085:null;});});},_buildBreadcrumb:function(_1088,_1089){if(!_1089){return;}if(this.treeStoreModel.isTypeOfRoot(_1088)){_1089.set("breadcrumb",[_1088]);return;}this.treeStoreModel.getAncestors(_1088.contentLink,lang.hitch(this,function(_108a){var _108b,paths=[_1088];for(var i=_108a.length-1;i>=0;i--){_108b=_108a[i];paths.unshift(_108b);if(this.treeStoreModel.isTypeOfRoot(_108b)){break;}}_1089.set("breadcrumb",paths);}));},getContextualParentLink:function(_108c,_108d){var link=this.inherited(arguments);var _108e=this.treeStoreModel.get("previousSelection");if(_108e&&_108e.selectedContent){var _108f=_108e.selectedContent.tree.getNodesByItem(link)[0];if(_108f===undefined){link=this.roots[this.roots.length-1];}}return link;}});});},"epi-cms/widget/viewmodel/HierarchicalListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/registry","epi","epi/dependency","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi-cms/_MultilingualMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/command/NewFolder","epi-cms/command/RenameFolder","epi-cms/widget/CreateCommandsMixin","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","epi-cms/command/PasteContent","epi-cms/command/TranslateContent","epi-cms/component/command/ViewTrash","epi-cms/component/command/ChangeContext"],function(array,_1090,lang,topic,_1091,when,_1092,epi,_1093,_1094,_1095,_1096,_1097,_1098,_1099,_109a,_109b,_109c,_109d,_109e,_109f,_10a0,_10a1,_10a2,_10a3,_10a4,_10a5,_10a6){return _1090([_1091,_1099,_1098,_109f],{menuType:{ROOT:1,TREE:2,LIST:4},searchArea:"",searchRoots:"",clipboardManager:null,selection:null,commands:null,createCommands:null,createHierarchyCommands:null,pseudoContextualCommands:null,currentTreeItem:null,currentListItem:null,listQuery:null,listQueryOptions:null,showAllLanguages:true,treeStoreModelClass:null,treeStoreModel:null,store:null,searchStore:null,storeKey:"epi.cms.content.light",mainNavigationTypes:null,containedTypes:null,_showAllLanguagesSetter:function(value){this.showAllLanguages=value;this._updateListQuery(this.currentTreeItem);if(this.get("isSearching")){var _10a7=this.get("searchListQuery");this._updateSearchListQuery(_10a7.queryText);}this.treeStoreModel.set("showAllLanguages",value);},_currentTreeItemSetter:function(value){this.currentTreeItem=value;this._updateListQuery(value);},postscript:function(args){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1093.resolve("epi.cms.contentRepositoryDescriptors");_1090.safeMixin(this,this.contentRepositoryDescriptors[args.repositoryKey]);this.clipboardManager=this.clipboardManager||new _1094();this.selection=this.selection||new _1096();this.store=this.store||_1093.resolve("epi.storeregistry").get(this.storeKey);this.searchStore=this.searchStore||_1093.resolve("epi.storeregistry").get("epi.cms.content.search");this._setupTreeStoreModel();this._setupCommands();this.set("commands",this._commandRegistry.toArray());this._setupSearchRoots();this.set("listQueryOptions",this.treeStoreModel._queryOptions);},startup:function(){this.inherited(arguments);this._setupSelection();},getCommand:function(_10a8){return this._commandRegistry[_10a8]?this._commandRegistry[_10a8].command:null;},contentContextChanged:function(_10a9,_10aa){this._setupSearchRoots();if(!this._isSupportedContent(_10a9)){return;}var self=this,_10ab=self.get("currentListItem"),_10ac=_109a.toContentReference(_10a9.id);var _10ad=this.get("isSearching");when(self.store.get(_10ac.createVersionUnspecificReference().toString()),function(_10ae){var _10af=self.getContextualParentLink(_10ae,_10a9);var _10b0=_109a.toContentReference(_10af);self.set("editingListItem",_10ac);if(_10aa&&_10aa.forceReload||!_109a.compareIgnoreVersion(_10ab,_10ac)){when(self.store.get(_10b0.createVersionUnspecificReference().toString()),function(model){self.treeStoreModel&&when(self.treeStoreModel.canExpandTo(model),function(_10b1){if(_10b1){self.set("currentTreeItem",_10b0);self.set("currentListItem",_10ac);if(!_10ad){self._updateCommands(model,self.menuType.LIST);}}});});}});},getContextualParentLink:function(_10b2,_10b3){var _10b4=this.treeStoreModel.get("previousSelection");var _10b5=_10b4&&this.hasContextual(_10b4.selectedAncestors)&&_10b2.assetsFolderLink!=null?_10b2.assetsFolderLink:_10b3.parentLink;return _10b5||this.roots[0];},onSearchTextChanged:function(_10b6){this.set("isSearching",!!_10b6);this._updateSearchListQuery(_10b6);if(!this.get("isSearching")&&this.currentListItem){var self=this;when(this.store.get(this.currentListItem.createVersionUnspecificReference().toString())).then(function(_10b7){self._updateCommands(_10b7,self.menuType.LIST);});}else{this._updateCommands(null,this.menuType.LIST);}},onSearch:function(_10b8){when(this.store.get(_10b8.id),lang.hitch(this,function(model){var _10b9=_109a.toContentReference(model.contentLink);this.set("editingListItem",_10b9);this.set("currentListItem",_10b9);this.set("currentTreeItem",_109a.toContentReference(model.parentLink));this._updateCommands(model,this.menuType.LIST);}));},onTreeItemSelected:function(model,_10ba){var _10bb=this.get("currentTreeItem"),_10bc=_109a.toContentReference(model.contentLink),_10bd=_10ba?this.menuType.ROOT:this.menuType.TREE;this._updateCommands(model,_10bd);if(!_109a.compareIgnoreVersion(_10bb,_10bc)&&_109a.emptyContentReference!==_10bc){this.set("currentTreeItem",_10bc);}},onListItemSelected:function(model){var _10be=this.get("currentListItem"),_10bf=_109a.toContentReference(model.contentLink);this._updateCommands(model,this.menuType.LIST);if(!_109a.compareIgnoreVersion(_10be,_10bf)){this.set("currentListItem",_10bf);}},onListItemUpdated:function(_10c0){},_isSupportedContent:function(_10c1){return !!(_10c1&&_10c1.id)&&this.containedTypes.some(function(type){return _1097.isBaseTypeIdentifier(_10c1.dataType,type);});},_setupSelection:function(){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _10c2;if(!this._isContentContext(ctx)||!this._isSupportedContent(ctx)){_10c2=_109a.toContentReference(this.roots[0]).toString();when(this.store.get(_10c2),lang.hitch(this,function(model){this.onTreeItemSelected(model,true);}));}else{this.contentContextChanged(ctx,null);}}));},_setupTreeStoreModel:function(){if(!this.treeStoreModelClass){this.treeStoreModelClass=this.enableContextualContent?_109c:_109b;}var _10c3=new this.treeStoreModelClass({store:this.store,roots:this.roots,typeIdentifiers:this.mainNavigationTypes,containedTypes:this.containedTypes,notAllowToCopy:this.preventCopyingFor,notAllowToDelete:this.preventDeletionFor,notSupportContextualContents:this.preventContextualContentFor,autoSelectPastedItem:false,onAddDelegate:lang.hitch(this,function(node){var _10c4=_1092.getEnclosingWidget(node.domNode),_10c5=_10c4&&_10c4.item,_10c6=(typeof (this.treeStoreModel.canEdit)==="function")&&this.treeStoreModel.canEdit(_10c5);if(_10c6){node.edit();var _10c7=function(){topic.publish("/epi/cms/contentdata/childrenchanged",_10c5.parentLink);};var _10c8=node.on("rename",function(){_10c8.remove();_10c7();});var _10c9=node.on("cancelEdit",function(){_10c9.remove();_10c7();});}}),onRefreshRoots:lang.hitch(this,this._setupSearchRoots),additionalQueryOptions:{sort:this._getSortSettings()}});this.set("treeStoreModel",_10c3);},_getSortSettings:function(){return [{attribute:"name",descending:false}];},_setupSearchRoots:function(){var roots=this.roots instanceof Array&&this.roots.length>0?lang.clone(this.roots):[];when(this.getCurrentContent()).then(lang.hitch(this,function(_10ca){var _10cb=_10ca&&_10ca.assetsFolderLink;if(_10cb&&typeof this._getPseudoContextualContent==="function"&&_10cb!==this._getPseudoContextualContent().toString()){roots.push(_10cb);}})).always(lang.hitch(this,function(){this.set("searchRoots",roots.join(","));}));},_setupCommands:function(){var _10cc=this.menuType;var _10cd={category:"context",model:this.treeStoreModel,selection:this.selection,clipboard:this.clipboardManager};this.createHierarchyCommands={};var index=1;array.forEach(this.mainNavigationTypes,function(type){this.createHierarchyCommands[type]={command:new _109d(lang.mixin({typeIdentifier:type},_10cd)),isAvailable:_10cc.ROOT|_10cc.TREE,order:index};index=index+1;},this);this.createCommands=this.getCreateCommands(index);var _10ce={rename:{command:new _109e({category:"context"}),isAvailable:_10cc.TREE,order:10},cut:{command:new _10a1(_10cd),isAvailable:_10cc.TREE|_10cc.LIST,order:20},copy:{command:new _10a0(_10cd),isAvailable:_10cc.TREE|_10cc.LIST,order:30},paste:{command:new _10a3(_10cd),isAvailable:_10cc.ROOT|_10cc.TREE,order:40},edit:{command:new _10a6({category:"context",forceReload:true,forceContextChange:true}),isAvailable:this.menuType.LIST,order:3},translate:{command:new _10a4(),isAvailable:this.menuType.TREE|this.menuType.LIST},"delete":{command:new _10a2(_10cd),isAvailable:_10cc.TREE|_10cc.LIST,order:50},trash:{command:new _10a5({typeIdentifiers:this.mainNavigationTypes,order:60}),order:60},sort:function(){var _10cf=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)){var index=this[key].order;if(!index){index=100;}_10cf.push([index,this[key].command]);}}_10cf.sort(function(a,b){return a[0]-b[0];});return _10cf;},toArray:function(){var _10d0=this.sort();var _10d1=[];array.forEach(_10d0,function(key){_10d1.push(key[1]);});return _10d1;}};this._commandRegistry=lang.mixin(this._commandRegistry,this.createHierarchyCommands,this.createCommands,_10ce);this.pseudoContextualCommands=this._getPseudoContextualCommands();},_updateListQuery:function(_10d2){var id,query=null;var _10d3=array.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);if(_10d2){id=_10d2.toString();query=this._createListChildrenQuery(id,this.showAllLanguages,_10d3);}this.set("listQuery",query);},_updateSearchListQuery:function(_10d4){var query=null;if(_10d4){query=this._createListSearchQuery(_10d4,this.showAllLanguages);}this.set("searchListQuery",query);},_createListSearchQuery:function(_10d5,_10d6){return {queryText:_10d5,query:"searchcontent",allLanguages:_10d6,contentSearchAreas:this.get("searchArea"),searchRoots:this.get("searchRoots"),maxResults:1000,filterDeleted:true};},_createListChildrenQuery:function(id,_10d7,_10d8){return {referenceId:id,query:"getchildren",allLanguages:_10d7,typeIdentifiers:_10d8};},_updateSelection:function(model){this.selection.set("data",model?[{type:"epi.cms.contentdata",data:model}]:[]);},_updateCommands:function(model,_10d9){this._updateSelection(model);if(typeof this.treeStoreModel.isSupportedType==="function"&&model&&this.treeStoreModel.isSupportedType(model.typeIdentifier)){this._updateTreeContextCommandModels(model);this.decoratePseudoContextualCommands(this.pseudoContextualCommands);}this._commandRegistry.translate.command.set("model",model);this._commandRegistry.translate.command.set("executeDelegate",null);this._commandRegistry.edit.command.set("model",model);this._updateCommandAvailability(_10d9);},_updateTreeContextCommandModels:function(model){this._updateCreateCommandModels(model);this._commandRegistry.rename.command.set("model",model);},_updateCreateCommandModels:function(model){var _10da=this.createCommands;for(var key in _10da){_10da[key].command.set("model",model);}},_getPseudoContextualCommands:function(){var key,_10db=[];for(key in this.createCommands){_10db.push(this.createCommands[key].command);}for(key in this.createHierarchyCommands){_10db.push(this.createHierarchyCommands[key].command);}_10db.push(this._commandRegistry.paste.command);return _10db;},_updateCommandAvailability:function(_10dc){var _10dd=this._commandRegistry,_10de;for(var key in _10dd){if(key!=="toArray"&&_10dd.hasOwnProperty(key)){_10de=_10dd[key].isAvailable;if(_10de){var _10df=_10dd[key].command;this._updateAvailabilityForSpecificCommand(_10df,_10dc,_10de);}}}},_updateAvailabilityForSpecificCommand:function(_10e0,_10e1,_10e2){if(!_10e0.isInstanceOf(_10a4)){_10e0.set("isAvailable",!!(_10e2&_10e1));}},upload:function(_10e3){}});});},"epi/shell/ClipboardManager":function(){define("epi/shell/ClipboardManager",["dojo/_base/declare","dojo/Stateful"],function(_10e4,_10e5){return _10e4(_10e5,{copy:true,data:null,constructor:function(){this.data=[];},clear:function(){this.set("data",null);},isCopy:function(){return this.get("copy");},setDataObject:function(_10e6,copy){this.set("copy",copy);this.set("data",_10e6);},getDataObject:function(){return this.data;},containsData:function(){return !!this.data;}});});},"epi/shell/selection":function(){define("epi/shell/selection",["dojo/_base/declare","./StatefulArray"],function(_10e7,_10e8){return _10e7(_10e8,{data:null,constructor:function(){this.data=[];}});});},"epi-cms/_MultilingualMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/lang","epi/dependency","epi-cms/ApplicationSettings","epi-cms/component/SiteTreeModel"],function(_10e9,_10ea,when,lang,_10eb,_10ec,_10ed){return _10e9([],{isMultilingual:false,_application:null,_siteTreeModel:null,_cachedValue:undefined,constructor:function(_10ee){lang.mixin(this,_10ee);},_isSiteMultilingual:function(){var _10ef=new _10ea();if(this._cachedValue!==undefined){_10ef.resolve(this._cachedValue);}if(!this._siteTreeModel){var _10f0=_10eb.resolve("epi.storeregistry"),_10f1=_10f0.get("epi.cms.sitestructure");this._siteTreeModel=new _10ed({store:_10f1});}when(this._siteTreeModel.getAllLanguagesForCurrentSite(),lang.hitch(this,function(items){this._cachedValue=items.length>=2;_10ef.resolve(this._cachedValue);}));return _10ef;},_contentExistsInCurrentLanguage:function(_10f2){if(!_10f2){return false;}if(_10f2.capabilities&&!_10f2.capabilities.language){return true;}if(!_10f2.currentLanguageBranch){return false;}return _10ec.currentContentLanguage===_10f2.currentLanguageBranch.languageId;}});});},"epi-cms/widget/command/NewFolder":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(array,_10f3,lang,topic,when,_10f4,_10f5,_10f6,_10f7,_10f8){return _10f3([_10f4,_10f5],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _10f9=this.typeIdentifier;this._defaultName=_10f6.getResourceValue(_10f9,"newitemdefaultname");var _10fa=_10f6.getResourceValue(_10f9,"create");this.set("label",_10fa);this.set("tooltip",_10fa);},_execute:function(){var self=this,_10fb=self.get("selectionData"),_10fc=(new _10f7(_10fb.contentLink)).createVersionUnspecificReference().toString(),_10fd=self.createAsLocalAsset;var _10fe=function(_10ff){self.model.getChildren(_10ff,function(_1100){when(self.model.add({parentLink:_10fc,name:self._getUniqueFolderName(_1100,self._defaultName),contentTypeIdentifier:self.typeIdentifier,createAsLocalAsset:_10fd},self.onRefreshSelection),function(_1101){if(_1101.parentLink!==_10fc){topic.publish("/epi/cms/action/createlocalasset");}});});};if(_10fd){when(self.model.store.refresh(_10fc),function(_1102){when(self.model.store.get(_1102.assetsFolderLink),_10fe);});}else{_10fe(_10fb);}},_onModelChange:function(){var _1103=this.get("selectionData"),_1104=_10f8.action.Create,_1105=_10f8.providerCapabilities.Create,_1106=this.model&&_1103&&_10f8.isActionAvailable(_1103,_1104,_1105,true);this.set("canExecute",!!_1106);},_getUniqueFolderName:function(arr,_1107){var _1108=function(times){var name=times>0?lang.replace(_1107+" {0}",[times]):_1107;if(times>1000){return name;}var _1109=array.some(arr,function(child){return lang.trim(child.name).toLowerCase()===lang.trim(name).toLowerCase();});if(_1109){times=times+1;return _1108(times);}return name;};return _1108(0);}});});},"epi-cms/command/RenameFolder":function(){define(["dojo/_base/declare","epi","epi-cms/_MultilingualMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command"],function(_110a,epi,_110b,_110c,_110d){return _110a([_110d,_110b],{label:epi.resources.action.rename,contentActionSupport:null,iconClass:"epi-iconRename",renameDelegate:null,typeIdentifier:"episerver.core.contentfolder",postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_110c;},_execute:function(){this.renameDelegate(this.model);},_onModelChange:function(){var _110e=this.renameDelegate&&this.model&&this.model.typeIdentifier===this.typeIdentifier&&this.contentActionSupport.hasAccess(this.model.accessMask,_110c.accessLevel[_110c.action.Edit])&&this._contentExistsInCurrentLanguage(this.model);this.set("canExecute",_110e);}});});},"epi-cms/widget/CreateCommandsMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/dependency","../command/PopupCommand","../command/NewContent","epi/i18n!epi/nls/episerver.shared"],function(array,_110f,lang,_1110,_1111,_1112,_1113){return _110f([],{contentRepositoryDescriptors:null,typeDescriptorManager:null,createCommandClass:_1112,repositoryKey:null,category:null,isAvailableFlags:null,postscript:function(){this.inherited(arguments);if(!this.repositoryKey){throw "You need to specify the repositoryKey field";}this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1110.resolve("epi.cms.contentRepositoryDescriptors");_110f.safeMixin(this,this.contentRepositoryDescriptors[this.repositoryKey]);this.commandCategory=this.commandCategory||"context";var _1114={ROOT:1,TREE:2,LIST:4};this.isAvailableFlags=this.isAvailableFlags||_1114.ROOT|_1114.TREE;},getCreateCommands:function(index){var _1115={};var _1116=index||1;if(!this.creatableTypes){return _1115;}array.forEach(this.creatableTypes,function(type){_1115[type]={command:this._createCommand(type),isAvailable:this.isAvailableFlags,order:_1116};_1116=_1116+1;},this);if(this.creatableTypes.length<2){return _1115;}var _1117=new _1111({label:_1113.action["new"],commands:_1115});return {popupCommand:{command:_1117,order:index}};},_createCommand:function(type){return new this.createCommandClass({contentType:type,category:this.commandCategory});}});});},"epi-cms/command/PopupCommand":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","epi/shell/command/_Command","epi/shell/command/_CommandProviderMixin","epi/shell/widget/ContextMenu"],function(array,_1118,_1119,_111a,_111b,_111c){return _1118([_111a,_111b],{category:"popup",canExecute:true,popup:null,popupClass:_111c,popupCategory:"context",_commandsSetter:function(value){if(!value){return;}var _111d=[];if(value instanceof Array){_111d=value;}else{for(var index in value){_111d.push(value[index].command);}}this.commands=_111d;this._updateIsAvailable();},_popupSetter:function(popup){this.popup=popup;popup.addProvider(this);},_updateIsAvailable:function(){var _111e=array.some(this.get("commands"),function(_111f){return _111f.get("isAvailable");});this.set("isAvailable",_111e);},_onModelChange:function(){this.updateCommandModel(this.model);this._updateIsAvailable();}});});},"epi-cms/command/NewContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(array,_1120,lang,_1121,topic,when,all,_1122,_1123,_1124,_1125){return _1120([_1123],{contentType:null,createAsLocalAsset:false,postscript:function(){this.inherited(arguments);var _1126=this.contentType;this.label=this.label||_1124.getResourceValue(_1126,"create");this.tooltip=this.tooltip||_1124.getResourceValue(_1126,"createdescription");this.iconClass=this.iconClass||_1124.getValue(_1126,"commandIconClass");if(!this.store){var _1127=_1122.resolve("epi.storeregistry");this.store=_1127.get("epi.cms.contenttype");}},_execute:function(){topic.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,view:_1124.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}this.set("createAsLocalAsset",this.model?this.model.typeIdentifier==="episerver.core.contentassetfolder":false);this.set("canExecute",this._canExecute());var model=this.model;if(!model){return;}when(this._getContentType(model),lang.hitch(this,function(_1128){if(!_1128){this.set("isAvailable",false);return;}when(this._checkAvailability(_1128.availableContentTypes),lang.hitch(this,function(_1129){this.set("isAvailable",_1129);}));}));},_canExecute:function(){var model=this.model,_112a=_1125.action.Create,_112b=_1125.providerCapabilities.Create,_112c=model&&!(model.isWastebasket||model.isDeleted)&&_1125.hasLanguageAccess(model)&&_1125.isActionAvailable(model,_112a,_112b,true);return !!_112c;},_getContentType:function(model){if(!model){return null;}return this.store.get(model.contentTypeID);},_checkAvailability:function(_112d){if(_112d.length===0){return false;}var _112e=new _1121();var _112f=array.map(_112d,lang.hitch(this,function(_1130){return this.store.get(_1130);}));when(all(_112f),lang.hitch(this,function(_1131){var _1132=array.some(_1131,lang.hitch(this,function(_1133){return _1124.isBaseTypeIdentifier(_1133.typeIdentifier,this.contentType);}));_112e.resolve(_1132);}));return _112e;}});});},"epi-cms/command/CopyContent":function(){define(["dojo/_base/declare","dojo/_base/array","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_1134,array,epi,_1135,_1136,_1137){return _1134([_1135,_1136,_1137],{label:epi.resources.action.copy,iconClass:"epi-iconCopy",_execute:function(){this.clipboard.set("copy",true);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_1138=this.selection.data,_1139=false;if(model&&_1138.length){_1139=array.every(_1138,function(item){return model.canCopy(item.data);});}this.set("canExecute",_1139);}});});},"epi-cms/command/CutContent":function(){define(["dojo/_base/array","dojo/_base/declare","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(array,_113a,epi,_113b,_113c,_113d){return _113a([_113b,_113c,_113d],{label:epi.resources.action.cut,iconClass:"epi-iconCut",_execute:function(){this.clipboard.set("copy",false);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_113e=this.selection.data,_113f=false;if(model&&_113e.length){_113f=array.every(_113e,function(item){return model.canCut(item.data);});}this.set("canExecute",_113f);}});});},"epi-cms/command/DeleteContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command","epi/i18n!epi/nls/episerver.shared"],function(_1140,lang,_1141,topic,when,_1142,_1143,_1144,_1145,_1146,_1147,_1148){return _1140([_1144,_1145,_1146],{label:_1147.movetotrash,iconClass:"epi-iconTrash",hasWastebasket:true,_execute:function(){var model=this.model,_1149=this.clipboard,_114a=this.selection.data,_114b=this.hasWastebasket?model.move(_114a,{contentLink:_1142.wastebasketPage,isWastebasket:true}):model.remove(_114a);return when(_114b,lang.hitch(this,function(){var _114c=[];if(_1149&&_1149.data){_114a.forEach(function(_114d){var map=_1149.data.map(function(_114e){return model.isAncestor(_114d.data,_114e.data);});_114c=_114c.concat(map);});}when(_1141(_114c),function(_114f){var _1150=_114f.every(function(_1151){return _1151;});if(_1150){_1149.clear();}});}),lang.hitch(this,function(){topic.publish("/epi/cms/action/delete/error");}));},_hasWastebasketSetter:function(_1152){this.hasWastebasket=_1152;this.set("iconClass",_1152?"epi-iconTrash":"epi-iconClose");this.set("label",_1152?_1147.movetotrash:_1148.action.deletelabel);},_onModelChange:function(){var model=this.model,_1153=this.selection.data,_1154=function(item){var _1155=item.data;return _1155&&!_1155.isDeleted&&model.canDelete(_1155);},_1156=function(item){var _1157=item.data;return _1157&&_1143.hasProviderCapability(_1157.providerCapabilityMask,_1143.providerCapabilities.Wastebasket);};this.set("hasWastebasket",!!_1153.length&&_1153.every(_1156));this.set("canExecute",!!(model&&_1153.length)&&_1153.every(_1154)&&(this.hasWastebasket||!_1153.some(_1156)));}});});},"epi-cms/command/PasteContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(array,_1158,lang,_1159,when,epi,_115a,_115b,_115c){return _1158([_115a,_115b,_115c],{label:epi.resources.action.paste,iconClass:"epi-iconPaste",createAsLocalAsset:false,_execute:function(){var _115d=this.get("clipboardData"),_115e=this.get("selectionData");this.model.set("createAsLocalAsset",this.createAsLocalAsset);if(this.clipboard.copy){return this.model.copy(_115d,_115e);}else{return when(this.model.move(_115d,_115e),lang.hitch(this,function(){this.clipboard.clear();}));}},_onModelChange:function(){var self=this,model=self.model,_115f=self.get("clipboardData"),_1160=self.get("selectionData");self.set("canExecute",false);if(model&&_115f&&_115f.length&&_1160){var _1161=array.map(_115f,function(item){return model.canPaste(item.data,_1160,self.clipboard.copy);});when(_1159(_1161),function(_1162){var _1163=array.every(_1162,function(_1164){return _1164;});if(self.clipboard.copy){self.set("canExecute",_1163);return;}model.getAncestors(_1160,function(_1165){var _1166=array.some(_115f,function(item){return array.indexOf(_1165,item.data)>=0;});self.set("canExecute",_1163&&!_1166);});});}}});});},"epi-cms/component/command/ViewTrash":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_1167,lang,topic,when,_1168,_1169,_116a,_116b){return _1167([_116a],{label:_116b.viewtrash,category:"setting",typeIdentifiers:null,postscript:function(){this.inherited(arguments);var store=this.store||_1168.resolve("epi.storeregistry").get("epi.cms.content.light"),_116c=store.get(_1169.wastebasketPage.toString());when(_116c,lang.hitch(this,function(_116d){this.set("canExecute",_116d.statusCode!==403);}));},_execute:function(){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1169.wastebasketPage},{sender:this,typeIdentifiers:this.typeIdentifiers});}});});},"epi-cms/component/command/ChangeContext":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_116e,topic,_116f,_1170,_1171){return _116e([_1170],{contentActionSupport:null,forceContextChange:false,forceReload:false,viewType:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_116f;},_execute:function(){topic.publish("/epi/shell/context/request",{uri:this.model.uri},{sender:null,forceReload:this.forceReload,forceContextChange:this.forceContextChange,viewType:this.viewType,viewName:this.viewName});},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}if(this.model.length===1){this.model=this.model[0];}var _1172=this.model instanceof Array;var _1173=this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Read);this.set("canExecute",!_1172&&_1173);if(!_1172){if(this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Edit)){this.set("label",_1171.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_1171.view);this.set("iconClass","epi-iconSearch");}}}});});},"epi-cms/widget/viewmodel/MultipleFileUploadViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/when","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(array,_1174,when,_1175,_1176){return _1174([_1175,_1176],{upload:function(_1177){return when(this._filterUploadingFiles(_1177),function(_1178){if(!_1178||!(_1178.existingContents instanceof Array)||_1178.existingContents.length===0){return {showConfirmation:false,uploadingFiles:_1177};}return {showConfirmation:true,uploadingFiles:_1177,newFiles:_1178.newFiles,existingContents:_1178.existingContents};});},_filterUploadingFiles:function(_1179){var self=this;if(!self.store){return null;}return when(self.store.query(self.get("query")),function(_117a){var _117b=array.filter(_117a,function(_117c){return array.some(_1179,function(file){return file.name.toLowerCase()===_117c.name.toLowerCase();});});var _117d=array.filter(_1179,function(file){return array.every(_117a,function(_117e){return file.name.toLowerCase()!==_117e.name.toLowerCase();});});return {existingContents:_117b,newFiles:_117d};});}});});},"epi-cms/widget/MultipleFileUpload":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/form/Uploader","epi/routes","epi/shell/widget/dialog/Alert","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi/shell/form/uploader/HTML5"],function(array,_117f,lang,_1180,_1181,when,_1182,_1183,_1184,_1185,_1186,_1187,Alert,_1188,_1189,_118a,_118b,_118c){return _117f([_1183,_1184,_1185,_1182],{res:_118c,_isCompleted:true,_uploadStatus:[],templateString:_118b,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _1188();},upload:function(_118d){var self=this,_118e=self.uploaderInput,_118f=self._getUploadSettings();when(self.model.upload(_118d),function(_1190){when(self._confirm(_1190),function(_1191){self._resetUploader();if(!(_1191 instanceof Array)||_1191.length===0){return;}self._fileListModel.set("uploadFiles",_1191);_118e._files=_1191;_118e.upload(_118f);});});},close:function(){var self=this,files=self.uploaderInput._files,_1192=function(_1193){self.emit("close",_1193);self.set("disableToolbar",false);};if(self._isCompleted||!files||files.length<=0){_1192(false);}else{var _1194=new Alert({description:_118c.confirmdialog.description,onAction:function(){_1192(true);}});_1194.show();}},_setUploadStatusAttr:function(scope,_1195,_1196){this._uploadStatus=_1189.addStatus(this._uploadStatus,scope,_1195,_1196);},_getUploadStatusAttr:function(){return this._uploadStatus;},_setBreadcrumbAttr:function(parts){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_1180.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_1197=parts?parts.length:0;if(_1197>0){for(i;i<_1197-1;i++){this.breadcrumbBar._createItem(parts[i],true);}this.breadcrumbBar._createItem(parts[_1197-1],false);}},_setDisableToolbarAttr:function(_1198){this.uploaderInput.set("disabled",_1198);!_1198&&this.uploaderInput.set("tabindex",0);},_setupUploader:function(){var self=this;this.uploaderInput.uploadUrl=_1187.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});this.own(_1181.before(this.uploaderInput,"onChange",function(_1199){self._isCompleted=false;self.set("disableToolbar",true);return [self._getUploadSettings()];}),this.uploaderInput.on("error",function(err){self.set("uploadStatus",_1189.StatusScope.All,"",_118c.uploadform.errormessage);self._onUploadComplete();}));},_getUploadSettings:function(){return {uploadDirectory:this.get("uploadDirectory"),createAsLocalAsset:this.get("createAsLocalAsset")};},_setupFileList:function(){var self=this,_119a=this.uploaderInput;self._fileListModel=new _118a();self.fileList.set("model",self._fileListModel);this.own(_119a.on("begin",function(files){if(files&&files.length>0){self._fileListModel.set("showProgressBar",true);}}),_119a.on("progress",function(_119b){self._fileListModel.set("progress",_119b);}),_119a.on("complete",lang.hitch(self,self._onUploadComplete)),_1181.after(_119a,"reset",lang.hitch(self,self._fileListModel.clear)),_1181.around(_119a,"onChange",function(_119c){return function(_119d){var _119e=_119a._files;return when(self.model.upload(_119e),function(_119f){return when(self._confirm(_119f),function(_11a0){self._clearUploadStatus();_11a0=_1189.getFileArray(_11a0);if(!(_11a0 instanceof Array)||_11a0.length===0){self._resetUploader();return _119c.apply(_119a,[_119d]);}self._fileListModel.set("uploadFiles",_11a0);_119a._files=_11a0;_119a.upload(self._getUploadSettings());return _119c.apply(_119a,[_119d]);});});};}));},_confirm:function(_11a1){return _11a1.showConfirmation===true?this._confirmationDialog.showConfirmation(_11a1.existingContents,_11a1.uploadingFiles,_11a1.newFiles):_11a1.uploadingFiles;},_clearUploadStatus:function(){this._uploadStatus=[];},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){this._fileListModel.set("showProgressBar",false);this.uploaderInput.reset();this.set("disableToolbar",false);},_onUploadComplete:function(evt){var _11a2="";this._isCompleted=true;if(evt){if(evt instanceof Array){array.forEach(evt,function(item){_11a2=item.errorMessage;this.set("uploadStatus",item.index?_1189.StatusScope.Single:_1189.StatusScope.All,item.fileName||item.name,_11a2);},this);}else{if(evt.isValid===false&&evt.saved===false){this.set("uploadStatus",_1189.StatusScope.All,"",evt.errorMessage);}}}this._fileListModel.set("uploadStatus",this.get("uploadStatus"));this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",!this._fileListModel.uploadStatus?this._fileListModel.uploadFiles:null);}});});},"epi-cms/widget/MultipleFileUploadConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/aspect","dojo/Deferred","dojo/when","epi/string","epi/shell/widget/dialog/Dialog","epi-cms/widget/ReadOnlyContentList","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.replaceconfirmdialog"],function(array,_11a3,lang,_11a4,_11a5,_11a6,when,_11a7,_11a8,_11a9,_11aa){return _11a3(null,{showConfirmation:function(_11ab,_11ac,_11ad){var _11ae=new _11a6(),_11af=this._getDialog(_11ab.length),_11b0=this._getContentList();_11af.set("content",_11b0);_11af.set("onAction",function(_11b1){_11ae.resolve(_11b1?_11ac:_11ad);});when(_11af.show(),function(){_11b0.grid.renderArray(_11ab);});return _11ae;},_getDialog:function(_11b2){var self=this,_11b3=_11a7.toHTML(_11b2>1?lang.replace(_11aa.multiple.heading,[_11b2]):_11aa.single.heading),_11b4=_11a7.toHTML(_11b2>1?_11aa.multiple.description:_11aa.single.description);var _11b5=new _11a8({closeIconVisible:false,title:_11aa.title,heading:_11b3,description:_11b4,dialogClass:"epi-dialog--auto-height",getActions:function(){return self._getActions(this,_11b2===1);}});return _11b5;},_getActions:function(_11b6,_11b7){return [{name:"replaceFiles",label:_11b7?_11aa.single.buttons.replace:_11aa.multiple.buttons.replace,title:null,action:function(){when(_11b6.hide(),function(){return _11b6.onAction(true);});}},{name:"skipFiles",label:_11b7?_11aa.single.buttons.skip:_11aa.multiple.buttons.skip,title:null,action:function(){when(_11b6.hide(),function(){return _11b6.onAction(false);});}}];},_getContentList:function(){var _11b8=new _11a9();_11a4.add(_11b8.grid.domNode,"epi-thumbnailContentList");return _11b8;}});});},"epi-cms/widget/ReadOnlyContentList":function(){define(["dojo/_base/declare","dgrid/OnDemandList","epi/shell/dgrid/Formatter","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentListBase","epi/i18n!epi-cms/nls/episerver.shared.header"],function(_11b9,_11ba,_11bb,_11bc,_11bd,_11be,_11bf){return _11b9([_11be],{_gridClass:_11b9([_11ba,_11bb]),query:null,queryOptions:null,onPostCreateSettings:function(){},postCreate:function(){this.inherited(arguments);this.onPostCreateSettings();},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},getContextMenu:function(){},createList:function(){this.inherited(arguments);this.grid.set("showHeader",false);},getListSettings:function(){return this._getBaseSettings();},_setQueryAttr:function(value){this._set("query",value);this._updateQuery(value);},_getBaseSettings:function(_11c0){var _11c1=function(item){var _11c2=new _11bc(item.contentLink);var title=item.name+", "+_11bf.id+": "+_11c2.id+" ("+_11bf.type+": "+item.contentTypeName+")";return title;};var _11c3=function(item){return item.thumbnailUrl;};return {store:this.store,queryOptions:this.queryOptions,formatters:[_11bd.contentItemFactory("name",_11c1,null,_11c0,_11c3)],deselectOnRefresh:true,sort:this.queryOptions&&this.queryOptions.sort};},_updateQuery:function(query){if(query){this.grid.set("query",query);}else{this.grid.cleanup();}}});});},"epi-cms/widget/_ContentListBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/when","./_GridWidgetBase"],function(_11c4,lang,_11c5,_11c6,when,_11c7){return _11c4([_11c7],{storeKeyName:"epi.cms.content.search",trackActiveItem:false,gridAttachNode:null,_defaultGridNode:null,contextChangeEvent:"dblclick",postMixInProperties:function(){this.inherited(arguments);this.model=this.model||this.createModel();},postCreate:function(){this.inherited(arguments);this.createList();},createModel:function(){},createList:function(){var _11c8=this.getListSettings();_11c8=lang.mixin(_11c8,this.defaultGridMixin);if(!this.gridAttachNode){this._defaultGridNode=_11c5.create("div",null,this.domNode);}this.grid=new this._gridClass(_11c8,this.gridAttachNode||this._defaultGridNode);var _11c9=this.model&&this.model.commands&&this.model.commands.length>0;if(_11c9){this.grid.contextMenu.addProvider(this.model);}if(this.contextMenu){this.grid.contextMenu=this.contextMenu;}this.own(this.grid);this.setupEvents();},layout:function(){this.inherited(arguments);if(this._defaultGridNode){_11c6.setMarginBox(this._defaultGridNode,this._contentBox);}},getListSettings:function(){return {};},setupEvents:function(){},onContextChanged:function(){},_onSelect:function(e){when(this.getCurrentContext(),lang.hitch(this,function(_11ca){var grid=this.grid;var model={contextId:_11ca.id,data:[]};if(this.model){for(var id in grid.selection){if(grid.selection[id]){var row=grid.row(id);model.data.push(row.data);}}this.model.set("model",model);}}));}});});},"epi-cms/widget/UploadUtil":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/dom-style"],function(array,lang,_11cb){return {StatusScope:{Single:0,All:1},validUploadFiles:function(files){if(!files||!(files instanceof Array)||files.length===0){return false;}return !array.some(files,function(item){return (item.name==null||item.size==null);});},addStatus:function(store,scope,_11cc,_11cd){var _11ce=[];if(store instanceof Array){_11ce=lang.clone(store);}var _11cf=array.some(_11ce,function(item){return (item.scope===scope&&item.itemName===_11cc&&item.message===_11cd);});if(!_11cf){_11ce.push({scope:scope,itemName:_11cc,message:_11cd});}return _11ce;},filterFileOnly:function(files){return array.filter(files,function(file){if(file.type===""&&(file.size===0||file.size%4096===0)){return false;}return true;});},toggleVisibility:function(_11d0,_11d1){_11cb.set(_11d0,"display",(_11d1?"block":"none"));},getFileArray:function(_11d2){if(!_11d2){return null;}if(_11d2 instanceof Array){return _11d2;}if(typeof _11d2.item!=="function"){return null;}var i=0,total=_11d2.length,_11d3=[];for(i;i<total;i++){_11d3.push(_11d2.item(i));}return _11d3;}};});},"epi-cms/widget/viewmodel/FileListViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_11d4,array,lang,_11d5,_11d6,_11d7,_11d8){return _11d4([_11d5,_11d6],{progress:null,uploadFiles:null,uploadStatus:null,showProgressBar:false,_setUploadFilesAttr:function(files){if(!_11d7.validUploadFiles(files)){return;}var _11d9=[];array.forEach(files,function(file){_11d9.push({fileName:file.name,size:file.size,status:_11d8.uploadform.uploading});},this);this._set("uploadFiles",_11d9);},_setUploadStatusAttr:function(_11da){var files=this.get("uploadFiles");if(array.some(files,function(item){return item.status!==_11d8.uploadform.uploading;})){return;}array.forEach(files,function(item){if(!_11da||_11da.length<=0){item.status=_11d8.uploadform.uploaded;return false;}if(_11da[0]&&_11da[0].scope===_11d7.StatusScope.All&&_11da[0].itemName===""){item.status=_11d8.uploadform.failed;item.statusMessage=_11da[0].message;return false;}var _11db=array.filter(_11da,function(_11dc){return item.fileName===_11dc.itemName;});if(_11db&&_11db.length>0){item.status=_11d8.uploadform.failed;item.statusMessage=_11db[0].message;}else{item.status=_11d8.uploadform.uploaded;}},this);this._set("uploadFiles",files);},clear:function(){this._set("uploadFiles",null);}});});},"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\r\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\r\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\r\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\r\n            <span title=\"${res.uploadform.addfiles}\" >\r\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \r\n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\r\n            </span>\r\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\r\n    </form>\r\n</div>","epi-cms/widget/FileList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/form/uploader/Base","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dijit/ProgressBar","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.uploadform","dojo/text!./templates/FileList.html"],function(_11dd,lang,_11de,_11df,_11e0,_11e1,_11e2,_11e3,_11e4,_11e5,_11e6,_11e7,_11e8,_11e9,_11ea,_11eb){return _11dd([_11e2,_11e7],{templateString:_11eb,modelBindingMap:{showProgressBar:["showProgressBar"],progress:["progress"],uploadFiles:["uploadFiles"]},postCreate:function(){this.inherited(arguments);this._buildGrid();},_setUploadFilesAttr:function(files){this._bindData(files);},_setShowProgressBarAttr:function(show){_11e9.toggleVisibility(this.progressBar.domNode,show);},_setProgressAttr:function(_11ec){if(!_11ec){return;}this.progressBar.update({progress:_11ec.percent.replace("%","")});},_bindData:function(data){data=data||[];this._grid.refresh();this._grid.renderArray(data);},_buildGrid:function(){var _11ed=_11dd([_11e3,_11e5,_11e8]);this._grid=new _11ed({columns:{fileName:{label:_11ea.uploadfilename,field:"fileName",htmlEncode:true},size:{label:_11ea.uploadfilesize,field:"size",get:lang.hitch(this,function(file){var _11ee=this.convertBytes(file.size).value;if(isNaN(_11ee)){return _11ee;}var _11ef=_11ee===0?_11ea.bytetext:_11ea.bytestext;return lang.replace("{0} {1}",[_11ee,_11ef]);})},status:{label:_11ea.uploadfilestatus,field:"status",renderCell:lang.hitch(this,function(item,value,node,_11f0){_11de.set(node,"title",item.statusMessage?item.statusMessage:"");_11e0.toggle(node,"epi-failedStatus",item.status===_11ea.failed);node.innerHTML=item.status;})}}});this.own(this._grid);_11df.place(this._grid.domNode,this.domNode);}});});},"dijit/ProgressBar":function(){require({cache:{"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n"}});define("dijit/ProgressBar",["require","dojo/_base/declare","dojo/dom-class","dojo/_base/lang","dojo/number","./_Widget","./_TemplatedMixin","dojo/text!./templates/ProgressBar.html"],function(_11f1,_11f2,_11f3,lang,_11f4,_11f5,_11f6,_11f7){return _11f2("dijit.ProgressBar",[_11f5,_11f6],{progress:"0",value:"",maximum:100,places:0,indeterminate:false,label:"",name:"",templateString:_11f7,_indeterminateHighContrastImagePath:_11f1.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);if(!(this.params&&"value" in this.params)){this.value=this.indeterminate?Infinity:this.progress;}},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update();},update:function(_11f8){lang.mixin(this,_11f8||{});var tip=this.internalProgress,ap=this.domNode;var _11f9=1;if(this.indeterminate){ap.removeAttribute("aria-valuenow");}else{if(String(this.progress).indexOf("%")!=-1){_11f9=Math.min(parseFloat(this.progress)/100,1);this.progress=_11f9*this.maximum;}else{this.progress=Math.min(this.progress,this.maximum);_11f9=this.maximum?this.progress/this.maximum:0;}ap.setAttribute("aria-valuenow",this.progress);}ap.setAttribute("aria-labelledby",this.labelNode.id);ap.setAttribute("aria-valuemin",0);ap.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(_11f9);_11f3.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);tip.style.width=(_11f9*100)+"%";this.onChange();},_setValueAttr:function(v){this._set("value",v);if(v==Infinity){this.update({indeterminate:true});}else{this.update({indeterminate:false,progress:v});}},_setLabelAttr:function(label){this._set("label",label);this.update();},_setIndeterminateAttr:function(_11fa){this.indeterminate=_11fa;this.update();},report:function(_11fb){return this.label?this.label:(this.indeterminate?"&#160;":_11f4.format(_11fb,{type:"percent",places:this.places,locale:this.lang}));},onChange:function(){}});});},"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n","url:epi-cms/widget/templates/FileList.html":"<div class=\"epi-multiFileUpload-list\">\r\n    <div data-dojo-type=\"dijit/ProgressBar\" data-dojo-attach-point=\"progressBar\" data-dojo-props=\"maximum:100\"></div>\r\n</div>","epi/shell/form/uploader/HTML5":function(){define("epi/shell/form/uploader/HTML5",["dojo/_base/declare","dojo/_base/lang","dojox/form/uploader/plugins/HTML5","epi/shell/request/mutators"],function(_11fc,lang,HTML5,_11fd){var _11fe=_11fc([HTML5],{_headers:null,uploadWithFormData:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},sendAsBinary:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},createXhr:function(){var xhr=this.inherited(arguments),_11ff=this._headers;if(_11ff){for(var key in _11ff){if(_11ff.hasOwnProperty(key)){xhr.setRequestHeader(key,_11ff[key]);}}}return xhr;},_getHeadersThenExecute:function(_1200,args){var _1201={options:{headers:{}}};return _11fd.execute("beforeSend",_1201).then(lang.hitch(this,function(_1202){this._headers=_1202.options.headers;var _1203=_1200.apply(this,args);this._headers=null;return _1203;}));}});dojox.form.addUploaderPlugin(_11fe);return _11fe;});},"epi-cms/command/UploadContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/shell/DestroyableByKey","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference"],function(_1204,_1205,_1206,_1207,_1208){return _1204([_1205,_1206],{fileList:null,createAsLocalAsset:false,_execute:function(){var _1209=_1208.toContentReference(this.model.contentLink).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_1209.toString(),this.createAsLocalAsset);this.fileList=null;},_onModelChange:function(){var model=this.model,_120a=model&&_1207.hasProviderCapability(model.providerCapabilityMask,_1207.providerCapabilities.Create)&&_1207.hasAccess(model.accessMask,_1207.accessLevel.Create);this.destroyByKey("isSearchingWatch");this.viewModel&&this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.set("canExecute",!!(_120a&&this.viewModel&&!this.viewModel.get("isSearching")));}});});},"epi-cms/command/EditImage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/routes","epi/Url","epi/UriParser","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/shell/command/_SelectionCommandMixin"],function(_120b,lang,topic,_120c,_120d,Url,_120e,_120f,_1210,_1211,_1212,_1213,_1214){return _120b([_1213,_1214],{canExecute:false,iconClass:"epi-iconNewWindow",_segmentIdSeperator:",,",postscript:function(){this.inherited(arguments);this.contextService=this.contextService||_120c.resolve("epi.shell.ContextService");},getRouteParams:function(){var _1215=this._getTarget();return this.contextService.query({uri:"epi.cms.contentdata:///"+_1215.contentLink}).then(function(_1216){var _1217=new _120e(_1216.uri).getId();return {moduleArea:"LegacyCMS",path:"Edit/ImageEditor/ImageEditor.aspx",IsInLegacyWrapper:false,imageId:_1217};});},_createDialog:function(_1218,_1219){var _121a=this._getTarget();if(_121a){var _121b=function(_121c){if(_121c){topic.publish("/epi/shell/context/request",{url:_121c.src},{forceReload:true});}};lang.mixin(_1218,{url:_120d.getActionPath(_1219),dialogArguments:{src:_121a.permanentLink,contentLink:_1219.imageId},onCallback:_121b});}return new _1212(_1218);},_onModelChange:function(){if(!_1210.imageEditorEnabled){if(this.get("isAvailable")){this.set("isAvailable",false);}return;}var _121d=this._getTarget(),_121e=this.model&&_121d&&_120f.isBaseTypeIdentifier(_121d.typeIdentifier,"episerver.core.icontentimage");this.set("canExecute",!!_121e);},_getTarget:function(){var _121f=this.selection&&this.selection.data,_1220=_121f&&_121f.length===1&&_121f[0];return _1220&&(_1220.type==="epi.cms.contentdata")?_1220.data:null;}});});},"epi-cms/legacy/LegacyDialogPopup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/DeferredList","epi","epi/shell/widget/dialog/Dialog"],function(_1221,lang,_1222,_1223,_1224,_1225,epi,_1226){return _1221([_1226],{url:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showLoadingOverlay:false,legacyDialogObject:null,defaultActionsVisible:false,legacyButtonQuery:null,contentClass:"epi-dialog-fullWidth",dialogClass:"",dialogTitle:null,_legacyDialogContainer:null,_legacyDialogLoadDeferred:null,wrapper:null,buildRendering:function(){this.inherited(arguments);_1222.add(this.domNode,"epi-legacyDialog");},postCreate:function(){this.inherited(arguments);this._legacyDialogContainer=_1223.create("div");this.set("content",this._legacyDialogContainer);},onCallback:function(_1227,_1228){},onClose:function(){},onLoad:function(_1229){},onMapDialogButton:function(_122a){return true;},onBeforePerformAction:function(_122b){},show:function(){var _122c=new _1225([this._loadLegacyDialog(),this.inherited(arguments)]);return _122c.then(lang.hitch(this,function(_122d){var _122e=_122d[1];if(this.features&&this.features.left&&this.features.top){this.dialog._relativePosition={x:this.features.left,y:this.features.top};}return _122e;}));},_loadLegacyDialog:function(){if(this._legacyDialogLoadDeferred){return this._legacyDialogLoadDeferred;}this._legacyDialogLoadDeferred=new _1224();require(["epi-cms/legacy/LegacyDialogWrapper"],lang.hitch(this,function(_122f){var _1230=new _122f({url:this.url,dialogArguments:this.dialogArguments,callbackArguments:this.callbackArguments,features:this.features,autoFit:this.autoFit,showLoadingOverlay:this.showLoadingOverlay,dialogTitle:this.dialogTitle,legacyButtonQuery:this.legacyButtonQuery,showCloseButton:this.showCloseButton,opener:this.opener},this._legacyDialogContainer);if(this._started&&!_1230._started){_1230.startup();}this.legacyDialogObject=_1230.getLegacyDialog();this.connect(_1230,"onMapDialogButton",this.onMapDialogButton);this.connect(_1230,"onBeforePerformAction",this.onBeforePerformAction);this.connect(_1230,"onCallback",function(_1231,_1232){this.onCallback(_1231,_1232);setTimeout(lang.hitch(this,function(){this.hide();}),1);});this.connect(_1230,"onLoad",function(){this.set("title",_1230.title);this.onLoad(_1230);});this.connect(_1230,"onCancel",function(){this.hide();});this.connect(_1230,"onResize",function(){this.resize();});this.connect(this,"onHide",function(){this.onClose();});this.wrapper=_1230;this._legacyDialogLoadDeferred.resolve();}));return this._legacyDialogLoadDeferred;}});});},"epi-cms/contentediting/command/_LegacyDialogCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","epi/routes","epi/shell/command/_Command","epi/UriParser","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup"],function(_1233,lang,_1234,topic,_1235,_1236,_1237,_1238,_1239){return _1233([_1236],{dialogPath:null,raiseCloseEvent:null,routeParams:null,dialogParams:null,canExecute:true,getContentReference:function(_123a){var _123b=lang.getObject("model.contentData.contentLink",false,this),_123c=_123b?new _1238(_123b):null;if(_123c){_123c=_123a?_123c.toString():_123c.createVersionUnspecificReference().toString();}return _123c;},getRouteParams:function(){return {id:this.getContentReference(),path:this.dialogPath,moduleArea:"LegacyCMS",IsInLegacyWrapper:true};},getDialogParams:function(){return {};},_createDialog:function(_123d,_123e){var _123f={url:_1235.getActionPath(_123e),dialogArguments:window.document,autoFit:true,onClose:lang.hitch(this,function(){var _1240=this.getContentReference();if(this.raiseCloseEvent&&_1240){topic.publish("/epi/cms/contentdata/updated",{contentLink:_1240,recursive:true});}})};return new _1239(lang.mixin({},_123f,_123d));},_execute:function(){_1234([this.getDialogParams(),this.getRouteParams()]).then(lang.hitch(this,function(_1241){var _1242=this._createDialog.apply(this,_1241);_1242.show();}));}});});},"epi-cms/command/DownloadMedia":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/has","dojo/sniff","dojo/when","epi/shell/Downloader","epi/shell/TypeDescriptorManager","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_1243,_1244,_1245,has,sniff,when,_1246,_1247,_1248,_1249,_124a){return _1243([_1248,_1249],{label:_124a.download,tooltip:_124a.download,iconClass:"epi-iconDownload",_execute:function(){var _124b=this._getContentData();if(!_124b){return;}_1246.download(_124b.downloadUrl,_124b.name);},_onModelChange:function(){var _124c=this._getContentData(),_124d=_124c&&_124c.downloadUrl,_124e=_124c&&_124c.typeIdentifier,_124f=_124e&&_1247.getValue(_124e,"actAsAnAsset");this.set("canExecute",!!(_124f&&_124d));},_getContentData:function(){var _1250=null;if(this.selection&&this.selection.data&&this.selection.data instanceof Array&&this.selection.data.length===1){_1250=this.selection.data[0].data;}return _1250;}});});},"epi-cms/widget/HierarchicalList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/DestroyableByKey","epi/shell/widget/dialog/Alert","epi/shell/widget/ContextMenu","epi/shell/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/HierarchicalListViewModel","dojo/text!./templates/HierarchicalList.html","dojo/text!./templates/AssetsDropZone.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(array,_1251,lang,_1252,_1253,_1254,_1255,_1256,keys,on,when,_1257,_1258,_1259,_125a,_125b,_125c,_125d,_125e,_125f,Alert,_1260,_1261,_1262,_1263,_1264,_1265,_1266,_1267,_1268,res){return _1251([_1259,_1257,_1258,_125e,_125d,_125f],{contextMenu:null,templateString:_1267,showRoot:false,showThumbnail:false,enableDndFileDropZone:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_1266,hierarchicalListClass:"",noDataMessage:"",noSearchResultMessage:res.nosearchresults,createContentIcon:"",createContentText:"",modelBindingMap:{searchRoots:["searchRoots"],searchArea:["searchArea"],listQuery:["listQuery"],currentTreeItem:["currentTreeItem"],currentListItem:["currentListItem"],editingListItem:["editingListItem"],searchListQuery:["searchListQuery"]},_setSearchAreaAttr:function(value){this.searchBox.set("area",value);},_setSearchRootsAttr:function(value){this.searchBox.set("searchRoots",value);},_setListQueryAttr:function(value){this.list.set("query",value);},_setSearchListQueryAttr:function(value){this.searchResultList.set("query",value);this._showSearchResults(value);},_setCurrentTreeItemAttr:function(value){if(value){this._toggleActive(this.tree,this.list);when(this.tree.selectContent(value.toString()),lang.hitch(this,function(){var _1269=this.tree.getNodesByItem(value.toString())[0];if(_1269){this.tree.model.set("previousSelection",{selectedContent:_1269,selectedAncestors:_1269.getTreePath()});}}));}},_setCurrentListItemAttr:function(value){this.list.set("currentItem",value);this._toggleActive(this.list,this.tree);},_setEditingListItemAttr:function(value){this.list.set("editingItem",value);},_setShowRootAttr:function(value){this.tree.set("showRoot",value);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _126a=_1251(this.modelClassName);this.model=this.commandProvider=new _126a({repositoryKey:this.repositoryKey});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _1260({category:"context"}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_1253.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();if(this.enableDndFileDropZone){this._setupDropZone();}this._toggleCreateContentArea(this.showCreateContentArea);this.model.startup();this.own(this.model.clipboardManager.watch("data",lang.hitch(this,this._updateClipboardIndicators)),this.searchBox.on("searchBoxChange",lang.hitch(this,this._onSearchTextChanged)),this.model.watch("isSearching",lang.hitch(this,function(){if(this._dropZone){this._dropZone.set("enabled",!this.model.get("isSearching"));}})));},startup:function(){this.inherited(arguments);if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){if(this.enableDndFileDropZone){var grid=this.list.grid;if(grid){_1253.add(grid.bodyNode,"epi-drop-area");}var _126b=this.searchResultList.grid;if(_126b){_1253.add(_126b.bodyNode,"epi-drop-area");}}var _126c=_1255.getMarginBox(this.searchBoxNode),_126d={h:this._contentBox.h-_126c.h,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_126d);},_toggleCreateContentArea:function(_126e){_1256.set(this.createContentArea.domNode,"display",_126e?"":"none");this.listContainer.layout();},_toggleActive:function(_126f,_1270){_1253.remove(_1270.domNode,"epi-focused");_1253.add(_126f.domNode,"epi-focused");},_showNotification:function(_1271){var _1272=new Alert({description:_125c.toHTML(_1271)});_1272.show();},_onSearchTextChanged:function(_1273){this._wireItemSelectedEvent(_1273?this.searchResultList:this.list);this.model.onSearchTextChanged(_1273);},_showSearchResults:function(_1274){_1256.set(this.contentNode,"display",!!_1274?"none":"");_1256.set(this.resultNode,"display",!_1274?"none":"");this.container.layout();},_onDrop:function(evt,_1275){_1275=_1265.filterFileOnly(_1275);if(!_1275||_1275.length<=0){return;}var _1276=this.model.getCommand("uploadDefault");if(!_1276){return;}_1276.set("fileList",_1275);_1276.execute();this.searchBox.clearValue();},_setupDropZone:function(){this.own(this._dropZone=new _1264({templateString:_1268,res:res,outsideDomNode:this.container.domNode}));_1254.place(this._dropZone.domNode,this.domNode,"first");this.connect(this._dropZone,"onDrop",this._onDrop);var _1277=this.model.getCommand("uploadDefault");if(_1277){var _1278=this._dropZone;this.own(_1277.watch("canExecute",function(name,_1279,_127a){_1278.set("enabled",_127a);}));}},_setupTree:function(){var _127b=this.model._commandRegistry;function _127c(item,node,e){this.model.onTreeItemSelected(item,this.tree.model.isTypeOfRoot(item));};function _127d(copy){copy?_127b.copy.command.execute():_127b.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_127d),on(this.tree,"select",lang.hitch(this,_127c)),on(this.tree,"paste",function(){_127b.paste.command.execute();}),on(this.tree,"delete",function(){_127b["delete"].command.execute();}),_1252.after(this.tree,"onClick",lang.hitch(this,_127c),true));this.model._commandRegistry.rename.command.set("renameDelegate",lang.hitch(this,function(model){this.tree.getNodesByItem(model)[0].edit();}));},_setupCreateContentArea:function(){this.createContentAreaButton.set("iconClass",this.createContentIcon);this.createContentAreaButton.set("label",this.createContentText);this.own(this.createContentAreaButton.on("click",lang.hitch(this,"_onCreateAreaClick")));},_wireItemSelectedEvent:function(list){this.destroyByKey("itemSelectedWatch");this.ownByKey("itemSelectedWatch",on(list,"itemSelected",lang.hitch(this.model,this.model.onListItemSelected)));},_setupList:function(){var _127e=this.model._commandRegistry;this._wireItemSelectedEvent(this.list);this.own(_1252.after(this.model,"onListItemUpdated",lang.hitch(this.list,function(_127f){when(_127f,lang.hitch(this,this.editContent));})),this.searchResultList.grid.addKeyHandler(keys.ESCAPE,lang.hitch(this.searchBox,this.searchBox.clearValue)),_1252.after(this.model.treeStoreModel,"onDeleted",lang.hitch(this,function(items){array.forEach(items,function(item){var _1280=this.searchResultList.grid.row(item.data.contentLink);if(_1280&&_1280.data){this.searchResultList.grid.removeRow(_1280);}},this);}),true));this.searchBox.on("keyup",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER){e.preventDefault();this.searchResultList.editSelectedContent();}}));this.searchBox.on("keydown",lang.hitch(this,function(e){if(e.keyCode===keys.DOWN_ARROW||e.keyCode===keys.UP_ARROW){e.preventDefault();this.searchResultList.grid.moveSelection(e.keyCode===keys.UP_ARROW);}}));if(this.model.changeContextOnItemSelection){var _1281=function(){_127e.edit.command.execute();};this.own(on(this.list,"itemAction",_1281),on(this.searchResultList,"itemAction",_1281));}if(this.showThumbnail){_1253.add(this.list.grid.domNode,"epi-thumbnailContentList");_1253.add(this.searchResultList.grid.domNode,"epi-thumbnailContentList");}this.list.set("noDataMessage",this.noDataMessage);this.searchResultList.set("noDataMessage",this.noSearchResultMessage);},_onCreateAreaClick:function(){this.list.emit("createItemAction",{});},_onSearchAction:function(value){this.model.onSearch(value.metadata);},_updateClipboardIndicators:function(name,_1282,_1283){var _1284=this.model.clipboardManager.isCopy();if(_1282 instanceof Array){array.forEach(_1282,function(clip){this.tree.toggleCut(clip.data,false);this.list.toggleCut(clip.data,false);this.searchResultList.toggleCut(clip.data,false);},this);}if(!_1284&&_1283 instanceof Array){array.forEach(_1283,function(clip){this.tree.toggleCut(clip.data,true);this.list.toggleCut(clip.data,true);this.searchResultList.toggleCut(clip.data,true);},this);}}});});},"epi-cms/widget/FolderTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/aspect","dojo/json","dojo/when","dojox/html/entities","dijit/tree/_dndSelector","epi/dependency","epi/string","epi-cms/widget/_FolderTreeNode","epi-cms/widget/ContentTree","epi-cms/widget/ContentTreeStoreModel"],function(array,_1285,lang,_1286,_1287,_1288,json,when,_1289,_128a,_128b,_128c,_128d,_128e,_128f){return _1285([_128e],{handleSelection:true,postCreate:function(){var self=this;self.inherited(arguments);self.own(self.connect(self.model,"onDeleted",lang.hitch(self,self._onDeleted)),_1288.around(self.model,"onRefreshRoots",function(_1290){return function(_1291){if(_1291&&typeof self._onItemDelete==="function"){self._onItemDelete(_1291);}return _1290.apply(self.model,[_1291]);};}));},toggleCut:function(item,isCut){var node=this.tree.getNodesByItem(item)[0];if(node){_1287.toggle(node.rowNode,"epi-opacity50",isCut);}},_createTreeModel:function(){return new _128f({store:this.store});},_updateItemDeletedHierachy:function(node){if(!node){return;}array.forEach(node.getChildren(),function(_1292){_1292.set({item:lang.mixin(_1292.item,{isDeleted:true})});this._updateItemDeletedHierachy(_1292);},this);},_onDeleted:function(item){var nodes=this.getNodesByItem(item);array.forEach(nodes,function(node){this._updateItemDeletedHierachy(node);},this);},_renameFolder:function(item,name){var _1293=lang.trim(name),_1294=this.getNodesByItem(item)[0];if(_1293){when(this.model.rename(item.contentLink,_1293)).otherwise(function(ex){_1294.rollbackLabel(item.name,ex);_1294.edit();});}else{_1294.rollbackLabel(item.name);}},buildNodeFromTemplate:function(args){var _1295=new _128d(args);_1295.bindContextMenu(this.contextMenu);this.own(_1295.on("rename",lang.hitch(this,function(val){this._renameFolder(_1295.item,val);})));return _1295;},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node._handleMouseEnter();},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node._handleMouseLeave();},_onClick:function(node,evt){this.inherited(arguments);node._onClick();}});});},"epi-cms/widget/_FolderTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_1296,lang,_1297,_1298,_1299,_129a,_129b,_129c,keys,on,when,_129d,_129e,_129f,_12a0,_12a1,epi,_12a2){_1296("_TreeInlineEditor",[_12a1._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});var _12a3={normal:0,root:1};return _1296([_12a2,_129b],{templateString:_129e,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_129a.set(this.iconNodeMenu,"zIndex",_1299.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _12a1({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:lang.hitch(this,this._onChangeLabelValue),onCancel:lang.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",lang.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!==keys.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_1298.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,error){if(!this.labelWidget.value){this._resetValue(val);}if(error&&error.length>0){this._setEditorState(error[0].errorMessage);}},bindContextMenu:function(menu){this.contextMenu=menu;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var self=this,def=new _129c();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState^self._rowStates.EXPANDED;self._updateStyle();def.resolve(true);});return def;},expand:function(){var self=this,def=new _129c();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState|self._rowStates.EXPANDED;self._updateStyle();def.resolve();});return def;},setSelected:function(_12a4){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _12a5=this._currentRowState;this._currentRowState=_12a4?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_12a5;this._updateStyle();if(_12a4){this.emit("nodeSelected",this);}},_updateIndividualLayout:function(){this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_1298.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_1298.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_12a6){var _12a7=this._rowStates;switch(_12a6){case _12a7.SELECTED:case _12a7.ENTERED:if(this.contextMenu){_1298.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_1298.remove(this.iconNodeMenu,this._blockFolderMenu);}_1298.remove(this.iconNode,this._blockFolderExpand);_1298.remove(this.iconNode,this._blockFolderCollapse);var _12a8=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_1298.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_12a8);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_1298.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){for(var _12a9 in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_12a9],10)>0){this._updateStyleBySingleState(this._rowStates[_12a9]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_1297.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_12aa){if(this._editWidget){_12aa=_129d.encode(_12aa);this._editWidget.invalidMessage=_12aa||"";this._editWidget.set("state",_12aa?"Error":"");this._editWidget.isValid=function(){return !_12aa;};this._editWidget.validate();}}});});},"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\r\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/ContentList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/aspect","dojo/Evented","dojo/on","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dojox/html/entities","epi","epi/shell/dgrid/Formatter","epi/shell/dgrid/selection/Extensions","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ReadOnlyContentList"],function(_12ab,lang,_12ac,_12ad,_12ae,_12af,on,_12b0,_12b1,_12b2,_12b3,epi,_12b4,_12b5,_12b6,_12b7,_12b8,DnD,_12b9,_12ba){return _12ab([_12ba,_12af],{_gridClass:_12ab([_12b1,_12b4,_12b2,_12b5,DnD,_12b0,_12b9]),resources:"",noDataMessage:null,editingItem:null,postCreate:function(){this.inherited(arguments);_12ac.add(this.domNode,"epi-contentList");},_setCurrentItemAttr:function(value){if(!this.get("editingItem")){this.set("editingItem",value);}this._set("currentItem",value);this.select(value);},_setNoDataMessageAttr:function(value){this.noDataMessage=value;this.grid.set("noDataMessage",value);},_dndNodeCreator:function(item,hint){var _12bb=_12b6.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_12bb&&this.dndTypes){_12bb=this.dndTypes;}return {node:_12ad.create("div").appendChild(document.createTextNode(item.name)),type:_12bb,data:item};},getListSettings:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:epi.resources.action.options}};return lang.delegate(this._getBaseSettings(menu),{noDataMessage:this.noDataMessage,dndParams:{copyOnly:true,selfAccept:false,accept:[],creator:lang.hitch(this,this._dndNodeCreator)}});},setupEvents:function(){this.inherited(arguments);this.own(_12ae.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)),this.grid.on("dgrid-contextmenu",lang.hitch(this,"_itemSelected")));},_onSelect:function(evt){this.inherited(arguments);if(this.grid.selectionMode==="single"){this._itemSelected(evt.rows[0].element);}},_itemSelected:function(_12bc){var row=this.grid.row(_12bc);this.emit("itemSelected",row.data);},editContent:function(item){if(!item||!this.grid.row(item).element){return;}this.emit("itemAction",item);this.set("editingItem",this.currentItem);},editSelectedContent:function(){var _12bd=this.grid.getFirstSelectedRow();if(!_12bd){return;}this.editContent(_12bd.data);},_onChangeContext:function(evt){var grid=this.grid;on.once(grid.domNode,"dgrid-refresh-complete",function(evt){grid.focus(grid.getFirstSelectedRow());});this.editContent(grid.row(evt).data);},toggleCut:function(item,isCut){var row;if(item){row=this.grid.row(_12b7.toContentReference(item.contentLink).id);if(row&&row.element){_12ac.toggle(row.element,"epi-opacity50",isCut);}}}});});},"epi/shell/dgrid/selection/Extensions":function(){define("epi/shell/dgrid/selection/Extensions",["dojo/_base/declare","dojo/query"],function(_12be,query){return _12be([],{moveSelectionUp:function(){return this.moveSelection(true);},moveSelectionDown:function(){return this.moveSelection(false);},moveSelection:function(up){var _12bf=this.getFirstSelectedRow();if(!_12bf){return this._selectFirstRow();}this.clearSelection();_12bf=up?this.up(_12bf,1,true):this.down(_12bf,1,true);this.select(_12bf,1,true);return _12bf;},hasSelection:function(){return Object.keys(this.selection).length>0;},getFirstSelectedRow:function(){if(!this.hasSelection()){return null;}var row=this.row(Object.keys(this.selection)[0]);if(row&&!row.data){return null;}return row;},_selectFirstRow:function(){var rows=query(".dgrid-row",this.domNode);if(rows.length===0){return null;}var _12c0=this.row(rows[0]);if(!_12c0){return null;}this.select(_12c0,1,true);return _12c0;}});});},"epi-cms/widget/FilesUploadDropZone":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone","dojo/text!./templates/FilesUploadDropZone.html"],function(_12c1,lang,_12c2,_12c3,_12c4,_12c5,_12c6,_12c7){return _12c1([_12c4,_12c5],{res:_12c6,templateString:_12c7,dragStartCssClass:"epi-dragStart",dragOverCssClass:"epi-dragOver",outsideDomNode:null,enabled:true,postCreate:function(){this.inherited(arguments);if(this.outsideDomNode){this.connect(this.outsideDomNode,"dragover",lang.hitch(this,this._onDragOverOutside));this.connect(this.outsideDomNode,"dragleave",lang.hitch(this,function(evt){this._onDragLeave(evt,this.outsideDomNode);}));this.connect(this.outsideDomNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.outsideDomNode,"drop",lang.hitch(this,this._onDragLeave));}this.connect(this.domNode,"dragover",lang.hitch(this,this._onDragOver));this.connect(this.domNode,"dragleave",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"drop",lang.hitch(this,this._onDrop));},_onDragOverOutside:function(evt){if(!this.enabled){return;}evt.preventDefault();_12c2.add(this.domNode,this.dragStartCssClass);},_isHover:function(evt,_12c8){var _12c9=_12c3.position(_12c8),_12ca=evt.clientX,_12cb=evt.clientY;return !(_12ca<_12c9.x||_12ca>(_12c9.x+_12c9.w)||_12cb<_12c9.y||_12cb>(_12c9.y+_12c9.h));},_onDragOver:function(evt){if(!this.enabled){return;}evt.preventDefault();_12c2.remove(this.domNode,this.dragStartCssClass);_12c2.add(this.domNode,this.dragOverCssClass);},_onDragLeave:function(evt,_12cc){if(!this.enabled){return;}evt.preventDefault();if(!this._isHover(evt,_12cc||this.domNode)){this._removeAllCssClasses();}},onDrop:function(evt,files){},_onDrop:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();this.onDrop(evt,evt.dataTransfer.files);},_removeAllCssClasses:function(){_12c2.remove(this.domNode,this.dragStartCssClass);_12c2.remove(this.domNode,this.dragOverCssClass);}});});},"url:epi-cms/widget/templates/FilesUploadDropZone.html":"<div class=\"epi-filesUploadDropZone\">\r\n    <div>\r\n        <span data-dojo-attach-point=\"description\">${res.description}</span>\r\n    </div>\r\n</div>","url:epi-cms/widget/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxNode\">\r\n        <div data-dojo-attach-point=\"searchBox\"\r\n             data-dojo-type=\"epi/shell/widget/SearchBox\"\r\n             data-dojo-props=\"triggerContextChange: this.triggerContextChange, triggerChangeOnEnter: true, encodeSearchText: true\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"container\"\r\n         data-dojo-type=\"dijit/layout/BorderContainer\"\r\n         data-dojo-props=\"gutters: false\">\r\n\r\n        <div data-dojo-attach-point=\"contentNode\">\r\n            <div class=\"epi-secondaryGadgetContainer epi-gadgetTopContainer\"\r\n                 data-dojo-attach-point=\"tree\"\r\n                 data-dojo-type=\"epi-cms/widget/FolderTree\"\r\n                 data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu\"></div>\r\n            <div class=\"epi-gadgetBottomContainer\"\r\n                 data-dojo-attach-point=\"listContainer\"\r\n                 data-dojo-type=\"dijit/layout/BorderContainer\"\r\n                 data-dojo-props=\"region:'bottom', splitter:true, gutters: false\">\r\n                <div class=\"epi-createContentContainer\"\r\n                     data-dojo-attach-point=\"createContentArea\"\r\n                     data-dojo-type=\"dijit/layout/_LayoutWidget\"\r\n                     data-dojo-props=\"region:'top', splitter:false\">\r\n                    <button type=\"button\" class=\"epi-flat epi-chromeless\"\r\n                            data-dojo-type=\"dijit/form/Button\"\r\n                            data-dojo-attach-point=\"createContentAreaButton\"></button>\r\n                </div>\r\n                <div data-dojo-attach-point=\"list\"\r\n                     data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                     data-dojo-props=\"region:'center', splitter:false, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"resultNode\" style=\"display:none\">\r\n            <div data-dojo-attach-point=\"searchResultList\"\r\n                 data-dojo-type=\"epi-cms/widget/ContentList\"\r\n                 data-dojo-props=\"region:'center', splitter:false, store: this.model.searchStore, queryOptions: this.model.searchResultQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n","url:epi-cms/widget/templates/AssetsDropZone.html":"<div class=\"epi-assetsDropZone\">\r\n    <span class=\"dijitReset dijitInline epi-dropZoneText\">${res.dropzonedescription}</span>\r\n</div>\r\n","epi-cms/component/PageNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi-cms/ApplicationSettings","../command/NewContent","./command/ViewTrash","./ContentNavigationTree","epi/i18n!epi/cms/nls/episerver.cms.components.createpage"],function(array,_12cd,lang,topic,when,_12ce,_12cf,_12d0,_12d1,_12d2){return _12cd([_12d1],{betweenThreshold:5,expandExtraNodeItems:_12ce.startPage,allowSorting:true,postMixInProperties:function(){this.inherited(arguments);this.checkAcceptance=lang.hitch(this,this.checkAcceptance);this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);},checkAcceptance:function(_12d3,nodes){return _12d3===this.tree.dndController;},checkItemAcceptance:function(_12d4,_12d5,_12d6){return this.allowSorting||_12d6==="over";},_startupCommands:function(){this.inherited(arguments);this._createCommand=new _12cf({order:10,contentType:this.settings.containedTypes[0],iconClass:"epi-iconPlus",label:_12d2.command.label,resources:_12d2});this.commands=array.filter(this.commands,lang.hitch(this,function(_12d7){return !(_12d7 instanceof _12cf);}));this._viewTrashCommand=new _12d0({typeIdentifiers:this.typeIdentifiers,order:100});this.commands.push(this._createCommand);this.commands.push(this._viewTrashCommand);},_setShowAllLanguagesAttr:function(value){this.inherited(arguments);this.allowSorting=!!value;},getIconClass:function(item,_12d8){var _12d9=array.some(this.model.roots,function(root){return root===this.model.getIdentity(item);},this);if(_12d9){return "epi-iconObjectRoot";}else{if(item.isStartPage){return "epi-iconObjectStart";}else{return this.inherited(arguments);}}}});});},"epi-cms/component/ContentNavigationTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(array,_12da,_12db,lang,_12dc,topic,when,_12dd,_12de,_12df,_12e0,_12e1,_12e2,Alert,_12e3,_12e4,_12e5,_12e6,_12e7,_12e8,_12e9,_12ea,_12eb,_12ec,_12ed,_12ee,_12ef,_12f0,_12f1,_12f2,_12f3,_12f4,res){return _12db([_12ed,_12e4,_12e0,_12e5],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_12ea,nodeConstructor:_12e9,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _12df();this.selection=new _12e1();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",lang.hitch(this,function(copy){copy?this._copyCommand.execute():this._cutCommand.execute();})),this.on("paste",lang.hitch(this,function(){when(this._pasteCommand.execute(),lang.hitch(this,function(){this.selectedNode.expand();}));})),this.on("delete",lang.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("select",lang.hitch(this,this._onTreeNodeClicked)));this.connect(this,"onClick","_onTreeNodeClicked");var _12f5=lang.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_12f5);this.subscribe("/dnd/cancel",_12f5);},startup:function(){this.inherited(arguments);when(this.getCurrentContext(),lang.hitch(this,function(_12f6){this.contextChanged(_12f6);}));},_preparePathNodes:function(paths){var self=this,_12f7;array.some(paths,function(_12f8,index){var nodes=self.getNodesByItem(_12f8),_12f9=nodes.length===1&&!nodes[0];if(index>0&&_12f9){array.forEach(_12f7,function(_12fa){if(_12fa.state==="LOADED"){_12fa._loadDeferred=null;}});return true;}_12f7=nodes;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showLanguagesCommand=new _12e8({model:this});var _12fb=this._contextMenuCommandProvider.get("commands");array.some(_12fb,lang.hitch(this,function(_12fc){if(_12fc instanceof _12f0){this._copyCommand=_12fc;}else{if(_12fc instanceof _12f1){this._cutCommand=_12fc;}else{if(_12fc instanceof _12f3){this._pasteCommand=_12fc;}else{if(_12fc instanceof _12f2){this._deleteCommand=_12fc;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showLanguagesCommand].concat(_12fb);},_setShowAllLanguagesAttr:function(value){this._set("showAllLanguages",value);this.model.set("showAllLanguages",value);},_onTreeNodeClicked:function(page,node,event){when(this.getCurrentContext(),lang.hitch(this,function(_12fd){var _12fe=true;if(_12fd&&_12ec.isContentReference(_12fd.id)){_12fe=_12ec.compareIgnoreVersion(page.contentLink,_12fd.id);}var _12ff=function(_1300){var _1301={typeName:_12e2.getResourceValue(page.typeIdentifier,"name"),name:page.name};topic.publish("/epi/shell/context/request",{uri:page.uri},{sender:lang.mixin(_1300,{requestedContent:_1301}),forceContextChange:true});};if(!_12fe){_12ff(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_12ff,300);}));},contentContextChanged:function(_1302,_1303){var _1304=new _12ec(_1302.id),_1305=_1304.createVersionUnspecificReference().toString(),_1306=_12e6.wastebasketPage.toString();this.inherited(arguments);if(_1305===_1306){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_1305;if(_1303&&_1303.sender===this&&this.selectedItem&&_1305===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_1302.dataType)){this.selectContent(_1305,false,true).then(lang.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_1307){return this.tree.model.isSupportedType(_1307);},_getSelectionData:function(_1308){return _1308?[{type:"epi.cms.contentdata",data:_1308}]:[];},_updateGlobalToolbarButtons:function(_1309){var node=_1309||this.get("selectedNode"),_130a=node?this._getSelectionData(node.item):[];if(this._createCommand){this._createCommand.set("model",node&&node.item);}this._contextMenuCommandProvider.updateCommandModel(node&&node.item);this.selection.set("data",_130a);},contextChangeFailed:function(_130b,_130c,_130d){this.inherited(arguments);if(_130b){if(_130d&&_130d.sender===this){this.selectContent(_130b.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!==this.selectedNode&&this._focusNode.rowNode){_12dc.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_12dc.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(value){this._removeHighlightClass();this._focusNode=value;},_showContextMenu:function(evt){if(!this._contextMenu){this.own(this._contextMenu=new _12ee({leftClickToOpen:true,category:"context",popupParent:this}),_12da.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_12da.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _130e=this.inherited(arguments);if(_130e.item.contentLink===this.tree.model.rootPage){var _130f=array.filter(_130e.domNode.children,function(_1310){return _1310.className===this._separatorAfterCssClass;},this);}_130e.on("onContextMenuClick",lang.hitch(this,function(node){this._updateGlobalToolbarButtons(node.node);this.set("_focusNode",node.node);this._showContextMenu(node);}));return _130e;},getIconClass:function(item,_1311){var _1312=this.inherited(arguments);if(!item||!item.properties||!item.properties.pageShortcutType){return _1312;}var _1313="";switch(item.properties.pageShortcutType){case _12e7.pageShortcutTypes.Shortcut:_1313="epi-iconObjectInternalLink";break;case _12e7.pageShortcutTypes.External:_1313="epi-iconObjectExternalLink";break;case _12e7.pageShortcutTypes.Inactive:_1313="epi-iconObjectNoLink";break;case _12e7.pageShortcutTypes.FetchData:_1313=!item.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _1313?_1312+" "+_1313:_1312;},enableDrop:function(node,_1314){node._droppable=_1314;},_showNotificationMessage:function(_1315){var _1316=new Alert({description:_12de.toHTML(_1315)});_1316.show();},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node.showContextMenu(true);},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node.showContextMenu(false);}});});},"epi-cms/contentediting/PageShortcutTypeSupport":function(){define([],function(){return {pageShortcutTypes:{Normal:0,Shortcut:1,External:2,Inactive:3,FetchData:4}};});},"epi-cms/command/ShowAllLanguages":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command"],function(_1317,lang,when,_1318,_1319,_131a,_131b,_131c){return _1317([_131b],{property:"showAllLanguages",category:"setting",order:50,_watchHandle:null,postscript:function(){this.inherited(arguments);this.currentContentLanguage=this.currentContentLanguage||_131a.currentContentLanguage;this.store=this.store||_1319.resolve("epi.storeregistry").get("epi.cms.language");when(this.store.get(this.currentContentLanguage),lang.hitch(this,function(_131d){this.set("label",lang.replace(_131c.showonlycontentin,[_1318.encode(_131d.name)]));}));},_execute:function(){this.set("active",!this.active);this.model.set(this.property,!this.active);},_onModelChange:function(){if(this.model&&this.model._isSiteMultilingual){when(this.model._isSiteMultilingual(),lang.hitch(this,function(value){this.set("canExecute",value);}));}}});});},"epi-cms/component/_ContentNavigationTreeNode":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/Evented","dojo/mouse","dojo/on","dojo/text!./templates/_ContentNavigationTreeNode.html","epi/datetime","epi/dependency","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/Tooltip","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(array,_131e,event,lang,_131f,_1320,_1321,mouse,on,_1322,_1323,_1324,_1325,_1326,_1327,_1328,_1329,_132a,res){return _131e([_1329,_1326,_1321],{templateString:_1322,res:res,hasContextMenu:true,_pageLocked:"epi-pt-accessRights",_pageBeingEdited:"epi-pt-edited",_contextMenuClass:"epi-iconContextMenu",_iconNodeClass:"",_selected:false,_contentTypeStore:null,postMixInProperties:function(){this.inherited(arguments);var _132b=_1324.resolve("epi.storeregistry");this._contentTypeStore=_132b.get("epi.cms.contenttype");},postCreate:function(){this.inherited(arguments);this.set("model",new _132a({contentStatus:this.item.status}));},modelBindingMap:{statusIcon:["statusIcon"],statusMessage:["statusMessage"]},_setStatusMessageAttr:function(_132c){_131f.set(this.iconNodeStatus,"title",_1325.toTooltipText(_132c));},_setStatusIconAttr:function(_132d){if(!(_132d instanceof Array)){return;}_1320.remove(this.iconNodeStatus);_1320.add(this.iconNodeStatus,"dijitTreeIcon epi-extraIcon");array.forEach(_132d,function(_132e){_1320.add(this.iconNodeStatus,_132e);},this);},setSelected:function(_132f){this.inherited(arguments);if(this.hasContextMenu){_1320.toggle(this.iconNodeMenu,this._contextMenuClass,this._selected=_132f);}},showContextMenu:function(show){if(!this._selected&&this.hasContextMenu){_1320.toggle(this.iconNodeMenu,this._contextMenuClass,show);}},_onClickIconNodeMenu:function(evt){event.stop(evt);this.labelNode.focus();this.emit("onContextMenuClick",{node:this,target:evt.target,x:evt.pageX,y:evt.pageY});},_onMouseDownIconNodeMenu:function(evt){event.stop(evt);},_updateIndividualLayout:function(){this._updateAccessRightIcon();if(this.model){this.model.set("contentStatus",this.item.status);}},_updateAccessRightIcon:function(){if(this.item.accessMask===0||this.item.accessMask===1){_1320.add(this.iconNodeAccess,this._pageLocked);_131f.set(this.iconNodeAccess,"title",this.res.tooltip.pagelocked);_1320.add(this.contentNode,"epi-treeReadOnly");}else{if(this.item.inUseNotifications&&this.item.inUseNotifications.length>0){_1320.add(this.iconNodeAccess,this._pageBeingEdited);var _1330=[this.res.tooltip.beingedited];array.forEach(this.item.inUseNotifications,function(_1331){var date=_1323.toUserFriendlyString(new Date(_1331.created));_1330.push(_1331.userName+", "+date);},this);_131f.set(this.iconNodeAccess,"title",_1330.join("\n"));}else{_1320.remove(this.iconNodeAccess,this._pageBeingEdited);_1320.remove(this.iconNodeAccess,this._pageLocked);_131f.set(this.iconNodeAccess,"title","");_1320.remove(this.contentNode,"epi-treeReadOnly");}}}});});},"url:epi-cms/component/templates/_ContentNavigationTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\" data-dojo-attach-event=\"onmousedown:_onMouseDownIconNodeMenu, click: _onClickIconNodeMenu\" >&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeStatus\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeAccess\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\r\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi/shell/widget/Tooltip":function(){define("epi/shell/widget/Tooltip",["dojo/_base/declare","dojo/string","dojox/html/entities","dojox/html/ellipsis","dijit/Tooltip"],function(_1332,_1333,_1334,_1335,_1336){return _1332(_1336,{showDelay:600,position:["after","before","below","above"],tooltipRows:null,tooltipRowTemplate:"<span>${label}</span>: ${text}",tooltipRowNoTextTemplate:"<span>${label}</span>",getContent:function(){if(this.tooltipRows){var _1337="<ul class='dijitInline dijitReset epi-tooltip-ellipsis'>";for(var i=0;i<this.tooltipRows.length;i++){var row=this.tooltipRows[i];if(!row.text){row.text="";}if(row.htmlEncode===undefined||row.htmlEncode===true){row.label=_1334.encode(row.label);row.text=_1334.encode(row.text);}if(!row.text){_1337+="<li class='dojoxEllipsis'>"+_1333.substitute(this.tooltipRowNoTextTemplate,row)+"</li>";}else{_1337+="<li class='dojoxEllipsis'>"+_1333.substitute(this.tooltipRowTemplate,row)+"</li>";}}_1337+="</ul>";return _1337;}return this.inherited(arguments);}});});},"epi-cms/widget/viewmodel/ContentStatusViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","dojo/Stateful","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/_ContextMixin","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(array,_1338,_1339,lang,when,all,_133a,_133b,_133c,_133d,_133e,_133f,_1340){return _1338([_133a,_133e],{_contentStructureStore:null,autoLoadStatus:false,statusIcon:null,statusMessage:null,constructor:function(){this._statusIconMap={0:["epi-statusIndicatorIcon","epi-statusIndicator0"],1:["epi-statusIndicatorIcon","epi-statusIndicator1"],2:["epi-statusIndicatorIcon","epi-statusIndicator2"],3:["epi-statusIndicatorIcon","epi-statusIndicator3"],4:["epi-statusIndicatorIcon","epi-statusIndicator4"],5:["epi-statusIndicatorIcon","epi-statusIndicator5"],6:["epi-statusIndicatorIcon","epi-statusIndicator6"],7:["epi-statusIndicatorIcon","epi-statusIndicator7"],100:["epi-statusIndicatorIcon","epi-statusIndicator100"]};this._statusMessageMap={0:_1340.notcreated,1:_1340.rejected,2:_1340.checkedout,3:_1340.checkedin,4:_1340.published,5:_1340.previouslypublished,6:_1340.delayedpublish,7:_1340.awaitingapproval,100:_1340.expired};},postscript:function(){this.inherited(arguments);this._contentStructureStore=this._contentStructureStore||_133b.resolve("epi.storeregistry").get("epi.cms.content.light");},loadStatus:function(){if(!this.contentLink){return;}when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this._contentStructureStore.refresh(this.contentLink),lang.hitch(this,function(_1341){if(_1341&&_1341.status!==undefined){this.set("content",_1341);}}));}));},_contentLinkSetter:function(_1342){if(!_1342){return;}this.contentLink=_1342;if(this.autoLoadStatus){this.loadStatus();}},_isDeletedGetter:function(){return this.get("content")&&this.get("content").isDeleted;},_isTranslationNeededGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch&&this.get("content").missingLanguageBranch.isTranslationNeeded;},_missingLanguageBranchGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch;},_contentSetter:function(_1343){this.content=_1343;this.set("contentStatus",_1343.status);},_contentStatusSetter:function(_1344){this.contentStatus=_1344;if(!_1344){return;}this.set("statusIcon",this._statusIconMap[_1344]);when(this._getStatusMessage(),lang.hitch(this,function(_1345){this.set("statusMessage",_1345);}));},_getStatusMessage:function(){if(this.get("isDeleted")){return _1340.versionnotfound;}if(this.get("isTranslationNeeded")){return _133f.getMissingLanguageMessage(this.content);}if(this.get("isVisibleOnSite")){return null;}return this._statusMessageMap[this.get("contentStatus")];},_isVisibleOnSiteGetter:function(){var _1346=this.get("missingLanguageBranch");if(this.get("isDeleted")||_1346&&_1346.reason===6){return false;}return this.get("contentStatus")===_133d.versionStatus.Published;}});});},"epi-cms/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/array","epi/shell/command/_CommandProviderMixin","../command/CopyContent","../command/CutContent","../command/PasteContent","../command/TranslateContent","../command/DeleteContent","../widget/CreateCommandsMixin","epi/shell/selection"],function(_1347,array,_1348,_1349,_134a,_134b,_134c,_134d,_134e,_134f){return _1347([_1348,_134e],{treeModel:null,clipboardManager:null,_settings:null,_newContentCommand:null,_translateContentCommand:null,constructor:function(_1350){_1347.safeMixin(this,_1350);},postscript:function(){this.inherited(arguments);this._settings={category:"context",model:this.treeModel,clipboard:this.clipboardManager,selection:new _134f()};this._translateContentCommand=new _134c({category:"context"});var _1351=this.getCreateCommands(),_1352=[];for(var key in _1351){_1352.push(_1351[key].command);}_1352.push(this._translateContentCommand,new _134a(this._settings),new _1349(this._settings),new _134b(this._settings),new _134d(this._settings));this.set("commands",_1352);},updateCommandModel:function(model){array.forEach(this.get("commands"),function(_1353){if(_1353.isInstanceOf(this.createCommandClass)||_1353.popup){_1353.set("model",model);}},this);this._translateContentCommand.set("model",model);this._settings.selection.set("data",[{type:"epi.cms.contentdata",data:model}]);}});});},"epi-cms/component/RecentlyChanged":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/widget/layout/ComponentContainer","epi/shell/widget/dialog/Alert","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.recentlychanged"],function(_1354,lang,epi,_1355,_1356,_1357,_1358,_1359,Alert,_135a,_135b,_135c,_135d,_135e){return _1354([_135d,_1356,_135a],{_componentsController:null,onlyShowMyChanges:false,postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this._componentsController=_1355.resolve("epi.shell.controller.Components");this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _135f=lang.mixin({columns:this._createGridColumns(),store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_135f,this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);var _1360=[new _1358({label:_135e.showmychanges,category:"setting",model:this,property:"onlyShowMyChanges"}),new _1357({iconClass:"epi-iconReload",label:epi.resources.action.refresh,canExecute:true,_execute:lang.hitch(this,function(){this.grid.refresh();})})];this.add("commands",_1360);this.fetchData();},_setOnlyShowMyChangesAttr:function(value){this._set("onlyShowMyChanges",value);if(this._started){this._saveSettingComponent("onlyShowMyChanges",value);}},fetchData:function(){var query=this._getQuery();this.grid.set("query",query.query,query.options);},_getQuery:function(){return {query:{query:"recentlychanged",onlyShowMyChanges:this.onlyShowMyChanges,keepversion:true},options:{ignore:["query"],sort:[{attribute:"saved",descending:true}]}};},_createGridColumns:function(){var _1361={name:{label:epi.resources.header.name,className:"epi-width50",renderCell:lang.hitch(this,this._renderContentItem)},status:{label:epi.resources.header.status,renderCell:function(item,value,node,_1362){node.innerHTML=_135b.getVersionStatus(value);},className:"epi-width15"},saved:{label:epi.resources.header.saved,formatter:this._localizeDate,className:"epi-width25"}};if(!this.get("onlyShowMyChanges")){_1361.changedBy={label:epi.resources.header.by,formatter:this._createUserFriendlyUsername,className:"epi-width10"};}return _1361;},_saveSettingComponent:function(type,value){var item=this._componentsController.getComponentDefinition(this.id),query;if(item){item.settings.onlyShowMyChanges=value;var saved=this._componentsController.saveComponent(item);saved.then(function(done){},function(){var _1363=new Alert({description:_135e.errormessage});_1363.show();});query=this._getQuery();this.grid.query=query.query;this.grid.queryOptions=query.options;this.grid.set("columns",this._createGridColumns());}},onContextChanged:function(_1364){this.grid.clearSelection();var _1365=new _135c(_1364.id).createVersionUnspecificReference().toString();var row=this.grid.row(_1365);if(row){this.grid.select(row);}}});});},"epi-cms/component/SharedBlocks":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","epi-cms/widget/HierarchicalList","epi-cms/component/SharedBlocksViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createblock","epi/i18n!epi/cms/nls/contenttypes.blockdata"],function(array,_1366,lang,_1367,on,_1368,_1369,_136a,res){return _1366([_1368],{showCreateContentArea:false,modelClassName:_1369,noDataMessage:_136a.nocontent,hierarchicalListClass:"epi-blockList",createContentIcon:"epi-iconPlus",createContentText:res.create,buildRendering:function(){this.inherited(arguments);var self=this;this.own(_1367.after(this.list.grid,"renderQuery",function(_136b){_136b.then(function(_136c){var _136d=_136c.length>0?false:self.model.getCommand("newBlockDefault").get("canExecute");self._toggleCreateContentArea(_136d);});}));},_onCreateAreaClick:function(){this.inherited(arguments);this.model._commandRegistry.newBlockDefault.command.execute();},_setupList:function(){this.inherited(arguments);var _136e=this.model._commandRegistry,_136f=this.list;this.own(on(_136f,"copyOrCut",function copyOrCuthandler(copy){copy?_136e.copy.command.execute():_136e.cut.command.execute();}),on(_136f,"delete",function(){_136e["delete"].command.execute();}));}});});},"epi-cms/component/SharedBlocksViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/widget/viewmodel/HierarchicalListViewModel","./command/NewBlock","epi-cms/command/ShowAllLanguages"],function(_1370,lang,_1371,_1372,_1373){return _1370([_1371],{_updateTreeContextCommandModels:function(model){this.inherited(arguments);var _1374=lang.hitch(this.treeStoreModel,this.treeStoreModel.translate);this._commandRegistry.translate.command.set("model",model);this._commandRegistry.translate.command.set("executeDelegate",_1374);this._commandRegistry.newBlockDefault.command.set("model",model);},_setupCommands:function(){this.inherited(arguments);var _1375={newBlockDefault:{command:new _1372({viewModel:this})},allLanguages:{command:new _1373({model:this}),order:55}};this._commandRegistry=lang.mixin(this._commandRegistry,_1375);this.pseudoContextualCommands.push(this._commandRegistry.newBlockDefault.command);}});});},"epi-cms/component/command/NewBlock":function(){define(["dojo/_base/declare","epi/shell/DestroyableByKey","epi-cms/command/NewContent","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_1376,_1377,_1378,_1379){return _1376([_1378,_1377],{contentType:"episerver.core.blockdata",iconClass:"epi-iconPlus",label:_1379.command.label,resources:_1379,viewModel:null,_onModelChange:function(){this.destroyByKey("isSearchingWatch");this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.inherited(arguments);},_canExecute:function(){var _137a=this.inherited(arguments);return _137a&&!this.viewModel.get("isSearching");}});});},"epi-cms/component/SiteTree":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/Tooltip","epi-cms/component/SiteTreeModel","epi-cms/component/SiteTreeNode","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/ToggleCommand","epi/shell/widget/Tree","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(_137b,_137c,lang,array,when,_137d,_137e,_137f,_1380,_1381,_1382,_1383,_1384,Tree,_1385){return _137b([_137e,_1383],{profile:null,buildRendering:function(){this.inherited(arguments);_137d.set(this.domNode,"overflow","auto");},postCreate:function(){this.inherited(arguments);var _1386=_1382.resolve("epi.storeregistry");var store=_1386.get("epi.cms.sitestructure");this.profile=this.profile||_1382.resolve("epi.shell.Profile");var model=this._treeModel=new _1380({store:store});var _1387=new _1384({category:"setting",label:_1385.showalllanguages,model:model,property:"showAllLanguages"});this.commands.push(_1387);this._tree=new Tree({model:model,showRoot:false,"class":"epi-simpleTree",persist:false,onClick:lang.hitch(this,function(item){if(!item.host||!item.languageId){window.location.replace(item.editUrl);}else{var self=this;when(self.profile.setContentLanguage(item.languageId,item.host),function(){var _1388=item.editUrl;if(array.some(item.hosts,function(host){return host===window.location.host;})){_1388=item.editUrl.replace(new RegExp(item.host,"i"),window.location.host);}window.location.replace(_1388);});}}),_createTreeNode:function(args){return new _1381(args);},_onNodeMouseEnter:function(node){if(node.item.isLanguageNode&&!node.item.isAvailable){_137f.show(_1385.notavailabletooltip,node.labelNode,["after-centered","below"]);}},_onNodeMouseLeave:function(node){_137f.hide(node.labelNode);}});this.addChild(this._tree);},layout:function(){this._tree.resize();},startup:function(){this.inherited(arguments);this._setTreePath();},_setTreePath:function(){_137c.when(this._treeModel.getCurrentSite(),lang.hitch(this,function(_1389){this._tree.set("path",["root",_1389.currentSite,_1389.currentEditLanguageId]);}));}});});},"epi-cms/component/SiteTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","epi-cms/widget/_ContentTreeNode"],function(_138a,_138b,_138c){return _138a([_138c],{_updateItemClasses:function(item){this.inherited(arguments);if(item.isLanguageNode&&!item.isAvailable){_138b.add(this.domNode,"epi-st-disabledRow");}else{_138b.remove(this.domNode,"epi-st-disabledRow");}if(!item.isLanguageNode){_138b.add(this.iconNode,"epi-iconObjectStart");}}});});},"epi-cms/component/Tasks":function(){define(["dojo","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/topic","dijit/form/Select","dijit/_TemplatedMixin","dijit/_Container","dijit/layout/_LayoutWidget","dijit/_WidgetsInTemplateMixin","epi","epi-cms/component/ContentQueryGrid","dojo/text!./templates/Tasks.html","epi/i18n!epi/cms/nls/episerver.cms.components.tasks"],function(dojo,_138d,array,lang,_138e,_138f,topic,_1390,_1391,_1392,_1393,_1394,epi,_1395,_1396,_1397){return _138d([_1392,_1393,_1391,_1394],{templateString:_1396,resources:_1397,querySelection:null,_selectionChangedEventHandler:null,postCreate:function(){this.inherited(arguments);var _1398=array.map(this.queries,function(item){return {label:item.displayName,value:item.name};},this);this.querySelection=new _1390({name:"QuerySelection",options:_1398});_138e.place(this.querySelection.domNode,this.reloadButton.domNode,"before");this.own(this.querySelection.on("change",lang.hitch(this,this._reloadQuery)),topic.subscribe("/epi/cms/action/refreshmytasks",lang.hitch(this,this._reloadQuery)));},startup:function(){this.inherited(arguments);this._reloadQuery();},resize:function(_1399){this.inherited(arguments);this.contentQuery.resize(this._caculateContentQuerySize(_1399));},_caculateContentQuerySize:function(_139a){var _139b=_138f.getMarginBox(this.toolbar);return {w:_139a.w,h:_139a.h-_139b.h};},_reloadQuery:function(){var query=this.querySelection.get("value");array.some(this.queries,function(item,index){if(item.name===query){this.contentQuery.set("ignoreVersionWhenComparingLinks",!item.versionSpecific);return true;}},this);this.contentQuery.set("queryName",query);}});});},"epi-cms/component/ContentQueryGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/aspect","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase"],function(_139c,lang,when,_139d,_139e,_139f){return _139c([_139f],{queryName:null,queryParameters:null,dndTypes:["epi.cms.contentreference"],postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _13a0=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)},status:{className:"epi-width35",renderCell:function(item,value,node,_13a1){node.innerHTML=_139e.getVersionStatus(value);}}},store:this.store,dndSourceType:this.dndTypes},this.defaultGridMixin);this.grid=new this._gridClass(_13a0,this.domNode);this.grid.set("showHeader",false);this.own(_139d.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},fetchData:function(){when(this._getCurrentItem(),lang.hitch(this,function(_13a2){this.set("currentItem",_13a2);}));this.grid.set("queryOptions",{ignore:["query"],sort:[{attribute:"name",descending:true}]});var _13a3=this.queryParameters||{};_13a3.query=this.queryName;this.grid.set("query",_13a3);},_setQueryNameAttr:function(value){this.queryName=value;this.fetchData();}});});},"url:epi-cms/component/templates/Tasks.html":"<div>\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"toolbar\">\r\n        <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"reloadButton\" data-dojo-attach-event=\"onClick: _reloadQuery\"\r\n            class=\"epi-chromelessButton epi-iconReload epi-input-margin--left dijitInline dijitReset\">\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"epi-cms/component/ContentQueryGrid\" data-dojo-attach-point=\"contentQuery\">\r\n    </div>\r\n</div>\r\n","epi-cms/component/Trash":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_FocusableMixin","epi-cms/widget/Trash","epi-cms/widget/viewmodel/TrashViewModel"],function(_13a4,_13a5,_13a6,_13a7,_13a8,_13a9,Trash,_13aa){return _13a4([_13a6,_13a7,_13a8,_13a9],{templateString:"<div class=\"epi-trashComponent\"><div data-dojo-type='epi-cms/widget/Trash' data-dojo-attach-point='trash'></div></div>",updateView:function(data){if(data){this.trash.set("typeIdentifiers",data.typeIdentifiers);}if(this._trashModel){this._trashModel.destroy();}this.trash.set("model",this._trashModel=new _13aa());},destroy:function(){this._trashModel.destroy();this.inherited(arguments);}});});},"epi-cms/widget/Trash":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/Deferred","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/registry","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/command/withConfirmation","epi-cms/widget/TrashItemList","epi-cms/widget/EmptyTrashMenu","epi-cms/widget/TrashViewModelConfirmation","epi-cms/widget/command/EmptyTrash","epi-cms/widget/command/RestoreContent","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/Trash.html"],function(array,_13ab,lang,_13ac,_13ad,_13ae,_13af,_13b0,_13b1,_13b2,_13b3,_13b4,_13b5,_13b6,Alert,_13b7,_13b8,_13b9,_13ba,_13bb,_13bc,_13bd,_13be){return _13ab([_13b0,_13b1,_13b2,_13b6,_13ae],{resources:_13bd,templateString:_13be,_restoreContentCommand:null,typeIdentifiers:null,modelBindingMap:{contentStore:["store"],queryOptions:["queryOptions"],actionResponse:["actionResponse"],trashes:["trashes"]},postCreate:function(){this.inherited(arguments);this.tabContainer.watch("selectedChildWidget",lang.hitch(this,function(name,_13bf,_13c0){if(_13c0.itemListId){var _13c1=_13b5.byId(_13c0.itemListId);_13c1.bindUserSelector(_13c0.trash.deletedByUsers);}this.model.set("currentTrash",_13c0.trash);}));this._restoreContentCommand=new _13bc({model:this.model});this.watch("model",lang.hitch(this,function(){this.model=_13ba(this.model);this._restoreContentCommand.set("model",this.model);}));this.on("itemClick",this._onItemClick);this.on("deletedByChange",this._onDeletedByChange);},_setTrashesAttr:function(_13c2){this.tabContainer.destroyDescendants();var _13c3=[];array.forEach(_13c2,function(trash){if(trash&&trash.active){this._addTrash(trash);var _13c4=new _13bb({label:trash.name,tooltip:trash.name,trashId:trash.wasteBasketLink,model:this.model});_13c3.push(_13b7(_13c4,null,{title:_13bd.emptytrash.title,description:this.model.getEmptyTrashConfirmMessage(trash.name),onShow:lang.hitch(this,function(){var _13c5=this.tabContainer.selectedChildWidget.getChildren()[0];_13c5.clearSelection();})}));}},this);this.emptyTrashMenu.set("commands",_13c3);if(_13c2&&_13c2.length===1){_13ac.add(this.tabContainer.domNode,"hide-tablist");}this.tabContainer.startup();this.tabContainer.layout();},_addTrash:function(trash){var _13c6=null;if(trash.active){trash.isRequireLoad=true;var item=new _13b4({title:trash.name,trash:trash});this.tabContainer.addChild(item);if(this._isSelected(trash)){_13c6=item;}}if(_13c6){this.tabContainer.selectChild(_13c6);}},_isSelected:function(trash){var _13c7=false;array.some(trash.typeIdentifiers,lang.hitch(this,function(_13c8){return array.some(this.typeIdentifiers,function(type){if(_13c8===type){_13c7=true;return false;}});}));return _13c7;},_setQueryOptionsAttr:function(_13c9){if(_13c9){var _13ca=this.tabContainer.selectedChildWidget;if(_13ca){var _13cb=this.get("store"),_13cc=null;if(_13ca.itemListId){_13cc=_13b5.byId(_13ca.itemListId);_13cc.set("queryOptions",_13c9);}else{_13cc=new _13b8({queryOptions:_13c9,store:_13cb,model:this.model});_13cc.on("itemClick",lang.hitch(this,function(row){this.emit("itemClick",row);}));_13cc.on("deletedByChange",lang.hitch(this,function(_13cd){this.emit("deletedByChange",_13cd);}));_13cc.on("searchBoxChange",lang.hitch(this,this._onSearchBoxChange));_13ca.set("content",_13cc);_13ca.itemListId=_13cc.id;}_13cc.updateRemovedBy(_13c9);}}},_setActionResponseAttr:function(_13ce){if(!_13ce){return;}this._showNotificationMessage(_13ce);},_showNotificationMessage:function(_13cf){new Alert({description:_13cf?_13cf:""}).show();},_onItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){this._restoreContentCommand.set("content",row.data);this._restoreContentCommand.execute();}},_onDeletedByChange:function(_13d0){var _13d1=this.model.get("currentTrash");_13d1.deletedBy=_13d0;_13d1.isRequireLoad=true;this.model.set("currentTrash",_13d1);},_onSearchBoxChange:function(_13d2){var _13d3=this.model.get("currentTrash");_13d3.queryText=_13d2;_13d3.isRequireLoad=true;this.model.set("currentTrash",_13d3);}});});},"epi-cms/widget/TrashItemList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(array,_13d4,lang,_13d5,_13d6,_13d7,_13d8,_13d9,_13da,keys,_13db,query,html,_13dc,_13dd,when,_13de,_13df,_13e0,_13e1,_13e2,_13e3,_13e4,_13e5,Tree,_13e6,_13e7,put,epi,_13e8,_13e9,_13ea,_13eb,_13ec,_13ed,_13ee,_13ef,_13f0,_13f1){return _13d4([_13de,_13df,_13e0,_13db,_13dc,_13ed],{resources:_13f0,epi:epi,templateString:_13f1,_grid:null,_observers:{},_setQueryOptionsAttr:function(_13f2){this._set("queryOptions",_13f2);this._initialize();},updateRemovedBy:function(_13f3){var _13f4=this.model.get("currentTrash");if(this.model.isEmptyTrash){this.bindDefaultUserSelector();return;}var _13f5=this.store.query({referenceId:_13f3.query.referenceId,query:"getblockrootchildren"});var _13f6=lang.hitch(this,function(item,_13f7,_13f8){var _13f9=_13f4.isDefaultProvider?"":_13f4.name;when(this.model.trashStore.query({providerName:_13f9}),lang.hitch(this,function(trash){if(trash){var _13fa=trash.deletedByUsers;_13f4.deletedByUsers=_13fa;this.bindUserSelector(_13fa);}}));});var id=_13f4.name,_13fb=this._observers[id];if(_13fb){_13fb.cancel();delete this._observers[id];}this._observers[id]=_13f5.observe(_13f6,true);},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.bindUserSelector(this.model.get("currentTrash").deletedByUsers);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",lang.hitch(this,function(_13fc){this.emit("searchBoxChange",_13fc);}));this.removedBy._updateSelection=function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!lang.isArray(val)){val=[val];}array.forEach(this._getChildren(),function(child){var _13fd=array.some(val,function(v){return child.option&&(v===child.option.value);});_13d6.toggle(child.domNode,this.baseClass+"SelectedOption",_13fd);child.domNode.setAttribute("aria-selected",_13fd);},this);};},resize:function(){if(this._grid){var top=_13d8.position(this._grid.domNode).y;var _13fe=_13d8.position(_13d5.body()).h;_13d9.set(this._grid.domNode,"height",(_13fe-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_13d7.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},bindDefaultUserSelector:function(){this.removedBy._onChangeActive=false;this.removedBy.removeOption(this.removedBy.options);this.removedBy.addOption({label:epi.resources.text.anyone,value:""});this.removedBy._onChangeActive=true;},bindUserSelector:function(_13ff){if(_13ff){var _1400=this.removedBy.get("value");this.bindDefaultUserSelector();this.removedBy._onChangeActive=false;array.forEach(_13ff,function(_1401){this.removedBy.addOption({label:this._createUserFriendlyUsername(_1401),value:_1401});},this);this.removedBy.set("value",_1400);this.removedBy._onChangeActive=true;}},_createGrid:function(store,_1402){var _1403=_13d4([_13e3,_13e4,_13e5,_13e9,_13e6]);var grid=new _1403({store:store,columns:{name:Tree({field:"name",label:epi.resources.header.name,renderCell:lang.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_13ea.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_13ea.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _13e2({target:grid.domNode,color:"#fff"}).placeAt(document.body);this._standby.startup();this.own(_13da.after(grid,"expand",function(_1404){var row=_1404.element?_1404:grid.row(_1404),_1405=query(row.element).parent()[0];if(_1405){_13d9.set(_1405,"height","");}},true));_13da.after(grid,"_processScroll",lang.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_13da.before(grid,"adjustRowIndices",function(_1406){if(_1406){array.forEach(query("div.dgrid-no-data",this.contentNode),function(div){html.set(div,"");});}});_13da.around(grid,"insertRow",lang.hitch(this,this._aroundInsertRow));_13da.before(grid,"renderArray",lang.hitch(this,function(_1407,_1408,_1409){var _140a=this.queryOptions.query;if(_140a&&_140a.query==="searchdeletedcontent"){_1407.map(function(_140b){if(_140b){_140b.hasChildren=false;}});}}));if(_1402){grid.set("queryOptions",_1402.options);grid.set("query",_1402.query);}var _140c="epi-dgrid-mouseover";grid.on(_13e7.enterRow,function(evt){_13d6.add(this,_140c);});grid.on(_13e7.leaveRow,function(evt){_13d6.remove(this,_140c);});grid.on(".epi-gridAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("itemClick",row);}));grid.on(".dgrid-column-action:keydown",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=grid.row(e);this.emit("itemClick",row);}}));return grid;},_renderTreeNode:function(_140d,data,td,_140e){if(_140d&&_140d.thumbnailUrl){var image=_13d7.create("img",{src:_140d.thumbnailUrl+_13dd.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_13d7.place(_13ea.ellipsis(_13ea.htmlEncode(data)),td);}else{var _140f=_13eb.getValue(_140d.typeIdentifier,"iconClass")||"epi-iconObjectPage";_13d7.place(_13ea.icon(_140f+" epi-objectIcon",_13ea.ellipsis(_13ea.htmlEncode(data))),td);}},_renderActionMenu:function(value){var data={title:_13f0.restore.tooltip,label:_13f0.restore.label};return lang.replace("<a class=\"epi-gridAction epi-visibleLink\" title=\"{title}\">{label}</a>",data);},_localizeDate:function(value){return _13ee.toUserFriendlyString(value);},_createUserFriendlyUsername:function(name){return _13ef.toUserFriendlyString(_13ea.htmlEncode(name));},_onDeletedByChange:function(_1410){if(this.model.isEmptyTrash){this.model.isEmptyTrash=false;return;}this.emit("deletedByChange",_1410);},_showStandby:function(_1411){if(!this._standby){return;}if(_1411){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_13f0.trashitemempty+"</span></span>";},_aroundInsertRow:function(_1412){return lang.hitch(this,function(_1413,_1414,_1415,i,_1416){var row=_1412.apply(this._grid,arguments);if(_1413&&_1413.thumbnailUrl){_13d6.add(row,"epi-mediaContent");}return row;});}});});},"dgrid/tree":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(_1417,_1418,_1419,_141a,on,_141b,has,Grid,_141c,put){function _141d(level,_141e,_141f,_1420){var dir=this.grid.isRTL?"right":"left",cls=".dgrid-expando-icon",node;if(_141e){cls+=".ui-icon.ui-icon-triangle-1-"+(_141f?"se":"e");}node=put("div"+cls+"[style=margin-"+dir+": "+(level*(this.indentWidth||9))+"px; float: "+dir+"]");node.innerHTML="&nbsp;";return node;};function _1421(event){var _1422=this,_1423=this.style.height;if(_1423){this.style.display=_1423=="0px"?"none":"block";}if(event){put(this,".dgrid-tree-resetting");setTimeout(function(){put(_1422,"!dgrid-tree-resetting");});}this.style.height="";};function tree(_1424){var _1425=_1424.renderCell||Grid.defaultRenderCell;var _1426,_1427;if(!_1424){_1424={};}_1424.shouldExpand=_1424.shouldExpand||function(row,level,_1428){return _1428;};_141b.after(_1424,"init",function(){var grid=_1424.grid,_1429=".dgrid-content .dgrid-column-"+_1424.id,_142a=[];grid.cleanEmptyObservers=false;if(!grid.store){throw new Error("dgrid tree column plugin requires a store to operate.");}if(!_1424.renderExpando){_1424.renderExpando=_141d;}_142a.push(grid.on(_1424.expandOn||".dgrid-expando-icon:click,"+_1429+":dblclick,"+_1429+":keydown",function(event){var row=grid.row(event);if((!grid.store.mayHaveChildren||grid.store.mayHaveChildren(row.data))&&(event.type!="keydown"||event.keyCode==32)&&!(event.type=="dblclick"&&_1427&&_1427.count>1&&row.id==_1427.id&&event.target.className.indexOf("dgrid-expando-icon")>-1)){grid.expand(row);}if(event.target.className.indexOf("dgrid-expando-icon")>-1){if(_1427&&_1427.id==grid.row(event).id){_1427.count++;}else{_1427={id:grid.row(event).id,count:1};}}}));if(has("touch")){_142a.push(grid.on(_141c.selector(_1429,_141c.dbltap),function(){grid.expand(this);}));}if(!grid._expanded){grid._expanded={};}_142a.push(_141b.after(grid,"insertRow",function(_142b){var row=this.row(_142b),_142c=_1424.shouldExpand(row,_1426,this._expanded[row.id]);if(_142c){this.expand(_142b,true,true);}return _142b;}));_142a.push(_141b.before(grid,"removeRow",function(_142d,_142e){var _142f=_142d.connected;if(_142f){_141a(">.dgrid-row",_142f).forEach(function(_1430){grid.removeRow(_1430,true);});if(!_142e){put(_142f,"!");}}}));if(_1424.collapseOnRefresh){_142a.push(_141b.after(grid,"cleanup",function(){this._expanded={};}));}grid._calcRowHeight=function(_1431){var _1432=_1431.connected;return _1431.offsetHeight+(_1432?_1432.offsetHeight:0);};grid.expand=function(_1433,_1434,_1435){var row=_1433.element?_1433:grid.row(_1433),_1436=has("transitionend"),dfd=new _1419(),_1437=dfd.promise;dfd.resolve();_1433=row.element;_1433=_1433.className.indexOf("dgrid-expando-icon")>-1?_1433:_141a(".dgrid-expando-icon",_1433)[0];_1435=_1435||_1424.enableTransitions===false;if(_1433&&_1433.mayHaveChildren&&(_1435||_1434!==!!this._expanded[row.id])){var _1438=_1434===undefined?!this._expanded[row.id]:_1434;put(_1433,".ui-icon-triangle-1-"+(_1438?"se":"e")+"!ui-icon-triangle-1-"+(_1438?"e":"se"));var _1439=row.element,_143a=_1439.connected,_143b,_143c,_143d={originalQuery:this.query};if(!_143a){_143a=_143d.container=_1439.connected=put(_1439,"+div.dgrid-tree-container");var query=function(_143e){return grid.store.getChildren(row.data,_143e);};if(_1424.allowDuplicates){_143d.parentId=row.id;}if("level" in _1433){query.level=_1433.level;}_1437=_1437.then(function(){if(grid.renderQuery){return grid.renderQuery(query,_143d);}var _143f=put(_143a,"div");var rows=grid.renderArray(query(_143d),_143f,"level" in query?{queryLevel:query.level}:{});_1419.when(rows,function(){put(_143f,"!");});return rows;});if(_1436){on(_143a,_1436,_1421);}else{_1421.call(_143a);}}_143a.hidden=!_1438;_143b=_143a.style;if(!_1436||_1435){_143b.display=_1438?"block":"none";_143b.height="";}else{if(_1438){_143b.display="block";_143c=_143a.scrollHeight;_143b.height="0px";}else{put(_143a,".dgrid-tree-resetting");_143b.height=_143a.scrollHeight+"px";}setTimeout(function(){put(_143a,"!dgrid-tree-resetting");_143b.height=_1438?(_143c?_143c+"px":"auto"):"0px";});}if(_1438){this._expanded[row.id]=true;}else{delete this._expanded[row.id];}}return _1437;};_141b.after(_1424,"destroy",function(){_1418.forEach(_142a,function(l){l.remove();});delete grid.expand;delete grid._calcRowHeight;});});_1424.renderCell=function(_1440,value,td,_1441){var grid=_1424.grid,level=Number(_1441&&_1441.queryLevel)+1,_1442=!grid.store.mayHaveChildren||grid.store.mayHaveChildren(_1440),_1443=_1441.parentId,_1444,node;level=_1426=isNaN(level)?0:level;_1444=_1424.renderExpando(level,_1442,grid._expanded[(_1443?_1443+"-":"")+grid.store.getIdentity(_1440)],_1440);_1444.level=level;_1444.mayHaveChildren=_1442;node=_1425.call(_1424,_1440,value,td,_1441);if(node&&node.nodeType){put(td,_1444);put(td,node);}else{td.insertBefore(_1444,td.firstChild);}};return _1424;};tree.defaultRenderExpando=_141d;return tree;});},"dgrid/extensions/ColumnResizer":function(){define(["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_1445,_1446,query,lang,dom,geom,has,_1447,put){function _1448(table,span,_1449,_144a,id){for(var i=1;i<span;i++){table[_1449+i][_144a]=id;}};function _144b(_144c){var i=_144c.length,l=i,_144d=_144c[0].length,table=new Array(i);while(i--){table[i]=new Array(_144d);}var _144e={};for(i=0;i<l;i++){var row=table[i],_144f=_144c[i];for(var j=0,js=0;j<_144d;j++){var cell=_144f[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_1448(table,cell.rowSpan,i,j,cell.id);}if(i>0&&cell.colSpan&&cell.colSpan>1){for(k=1;k<cell.colSpan;k++){row[++j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_1448(table,cell.rowSpan,i,j,cell.id);}}}_144e[cell.id]=_144c[0][j].id;js++;}}return _144e;};function _1450(grid,colId,width,_1451,_1452){if(width<=0){return;}var _1453=grid.columns[colId],event,rule;if(!_1453){return;}event={grid:grid,columnId:colId,width:width,bubbles:true,cancelable:true};if(_1451){event.parentType=_1451;}if(!grid._resizedColumns||_1446.emit(grid.headerNode,"dgrid-columnresize",event)){if(width==="auto"){delete _1453.width;}else{_1453.width=width;width+="px";}rule=grid._columnSizes[colId];if(rule){rule.set("width",width);}else{rule=_1447.addCssRule("#"+_1447.escapeCssIdentifier(grid.domNode.id)+" .dgrid-column-"+_1447.escapeCssIdentifier(colId,"-"),"width: "+width+";");}grid._columnSizes[colId]=rule;if(_1452!==false){grid.resize();}return true;}};var _1454,_1455=0;var _1456={create:function(){_1454=put("div.dgrid-column-resizer");},destroy:function(){put(_1454,"!");_1454=null;},show:function(grid){var pos=geom.position(grid.domNode,true);_1454.style.top=pos.y+"px";_1454.style.height=pos.h+"px";put(document.body,_1454);},move:function(x){_1454.style.left=x+"px";},hide:function(){_1454.parentNode.removeChild(_1454);}};return _1445(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_1455++){_1456.create();}},destroy:function(){this.inherited(arguments);for(var name in this._columnSizes){this._columnSizes[name].remove();}if(!--_1455){_1456.destroy();}},resizeColumnWidth:function(colId,width){return _1450(this,colId,width);},configStructure:function(){var _1457=this._oldColumnSizes=lang.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _1457){if(!(k in this._columnSizes)){_1457[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_1458){this.inherited(arguments);var colId=_1458.id,rule;if("width" in _1458){if((rule=this._oldColumnSizes[colId])){rule.set("width",_1458.width+"px");}else{rule=_1447.addCssRule("#"+_1447.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_1447.escapeCssIdentifier(colId,"-"),"width: "+_1458.width+"px;");}this._columnSizes[colId]=rule;}},renderHeader:function(){this.inherited(arguments);var grid=this;var assoc;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){assoc=lang.mixin(assoc||{},_144b(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){assoc=_144b(this.subRows);}}var _1459=query(".dgrid-cell",grid.headerNode),i=_1459.length;while(i--){var _145a=_1459[i],id=_145a.columnId,col=grid.columns[id],_145b=_145a.childNodes,_145c;if(!col||col.resizable===false){continue;}var _145d=put("div.dgrid-resize-header-container");_145a.contents=_145d;while(_145b.length>0){put(_145d,_145b[0]);}_145c=put(_145a,_145d,"div.dgrid-resize-handle.resizeNode-"+_1447.escapeCssIdentifier(id,"-"));_145c.columnId=assoc&&assoc[id]||id;}if(!grid.mouseMoveListen){_1446(grid.headerNode,".dgrid-resize-handle:mousedown"+(has("touch")?",.dgrid-resize-handle:touchstart":""),function(e){grid._resizeMouseDown(e,this);grid.mouseMoveListen.resume();grid.mouseUpListen.resume();});grid._listeners.push(grid.mouseMoveListen=_1446.pausable(document,"mousemove"+(has("touch")?",touchmove":""),_1447.throttleDelayed(function(e){grid._updateResizerPosition(e);})));grid._listeners.push(grid.mouseUpListen=_1446.pausable(document,"mouseup"+(has("touch")?",touchend":""),function(e){grid._resizeMouseUp(e);grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}));grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}},_resizeMouseDown:function(e,_145e){e.preventDefault();dom.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=query(".dgrid-column-"+_1447.escapeCssIdentifier(_145e.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(e);_1456.show(this);},_resizeMouseUp:function(e){var _145f=this._columnSizes,_1460,_1461,_1462;if(this.adjustLastColumn){_1462=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_1460=query(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_1460=_1460.filter(function(node){var idx=node.columnId.split("-");return idx[0]=="0"&&!(node.columnId in _145f);});}else{if(this.subRows&&this.subRows.length>1){_1460=_1460.filter(function(node){return node.columnId.charAt(0)=="0"&&!(node.columnId in _145f);});}}_1461=_1460.map(function(_1463){return _1463.offsetWidth;});_1460.forEach(function(_1464,i){_1450(this,_1464.columnId,_1461[i],null,false);},this);this._resizedColumns=true;}dom.setSelectable(this.domNode,true);var cell=this._targetCell,delta=this._getResizeMouseLocation(e)-this._startX,_1465=cell.offsetWidth+delta,obj=this._getResizedColumnWidths(),_1466=obj.totalWidth,_1467=obj.lastColId,_1468=query(".dgrid-column-"+_1447.escapeCssIdentifier(_1467,"-"),this.headerNode)[0].offsetWidth;if(_1465<this.minWidth){_1465=this.minWidth;}if(_1450(this,cell.columnId,_1465,e.type)){if(cell.columnId!=_1467&&this.adjustLastColumn){if(_1466+delta<_1462){_1450(this,_1467,"auto",e.type);}else{if(_1468-delta<=this.minWidth){_1450(this,_1467,this.minWidth,e.type);}}}}_1456.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _1469=this._getResizeMouseLocation(e),delta=_1469-this._startX,width=this._targetCell.offsetWidth,left=_1469;if(width+delta<this.minWidth){left=this._startX-(width-this.minWidth);}_1456.move(left);},_getResizeMouseLocation:function(e){var posX=0;if(e.pageX){posX=e.pageX;}else{if(e.clientX){posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return posX;},_getResizedColumnWidths:function(){var _146a=0,_146b=query((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode);var i=_146b.length;if(!i){return {};}var _146c=_146b[i-1].columnId;while(i--){_146a+=_146b[i].offsetWidth;}return {totalWidth:_146a,lastColId:_146c};}});});},"url:epi-cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n        <span class=\"epi-removedByContainer\">\r\n            <label for=\"removedBy_${id}\">${resources.removedby}</label>\r\n            <select data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"removedBy\" id=\"removedBy_${id}\" data-dojo-attach-event='onChange: _onDeletedByChange'>\r\n            </select>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>","epi-cms/widget/EmptyTrashMenu":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_146d,_146e,_146f,_1470,_1471,_1472){return _146d([_146e],{resources:_1472,_setCommandsAttr:function(_1473){this._set("commands",_1473);this._bindEmptyTrashMenu(_1473);},_bindEmptyTrashMenu:function(_1474){this.destroyDescendants();if(!_1474||_1474.length<1){return;}var _1475=_1474.length>1;var _1476=null;if(_1475){_1476=new _1470({settings:{label:_1472.emptytrash.title,dropDownPosition:["below-alt"]}});}else{_1476=new _146f({settings:{label:_1472.emptytrash.title}});this.commands[0].label=_1472.emptytrash.title;}new _1471({configuration:[{builder:_1476,target:this}],commandSource:this}).build();},getCommands:function(){return this.get("commands");}});});},"epi-cms/widget/TrashViewModelConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/dialog/Confirmation","epi/shell/widget/dialog/Alert","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_1477,_1478,lang,_1479,when,_147a,_147b,_147c,_147d,_147e,Alert,_147f,_1480,_1481){return function(model){var _1482=function(title,_1483,_1484){var _1485=new _1478();var _1486=new _147e({description:_147b.toHTML(_1483),title:_147b.toHTML(title),onAction:function(_1487){_1487?_1485.resolve(_1484):_1485.cancel();}});_1486.show();return _1485;};var _1488=function(_1489,roots,_148a){var _148b=function(_148c){var _148d=_147a.resolve("epi.cms.contentRepositoryDescriptors");var _148e=[];for(var key in _148d){_148d[key].containedTypes.forEach(function(type){if(_147c.isBaseTypeIdentifier(_148c.typeIdentifier,type)){_148e=_148e.concat(_148d[key].containedTypes);}});}return _148e;};var df=new _1478(),_148f=_1481.restore.dialog,_1490=_147c.getValue(_1489.typeIdentifier,"containerTypes"),_1491=_148b(_1489),_1492={showButtons:false,roots:roots,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_1490||_1491,selectedContentType:_1489.typeIdentifier,showAllLanguages:true};var _1493=new _147f(_1492);var _1494=new _147d({title:_147b.toHTML(_148f.title),description:_148a||_147b.toHTML(_148f.description),confirmActionText:_147b.toHTML(_1481.restore.label),content:_1493});var _1495=function(value){when(model.contentStore.query({id:value}),function(_1496){_1494.onActionPropertyChanged({name:"ok"},"disabled",!_1496);});};_1493.on("change",function(value){if(value){_1495(value);}else{_1494.onActionPropertyChanged({name:"ok"},"disabled",true);}});_1494.on("execute",function(){df.resolve(_1493.get("value"));});_1494.on("onHide",function(){df.cancel();});_1494.show();_1493.onChange(null);return df;};var _1497=function(_1498,_1499){var _149a=_1480.action.Create,_149b=_1480.providerCapabilities.Create,_149c=_1499&&!(_1499.isWastebasket||_1499.isDeleted)&&_1480.isActionAvailable(_1499,_149a,_149b,true,true);if(!_149c){var _149d=new Alert({description:_147b.toHTML(_1481.restore.userdonothavepermission)});_149d.show();return false;}return true;};var _149e=function(_149f){var _14a0=_147a.resolve("epi.cms.contentRepositoryDescriptors");var roots=[];for(var key in _14a0){_14a0[key].containedTypes.forEach(function(type){if(_147c.isBaseTypeIdentifier(_149f.typeIdentifier,type)){_14a0[key].roots.forEach(function(root){if(roots.indexOf(root)===-1){roots.push(root);}});}});}return roots;};var _14a1=function(model,_14a2,_14a3,_14a4,_14a5,_14a6){var _14a7;if(!_14a5||!model||!_14a2){return false;}if(_14a4&&_14a3){_14a7=_1482(_1481.restore.label,_1481.restore.confirmquestion,_14a3);}else{_14a7=_1488(_14a2,_149e(_14a2),_14a6);}when(_14a7,function(_14a8){when(model.contentStore.get(_14a8),function(_14a9){if(!_1497(_14a2,_14a9)){return false;}return _14a5.apply(model,[_14a2,_14a8]);});},function(){return false;});};_1479.around(model,"restore",function(_14aa){return function(_14ab,_14ac){var _14ad;return when(model.contentStore.query({id:_14ab.contentLink}),lang.hitch(this,function(_14ae){var _14af=null;var _14b0=null;if(_14ae.hasOwnProperty("statusCode")&&(_14ae.statusCode===401||_14ae.statusCode===403)){_14af=_147b.toHTML(_1481.restore.userdonothavepermission);}if(_14ae.hasOwnProperty("isDeleted")&&!_14ae.isDeleted){_14af=_147b.toHTML(_1481.restore.contentalreadyrestored);_14b0=function(){model.updateTrash(model.get("currentTrash"));};}if(_14af){var _14b1=new Alert({description:_14af,onAction:_14b0});_14b1.show();return false;}var _14b2=model.get("currentTrash");if(_14ae.parentLink!==_14b2.wasteBasketLink){return when(_1488(_14ae,_149e(_14ae)),function(_14b3){when(model.contentStore.get(_14b3),function(_14b4){if(!_1497(_14ae,_14b4)){return false;}return _14aa.apply(model,[_14ae,_14b3]);});},function(){return false;});}else{return when(model.getOldParent(_14ae.contentLink),function(_14b5){var _14b6=_14b5?_14b5.contentLink:null;_14a1(model,_14ae,_14b6,_14b6!=null,_14aa);});}}),lang.hitch(this,function(error){var _14b7=new Alert({description:_147b.toHTML(_1481.restore.contentdeletedpermanently),onAction:function(){model.updateTrash(model.get("currentTrash"));}});_14b7.show();return false;}));};});return model;};});},"epi-cms/widget/command/EmptyTrash":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_14b8,_14b9){return _14b8([_14b9],{label:null,tooltip:null,trashId:null,_execute:function(){if(this.canExecute){this.model.emptyTrash(this.trashId);}},_onModelChange:function(){var _14ba=!!this.trashId;this.set("canExecute",_14ba);}});});},"epi-cms/widget/command/RestoreContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_14bb,_14bc){return _14bb([_14bc],{content:null,_execute:function(){if(this.canExecute&&this.content){this.model.restore(this.content);}},_onModelChange:function(){var _14bd=!!this.model;this.set("canExecute",_14bd);}});});},"url:epi-cms/widget/templates/Trash.html":"<div class=\"epi-trash\">\r\n    <div class=\"epi-listingTopContainer\">\r\n        <h1 class=\"dijitInline\">${resources.heading}</h1>\r\n        <div class=\"epi-mediumButton epi-button--bold epi-emptyCommand\" data-dojo-attach-point=\"emptyTrashMenu\" data-dojo-type=\"epi-cms/widget/EmptyTrashMenu\"\r\n            data-dojo-props=\"title: '${resources.emptytrash.tooltip}'\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"stackContainer\">\r\n        <div data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-attach-point=\"tabContainer\" data-dojo-props=\"doLayout:false, useMenu:true, useSlider:false\"> <!-- doLayout=\"false\" for flexible height -->\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/widget/viewmodel/TrashViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/_base/json","epi/epi","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_14be,_14bf,lang,topic,_14c0,json,epi,_14c1,_14c2,_14c3,_14c4){return _14be([_14c0,_14c1],{resources:_14c4,trashes:null,currentTrash:null,queryOptions:null,isEmptyTrash:false,storeRegistry:null,contentStore:null,trashStore:null,showAllLanguages:true,_contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this.storeRegistry=_14c3.resolve("epi.storeregistry");this.contentStore=this.contentStore||this._getStore();this.trashStore=this.trashStore||this.storeRegistry.get("epi.cms.wastebasket");this._contentRepositoryDescriptors=_14c3.resolve("epi.cms.contentRepositoryDescriptors");if(!this.trashes){this._createTrashes();}},destroy:function(){epi.removeDelegateAspects(this.contentStore);},_getStore:function(){var store=this.storeRegistry.get("epi.cms.content.light"),model=this;var _14c5=epi.delegate(store,{getChildren:function(_14c6,_14c7){var _14c8=model.get("currentTrash"),_14c9=model._createQueryOptions(_14c8);lang.mixin(_14c9.query,{referenceId:_14c6.contentLink});return this.query(_14c9.query,_14c9.options);},mayHaveChildren:function(_14ca){return _14ca.hasChildren;}},["notify"]);return _14c5;},_createTrashes:function(){_14bf.when(this.trashStore.query(),lang.hitch(this,function(_14cb){this.set("trashes",lang.clone(_14cb));}));},_setCurrentTrashAttr:function(trash){this._set("currentTrash",trash);if(trash.isRequireLoad){this.updateTrash(trash);trash.isRequireLoad=false;}},getEmptyTrashConfirmMessage:function(_14cc){var _14cd=_14c4.emptytrash.singleproviderdescription;if(this.trashes.length>1){_14cd=_14c4.emptytrash.description.replace("{0}",_14cc);}return _14cd;},updateTrash:function(trash){if(trash&&trash.active){this.set("queryOptions",this._createQueryOptions(trash));}else{this.set("queryOptions",null);}},_createQueryOptions:function(trash){var query={referenceId:trash.wasteBasketLink,query:"getchildren"};var _14ce={ignore:["query"],comparers:this._createComparers()};if(this.showAllLanguages){lang.mixin(query,{allLanguages:this.showAllLanguages});_14ce.ignore.push("allLanguages");}if(trash.deletedBy){lang.mixin(query,{deletedBy:trash.deletedBy});}if(trash.isSearchable){lang.mixin(query,{isSearchable:trash.isSearchable});_14ce.ignore.push("isSearchable");}if(trash.queryText){lang.mixin(query,{query:"searchdeletedcontent"});lang.mixin(query,{matchProvider:true});lang.mixin(query,{queryText:trash.queryText});}return {query:query,options:_14ce};},_createComparers:function(){return {referenceId:function(_14cf,_14d0){return _14cf===_14d0.parentLink;}};},emptyTrash:function(_14d1){if(_14d1){_14bf.when(this.trashStore.executeMethod("Empty",_14d1),lang.hitch(this,function(_14d2){var _14d3=array.filter(this.get("trashes"),function(trash){return trash&&trash.wasteBasketLink===_14d1;});array.forEach(_14d3,function(trash){trash.deletedByUsers=[];trash.isRequireLoad=true;trash.deletedByUsers=[];});this.isEmptyTrash=true;topic.publish("/epi/cms/trash/empty",_14d2.extraInformation);if(this.currentTrash.wasteBasketLink===_14d1){this.set("currentTrash",this.currentTrash);}}),lang.hitch(this,function(_14d4){if(_14d4.status===403){this.set("actionResponse",_14c4.emptytrash.accessdenied);}}));}},restore:function(_14d5,_14d6){if(_14d5&&_14d5.contentLink&&_14d5.isDeleted&&_14d6){_14bf.when(this.contentStore.move(_14d5.contentLink,{targetId:_14d6}),lang.hitch(this,function(_14d7){if(_14d7){this.contentStore.refresh(_14d5.contentLink);if(_14d5.parentLink!==this.currentTrash.wasteBasketLink){this.contentStore.refresh(_14d5.parentLink).then(lang.hitch(this,function(){this.updateTrash(this.currentTrash);}));}var _14d8=this.contentStore.get(_14d6);if(_14d8&&!_14d8.hasChildren){this.contentStore.refresh(_14d6).then(function(_14d9){topic.publish("/epi/cms/contentdata/restored",_14d9);});}}}),lang.hitch(this,function(_14da){this.set("actionResponse",_14da.xhr?json.fromJson(_14da.xhr.responseText):_14c4.restore.error);}));}},getOldParent:function(_14db){var df=new _14bf();_14bf.when(this.contentStore.query({referenceId:_14db,query:"getrestorepoint",allLanguages:true}),function(_14dc){var _14dd=_14dc&&lang.isArray(_14dc)&&_14dc.length>0?_14dc[0]:null;df.resolve(_14dd);});return df;}});});},"epi-cms/component/Versions":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/string","dojo/topic","dojo/when","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","epi-cms/dgrid/formatters","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/withConfirmation","epi/shell/widget/_FocusableMixin","epi/shell/widget/dialog/Alert","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/component/command/DeleteVersion","epi-cms/component/command/DeleteLanguageBranch","epi-cms/component/command/SetCommonDraft","epi-cms/command/ShowAllLanguages","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(array,_14de,lang,_14df,_14e0,_14e1,topic,when,_14e2,_14e3,_14e4,_14e5,epi,_14e6,_14e7,_14e8,_14e9,_14ea,Alert,_14eb,_14ec,_14ed,_14ee,_14ef,_14f0,_14f1,_14f2,_14f3,_14f4){return _14de([_14f3,_14e8,_14ea,_14eb],{showAllLanguages:true,isMultilingual:false,postMixInProperties:function(){this._commonDrafts={};this.storeKeyName="epi.cms.contentversion";this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);this._currentContentLanguage=_14ec.currentContentLanguage;var _14f5=_14e6.resolve("epi.storeregistry");this._contentStore=_14f5.get("epi.cms.contentdata");},buildRendering:function(){this.inherited(arguments);var _14f6=_14de([_14e3,_14e4]);this.grid=new _14f6({columns:{language:{label:epi.resources.header.language},status:{label:epi.resources.header.status,renderCell:_14e5.commonDraft},savedDate:{label:epi.resources.header.saved,formatter:this._localizeDate},savedBy:{label:epi.resources.header.by,formatter:this._createUserFriendlyUsername}},selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",sort:[{attribute:"savedDate",descending:true}]},this.domNode);},postCreate:function(){this.inherited(arguments);this.add("commands",new _14f1({model:this}));this._commonDraftCommand=new _14f0();this._deleteVersionCommand=new _14ee();this._deleteLanguageBranchCommand=new _14ef();this.own(_14df.after(this._commonDraftCommand,"execute",lang.hitch(this,function(_14f7){_14f7.then(lang.hitch(this,this.fetchData),lang.hitch(this,this._onSetCommonDraftFailure));})),_14df.after(this._deleteVersionCommand,"execute",lang.hitch(this,function(_14f8){_14f8.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})),_14df.after(this._deleteLanguageBranchCommand,"execute",lang.hitch(this,function(_14f9){_14f9.then(lang.hitch(this,this._onDeleteLanguageBranchSuccess),lang.hitch(this,this._onDeleteVersionFailure));})));this.add("commands",this._commonDraftCommand);this.add("commands",_14e9(this._deleteVersionCommand,null,{title:_14f4.deletemenuitemtitle,heading:_14f4.deleteversion.note,description:_14f4.deleteversion.confirmquestion}));this._deleteLanguageBranchSettings={cancelActionText:epi.resources.action.cancel,setFocusOnConfirmButton:false};this.add("commands",_14e9(this._deleteLanguageBranchCommand,null,this._deleteLanguageBranchSettings));},startup:function(){if(this._started){return;}this.inherited(arguments);this.own(_14df.around(this.grid,"renderRow",lang.hitch(this,this._aroundRenderRow)));this._toggleLanguage(this.showAllLanguages);this.fetchData();},_setShowAllLanguagesAttr:function(value){this._set("showAllLanguages",value);this._toggleFilterByLanguage(value);},contextChanged:function(_14fa,_14fb){this.inherited(arguments);!this._isContentContext(_14fa)&&this.grid.set("store",null);},fetchData:function(){when(this.getCurrentContent(),lang.hitch(this,function(item){if(!item){return;}this._setQuery(item.contentLink,this._showAllLanguages);this.set("isMultilingual",true);}));},_aroundRenderRow:function(_14fc){return lang.hitch(this,function(item){if(item.isCommonDraft){var _14fd=this._commonDrafts[item.language];if(_14fd&&_14fd!==item.contentLink){this._removeCommonDraft(_14fd);}this._commonDrafts[item.language]=item.contentLink;}this._versionsByLanguage[item.language]=this._versionsByLanguage[item.language]||[];if(array.every(this._versionsByLanguage[item.language],function(ver){return ver!==item.contentLink;})){this._versionsByLanguage[item.language].push(item.contentLink);}var row=_14fc.apply(this.grid,arguments);_14e0.toggle(row,"dgrid-row-published",item.status===_14f2.versionStatus.Published);return row;});},_onError:function(e){if(e.error&&e.error.status===403){when(this.getCurrentContent(),lang.hitch(this,function(item){this._showErrorMessage(epi.resources.messages.nopermissiontoviewdata);this.set("isMultilingual",false);this._updateMenu(item);}));}else{this.inherited(arguments);}},_onSelect:function(e){var item=e.rows[0].data;this._updateMenu(item);this.inherited(arguments);},_updateMenu:function(item){this._commonDraftCommand.set("model",item);this._deleteVersionCommand.set("model",item);when(this._contentStore.get(item.contentLink),lang.hitch(this,function(_14fe){if(_14fe&&_14fe.currentLanguageBranch){var _14ff=lang.replace(_14f4.deletelanguagebranch.label,[_14fe.currentLanguageBranch.name]),_1500=_14e7.getResourceValue(_14fe.typeIdentifier,"deletelanguagebranchdescription");lang.mixin(this._deleteLanguageBranchSettings,{confirmActionText:_14ff,description:lang.replace(_1500,[_14e2.encode(_14fe.name),_14fe.currentLanguageBranch.name]),title:_14ff});this._deleteLanguageBranchCommand.set("label",_14ff);}this._deleteLanguageBranchCommand.set("model",_14fe);}));},_showNotificationMessage:function(_1501){var _1502=new Alert({title:_14f4.notificationtitle,description:_1501});_1502.show();},_selectCommonDraftVersion:function(uri,_1503){var _1504={sender:this};if(_1503){_1504.forceReload=_1503;}topic.publish("/epi/shell/context/request",{uri:uri},_1504);},_onDeleteLanguageBranchSuccess:function(){return when(this._onDeleteVersionSuccess(arguments),lang.hitch(this,function(){var _1505=this._deleteLanguageBranchCommand.model.currentLanguageBranch.languageId;array.forEach(this._versionsByLanguage[_1505],lang.hitch(this,function(ver){this.store.notify(undefined,new _14ed(ver));}));}));},_onDeleteVersionSuccess:function(){var self=this;return when(this.getCurrentContent(),function(_1506){var _1507=new _14ed(_1506.contentLink);var _1508=_1507.createVersionUnspecificReference().toString();self._selectCommonDraftVersion("epi.cms.contentdata:///"+_1508,true);});},_onDeleteVersionFailure:function(_1509){if(!_1509||!_1509.status){return;}else{if(_1509.status===403){this._showNotificationMessage(_14f4.deleteversion.cannotdeletepublished);}else{this._showNotificationMessage(_14f4.deleteversion.cannotdelete);}}},_onSetCommonDraftFailure:function(){this._showNotificationMessage(_14f4.setcommondraft.failuremessage);},_removeCommonDraft:function(_150a){if(_150a){var item=this.grid.row(_150a).data;if(item){item.isCommonDraft=false;}}},_toggleFilterByLanguage:function(_150b){when(this.getCurrentContext(),lang.hitch(this,function(_150c){if(!this._isContentContext(_150c)){this.grid.set("store",null);}else{this._setQuery(_150c.id,_150b);this._toggleLanguage(_150b);this._showAllLanguages=_150b;}}));},_setQuery:function(_150d,_150e){var query={contentLink:new _14ed(_150d).createVersionUnspecificReference().toString()};if(!_150e){query.language=this._currentContentLanguage;}this.grid.set("query",query);if(!this.grid.store){this.grid.set("store",this.store);}this._versionsByLanguage={};},_toggleLanguage:function(_150f){var value=_150f?"table-cell":"none";this.grid.styleColumn("language",_14e1.substitute("display:${0};",[value]));}});});},"epi-cms/component/command/DeleteVersion":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_1510,lang,when,_1511,_1512,_1513,_1514,_1515){return _1510([_1515],{label:_1514.deletemenuitemtitle,iconClass:"epi-iconTrash",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_1513.resolve("epi.storeregistry");this._content=this.storeRegistry.get("epi.cms.contentdata");this._versions=this.storeRegistry.get("epi.cms.contentversion");},_execute:function(){return this._versions.remove(this.model.contentLink);},_onModelChange:function(){if(_1511.disableVersionDeletion){this.set("isAvailable",false);return;}this.set("isAvailable",true);if(!this.model.allowToDelete){this.set("canExecute",false);return;}when(this._content.get(this.model.contentLink),lang.hitch(this,function(_1516){var _1517=_1512.action,_1518=_1516&&_1512.isActionAvailable(_1516,_1517.Delete);this.set("canExecute",_1518);}));}});});},"epi-cms/component/command/DeleteLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/shell/command/_Command","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_1519,lang,when,_151a,_151b,_151c,_151d,_151e,_151f){return _1519([_151b,_151c],{label:"",iconClass:"",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_151a.resolve("epi.storeregistry");this._versions=this.storeRegistry.get("epi.cms.contentversion");this._structure=this.storeRegistry.get("epi.cms.content.light");},_execute:function(){var _1520=_151e.toContentReference(this.model.contentLink);return when(this._versions.remove(_1520,{deleteLanguageBranch:true}),lang.hitch(this,function(){return this._structure.refresh(_1520.createVersionUnspecificReference().toString());}));},_onModelChange:function(){var model=this.model,_1521=!!(model&&model.currentLanguageBranch&&model.capabilities.deleteLanguageBranch&&!_151d.disableVersionDeletion),_1522=_1521&&!model.currentLanguageBranch.isMasterLanguage&&_151f.isActionAvailable(model,_151f.action.Delete);this.set("canExecute",_1522);this.set("isAvailable",_1521);}});});},"epi-cms/component/command/SetCommonDraft":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_1523,topic,_1524,_1525,_1526,_1527){return _1523([_1527],{label:_1526.setcommondraftitemtitle,iconClass:"epi-iconPrimary",category:"context",constructor:function(){var _1528=_1525.resolve("epi.storeregistry");this.store=_1528.get("epi.cms.contentversion");},_execute:function(){var store=this.store;return store.patch({isCommonDraft:true,contentLink:this.model.contentLink},{id:this.model.contentLink}).then(function(item){topic.publish("/epi/cms/content/statuschange/","common-draft",{id:item.contentLink});return store.patchCache(item);});},_onModelChange:function(){var model=this.model,_1529=_1524.versionStatus,_152a=model&&!model.isCommonDraft&&(model.status===_1529.CheckedOut||model.status===_1529.Rejected);this.set("canExecute",!!_152a);}});});},"epi-cms/contentediting/ContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","dojo/on","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","epi","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails","dojo/text!./templates/ContentDetails.html"],function(dojo,array,_152b,lang,url,win,_152c,_152d,on,topic,_152e,_152f,_1530,epi,_1531,_1532,_1533,res,_1534){return _152b([_152f,_152e,_1530,_1531],{templateString:_1534,_setContentTypeNameAttr:{node:"typeNode",type:"innerHTML"},_setContentIdAttr:{node:"idNode",type:"innerHTML"},_setExistingLanguagesAttr:function(_1535){this.languagesNode.innerHTML="";array.forEach(_1535,function(item,idx){var elm,_1536=idx===_1535.length-1;if(item.isCurrentLanguage){elm=_152d.create("span",{innerHTML:item.urlSegment});}else{var url=new dojo._Url(window.top.location.href);elm=_152d.create("a",{innerHTML:item.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",item.text,"#context=epi.cms.contentdata:///",item.contentLink].join(""),"class":"epi-visibleLink"});}_152d.place(elm,this.languagesNode);if(!_1536){_152d.place(win.doc.createTextNode(", "),this.languagesNode);}},this);},_setVisibleToAttr:function(_1537){this.visibleToNode.innerHTML=_1537?res.visibleto.everyone:res.visibleto.restricted;},_setManageAccessRightsVisibleAttr:function(value){_152c.set(this.manageAccessRightsButton.domNode,"display",value?"":"none");},resources:null,modelBindingMap:{contentTypeName:["contentTypeName"],contentId:["contentId"],existingLanguages:["existingLanguages"],visibleToEveryOne:["visibleTo"]},_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);this.resources=dojo.mixin({},epi.resources.action,res);},postCreate:function(){this.inherited(arguments);var _1538=new _1532();this._menuAssembler=new _1533({configuration:[{builder:_1538,target:this.additionalActionsMenu}],commandSource:this.model});this.dropdownButton.set("title",this.resources.toolsbutton.tooltip);},destroy:function(){if(this._menuAssembler){this._menuAssembler.destroy();}this.inherited(arguments);if(this.model){this.model.destroy();}},_setModelAttr:function(value){this.inherited(arguments);if(this._menuAssembler){this._menuAssembler.set("commandSource",this.model);}if(this.model&&this.model.accessRightsCommand){this.own(this.model.accessRightsCommand.watch("canExecute",lang.hitch(this,function(){this.set("manageAccessRightsVisible",this.model.accessRightsCommand.canExecute);})));}},_onManageAccessRightsClick:function(){if(this.model&&this.model.accessRightsCommand){this.model.accessRightsCommand.execute();}}});});},"url:epi-cms/contentediting/templates/ContentDetails.html":"<ul class=\"epi-form-container__section\">\r\n    <ul data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></ul>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.visibleto.title}</label>\r\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\r\n            <span data-dojo-attach-point=\"visibleToNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink epi-valign--top\">${resources.manage}</div>\r\n        </div>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.existinglanguages}</label>\r\n        <span data-dojo-attach-point=\"languagesNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label>${resources.idandtypename}</label>\r\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\r\n            <span class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\">\r\n                <span data-dojo-attach-point=\"idNode\"></span>, <span data-dojo-attach-point=\"typeNode\"></span>\r\n            </span>\r\n        </div>\r\n    </li>\r\n    <li class=\"epi-form-container__section__row\">\r\n        <label></label>\r\n        <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\r\n            <span>${resources.toolsbutton.label}</span>\r\n            <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\r\n        </div>\r\n    </li>\r\n</ul>","epi-cms/contentediting/CreateContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/dom-class","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/NewContentNameInputDialog","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi-cms/widget/ContentTypeList","epi-cms/widget/PropertiesForm","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","dojo/text!./templates/CreateContent.html","epi/i18n!epi/nls/episerver.shared"],function(_1539,lang,_153a,_153b,_153c,topic,when,_153d,_153e,_153f,_1540,_1541,_1542,_1543,_1544,_1545,_1546,_1547,_1548,_1549,_154a,_154b,_154c,_154d,_154e){return _1539([_1540,_153d,_153e,_1545],{templateString:_154d,sharedResources:_154e,modelType:_1548,_contextService:null,_beingSuspended:null,modelBindingMap:{parent:["parent"],requestedType:["requestedType"],metadata:["metadata"],isContentTypeSelected:["isContentTypeSelected"],headingText:["headingText"],createAsLocalAssetHelpText:["createAsLocalAssetHelpText"],contentName:["contentName"],contentNameHelpText:["contentNameHelpText"],wizardStep:["wizardStep"],showAllProperties:["showAllProperties"],createAsLocalAsset:["createAsLocalAsset"],seamlessTopPanel:["seamlessTopPanel"],namePanelIsVisible:["namePanelIsVisible"],headingPanelIsVisible:["headingPanelIsVisible"],saveButtonIsVisible:["saveButtonIsVisible"],saveButtonDisabled:["saveButtonDisabled"],showCurrentNodeOnBreadcrumb:["showCurrentNodeOnBreadcrumb"],notificationContext:["notificationContext"],actualParentLink:["actualParentLink"],propertyFilter:["propertyFilter"],allowedTypes:["allowedTypes"],restrictedTypes:["restrictedTypes"]},_setParentAttr:function(_154f){if(_154f){this.toolbar.setItemProperty("currentcontent","currentItemInfo",{name:_154f.name,dataType:_154f.typeIdentifier});}},_setPropertyFilterAttr:function(_1550){this._set("propertyFilter",_1550);this.propertiesForm.propertyFilter=_1550;},_setAllowedTypesAttr:function(value){this.contentTypeList.set("allowedTypes",value);},_setRestrictedTypesAttr:function(value){this.contentTypeList.set("restrictedTypes",value);},_setRequestedTypeAttr:function(_1551){this.contentTypeList.set("requestedType",_1551);},_setMetadataAttr:function(_1552){if(_1552){this.propertiesForm.set("metadata",_1552);}},_setHeadingTextAttr:function(_1553){this.headingTextNode.textContent=this.subHeadingTextNode.textContent=_1553;},_setContentNameHelpTextAttr:{node:"contentNameHelpTextNode",type:"innerText"},_setCreateAsLocalAssetAttr:function(_1554){this._set("createAsLocalAsset",_1554);var _1555=this.model.get("parent");if(_1555){this.toolbar.setItemProperty("breadcrumbs","contentLink",_1554?_1555.assetsFolderLink:_1555.contentLink);}this.contentTypeList.set("localAsset",_1554);},_setCreateAsLocalAssetHelpTextAttr:{node:"subHeadingDescNode",type:"innerHTML"},_setContentNameAttr:function(_1556){this.nameTextBox.set("value",_1556);},_setWizardStepAttr:function(_1557){var _1558;var child;if(_1557<0||_1557===this.wizardStep){return;}_1558=this.stackContainer.getChildren();if(_1557<_1558.length){child=_1558[_1557];this.stackContainer.selectChild(child);this._set("wizardStep",_1557);}},_setShowAllPropertiesAttr:function(_1559){this._set("showAllProperties",_1559);this.propertiesForm.set("showAllProperties",_1559);},_setSeamlessTopPanelAttr:function(value){_153c.toggle(this.topPanel.domNode,"epi-listingTopContainer",value);},_setNamePanelIsVisibleAttr:function(_155a){_153b.set(this.namePanel,"display",_155a?"":"none");},_setHeadingPanelIsVisibleAttr:function(_155b){_153b.set(this.headingPanel,"display",_155b?"":"none");_153b.set(this.subHeadingPanel,"display",_155b?"none":"");},_setSaveButtonIsVisibleAttr:function(_155c){this.toolbar.setItemVisibility("saveButton",_155c);},_setSaveButtonDisabledAttr:function(_155d){this.toolbar.setItemProperty("saveButton","disabled",_155d);},_setShowCurrentNodeOnBreadcrumbAttr:function(show){this.toolbar.setItemProperty("breadcrumbs","showCurrentNode",show);this.toolbar.setItemVisibility("currentcontent",!show);},_setNotificationContextAttr:function(_155e){this.toolbar.setItemProperty("notificationCenter","notificationContext",_155e);},_setActualParentLinkAttr:function(_155f){this.contentTypeList.set("parentLink",_155f);},_setContentTypeNameAttr:{type:"innerHTML",node:"contentTypeNameNode"},postMixInProperties:function(){this.inherited(arguments);this.model=new this.modelType();this.own(this.model.on("saveSuccess",lang.hitch(this,this._onSaveSuccess)));this.own(this.model.on("saveError",lang.hitch(this,this._onSaveError)));this.own(this.model.on("invalidContentName",lang.hitch(this,this._onInvalidContentName)));},postCreate:function(){this.inherited(arguments);this._contextService=this._contextService||_1544.resolve("epi.shell.ContextService");this._setupToolbar();},layout:function(){if(this._started){this.layoutContainer.resize(this._containerContentBox||this._contentBox);_153c.add(this.stackContainer.domNode,"epi-animation-node-reset");}},updateView:function(data){if(data&&((data.parent&&data.requestedType)||(data.contentData&&data.languageBranch))){this.view=data.view;this._setCreateMode();this._beingSuspended=false;this.set("contentTypeName","");when(this.model.update(data),lang.hitch(this,function(){this.layout();if(this.nameTextBox){this.nameTextBox.focus();this.nameTextBox.textbox.select();}}),function(err){});}},_onSaveSuccess:function(_1560){this._clearCreateMode();this._beingSuspended=true;if(_1560.changeContext){this._changeContext(_1560.newContentLink);}else{this._backToCurrentContext();}if(this.createAsLocalAsset===true){topic.publish("/epi/cms/action/createlocalasset");}},_onSaveError:function(){this._clearCreateMode();topic.publish("/epi/cms/action/showerror");},_onInvalidContentName:function(_1561){var _1562=new _1547({defaultContentName:_1561});var _1563=new _1546({defaultActionsVisible:false,autofocus:true,content:_1562,title:_1562.title});this.own(_153a.after(_1563,"onExecute",lang.hitch(this,function(){var name=_1562.get("value");if(name===_1561){this.model.set("ignoreDefaultNameWarning",true);}this.model.set("contentName",name);this.model.save();}),true),_153a.after(_1563,"onCancel",lang.hitch(this,function(){if(this.contentTypeList.shouldSkipContentTypeSelection){this._cancel();}else{this.model.set("isContentTypeSelected",false);}}),true));_1563.show();},_onContentTypeSelected:function(item){if(!this.isContentTypeSelected){this.model.set("contentTypeId",item.id);this.set("contentTypeName",item.localizedName);}},_onPropertyValidStateChange:function(_1564,error){if(error){this.model.addInvalidProperty(_1564,error);}else{this.model.removeInvalidProperty(_1564);}},_onBlurVerifyContent:function(){if(this.nameTextBox.get("value")===""){this.nameTextBox.set("value",this.model.defaultName);}},_onContentNameChange:function(name){this.model.set("contentName",name);},_onSave:function(){if(this._beingSuspended){return;}this.propertiesForm.validate();this.model.set("properties",this.propertiesForm.get("value"));this.model.save();},_onCancel:function(){this._cancel();},_cancel:function(){this._clearCreateMode();this.model.cancel();this._backToCurrentContext();},_setupToolbar:function(){var _1565=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _1566=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"},{parent:"trailing",name:"notificationCenter",widgetType:"epi-cms/widget/NotificationStatusBar"},{parent:"trailing",name:"saveButton",title:_154e.action.create,label:_154e.action.create,type:"button",action:lang.hitch(this,this._onSave),settings:{"class":"epi-button--bold epi-primary"}},{parent:"trailing",name:"cancelButton",title:_154e.action.cancel,label:_154e.action.cancel,type:"button",action:lang.hitch(this,this._onCancel),settings:{"class":"epi-button--bold"}}];when(this.toolbar.add(_1565),lang.hitch(this,function(){this.toolbar.add(_1566);}));},_changeContext:function(_1567){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1567},{sender:this,viewName:this.view,forceContextChange:true,forceReload:true});},_backToCurrentContext:function(){topic.publish("/epi/shell/action/changeview/back");},_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"create"});topic.publish("/epi/cms/action/togglecreatemode",true);},_clearCreateMode:function(){_153c.remove(this.stackContainer.domNode,"epi-animation-node-reset");lang.mixin(this._contextService.currentContext,{currentMode:undefined});topic.publish("/epi/cms/action/togglecreatemode",false);}});});},"epi-cms/contentediting/NewContentNameInputDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/keys","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","epi","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/NewContentNameInputDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.newcontentnamedialog"],function(_1568,lang,_1569,keys,_156a,_156b,_156c,_156d,_156e,epi,_156f,_1570,_1571,_1572,res){return _1568([_156b,_156c,_156d,_1571,_156f,_156a],{templateString:_1572,res:res,defaultContentName:null,message:null,title:null,nameLabel:epi.resources.header.name,_setMessageAttr:{node:"messageNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);this.message=lang.replace(this.res.warningtext,{defaultname:this.defaultContentName});this._set("message",this.message);this.title=res.title;},postCreate:function(){this.inherited(arguments);this.contentNameTextbox.set("value",this.defaultContentName);this.contentNameTextbox.on("keyup",lang.hitch(this,function(evt){var _1573=this.contentNameTextbox.isValid();if(evt.keyCode===keys.ENTER&&_1573){this.executeDialog();}}));this.on("focus",lang.hitch(this,function(){this.contentNameTextbox.textbox.select();}));},_getValueAttr:function(){return this.contentNameTextbox.get("value");},_onBlurVerifyContent:function(){if(this.contentNameTextbox.get("value")===""){this.contentNameTextbox.set("value",this.defaultContentName);}},getActions:function(){this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.contentNameTextbox.isValid()){this.executeDialog();}else{this.contentNameTextbox.focus();}})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/NewContentNameInputDialog.html":"<div class=\"epi-formContainer\">\r\n    <div data-dojo-attach-point=\"messageNode\"></div>\r\n    <br />\r\n    <div>\r\n        <label data-dojo-attach-point=\"contentNameLabelNode\">${nameLabel}</label>\r\n        <input type=\"text\" size=\"40\" maxlength=\"255\"  data-dojo-attach-point=\"contentNameTextbox\" data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                data-dojo-props=\"required: true, trim:true, selectOnClick: true\"\r\n                data-dojo-attach-event=\"onBlur: _onBlurVerifyContent\"\r\n                missingMessage: \"${res.errormessage.missingmessage}\" />\r\n    </div>\r\n</div>","epi-cms/contentediting/viewmodel/CreateContentViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/Stateful","dojo/string","dojo/when","dojo/Evented","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentEditingValidator","epi/i18n!epi/shell/ui/nls/episerver.shared.messages","epi/i18n!epi/cms/nls/episerver.cms.components.requiredproperties"],function(array,_1574,lang,json,_1575,_1576,when,_1577,_1578,_1579,_157a,_157b,_157c,_157d){return _1574([_1575,_1577],{_topLevelContainerType:"epi/shell/layout/SimpleContainer",_groupContainerType:"epi-cms/layout/CreateContentGroupContainer",contentDataStore:null,metadataManager:null,typeIdentifierManager:null,validator:null,parent:null,contentTypeId:null,requestedType:null,createAsLocalAsset:null,autoPublish:false,addToDestination:null,wizardStep:0,startWizardStep:0,contentName:null,ignoreDefaultNameWarning:null,properties:null,headingText:null,contentNameHelpText:"",createAsLocalAssetHelpText:null,namePanelIsVisible:null,headingPanelIsVisible:null,seamlessTopPanel:null,saveButtonIsVisible:null,saveButtonDisabled:null,showAllProperties:null,showCurrentNodeOnBreadcrumb:null,actualParentLink:null,metadata:null,postscript:function(){this.inherited(arguments);if(!this.contentDataStore){var _157e=_1578.resolve("epi.storeregistry");this.contentDataStore=_157e.get("epi.cms.contentdata");}this.metadataManager=this.metadataManager||_1578.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_1578.resolve("epi.cms.ProjectService");this.validator=this.validator||new _157b({contextTypeName:"epi.cms.contentdata"});this.set("propertyFilter",lang.hitch(this,this._propertyFilter));},update:function(_157f){this.set("ignoreDefaultNameWarning",false);this.set("properties",null);this.set("saveButtonIsVisible",false);this.set("wizardStep",this.startWizardStep);this.set("isContentTypeSelected",false);this.set("namePanelIsVisible",true);this.set("headingPanelIsVisible",true);this.set("showCurrentNodeOnBreadcrumb",true);this.set("seamlessTopPanel",true);if(_157f){array.forEach(["allowedTypes","restrictedTypes","requestedType","parent","createAsLocalAsset","autoPublish","addToDestination","contentTypeId"],function(_1580){this.set(_1580,_157f[_1580]);},this);}if(this.parent){var _1581=this.parent.contentLink+"_new_content";this.validator.clearErrorsBySource();this.validator.setContextId(_1581);this.set("notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_1581});}},save:function(){this.set("saveButtonDisabled",true);if(!this.ignoreDefaultNameWarning&&(!this.contentName||this.contentName===""||this.contentName===this.defaultName)){var _1582=this.contentName;if(this.metadata&&this.metadata.additionalValues&&this.metadata.additionalValues.modelTypeIdentifier){_1582=_1579.getResourceValue(this.metadata.additionalValues.modelTypeIdentifier,"newitemdefaultname");}this._emitSaveEvent("invalidContentName",_1582);return;}this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this.validator.validate(),lang.hitch(this,function(_1583){if(_1583){this._emitSaveEvent("validationError");return;}var _1584=this.buildContentObject();this.projectService.getCurrentProjectId().then(function(_1585){_1584.autoPublish=_1584.autoPublish&&!_1585;this.contentDataStore.put(_1584).then(lang.hitch(this,this._saveSuccessHandler),lang.hitch(this,this._saveErrorHandler));}.bind(this));}),lang.hitch(this,function(){this._emitSaveEvent("validationError");}));},_emitSaveEvent:function(_1586,_1587){this.set("saveButtonDisabled",false);this.emit(_1586,_1587);},cancel:function(){this.addToDestination&&(typeof this.addToDestination.cancel==="function")&&this.addToDestination.cancel();},_propertyFilter:function(_1588,_1589){var _158a=_1589.originalGroupName!=="EPiServerCMS_SettingsPanel"&&_1589.originalGroupName!=="Advanced";var _158b=this._isRequiredProperty(_1588,_1589);if(this.showAllProperties){return _158a||_158b;}else{return _158b;}},_saveSuccessHandler:function(_158c){var ref=new _157a(_158c),_158d=ref.createVersionUnspecificReference(),_158e=lang.hitch(this,function(_158f){this._emitSaveEvent("saveSuccess",{newContentLink:_158f,changeContext:true});});when(this.contentDataStore.refresh(_158c),lang.hitch(this,function(_1590){if(this.addToDestination){this.addToDestination.save({contentLink:_158d.toString(),name:_1590.name,typeIdentifier:this.requestedType});this._emitSaveEvent("saveSuccess",{changeContext:false});}else{_158e(_158d.toString());}}));},_saveErrorHandler:function(err){if(err&&err.responseText){var _1591=json.fromJson(err.responseText);array.forEach(_1591,function(item){if(item.propertyName){this.validator.setPropertyErrors(item.propertyName,[{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}else{this.validator.setGlobalErrors([{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}},this);}else{if(err){this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:err.message}],this.validator.validationSource.server);}}this._emitSaveEvent("saveError",err);},buildContentObject:function(){return {name:_1576.trim(this.contentName+""),parentLink:this._getParentLink(),contentTypeId:this.contentTypeId,properties:this.properties,createAsLocalAsset:this.createAsLocalAsset,autoPublish:this.autoPublish};},addInvalidProperty:function(_1592,_1593){this.validator.setPropertyErrors(_1592,[{severity:this.validator.severity.error,errorMessage:_1593}],this.validator.validationSource.client);},removeInvalidProperty:function(_1594){this.validator.clearPropertyErrors(_1594);},_contentTypeIdSetter:function(_1595){this.contentTypeId=_1595;if(_1595&&this.parent){this.set("isContentTypeSelected",true);this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this._getMetadata(this.parent.contentLink,_1595),lang.hitch(this,function(_1596){_1596=this._regroupProperties(_1596);this.set("metadata",_1596);if(this.autoPublish||this._hasRequiredProperties(_1596)){this.set("wizardStep",1);this.set("saveButtonIsVisible",true);}else{this.save();}}),lang.hitch(this,function(){this.set("isContentTypeSelected",false);this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:_157c.unexpectederror}],this.validator.validationSource.server);}));}},_createAsLocalAssetSetter:function(_1597){this.createAsLocalAsset=_1597;if(this.parent){this.set("actualParentLink",this._getParentLink());}},_autoPublishSetter:function(_1598){this.set("showAllProperties",_1598);this.autoPublish=_1598;},_parentSetter:function(_1599){this.parent=_1599;var _159a=this.parent.typeIdentifier,_159b=_1579.getResourceValue(this.requestedType,"name"),_159c=_1579.getResourceValue(_159a,"name"),_159d=_1579.getResourceValue(_159a,"createaslocalassethelptext");if(_159b&&_159c){_159d=lang.replace(_159d,[_159b.toLowerCase(),_159c.toLowerCase()]);}this.set("createAsLocalAssetHelpText",_159d);},_requestedTypeSetter:function(_159e){var _159f=_1579.getResourceValue(_159e,"create"),_15a0=_1579.getResourceValue(_159e,"newitemdefaultname");this.defaultName=_15a0;this.set("headingText",_159f);this.set("contentName",_15a0);this.requestedType=_159e;},_getParentLink:function(){if(!this.parent){return null;}if(this.createAsLocalAsset){return this.parent.ownerContentLink?this.parent.ownerContentLink:this.parent.contentLink;}return this.parent.contentLink;},_hasRequiredProperties:function(_15a1){return array.some(_15a1.properties,function(_15a2){return this._isRequiredProperty(_15a1,_15a2);},this);},_isRequired:function(_15a3){return _15a3.settings&&_15a3.settings.required;},_isRequiredProperty:function(_15a4,_15a5){var _15a6=!_15a5.additionalValues.hasValue;var _15a7=_15a5.showForEdit&&array.every(_15a4.groups,function(group){return (group.name!==_15a5.groupName&&group.name!==_15a5.originalGroupName)||group.displayUI;});var _15a8=array.some(_15a5.properties,function(_15a9){return this._isRequiredProperty(_15a5,_15a9);},this);return (this._isRequired(_15a5)||_15a8)&&_15a6&&_15a7&&(_15a5.name!=="icontent_name");},_regroupProperties:function(_15aa){_15aa=lang.clone(_15aa);_15aa.layoutType=this._topLevelContainerType;array.forEach(_15aa.properties,function(prop){var _15ab=this._isRequiredProperty(_15aa,prop);prop.originalGroupName=prop.groupName;prop.groupName=_15ab?"required":"additional";},this);_15aa.groups=[{name:"required",displayUI:true,title:_157d.groups.required,uiType:this._groupContainerType},{name:"additional",displayUI:true,title:_157d.groups.additional,uiType:this._groupContainerType}];return _15aa;},_getMetadata:function(_15ac,_15ad){return this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{parentLink:_15ac,contentTypeId:_15ad});}});});},"epi-cms/widget/ContentTypeList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(array,_15ae,lang,_15af,_15b0,all,when,_15b1,_15b2,_15b3,_15b4,i18n){return _15ae([_15b1],{store:null,parentLink:null,groups:null,requestedType:null,shouldSkipContentTypeSelection:null,allowedTypes:null,restrictedTypes:null,contentTypeService:null,postMixInProperties:function(){this.inherited(arguments);this.groups={};this.contentTypeService=this.contentTypeService||_15b2.resolve("epi.cms.ContentTypeService");if(!this.store){var _15b5=_15b2.resolve("epi.storeregistry");this.store=_15b5.get("epi.cms.contenttype");}},buildRendering:function(){this.inherited(arguments);var _15b6=new _15b4();this.connect(_15b6,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(_15b6);this._suggestedContentTypes=_15b6;},refresh:function(){this.clear();this._setupWidgetTemplate();when(all({types:this._getSuggestedContentTypes(this.requestedType),groups:this._groupContentTypes()}),lang.hitch(this,function(_15b7){var types=_15b7.types,_15b8=_15b7.groups,_15b9=_15b8.grouped,_15ba=_15b8.contentTypes;if(types.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_15af.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",types);this._suggestedContentTypes.setVisibility(true);}var key,group;for(key in _15b9){group=this._getOrCreateGroup(key);group.set("contentTypes",_15b9[key]);}if(_15ba instanceof Array&&_15ba.length===1){this.setVisibility(false);this.set("shouldSkipContentTypeSelection",true);this.onContentTypeSelected(_15ba[0]);}else{this.set("shouldSkipContentTypeSelection",false);}}));},setVisibility:function(_15bb){this.getChildren().forEach(function(group){group.setVisibility(_15bb);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_15b3.getResourceValue(this.requestedType,"suggestedtypes");this._otherTypesTitle=_15b3.getResourceValue(this.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getOrCreateGroup:function(name){var group=this.groups[name];if(!group){group=new _15b4({title:name});this.connect(group,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(group);this.groups[name]=group;}return group;},_getAvailableContentTypes:function(type){return this.contentTypeService.getAcceptedChildTypes(this.parentLink,this.get("localAsset"),[type],this.allowedTypes,this.restrictedTypes);},_getSuggestedContentTypes:function(type){var _15bc=this.store.query({query:"getsuggestedcontenttypes",localAsset:this.get("localAsset"),parentReference:this.parentLink,requestedTypes:[type]});return this.contentTypeService.filterQueryResult(_15bc,this.allowedTypes,this.restrictedTypes);},_groupContentTypes:function(){var _15bd={},_15be=new _15b0(),_15bf=this._otherTypesTitle;when(this._getAvailableContentTypes(this.requestedType),lang.hitch(this,function(_15c0){var count=_15c0.length;array.forEach(_15c0,function(item){when(item,function(type){var _15c1=type.groupName||_15bf,group=_15bd[_15c1]||[];group.push(type);_15bd[_15c1]=group;count--;if(count===0){_15be.resolve({grouped:_15bd,contentTypes:_15c0});}});});}));return _15be;},_setLocalAssetAttr:function(_15c2){this._set("localAsset",_15c2);if(this.requestedType&&this.parentLink){this.refresh();}},_setParentLinkAttr:function(value){this._set("parentLink",value);if(this.requestedType){this.refresh();}},onContentTypeSelected:function(){}});});},"epi-cms/widget/ContentTypeGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/text!./templates/ContentTypeGroup.html","dijit/_TemplatedMixin","dijit/layout/_LayoutWidget","epi-cms/widget/ContentType","dojo/keys","dijit/_KeyNavContainer"],function(_15c3,lang,array,_15c4,_15c5,_15c6,_15c7,_15c8,keys,_15c9){return _15c3([_15c7,_15c6,_15c9],{title:"",contentTypes:null,templateString:_15c5,buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.render();this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW,keys.UP_ARROW]:[keys.RIGHT_ARROW,keys.DOWN_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW,keys.DOWN_ARROW]:[keys.LEFT_ARROW,keys.UP_ARROW]);},render:function(){this.clear();array.forEach(this.contentTypes,function(type){var child=new _15c8({contentType:type});this.connect(child,"onSelect",this.onSelect);this.addChild(child);},this);},clear:function(){array.forEach(this.getChildren(),function(child){this.removeChild(child);child.destroyRecursive();},this);},_setTitleAttr:{node:"titleNode",type:"innerText"},_setContentTypesAttr:function(value){this._set("contentTypes",value);if(this._created){this.render();}},onSelect:function(){},setVisibility:function(_15ca){var value=(_15ca?"block":"none");_15c4.set(this.domNode,"display",value);}});});},"url:epi-cms/widget/templates/ContentTypeGroup.html":"<div class=\"epi-listingContainer\" data-dojo-attach-point=\"focusNode\" tabIndex=\"${tabIndex}\">\r\n    <h2 data-dojo-attach-point=\"titleNode\" class=\"epi-ribbonHeader\"></h2>\r\n    <ul data-dojo-attach-point=\"containerNode\" class=\"epi-advancedListing\"></ul>\r\n</div>","epi-cms/widget/ContentType":function(){define(["dojo","dojo/dom-class","dojo/string","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.pagetype","dojo/text!./templates/ContentType.html"],function(dojo,_15cb,_15cc,focus,_15cd,_15ce,i18n,_15cf){return dojo.declare([_15cd,_15ce],{templateString:_15cf,contentType:null,iconTemplate:"<img src=\"${0}\" alt=\"${1}\" class=\"epi-preview\" />",emptyIconTemplate:_15cc.substitute("<div class=\"epi-noPreviewIcon\"><span class=\"epi-noPreview\">${0}</span></div>",[i18n.nopreview]),buildRendering:function(){this.inherited(arguments);this.connect(this.domNode,"onclick",this._onClick);this.render();},render:function(){var type=this.contentType;if(type){this.set("name",type.localizedName);this.set("description",type.localizedDescription||i18n.nodescription);this.set("icon",type.imagePath);}},_setContentTypeAttr:function(value){this._set("contentType",value);if(this._created){this.render();}},_setNameAttr:{node:"nameNode",type:"innerText"},_setDescriptionAttr:{node:"descriptionNode",type:"innerText"},_setIconAttr:function(value){this._set("icon",value);this.iconNode.innerHTML=value?_15cc.substitute(this.iconTemplate,[value,this.name]):this.emptyIconTemplate;},focus:function(){this.inherited(arguments);_15cb.add(this.focusNode,"epi-advancedListingItemActive");focus.focus(this.focusNode);},_onBlur:function(){this.inherited(arguments);_15cb.remove(this.focusNode,"epi-advancedListingItemActive");},_onKeyPress:function(e){if(e.keyCode===13||e.keyCode===32){this.onSelect(this.contentType);}},_onClick:function(){this.onSelect(this.contentType);},_onMouseOver:function(){_15cb.add(this.focusNode,"epi-advancedListingItemActive");},_onMouseOut:function(){_15cb.remove(this.focusNode,"epi-advancedListingItemActive");},onSelect:function(item){}});});},"url:epi-cms/widget/templates/ContentType.html":"<li class=\"clearfix\" data-dojo-attach-event=\"onkeypress:_onKeyPress, onmouseover:_onMouseOver, onmouseout:_onMouseOut\" data-dojo-attach-point=\"focusNode\">\r\n    <div class=\"epi-browserWindow\"><div class=\"epi-browserWindowContent\" data-dojo-attach-point=\"iconNode\">${emptyIconTemplate}</div></div>\r\n    <h3 data-dojo-attach-point=\"nameNode\"></h3>\r\n    <p data-dojo-attach-point=\"descriptionNode\"></p>\r\n</li>","epi-cms/widget/PropertiesForm":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/layout/_LayoutWidget","epi/shell/widget/FormContainer"],function(array,_15d0,lang,when,_15d1,_15d2){return _15d0([_15d1],{metadata:null,showAllProperties:false,propertyFilter:null,_setMetadataAttr:function(value){this._set("metadata",value);setTimeout(lang.hitch(this,function(){this._setupForm();}),0);},_setupForm:function(){if(this._form){this._form.destroy();}this._form=new _15d2({metadata:this.metadata,doLayout:false,propertyFilter:lang.hitch(this,this.propertyFilter)});this.connect(this._form,"onFieldCreated",function(_15d3,_15d4){this.own(_15d4.watch("state",lang.hitch(this,function(name,_15d5,value){if(_15d5==="Error"&&value!=="Error"){this.onPropertyValidStateChange(_15d3);}else{if(_15d5!=="Error"&&value==="Error"){this.onPropertyValidStateChange(_15d3,_15d4.getErrorMessage());}}})));});this._form.placeAt(this.domNode);this.domNode.scrollTop=0;this.own(this._form);},validate:function(){return this._form.validate();},onPropertyValidStateChange:function(_15d6,_15d7){},_getValueAttr:function(){return this._form.get("value");}});});},"url:epi-cms/contentediting/templates/CreateContent.html":"<div class=\"epi-createContent\">\r\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\">\r\n        <div class=\"epi-static-node\" data-dojo-attach-point=\"topPanel\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"region:'top'\">\r\n            <div data-dojo-attach-point=\"headingPanel\">\r\n                <h1><span data-dojo-attach-point=\"headingTextNode\"></span>:&nbsp;<span data-dojo-attach-point=\"contentTypeNameNode\"></span></h1>\r\n            </div>\r\n            <div data-dojo-attach-point=\"toolbar\" class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"epi/shell/widget/ToolbarSet\" data-dojo-props=\"region:'top'\"></div>\r\n            <div data-dojo-attach-point=\"namePanel\">\r\n                <label>${sharedResources.header.name}</label>\r\n                <input data-dojo-attach-point=\"nameTextBox\"\r\n                       data-dojo-type=\"dijit/form/ValidationTextBox\"\r\n                       data-dojo-props=\"selectOnClick: true, required: true, trim:true\"\r\n                       data-dojo-attach-event=\"onChange: _onContentNameChange, onBlur: _onBlurVerifyContent\"\r\n                       maxlength=\"255\" />\r\n                <span data-dojo-attach-point=\"contentNameHelpTextNode\" class=\"dijitInline dgrid-no-data\"></span>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-newContentContainer epi-animation-node\" data-dojo-attach-point=\"stackContainer\" data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props=\"region: 'center'\">\r\n            <div data-dojo-attach-point=\"contentTypeList\" data-dojo-type=\"epi-cms/widget/ContentTypeList\" data-dojo-attach-event=\"onContentTypeSelected: _onContentTypeSelected\">\r\n                <div data-dojo-attach-point='subHeadingPanel' class=\"push-padding--left\">\r\n                    <h1 data-dojo-attach-point=\"subHeadingTextNode\"></h1>\r\n                    <p data-dojo-attach-point=\"subHeadingDescNode\"></p>\r\n                </div>\r\n            </div>\r\n            <div data-dojo-attach-point=\"propertiesForm\" data-dojo-type=\"epi-cms/widget/PropertiesForm\" data-dojo-attach-event=\"onPropertyValidStateChange: _onPropertyValidStateChange\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi-cms/contentediting/CreateLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/CreateContent","epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel"],function(_15d8,lang,_15d9,_15da){return _15d8([_15d9],{modelType:_15da,_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"translate"});}});});},"epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createpage.translate"],function(_15db,lang,when,_15dc,_15dd,res){return _15db([_15dd],{languageBranch:null,masterLanguageVersionId:null,contentNameHelpText:res.namehelptext,postscript:function(){this.wizardStep=1;this.startWizardStep=1;this.inherited(arguments);this._languageStore=this._languageStore||_15dc.resolve("epi.storeregistry").get("epi.cms.language");},update:function(_15de){var _15df=_15de.contentData;var _15e0=_15de.languageBranch;this.set("contentNameHelpText",_15df.publicUrl?res.namehelptext:"");var self=this;return when(this.contentDataStore.get(_15df.parentLink)).then(function(_15e1){var _15e2=_15dd.prototype.update.apply(self,[{requestedType:_15df.typeIdentifier,parent:_15e1,contentTypeId:_15df.contentTypeID}]);self.set("languageBranch",_15e0);self.set("masterLanguageVersionId",_15df.contentLink);self.set("contentName",_15df.name);return _15e2;}).then(function(_15e3){return when(self._languageStore.get(self.languageBranch)).then(function(_15e4){self.set("headingText",lang.replace(res.namelabel,[_15e4.name]));return _15e3;});});},_hasRequiredProperties:function(){return true;},_isRequired:function(_15e5){return this.inherited(arguments)&&(!this.languageBranch||_15e5.settings.isLanguageSpecific===true);},buildContentObject:function(){var _15e6=this.inherited(arguments);lang.mixin(_15e6,{languageBranch:this.languageBranch,masterLanguageVersionId:this.masterLanguageVersionId});return _15e6;}});});},"epi-cms/contentediting/DateTimeNowEditor":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/text!./templates/DateTimeNowEditor.html","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Tooltip","epi/shell/widget/_ValueRequiredMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.datetimenow"],function(_15e7,_15e8,lang,_15e9,_15ea,_15eb,_15ec,_15ed,_15ee,_15ef,_15f0){return _15e8([_15eb,_15ec,_15ed,_15ef],{templateString:_15ea,value:null,resources:_15f0,_selectorWatchHandle:null,postCreate:function(){this.inherited(arguments);this._selectorWatchHandle=this.dateTimeSelector.watch("value",lang.hitch(this,function(value,_15f1,_15f2){this._set("value",_15f2);this.onChange(_15f2);}));},onChange:function(_15f3){this.validate();},validate:function(){var _15f4=this.inherited(arguments);if(_15f4){var value=this.get("value");_15f4=this.disabled||!value||!this.minimumValue||value>this.minimumValue;this._set("state",_15f4?"":"Error");if(_15f4){_15ee.hide(this.domNode);}else{_15ee.show(this.minimumValueMessage,this.domNode);}}return _15f4;},_setValueAttr:function(value){this.dateTimeSelector.set("value",value);this._set("value",value);},_getValueAttr:function(){return this.dateTimeSelector.get("value");},_onExpireNowClick:function(){this.set("value",new Date());},destroy:function(){if(this._selectorWatchHandle){this._selectorWatchHandle.unwatch();}_15ee.hide(this.domNode);}});});},"url:epi-cms/contentediting/templates/DateTimeNowEditor.html":"<div class=\"dijitInline dijitInputContainer\">\r\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\"></div\r\n    ><a class=\"epi-visibleLink\" style=\"padding-left:10px\" data-dojo-attach-event=\"onclick:_onExpireNowClick\">${resources.now}</a>\r\n</div>","epi-cms/contentediting/DialogEditorWrapper":function(){define(["epi","dojo","epi-cms/contentediting/_EditorWrapperBase","epi/shell/widget/dialog/Dialog"],function(epi,dojo,_15f5,_15f6){return dojo.declare([_15f5],{closeOnChange:true,showButtons:false,_dialog:null,buildRendering:function(){this.inherited(arguments);if(!this.editorWidget){dojo["require"](this.editorWidgetType);var cls=dojo.getObject(this.editorWidgetType);var _15f7=this.editorParams||{};if("displayedValue" in cls.prototype||"value" in cls.prototype){_15f7["displayedValue" in cls.prototype?"displayedValue":"value"]=this.value;}this.editorWidget=new cls(_15f7);}var ew=this.editorWidget;var _15f8=new _15f6({content:ew,title:this.propertyDisplayName,defaultActionsVisible:this.showButtons,contentClass:"epi-dialog-fullWidth",destroyOnHide:false});this.connect(ew,"onKeyPress",this._onKeyPress);this.connect(ew,"onCancel",this._onCancel);this.connect(ew,"onResize",dojo.hitch(this,function(){this._dialog.resize();}));if("intermediateChanges" in ew){ew.set("intermediateChanges",true);}this.connect(ew,"onChange","_onChange");this.connect(_15f8,"onHide",this._onHide);this.connect(_15f8,"onCancel",this._onCancel);this._dialog=_15f8;},destroy:function(){this._dialog.destroyRecursive();this.inherited(arguments);},_onKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode===dojo.keys.ENTER&&e.target.tagName==="INPUT"){dojo.stopEvent(e);this._stopEdit();}}}},_onCancel:function(){this.cancel();this.editorWidget.set("value",this.value);if(this._dialog.open){this._dialog.hide();}},_onChange:function(){this.inherited(arguments);if(this.closeOnChange){this._stopEdit();}},_onHide:function(){if(this.editing){this._stopEdit();}},startEdit:function(){this.inherited(arguments);this._dialog.show();},_stopEdit:function(){this.inherited(arguments);if(this._dialog.open){this._dialog.hide();}},_setTitleAttr:function(title){if(this._dialog){this._dialog.set("title",title);}this._set("title",title);}});});},"epi-cms/contentediting/editors/CheckBoxListEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojox/html/entities","dijit/focus","dijit/_TemplatedMixin","dijit/_Widget","dijit/form/CheckBox","epi/shell/widget/_ValueRequiredMixin"],function(array,_15f9,lang,_15fa,on,_15fb,_15fc,_15fd,_15fe,_15ff,_1600){return _15f9([_15fe,_15fd,_1600],{templateString:"<div class=\"dijit dijitReset dijitInline\"></div>",baseClass:"epi-checkBoxList",valueIsCsv:true,valueIsInclusive:true,value:null,constructor:function(){this._checkboxes=[];this._labelClickHandles=[];},buildRendering:function(){this.inherited(arguments);array.forEach(this.selections,this._addCheckBoxForItem,this);},destroy:function(){var _1601;while((_1601=this._checkboxes.pop())){_1601.destroyRecursive();}var _1602;while((_1602=this._labelClickHandles.pop())){_1602.remove();}this.inherited(arguments);},focus:function(){try{if(this._checkboxes.length>0){_15fc.focus(this._checkboxes[0].domNode);}}catch(e){}},onChange:function(){},onBlur:function(){},onFocus:function(){},_calculateValue:function(){var _1603=[];var _1604=this.valueIsInclusive;array.forEach(this._checkboxes,function(_1605){if(_1604===_1605.checked){_1603.push(_1605.value);}});this._set("value",this.valueIsCsv?_1603.join(","):_1603);},_setValueAttr:function(value){this._set("value",value);var _1606=[];if(value){_1606=this.valueIsCsv?value.split(","):value;}var _1607=this.valueIsInclusive;var _1608=this._compareCheckboxValue;array.forEach(this._checkboxes,function(_1609){_1609.set("checked",_1607===array.some(_1606,function(v){return _1608(_1609,v);}));});},_compareCheckboxValue:function(_160a,value){var _160b=_160a.value;if(_160b===undefined||_160b===null){return false;}return _160b.toString()===value.toString();},_onBlur:function(){this.inherited(arguments);this.onBlur();},_addCheckBoxForItem:function(item){var _160c=_15fa.create("div",{"class":"epi-checkboxContainer"},this.domNode);var _160d=new _15ff({value:item.value});_160d.placeAt(_160c);this.own(on(_160d,"change",lang.hitch(this,function(){this._calculateValue();this.onChange(this.value);})));_160d.set("readOnly",!!this.readOnly);this._checkboxes.push(_160d);var label=_15fa.create("label",{"for":_160d.id},_160c);label.textContent=item.text;this._labelClickHandles.push(on(label,"click",lang.hitch(this,function(){_15fc.focus(_160d.domNode);})));}});});},"epi-cms/contentediting/editors/CollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/json","dojo/on","dojo/Stateful","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","put-selector/put","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/FormContainer","epi/string","epi/shell/command/withConfirmation","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/contentediting/_EditorWrapperBase","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/contentediting/editors/DefaultGridAssembler","./_AddItemDialogMixin","dojo/text!./templates/CollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor"],function(array,_160e,lang,_160f,_1610,_1611,json,on,_1612,when,_1613,_1614,_1615,_1616,_1617,_1618,_1619,put,_161a,_161b,_161c,_161d,_161e,_161f,_1620,_1621,DnD,_1622,_1623,_1624,_1625,_1626,_1627){return _160e([_1614,_1613,_161b,_1625],{templateString:_1626,multiple:true,baseClass:"epi-collection-editor",value:null,model:null,modelType:_161f,itemType:null,generateColumns:true,excludedColumns:null,includedColumns:null,gridType:_160e([_1616,_161a,_1617,_1615,DnD,_1618,_1619,_1623]),gridAssemblerType:_1624,gridSettings:null,itemModelType:null,itemEditorType:_161c,useFullWidth:true,_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+_1627.noitems+"</span></span>",_currentProviderHandler:null,postMixInProperties:function(){this.inherited(arguments);this.itemModelType=this.itemModelType||_1620;this.model=this.model||new this.modelType({itemType:this.itemType,itemModelType:this.itemModelType,data:this.value,availableCommands:this.commands});this.own(on(this.model,"itemsChanged",lang.hitch(this,this._onItemsChanged)));this.gridSettings=lang.mixin(this.gridSettings||{},{noDataMessage:this._noDataMessage});if(this.readOnly){this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;}this.gridSettings.dndParams={copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)};},postCreate:function(){this.inherited(arguments);when(this.model.initialize(),lang.hitch(this,function(){this._setupGrid();}));},onChange:function(value){},_setValueAttr:function(value){this._set("value",value);if(this.model){this.model.set("data",value);}},_dndNodeCreator:function(item,hint){var node=_1610.create("div");return {node:node,type:this.allowedDndTypes,data:item};},_setupGrid:function(){var _1628=this._getGridDefinition();var _1629=new this.gridAssemblerType({gridType:this.gridType,gridSettings:this.gridSettings,columnDefinitions:_1628,listCommands:this.readOnly?[]:this.model.getListCommands(),itemCommandsFactory:lang.hitch(this,function(item,_162a){return this.readOnly?[]:this.model.getItemCommands(item,this.commands,_162a);})});this.own(this.grid=_1629.build(this.gridNode,this.commandTargetNode));_1611.add(this.gridNode,"epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");if(!this.gridSettings.dndDisabled){this._setupDnD();}var items=this.model.get("items");this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}this.own(this.grid.on(".dgrid-row:click",lang.hitch(this,this.onGridRowClick)));this.own(this.grid.on(".dgrid-row:dblclick",lang.hitch(this,this.onGridRowDblClick)));},_setupDnD:function(){this.own(_160f.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_162b,_162c,nodes,copy){var i;if(this.grid.dndSource===_162c){for(i=0;i<nodes.length;i++){this.model.moveItem(this.grid.dndSource.getItem(nodes[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_162b.length;i++){this._addItem(_162b[i]);if(_162c&&_162c.grid&&_162c.grid.consumer&&_162c.grid.consumer!==this){_162c.grid.consumer.model.removeItem(this.grid.dndSource.getItem(nodes[i].id).data);}}}},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_162d){this.model.addItem(_162d,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}));},_dndGetItemData:function(item){return item.data;},_getGridDefinition:function(){var _162e=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};return this.model.generateFormatters(_162e);},_onGridRowSelect:function(e){if(!this.grid.itemCommandProviderMap){return;}if(this._currentProviderHandler){this._currentProviderHandler.removeProvider();}var item=this.grid.row(e).data;this._currentProviderHandler=this.grid.contextMenu.addProvider(this.grid.itemCommandProviderMap[json.stringify(item)]);},onGridRowClick:function(e){this._onGridRowSelect(e);},onGridRowDblClick:function(e){var item={model:this.grid.row(e).data};this.model.editItemDelegate(item);},_getDialogConfirmActionText:function(){return this.gridSettings.confirmActionText?this.gridSettings.confirmActionText:this.inherited(arguments);},onExecuteDialog:function(){var item=this._itemEditor.get("value");if(this._editingItemIndex!==undefined){this.model.saveItem(item,this._editingItemIndex);}else{this.model.addItem(item);}},_onItemsChanged:function(items){if(this.grid){for(var item in this.grid.itemCommandProviderMap){delete this.grid.itemCommandProviderMap[item];}this.grid.refresh();this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}}var value=this.model.get("data");this._set("value",value);if(!this.readOnly){this.onChange(value);}},_renderNoDataMessage:function(){if(this.grid.noDataNode){return;}this.grid.noDataNode=put(this.grid.contentNode,"div.dgrid-no-data");this.grid.noDataNode.innerHTML=this.grid.noDataMessage;}});});},"dgrid/extensions/ColumnReorder":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/dnd/Source","put-selector/put","xstyle/css!../css/extensions/ColumnReorder.css"],function(lang,_162f,_1630,on,query,_1631,put){var _1632=/(\d+)(?:-(\d+))?$/;function _1633(grid,match){var _1634=match[2],_1635=grid[_1634?"columnSets":"subRows"][match[1]];return _1634?_1635[match[2]]:_1635;};function _1636(grid,match,_1637){if(match[2]){grid.columnSets[match[1]][match[2]]=_1637;}else{grid.subRows[match[1]]=_1637;}};function _1638(_1639){return "dgrid-"+_1639+"-";};function _163a(_163b,_163c){return _163c.slice(_1638(_163b).length);};var _163d=_162f(_1631,{copyState:function(){return false;},checkAcceptance:function(_163e,nodes){return _163e==this;},_legalMouseDown:function(evt){return evt.target.className.indexOf("dgrid-resize-handle")>-1?false:this.inherited(arguments);},onDropInternal:function(nodes){var grid=this.grid,match=_1632.exec(_163a(grid.id,nodes[0].getAttribute("dndType"))),_163f=match[2]?"columnSets":"subRows",_1640=_1633(grid,match),_1641=grid.columns;this.inherited(arguments);if(!match){return;}setTimeout(function(){var _1642=_1630.map(nodes[0].parentNode.childNodes,function(col){return _1641[col.columnId];}),_1643;_1636(grid,match,_1642);_1643={grid:grid,subRow:_1642,column:_1641[nodes[0].columnId],bubbles:true,cancelable:true,parentType:"dnd"};_1643[_163f]=grid[_163f];if(on.emit(grid.domNode,"dgrid-columnreorder",_1643)){grid.set(_163f,grid[_163f]);}else{_1636(grid,match,_1640);grid.renderHeader();if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}}},0);}});var _1644=_162f(null,{columnDndConstructor:_163d,_initSubRowDnd:function(_1645,_1646){var _1647,c,len,col,th;for(c=0,len=_1645.length;c<len;c++){col=_1645[c];if(col.reorderable===false){continue;}th=col.headerNode;if(th.tagName!="TH"){th=th.parentNode;}put(th,".dojoDndItem[dndType="+_1646+"]");if(!_1647){_1647=th.parentNode;}}if(_1647){this._columnDndSources.push(new this.columnDndConstructor(_1647,{horizontal:true,grid:this}));}},renderHeader:function(){var _1648=_1638(this.id),_1649,cs;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets){for(cs=0,_1649=this.columnSets.length;cs<_1649;cs++){_1630.forEach(this.columnSets[cs],function(_164a,sr){this._initSubRowDnd(_164a,_1648+cs+"-"+sr);},this);}}else{_1630.forEach(this.subRows,function(_164b,sr){this._initSubRowDnd(_164b,_1648+sr);},this);}},_destroyColumns:function(){if(this._columnDndSources){_1630.forEach(this._columnDndSources,function(_164c){_164c.destroy();});}this.inherited(arguments);}});_1644.ColumnDndSource=_163d;return _1644;});},"epi-cms/contentediting/editors/model/CollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/Destroyable","dojox/mvc/StatefulArray","epi/dependency","epi/string","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(array,_164d,lang,_164e,_164f,_1650,_1651,when,all,_1652,_1653,_1654,_1655,_1656,_1657,_1658,_1659){var _165a={none:0,add:1,edit:2,remove:4,moveUp:8,moveDown:16};var _165b=_164d([_1651,_1650,_1652],{data:null,itemType:null,itemModelType:null,itemMetadata:null,metadataManager:null,availableCommands:null,_itemModels:null,_itemsUnchanged:false,postscript:function(){this.inherited(arguments);this.metadataManager=this.metadataManager||_1654.resolve("epi.shell.MetadataManager");this.itemModelType=this.itemModelType||_1657;},initialize:function(){return when(this.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_165c){this.set("itemMetadata",_165c);return this._initData();}));},_initData:function(){this._itemModels=new _1653([]);_164e.before(this._itemModels,"sort",lang.hitch(this,function(){this._itemsUnchanged=true;},true));this.own(this._itemModels.watchElements(lang.hitch(this,function(){if(!this._itemsUnchanged){this.emit("itemsChanged",this.get("items"));}this._itemsUnchanged=false;})));var _165d=array.map(this.data,function(item){var _165e=new this.itemModelType();return when(_165e.fromItemData(item,this.itemType),function(){return _165e;});},this);return when(all(_165d),lang.hitch(this,function(_165f){this._itemModels.splice.apply(this._itemModels,[0,this._itemModels.length].concat(_165f));}));},getListCommands:function(_1660){return [new _1656({name:"add",tooltip:_1659.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:this._commandIsAvailable(_165a.add,_1660),delegate:lang.hitch(this,this.addItemDelegate)})];},getItemCommands:function(item,_1661,_1662){return [new _1656({name:"edit",category:_1662,label:_1659.action.edit,iconClass:"epi-iconPen",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_165a.edit,_1661),delegate:lang.hitch(this,this.editItemDelegate)}),new _1656({name:"moveUp",category:_1662,label:_1659.action.moveup,iconClass:"epi-iconUp",model:item,canExecute:this._itemModels.indexOf(item)>0,isAvailable:this._commandIsAvailable(_165a.moveUp,_1661),delegate:lang.hitch(this,this.moveItemUpDelegate)}),new _1656({name:"moveDown",category:_1662,label:_1659.action.movedown,iconClass:"epi-iconDown",model:item,canExecute:this._itemModels.indexOf(item)<this._itemModels.length-1,isAvailable:this._commandIsAvailable(_165a.moveDown,_1661),delegate:lang.hitch(this,this.moveItemDownDelegate)}),new _1656({name:"remove",category:_1662,label:_1659.action.remove,iconClass:"epi-iconTrash",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_165a.remove,_1661),delegate:lang.hitch(this,this.removeItemDelegate)})];},_commandIsAvailable:function(_1663,_1664){_1664=_1664||this.availableCommands;return !!(_1663&_1664);},generateColumnsDefinition:function(_1665){var _1666={};array.forEach(array.filter(this.itemMetadata.properties,function(_1667){return array.every(_1665,function(col){return col!==_1667.name;});}),function(_1668){var _1669=_1655.pascalToCamel(_1668.name);_1666[_1669]={label:_1668.displayName||_1668.name};});return _1666;},generateFormatters:function(_166a){for(var _166b in _166a){array.some(this.itemMetadata.properties,function(_166c){if(_166b===_1655.pascalToCamel(_166c.name)){this._setTypeFormatter(_166c,_166a[_166b]);this._setSelectionFactoryFormatter(_166c,_166a[_166b]);this._setWrappingFormatter(_166a[_166b]);return true;}},this);}return _166a;},_typeFormatterMap:{"System.DateTime":_1658.localizedDate,"System.Boolean":_1658.friendlyBoolean},_wrappingFormatterMap:{SecondaryText:function(_166d){if(_166d){return function(value){return _1658.secondaryText(_166d(value),true);};}return function(value){return _1658.secondaryText(value);};},VisibleLink:function(_166e){if(_166e){return function(value){return _1658.visibleLink(_166e(value),true);};}return function(value){return _1658.visibleLink(value);};}},_setTypeFormatter:function(_166f,_1670){for(var _1671 in this._typeFormatterMap){if(_166f.modelType.indexOf(_1671)>-1){_1670.formatter=this._typeFormatterMap[_1671];break;}}},_setSelectionFactoryFormatter:function(_1672,_1673){if(_1672.selections&&_1672.selections.length>0){var _1674=_1672.selections;if(_1673){_1673.formatter=function(value){var _1675=value;_1674.forEach(function(_1676){if(_1676.value===value){_1675=_1676.text;}});return _1675;};}}},_setWrappingFormatter:function(_1677){if(_1677.wrappingFormatter&&this._wrappingFormatterMap[_1677.wrappingFormatter]){_1677.formatter=this._wrappingFormatterMap[_1677.wrappingFormatter](_1677.formatter);}},addItemDelegate:function(){this.emit("toggleItemEditor",null);},editItemDelegate:function(cmd){if(this._commandIsAvailable(_165a.edit,this.availableCommands)){var item=cmd.model;var index=this._itemModels.indexOf(item);this.emit("toggleItemEditor",item,index);}},removeItemDelegate:function(cmd){this.removeItem(cmd.model);},moveItemUpDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _1678=index-1;if(_1678>=0){this.moveItem(item,this._itemModels[_1678],true);}},moveItemDownDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _1679=index+1;if(_1679<this._itemModels.length){this.moveItem(item,this._itemModels[_1679],false);}},saveItem:function(item,index){var _167a=new this.itemModelType();return when(_167a.fromItemData(item,this.itemType),lang.hitch(this,function(){this._itemModels.splice(index,1,_167a);}));},addItem:function(item,_167b,_167c){var _167d=new this.itemModelType();return when(_167d.fromItemData(item,this.itemType),lang.hitch(this,function(){var _167e;if(!_167b){_167e=this._itemModels.length;}else{_167e=this._itemModels.indexOf(_167b);if(!_167c){_167e++;}}this._itemModels.splice(_167e,0,_167d);}));},moveItem:function(item,_167f,_1680){this._itemsUnchanged=true;var _1681=this._itemModels.indexOf(item);this._itemModels.splice(_1681,1);var _1682=this._itemModels.indexOf(_167f);var _1683=_1680?_1682:_1682+1;_1683=_1682===-1?_1681:_1683;this._itemModels.splice(_1683,0,item);},removeItem:function(item){var index=this._itemModels.indexOf(item);this._itemModels.splice(index,1);},_dataSetter:function(value){this.data=value;this._initData();},_dataGetter:function(){return array.map(this._itemModels,function(_1684){return _1684.toItemData();},this);},_itemsGetter:function(){return this._itemModels;}});_165b.commandMask=_165a;return _165b;});},"dojox/mvc/StatefulArray":function(){define("dojox/mvc/StatefulArray",["dojo/_base/lang","dojo/Stateful"],function(lang,_1685){function _1686(a){if(a._watchElementCallbacks){a._watchElementCallbacks();}return a;};var _1687=function(a){var array=lang._toArray(a||[]);var ctor=_1687;ctor._meta={bases:[_1685]};array.constructor=ctor;return lang.mixin(array,{pop:function(){return this.splice(this.get("length")-1,1)[0];},push:function(){this.splice.apply(this,[this.get("length"),0].concat(lang._toArray(arguments)));return this.get("length");},reverse:function(){return _1686([].reverse.apply(this,lang._toArray(arguments)));},shift:function(){return this.splice(0,1)[0];},sort:function(){return _1686([].sort.apply(this,lang._toArray(arguments)));},splice:function(idx,n){var l=this.get("length");idx+=idx<0?l:0;var p=Math.min(idx,l),_1688=this.slice(idx,idx+n),adds=lang._toArray(arguments).slice(2);[].splice.apply(this,[idx,n].concat(new Array(adds.length)));for(var i=0;i<adds.length;i++){this.set(p+i,adds[i]);}if(this._watchElementCallbacks){this._watchElementCallbacks(idx,_1688,adds);}if(this._watchCallbacks){this._watchCallbacks("length",l,l-_1688.length+adds.length);}return _1688;},unshift:function(){this.splice.apply(this,[0,0].concat(lang._toArray(arguments)));return this.get("length");},concat:function(a){return new _1687([].concat.apply(this,arguments));},join:function(sep){var list=[];for(var l=this.get("length"),i=0;i<l;i++){list.push(this.get(i));}return list.join(sep);},slice:function(start,end){var l=this.get("length");start+=start<0?l:0;end=(end===void 0?l:end)+(end<0?l:0);var slice=[];for(var i=start||0;i<Math.min(end,this.get("length"));i++){slice.push(this.get(i));}return new _1687(slice);},watchElements:function(_1689){var _168a=this._watchElementCallbacks,_168b=this;if(!_168a){_168a=this._watchElementCallbacks=function(idx,_168c,adds){for(var list=[].concat(_168a.list),i=0;i<list.length;i++){list[i].call(_168b,idx,_168c,adds);}};_168a.list=[];}_168a.list.push(_1689);var h={};h.unwatch=h.remove=function(){for(var list=_168a.list,i=0;i<list.length;i++){if(list[i]==_1689){list.splice(i,1);break;}}};return h;}},_1685.prototype,{set:function(name,value){if(name=="length"){var old=this.get("length");if(old<value){this.splice.apply(this,[old,0].concat(new Array(value-old)));}else{if(value>old){this.splice.apply(this,[value,old-value]);}}return this;}else{var _168d=this.length;_1685.prototype.set.call(this,name,value);if(_168d!=this.length){_1685.prototype.set.call(this,"length",this.length);}return this;}}});};return lang.setObject("dojox.mvc.StatefulArray",_1687);});},"epi/shell/command/DelegateCommand":function(){define("epi/shell/command/DelegateCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_168e,_168f){return _168e([_168f],{delegate:null,_execute:function(){return this.delegate?this.delegate.apply(this,[this].concat(arguments)):null;}});});},"epi-cms/contentediting/editors/model/CollectionEditorItemModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],function(array,_1690,lang,_1691){return _1690([_1691],{_itemDataPropertyNames:null,_nameGetter:function(){return this.name||this.text||"*";},fromItemData:function(_1692,_1693){lang.mixin(this,_1692);this._itemDataPropertyNames=[];for(var _1694 in _1692){if(_1692.hasOwnProperty(_1694)){this._itemDataPropertyNames.push(_1694);}}this.typeIdentifier=_1693&&_1693.toLowerCase();},toItemData:function(){var _1695={};array.forEach(this._itemDataPropertyNames,function(_1696){_1695[_1696]=this.get(_1696);},this);return _1695;}});});},"epi-cms/contentediting/editors/DefaultGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/json","dojo/Stateful","epi","epi/shell/command/builder/ButtonBuilder","epi/shell/command/withConfirmation","epi-cms/dgrid/formatters"],function(array,_1697,lang,json,_1698,epi,_1699,_169a,_169b){var _169c=_1697([],{gridType:null,gridSettings:null,columnDefinitions:null,listCommands:null,itemCommandsFactory:null,constructor:function(_169d){lang.mixin(this,_169d);},build:function(_169e,_169f){},instantiateGrid:function(_16a0,_16a1,_16a2,node){return new _16a0(lang.mixin(_16a1,{columns:_16a2,className:"epi-plain-grid"}),node);}});return _1697([_169c],{itemCommandProviderMap:null,constructor:function(){this.itemCommandProviderMap={};},build:function(_16a3,_16a4){this.columnDefinitions["_epiGrid_Action"]={renderHeaderCell:function(){},renderCell:lang.hitch(this,function(item,value,node,_16a5){var _16a6=this._getItemCommands(item);this.itemCommandProviderMap[json.stringify(item)]=new _1698({commands:_16a6});this.renderActionMenu(item,node,_16a6);}),className:"epi-columnNarrow",sortable:false};var grid=this.instantiateGrid(this.gridType,this.gridSettings,this.columnDefinitions,_16a3);grid.itemCommandProviderMap=this.itemCommandProviderMap;this._setupCommands(this.listCommands,_16a4);return grid;},renderActionMenu:function(item,node,_16a7){node.innerHTML=_16a7&&_16a7.length>0?_169b.menu({title:epi.resources.action.options}):"";},_getItemCommands:function(item){var _16a8=this.itemCommandsFactory(item,"context");array.some(_16a8,function(_16a9){if(_16a9.name==="remove"&&this.gridSettings.useDeleteWithConfirmation){_16a9=_169a(_16a9,null,{title:this.gridSettings.deleteConfirmationTitle,description:this.gridSettings.deleteConfirmationMessage});return true;}},this);return _16a8;},_setupCommands:function(_16aa,_16ab){var _16ac=this.getListCommandBuilder();array.forEach(_16aa,function(_16ad){_16ac.create(_16ad,_16ab);},this);},getListCommandBuilder:function(){return new _1699({settings:{showLabel:true},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"});}});});},"epi-cms/contentediting/editors/_AddItemDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_16ae,lang,on,_16af,_16b0,_16b1,_16b2,_16b3){return _16ae([_16af,_16b1],{itemEditorType:null,_itemEditor:null,_dialog:null,dialogParams:null,_editingItemIndex:null,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"toggleItemEditor",lang.hitch(this,this._onToggleItemEditor)));},_onToggleItemEditor:function(item,index){this._setupItemEditor();this._itemEditor.set("value",item);this._editingItemIndex=index;this.isShowingChildDialog=true;this._dialog.show();this._setDialogConfirmActionText(item);this._setDialogTitle(item);this._setDialogConfirmActionStatus(item);},_setupItemEditor:function(){this._itemEditor=this._createItemEditor();this.own(this._dialog=new _16b0(lang.mixin({title:this._getDialogTitleText(),content:this._itemEditor},this.dialogParams)));this._dialog.own(this._itemEditor,this.connect(this._itemEditor,"onChange","_setDialogConfirmActionStatus"),on(this._dialog,"execute",lang.hitch(this,this._onDialogExecute)),on(this._dialog,"hide",lang.hitch(this,this._onCancelDialog)));},_createItemEditor:function(){return new this.itemEditorType({metadata:this.model.get("itemMetadata"),doLayout:false});},_setDialogTitle:function(_16b4){this._dialog.set("title",this._getDialogTitleText(_16b4));},_getDialogTitleText:function(_16b5){return _16b2.title;},_onCancelDialog:function(){this.isShowingChildDialog=false;this.onCancelDialog();},_onDialogExecute:function(){if(this.validate()){this.onExecuteDialog();}},onExecuteDialog:function(){},onCancelDialog:function(){},_setDialogConfirmActionText:function(_16b6){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"label",this._getDialogConfirmActionText(_16b6));},_getDialogConfirmActionText:function(_16b7){return _16b7?_16b3.action.ok:_16b3.action.add;},_setDialogConfirmActionStatus:function(item){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!item||item==="");}});});},"epi-cms/widget/_HasChildDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom","dijit/_FocusMixin","dijit/popup"],function(_16b8,lang,_16b9,dom,_16ba,popup){return _16b8([_16ba],{isShowingChildDialog:false,_openedChildDialog:null,_waitingForFocus:false,startup:function(){if(!this._started){this.own(_16b9.before(popup,"open",lang.hitch(this,"_onPopupOpen"),true),_16b9.after(popup,"close",lang.hitch(this,"_onPopupClosed"),true));}this.inherited(arguments);},_onPopupOpen:function(_16bb){var popup=_16bb.popup;if(popup&&popup.popupParent){return;}var _16bc=popup&&popup.currentTarget;if(_16bc&&dom.isDescendant(_16bc,this.domNode)){this._openedChildDialog=popup;this.isShowingChildDialog=true;}},_onPopupClosed:function(popup){if(this._openedChildDialog===popup){this._openedChildDialog=null;this.isShowingChildDialog=false;this._waitingForFocus=true;setTimeout(lang.hitch(this,"_waitForFocus"),0);}},_waitForFocus:function(){if(this._waitingForFocus){this._waitingForFocus=false;this._onBlur();}},_onBlur:function(){if(this.isShowingChildDialog){return;}this.inherited(arguments);},_onFocus:function(){this._waitingForFocus=false;if(this.isShowingChildDialog){return;}this.inherited(arguments);}});});},"url:epi-cms/contentediting/editors/templates/CollectionEditor.html":"<div class=\"dijitInline\" style=\"width:100%;\">\r\n    <div data-dojo-attach-point=\"commandTargetNode\"></div>\r\n    <div data-dojo-attach-point=\"gridNode\"></div>\r\n</div>","epi-cms/contentediting/editors/ContentAreaEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/on","dojo/topic","dojo/when","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_CssStateMixin","dijit/_WidgetsInTemplateMixin","epi/shell/dnd/Target","epi/shell/command/_CommandProviderMixin","./_ContentAreaTree","./_ContentAreaTreeModel","./_TextWithActionLinksMixin","epi-cms/_ContentContextMixin","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi/shell/widget/ContextMenu","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/overlay/Block","epi-cms/widget/command/CreateContentFromSelector","epi-cms/widget/_HasChildDialogMixin","epi-cms/contentediting/command/BlockRemove","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/MoveToPrevious","epi-cms/contentediting/command/MoveToNext","epi-cms/contentediting/command/MoveOutsideGroup","epi-cms/contentediting/command/Personalize","epi-cms/contentediting/command/SelectDisplayOption","dojo/text!./templates/ContentAreaEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_16bd,lang,_16be,_16bf,on,topic,when,_16c0,_16c1,_16c2,_16c3,_16c4,_16c5,_16c6,_16c7,_16c8,_16c9,_16ca,_16cb,_16cc,_16cd,_16ce,_16cf,_16d0,_16d1,_16d2,_16d3,_16d4,_16d5,_16d6,_16d7,_16d8,_16d9){return _16bd([_16c1,_16c2,_16c4,_16c3,_16cd,_16ca,_16c6,_16d0,_16c9],{baseClass:"epi-content-area-editor",res:_16d9,templateString:_16d8,value:null,multiple:true,parent:null,overlayItem:null,model:null,intermediateChanges:true,editMode:"onpageedit",_preventOnBlur:false,_dndTarget:null,allowedTypes:null,restrictedTypes:null,constructor:function(){this.allowedDndTypes=[];},onChange:function(value){},_handleModelChange:function(value){this.validate();this.onChange(value);},_onBlur:function(){if(this._preventOnBlur){return;}this.inherited(arguments);},focus:function(){if(this.tree&&this.model.get("value").length>0){this._focusManager.focus(this.tree.domNode);}else{this.textWithLinks.focus();}},postMixInProperties:function(){this.inherited(arguments);this.commands=this._commands||[new _16d2(),new _16d7(),new _16d6({category:null}),new _16d5(),new _16d3(),new _16d4(),new _16d1()];this.own(this.model=this.model||new _16cb(),this.treeModel=this.treeModel||new _16c8({model:this.model}),this.model.watch("selectedItem",lang.hitch(this,function(name,_16da,_16db){this.updateCommandModel(_16db);})),on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._set("value",this.model.get("value"));this._handleModelChange(this.value);})));},buildRendering:function(){this.inherited(arguments);this.contextMenu=new _16cc();this.contextMenu.addProvider(this);this.own(this.contextMenu);this.setupActionLinks(this.actionsContainer);this.own(this._dndTarget=new _16c5(this.actionsContainer,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.own(_16be.after(this._dndTarget,"onDropData",lang.hitch(this,function(_16dc,_16dd,nodes,copy){var model=_16dc[0].data;this.model.modify(lang.hitch(this,function(){this.model.addChild(model);}));if(!this.tree){this._createTree();}}),true));this.own(_16be.after(this._dndTarget,"onDrop",lang.hitch(this,"focus")));},postCreate:function(){this.inherited(arguments);this.set("emptyMessage",_16d9.emptymessage);if(this.parent&&this.overlayItem){this.connect(this.parent,"onStartEdit",function(){this._selectFromOverlay(this.overlayItem.model);});}this.own(topic.subscribe("/dnd/start",lang.hitch(this,this._startDrag)));},startup:function(){if(this._started){return;}this.inherited(arguments);this.tree&&this.tree.startup();this.contextMenu.startup();},destroy:function(){this.tree&&this.tree.destroyRecursive();this.inherited(arguments);},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},executeAction:function(_16de){if(_16de==="createnewblock"){this._preventOnBlur=true;this.validate(false);var _16df=new _16cf({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_16df.set("model",{save:lang.hitch(this,function(block){this._preventOnBlur=false;var value=lang.clone(this.get("value"),true)||[];value.push(block);this.set("value",value);this.parent.set("editing",true);this.onChange(value);this.onBlur();}),cancel:lang.hitch(this,function(){this._preventOnBlur=false;this.onBlur();})});_16df.execute();}},isValid:function(_16e0){return (this._preventOnBlur||!this.required||this.model.get("value").length>0);},_setReadOnlyAttr:function(_16e1){this._set("readOnly",_16e1);_16bf.set(this.actionsContainer,"display",_16e1?"none":"");if(this._source){this._source.isSource=!this.readOnly;}if(this.model){this.model.set("readOnly",_16e1);}this.tree&&this.tree.set("readOnly",_16e1);},_checkAcceptance:function(_16e2,nodes){return this.readOnly?false:this._source.defaultCheckAcceptance(_16e2,nodes);},_createTree:function(){this.tree=new _16c7({accept:this.allowedDndTypes,reject:this.restrictedDndTypes,contextMenu:this.contextMenu,model:this.treeModel,readOnly:this.readOnly}).placeAt(this.domNode,"first");this.tree.own(_16be.after(this.tree.dndController,"onDndEnd",lang.hitch(this,"focus")));},_selectFromOverlay:function(_16e3){var child=_16e3&&_16e3.selectedItem&&_16e3.selectedItem.serialize(),model=this.model,path=["root"];if(!child){return;}if(child.contentGroup){model=model.getChild({name:child.contentGroup});path.push(model.id);}model=model.getChild(child);if(!model){return;}path.push(model.id);model.set("selected",true);model.set("ensurePersonalization",_16e3.selectedItem.ensurePersonalization);this.tree&&this.tree.set("path",path);},_startDrag:function(_16e4,nodes,copy){var _16e5=_16c0.getEnclosingWidget(nodes[0]);if(_16e5.isInstanceOf(_16ce)&&this.parent.cancel){this.parent.set("isModified",false);this.parent.cancel();}},_setValueAttr:function(value){this.tree&&this.tree.destroyRecursive();this._set("value",value||[]);this._supressValueChanged=true;this.model.set("value",value);this._supressValueChanged=false;this._createTree();}});});},"epi-cms/contentediting/editors/_ContentAreaTree":function(){define(["dojo/_base/declare","dojo/aspect","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dijit/registry","epi/dependency","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","./_BlockTreeNode","./_GroupTreeNode"],function(_16e6,_16e7,event,array,lang,_16e8,_16e9,_16ea,_16eb,_16ec,_16ed,Tree,_16ee,_16ef,_16f0,_16f1){return _16e6([Tree],{showRoot:false,dndController:_16ec,betweenThreshold:8,postMixInProperties:function(){this.inherited(arguments);this.accept.push("personalizationarea");},postCreate:function(){this.inherited(arguments);_16e8.add(this.domNode,"epi-tree-mngr");this.own(_16e7.after(this.dndController,"onDndItemRemoved",lang.hitch(this,function(_16f2){if(_16f2[0]&&_16f2[0].data){this.model.deleteItem(_16f2[0].data);}}),true));this.own(_16e7.after(this,"_onItemChildrenChange",lang.hitch(this,function(_16f3,_16f4){array.forEach(_16f4,function(child){var _16f5=this._itemNodesMap[this.model.getIdentity(child)];if(child.expandOnAdd){this._expandNode(_16f5[0]);}if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){_16f5[0].showPersonalizationSelector();}},this);}),true));},getTooltip:function(item){return item.label||"";},_setReadOnlyAttr:function(_16f6){this._set("readOnly",_16f6);if(this.dndController){this.dndController.isSource=!_16f6;}},getItemType:function(item){if(!item.typeIdentifier){if(item.contentGroup!==undefined){return ["personalizationarea"];}else{return null;}}return this.accept;},checkItemAcceptance:function(_16f7,_16f8,_16f9,copy){if(this.tree.readOnly){return false;}var _16fa=_16e9.getEnclosingWidget(_16f7);var _16fb=_16fa.item;var _16fc=true;_16f8.forInSelectedItems(function(item){_16fc=this.tree.model.checkItemAcceptance(_16fb,item.data.item,_16f9);},this);return _16fc;},_onNodeMouseEnter:function(node){node.set("mouseHover",true);},_onNodeMouseLeave:function(node){node.set("mouseHover",false);},_createTreeNode:function(model){var node;if(model.item instanceof _16ef){node=new _16f1(model);}else{if(model.item instanceof _16ee){node=new _16f0(model);}else{node=this.inherited(arguments);}}node.set("contextMenu",this.contextMenu);node.set("dndData",model.item);return node;},onClick:function(item,node,e){if(node instanceof _16f1){if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}}}});});},"epi-cms/contentediting/viewmodel/ContentBlockViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/promise/all","dojox/html/entities","epi","epi/dependency","./_ViewModelMixin","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_16fd,lang,when,all,_16fe,epi,_16ff,_1700,_1701,_1702){return _16fd([_1701,_1700],{label:null,store:null,hasSiblings:true,isVisible:true,settings:{displayOptionsAttributeName:"data-epi-content-display-option",contentGroupAttributeName:"data-contentgroup"},roles:null,constructor:function(){this.roleIdentities=this.roleIdentities||[];this.attributes={};},postscript:function(){this.inherited(arguments);if(!this.store){var _1703=_16ff.resolve("epi.storeregistry");this.store=_1703.get("epi.cms.visitorgroup");}this.set("label",this.name);this._reloadRoles();},serialize:function(){return {contentGroup:this.contentGroup,contentLink:this.contentLink,name:this.name,roleIdentities:this.roleIdentities,typeIdentifier:this.typeIdentifier,attributes:this.attributes};},equals:function(item){for(var prop in item){if(!epi.areEqual(this[prop],item[prop])){return false;}}return true;},isRoleSelected:function(_1704){if(!this.roleIdentities){return false;}return this.roleIdentities.indexOf(_1704)>-1;},hasAnyRoles:function(){if(!this.roleIdentities){return false;}return this.roleIdentities.length>0;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},moveOutsideGroup:function(){if(!this.contentGroup){return;}this.parent.modify(function(){this.parent.moveOutsideGroup(this);},this);},remove:function(){this.parent.modify(function(){this.parent.removeChild(this);},this);},personalize:function(){this.parent.modify(function(){this.parent.personalize(this);},this);},selectRole:function(_1705,_1706){var _1707=(this.roles||[]).map(function(role){return role.id;});var index=_1707.indexOf(_1705);if(index>=0){if(!_1706){_1707.splice(index,1);}}else{if(_1706){_1707.push(_1705);}}this.set("roleIdentities",_1707);},resetRoleIdentities:function(){this.set("visible",true);this.set("roleIdentities",null);},_displayOptionSetter:function(_1708){this.attributes[this.settings.displayOptionsAttributeName]=_1708;},_displayOptionGetter:function(){return this.attributes[this.settings.displayOptionsAttributeName];},_roleIdentitiesSetter:function(_1709){this.roleIdentities=_1709||[];this._reloadRoles();},_parentSetter:function(_170a){this.parent=_170a;this.set("contentGroup",this.parent.name);},_contentGroupSetter:function(_170b){if(_170b===undefined){_170b="";}this.contentGroup=_170b;this.attributes[this.settings.contentGroupAttributeName]=_170b;this._reloadRoles();},_reloadRoles:function(){var store=this.store;if(!store){return;}var _170c=all(this.roleIdentities.map(function(id){return when(store.get(id)).otherwise(function(){console.warn("Could not load visitor group with id: "+id);});}));_170c.then(lang.hitch(this,"set","roles"));return _170c;},_hasSiblingsSetter:function(_170d){this.hasSiblings=_170d;this._updateRolesString();},_selectedSetter:function(_170e){this.selected=_170e;if(_170e){this.emit("selected",this);}},_updateRolesString:function(){if(!this.contentGroup||this.roles===null){this.set("rolesString","");return;}if(!this.hasAnyRoles()){if(this.hasSiblings){this.set("rolesString",_1702.everyoneelsesee);}else{this.set("rolesString",_1702.everyonesees);}return;}if(!this.roles.length){this.set("rolesString",_1702.groupcannotsees);return;}var _170f=this.roles.map(function(r){return "<em>"+_16fe.encode(r.name)+"</em>";}).sort().join(", ");var names=_170f.replace(/, (?=[^,]+$)/," "+_1702.groupsand);var _1710="";if(this.roles.length>1){_1710=lang.replace(_1702.groupssee,{groupNames:names});}else{_1710=lang.replace(_1702.groupsees,{groupName:names});}this.set("rolesString",_1710);},_rolesSetter:function(roles){this.roles=roles.filter(function(role){return !!role;});this._updateRolesString();}});});},"epi-cms/contentediting/viewmodel/_ViewModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Evented","dijit/Destroyable"],function(array,_1711,_1712,_1713,_1714){return _1711([_1712,_1713,_1714],{modify:function(_1715,scope,_1716){this._isBeingModified=true;if(scope){_1715.apply(scope);}else{_1715();}this._isBeingModified=false;if(_1716||_1716===undefined){this.emit("changed");}},emit:function(type,event){if(type==="changed"&&this._isBeingModified){return;}this.inherited(arguments);}});});},"epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(array,_1717,lang,_1718,_1719){return _1717([_1718],{name:null,label:_1719.grouplabel,addChild:function(child,index){this.inherited(arguments,[child,index||0]);this._handles[child.id]=[child.on("selected",lang.hitch(this,"emit","selected",child)),child.on("changed",lang.hitch(this,"emit","changed"))];},serialize:function(){return array.map(this.getChildren(),function(child){return child.serialize();});},equals:function(item){return this.name===item.name;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},moveOutsideGroup:function(child){this.parent.moveOutsideGroup(child);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},remove:function(){this.parent.modify(lang.hitch(this,function(){this.parent.removeChild(this);}));},_hash:function(child){return child.contentLink+"_"+Date.now();},_selectedSetter:function(_171a){this.selected=_171a;if(_171a){this.emit("selected",this);}},_visibleGetter:function(){return array.some(this._data,function(item){return item.get("visible");});}});});},"epi-cms/contentediting/viewmodel/_ContainerViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","./_ViewModelMixin"],function(array,_171b,_171c){return _171b([_171c],{constructor:function(){this._data=[];this._handles={};},addChild:function(child,index){child.set("parent",this);child.set("readOnly",this.readOnly);if(!child.id){child.id=this._hash(child);}if(typeof index=="number"){this._data.splice(index,0,child);}else{this._data.push(child);}this._emitChildrenChanged();},getChild:function(item){var _171d=this._data;for(var i=_171d.length-1;i>=0;i--){if(_171d[i].equals(item)){return _171d[i];}}return null;},getChildById:function(id){var _171e=this._data;for(var i=_171e.length-1;i>=0;i--){if(_171e[i].id===id){return _171e[i];}}return null;},getChildByIndex:function(index){return this._data[index];},getChildren:function(){return this._data;},removeChild:function(child,_171f){var index=this.indexOf(child),_1720=this._handles[child.id];if(index<0&&_171f){array.forEach(this.getChildren(),function(item){if(typeof item.removeChild==="function"){item.removeChild(child,_171f);}});return;}else{if(index<0){return;}}if(_1720){array.forEach(_1720,function(_1721){_1721.remove();});delete this._handles[child.id];}this._data.splice(index,1);this._emitChildrenChanged();},move:function(child,index){var _1722=this.indexOf(child);this._data.splice(_1722,1);this._data.splice(index,0,child);this._emitChildrenChanged();},indexOf:function(child){return this._data.indexOf(child);},_hash:function(child){},_readOnlySetter:function(_1723){this.readOnly=_1723;array.forEach(this.getChildren(),function(child){child.set("readOnly",_1723);},this);},_emitChildrenChanged:function(_1724){var _1725=this._data.length;array.forEach(this._data,function(child,index){child.set("canMoveNext",index<(_1725-1));child.set("canMovePrevious",index>0&&index<=(_1725-1));child.set("hasSiblings",_1725>1);});this.set("count",_1725||0);this.emit("childrenChanged",_1724?_1724:this);}});});},"epi-cms/contentediting/editors/_BlockTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-class","dijit/Tree","dijit/focus","dijit/_HasDropDown","epi-cms/widget/PersonalizationSelector","epi-cms/dgrid/formatters","./_ContentAreaTreeNodeMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dojo/text!./templates/_BlockTreeNode.html"],function(_1726,lang,keys,_1727,Tree,_1728,_1729,_172a,_172b,_172c,_172d,_172e,_172f){return _1726([Tree._TreeNode,_172c,_1729],{templateString:_172f,_contextMenuClass:"epi-iconContextMenu",isExpandable:false,dropDownPosition:["before"],resources:lang.mixin(_172d,_172e),buildRendering:function(){this.inherited(arguments);this.dropDown=new _172a({model:this.item});this.own(this.dropDown);this.aroundNode=this.domNode;this.set("readOnly",this.item.readOnly);_1727.add(this.domNode,"epi-tree-mngr--block");var node=this.rolesNode;var icon=_172b.contentIcon(this.item.typeIdentifier);_1727.add(this.iconNode,icon);node.innerHTML=this.item.get("rolesString");this.own(this.item.watch("rolesString",lang.hitch(this,function(_1730,_1731,_1732){node.innerHTML=_1732;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this.set("readOnly",this.item.readOnly);})));},setSelected:function(_1733,_1734){this.inherited(arguments);this.item.set("selected",_1733);_1727.toggle(this.iconNodeMenu,this._contextMenuClass,_1733);},showPersonalizationSelector:function(){if(this.readOnly){return;}this.item.set("ensurePersonalization",false);_1728.focus(this.labelNode);this.loadAndOpenDropDown();},focus:function(){this.labelNode.focus();},_onKey:function(e){if(this.dropDown&&this._opened&&e.keyCode===keys.ESCAPE){this.closeDropDown();}},_onKeyUp:function(){}});});},"epi-cms/widget/PersonalizationSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","dojox/html/entities","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/CheckedMenuItem","epi/dependency","epi/shell/_StatefulGetterSetterMixin","dojo/text!./templates/PersonalizationSelector.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dijit/Menu","epi/shell/widget/RadioMenuItem"],function(array,_1735,lang,_1736,when,_1737,_1738,_1739,_173a,_173b,_173c,_173d,_173e,_173f){return _1735([_1738,_1739,_173a],{templateString:_173e,model:null,resources:_173f,postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1740=_173c.resolve("epi.storeregistry");this.store=_1740.get("epi.cms.visitorgroup");}},postCreate:function(){this.inherited(arguments);this.own(this.rdEveryone.on("change",lang.hitch(this,"restoreDefault")),this.model.watch("roleIdentities",lang.hitch(this,function(){if(!this.rdEveryone.checked&&this.model.roleIdentities&&this.model.roleIdentities.length===0){this.restoreDefault();}})));when(this.store.query(),lang.hitch(this,function(_1741){if(!this._destroyed){this.set("visitorGroups",_1741);}}));},restoreDefault:function(){array.forEach(this.visitorGroupsMenu.getChildren(),function(item){item.set("checked",false);});this.rdEveryone.set("checked",true);this.model.set("roleIdentities",null);},_setVisitorGroupsAttr:function(_1742){this._set("visitorGroups",_1742);if(!this.model.hasAnyRoles()){this.rdEveryone.set("checked",true);}array.forEach(_1742,function(group){var item=new _173b({label:_1737.encode(group.name),visitorgroupId:group.id,checked:this.model.isRoleSelected(group.id)});this.own(item.watch("checked",lang.hitch(this,function(_1743,_1744,_1745){this.model.selectRole(group.id,_1745);this.rdEveryone.set("checked",!this.model.hasAnyRoles());})));this.visitorGroupsMenu.addChild(item);},this);}});});},"url:epi-cms/widget/templates/PersonalizationSelector.html":"<div>\r\n    <div class=\"epi-dijitTooltipContainer\">\r\n        <div class=\"epi-invertedTooltip\">\r\n            <div class=\"epi-tooltipDialogTop\">\r\n                <span data-dojo-attach-point=\"header\">${resources.whocansee}</span>\r\n                <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\r\n            </div>\r\n        </div>\r\n        <div class=\"epi-tooltipDialogContent--max-height\">\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"visitorGroupsMenu\" style=\"width:100%\"></div>\r\n            <div class=\"epi-menuSeparator\" tabindex=\"-1\"></div>\r\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"filterOptionsMenu\" style=\"width:100%\">\r\n                <div data-dojo-attach-point=\"rdEveryone\" data-dojo-type=\"epi/shell/widget/RadioMenuItem\" data-dojo-props=\"label:'${resources.everyone}', value: ''\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>","epi/shell/widget/RadioMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>"}});define("epi/shell/widget/RadioMenuItem",["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dijit/CheckedMenuItem","dojo/text!./templates/RadioMenuItem.htm"],function(_1746,array,_1747,_1748,_1749){return _1746([_1748],{baseClass:"dijitMenuItem epi-radioMenuItem",iconClass:null,templateString:_1749,_onClick:function(e){this._resetState();this.inherited(arguments);},_resetState:function(){array.forEach(this._getChildren(),function(child,index){child.set("checked",false);});},_getChildren:function(){return this.getParent().getChildren();},_setIconClassAttr:function(_174a){this._set("iconClass",_174a);_1747.add(this.labelIconNode,_174a);}});});},"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>","epi-cms/contentediting/editors/_ContentAreaTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/focus","dojo/_base/event","dojo/dom-class"],function(_174b,lang,on,_174c,event,_174d){return _174b([],{destroy:function(){this._unBindContextMenu();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.own(on(this.iconNodeMenu,"click",lang.hitch(this.labelNode,this.labelNode.focus)));},_unBindContextMenu:function(){if(this.contextMenu){this.contextMenu.unBindDomNode(this.iconNodeMenu);}},_setContextMenuAttr:function(_174e){this._unBindContextMenu();this._set("contextMenu",_174e);this.contextMenu.bindDomNode(this.iconNodeMenu);},_setMouseHoverAttr:function(hover){this._set("hover",hover);if(this.item.get("selected")){return;}_174d.toggle(this.iconNodeMenu,this._contextMenuClass,this.hover);}});});},"url:epi-cms/contentediting/editors/templates/_BlockTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\r\n    <div class=\"epi-tree-mngr--node-wrapper\" data-dojo-attach-point=\"rowNode\">\r\n        <span data-dojo-attach-point=\"rolesNode, _buttonNode\" class=\"epi-tree-mngr--view-settings\"></span>\r\n        <div class=\"dijitTreeRow dijitInline\" role=\"presentation\">\r\n            <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                    <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" title=\"${resources.settingstooltip}\" role=\"presentation\">&nbsp;</span>\r\n                </span>\r\n                <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"/>\r\n                <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n\r\n            </span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/_GroupTreeNode":function(){define(["dojo/aspect","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/Tree","./_ContentAreaTreeNodeMixin","dojo/text!./templates/_GroupTreeNode.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_174f,array,_1750,lang,_1751,_1752,Tree,_1753,_1754,_1755){return _1750([Tree._TreeNode,_1753],{templateString:_1754,_contextMenuClass:"epi-iconContextMenu",resources:_1755,buildRendering:function(){this.inherited(arguments);_1751.remove(this.iconNode,"dijitFolderClosed");this.own(_174f.after(this,"expand",lang.hitch(this,function(_1756){_1756.then(lang.hitch(this,function(){if(this._destroyed){return;}_1751.add(this.domNode,"epi-treeNodeOpen");array.forEach(this.getChildren(),function(_1757){var child=_1757.item;if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){child.set("ensurePersonalization",false);_1757.showPersonalizationSelector();}},this);}));return _1756;})));this.own(_174f.after(this,"collapse",lang.hitch(this,function(_1758){_1758.then(lang.hitch(this,function(){_1751.remove(this.domNode,"epi-treeNodeOpen");}));return _1758;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this._toggleDropMoreMessageNode();})));},postCreate:function(){this.inherited(arguments);this.own(this.item.watch("count",lang.hitch(this,function(_1759,_175a,_175b){this.set("count",_175b);})));if(this.item){this.set("count",this.item.count);}},setSelected:function(_175c){this.inherited(arguments);this.item.set("selected",_175c);_1751.remove(this.rowNode,"dijitTreeRowSelected");_1751.toggle(this.domNode,"dijitTreeRowSelected",_175c);},_setCountAttr:function(count){this._set("count",count);this._toggleDropMoreMessageNode();},_toggleDropMoreMessageNode:function(){_1752.set(this.dropMoreMessageNode,"display",!this.item.readOnly&&this.count===1?"":"none");}});});},"url:epi-cms/contentediting/editors/templates/_GroupTreeNode.html":"<div class=\"dijitTreeNode epi-tree-mngr--group\" role=\"presentation\" data-dojo-attach-point=\"rowNode\">\r\n    <div class=\"dijitTreeRow dijitInline epi-tree-mngr--group-header\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"/>\r\n        <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\">&nbsp;</span>\r\n            </span>\r\n            <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon epi-iconUsers\" role=\"presentation\"/>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\r\n        </span>\r\n    </div>\r\n    <hr />\r\n    <span data-dojo-attach-point=\"dropMoreMessageNode\" class=\"epi-tip epi-tip--block\">${resources.groupdropmoremessage}</span>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/_ContentAreaTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/tree/model","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel"],function(array,_175d,lang,_175e,_175f,_1760){return _175d([_175e],{model:null,root:{id:"root",name:"root"},constructor:function(_1761){_175d.safeMixin(this,_1761);},pasteItem:function(_1762,_1763,_1764,bCopy,_1765,_1766){var _1767=_1763.id==="root"?this.model:this.model.getChildById(_1763.id);var child=_1767.getChildById(_1762.id);var _1768=_1764.id==="root"?this.model:this.model.getChildById(_1764.id);if(child instanceof _175f&&!child.hasAnyRoles()){child.set("ensurePersonalization",true);}if(_1767===_1768){this.model.modify(function(){_1768.move(child,_1765);});return;}this.model.modify(function(){_1767.removeChild(child);_1768.addChild(child,_1765);});},deleteItem:function(item){this.model.modify(lang.hitch(this,function(){this.model.removeChild(item,true);}));},newItem:function(args,_1769,_176a,_176b){if(args.dndData&&args.dndData.data){var _176c=_1769.id==="root"?this.model:this.model.getChildById(_1769.id);var item=args.dndData.data;if(!(item instanceof _175f)&&!(item instanceof _1760)){item=new _175f(item);}item.set("ensurePersonalization",true);this.model.modify(function(){_176c.addChild(item,_176a);});}},checkItemAcceptance:function(_176d,item,_176e){if(_176e==="over"){if(!(_176d instanceof _1760)){return false;}if(!(item instanceof _175f)){return false;}}if(_176d instanceof _175f&&item instanceof _1760&&_176d.contentGroup){return false;}return true;},getRoot:function(_176f){_176f(this.root);},getLabel:function(item){return item.label;},mayHaveChildren:function(item){if(typeof item.getChildren=="function"||item.id==="root"){return true;}return false;},getIdentity:function(item){return item.id;},getChildren:function(_1770,_1771){var _1772;if(_1770.id==="root"){_1772=this.model.getChildren();_1771(_1772);this.model.on("childrenChanged",lang.hitch(this,function(index,_1773,adds){this.onChildrenChange(this.root,this.model.getChildren());}));}else{var model=this.model.getChildById(_1770.id);if(model&&typeof model.getChildren=="function"){_1772=model.getChildren();_1771(_1772);model.on("childrenChanged",lang.hitch(this,function(index,_1774,adds){this.onChildrenChange(_1770,model.getChildren());}));}else{_1771([]);}}}});});},"dijit/tree/model":function(){define("dijit/tree/model",["dojo/_base/declare"],function(_1775){return _1775("dijit.tree.model",null,{destroy:function(){},getRoot:function(_1776){},mayHaveChildren:function(item){},getChildren:function(_1777,_1778){},isItem:function(_1779){},fetchItemByIdentity:function(_177a){},getIdentity:function(item){},getLabel:function(item){},newItem:function(args,_177b,_177c,_177d){},pasteItem:function(_177e,_177f,_1780,bCopy,_1781,_1782){},onChange:function(item){},onChildrenChange:function(_1783,_1784){}});});},"epi-cms/contentediting/editors/_TextWithActionLinksMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/when","epi/shell/widget/TextWithActionLinks","epi/i18n!epi/cms/nls/episerver.cms.widget.overlay.blockarea"],function(_1785,lang,_1786,on,when,_1787,_1788){return _1785(null,{textWithLinks:null,actionsResource:_1788,isCreateLinkVisible:function(){return true;},getTemplateString:function(){var _1789=new _1786();var _178a=this.actionsResource.emptyactions;when(this.isCreateLinkVisible(),function(_178b){var _178c=_178b?_178a.template:_178a.templatewithoutcreate;_1789.resolve({templateString:_178c,actions:_178a.actions});});return _1789.promise;},setupActionLinks:function(_178d){when(this.getTemplateString(),lang.hitch(this,function(_178e){if(!_178e){return;}this.textWithLinks=new _1787({contentString:_178e.templateString,namedActions:_178e.actions});this.own(on(this.textWithLinks,"onActionClick",lang.hitch(this,this.executeAction)));if(_178d){this.textWithLinks.placeAt(_178d);}}));},executeAction:function(_178f){}});});},"epi/shell/widget/TextWithActionLinks":function(){define("epi/shell/widget/TextWithActionLinks",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/Evented","dojo/on","dojo/query","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities"],function(array,_1790,event,lang,_1791,on,query,_1792,_1793,_1794,_1795){return _1790([_1792,_1793,_1791],{tagName:"span",templateString:"<{0}>{1}</{0}>",contentString:"",namedActions:null,_actionMap:null,_eventHandlers:null,postMixInProperties:function(){this.inherited(arguments);this._actionMap=[];this._eventHandlers=[];var _1796={};var _1797=this.contentString;var _1798;var id=0;if(this.namedActions){for(var _1799 in this.namedActions){_1798=_1795.encode(this.namedActions[_1799]);_1796[_1799]="<a class=\"epi-visibleLink\" href=\"#\" data-dojo-attach-point=\"action"+(id++)+"\">"+_1798+"</a>";this._actionMap.push(_1799);}_1797=lang.replace(_1797,_1796);}this.templateString=lang.replace(this.templateString,[this.tagName,_1797]);},postCreate:function(){this.inherited(arguments);array.forEach(this._actionMap,function(_179a,id){var link=this["action"+id];if(link){var _179b=on(link,"click",(function(_179c,_179d){return function(evt){event.stop(evt);_179c.emit("onActionClick",_179d);};})(this,_179a));this._eventHandlers.push(_179b);}},this);},destroy:function(){array.forEach(this._eventHandlers,function(_179e){_179e.remove();},this);this._eventHandlers=null;this.inherited(arguments);},focus:function(){var links=query("a",this.domNode);if(links.length>0){_1794.focus(links[0]);}}});});},"epi-cms/contentediting/viewmodel/ContentAreaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojox/uuid/generateRandomUuid","epi/dependency","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi-cms/_ContentContextMixin"],function(array,_179f,lang,all,when,_17a0,_17a1,_17a2,_17a3,_17a4,_17a5,_17a6){return _179f([_17a5,_17a6],{selectedItem:null,postscript:function(){this.inherited(arguments);this.contentTypeService=this.contentTypeService||_17a1.resolve("epi.cms.ContentTypeService");if(!this._contentTypeStore){var _17a7=_17a1.resolve("epi.storeregistry");this._contentTypeStore=_17a7.get("epi.cms.contenttype");}},addChild:function(child){if(!(child instanceof _17a2)&&!(child instanceof _17a3)){var model=new _17a2(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){child=this._groups[model.contentGroup];if(!child){child=this._createGroup(model.contentGroup);}child.addChild(model);}else{child=model;}}else{child.set("contentGroup",null);if(child instanceof _17a3){this.own(child.on("childrenChanged",lang.hitch(this,function(){this._emitChildrenChanged(child);if(child.getChildren().length===0){this.removeChild(child);}})));}else{if(child instanceof _17a2){child.resetRoleIdentities();this.own(child.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));}}}this.own(child.on("changed",lang.hitch(this,function(){this.emit("changed");})));this.inherited(arguments);this._handles[child.id]=child.on("selected",lang.hitch(this,"set","selectedItem"));},canCreateBlock:function(_17a8,_17a9){var _17aa=this.contentTypeService;return all([this.getCurrentContext(),this.getCurrentContent()]).then(function(_17ab){var _17ac=_17ab[0],_17ad=_17ab[1];if(!_17ac||!_17ad){return false;}var _17ae=_17a4.isActionAvailable(_17ad,_17a4.action.Create,_17a4.providerCapabilities.Create,true);if(!_17ae||!_17ac.capabilities.resourceable||_17ac.currentMode==="create"||_17ac.currentMode==="translate"){return false;}return when(_17aa.getAcceptedChildTypes(_17ad.contentLink,true,["episerver.core.blockdata"],_17a8,_17a9)).then(function(_17af){return !!_17af.length;});});},moveVisible:function(child,_17b0){var _17b1=array.filter(this.getChildren(),function(item){return item.get("visible");}),delta=_17b0?1:-1,_17b2=array.indexOf(_17b1,child)+delta,index=this.indexOf(_17b1[_17b2]);this.modify(lang.hitch(this,function(){this.move(child,index);}));},moveOutsideGroup:function(child){if(!child.contentGroup){return;}var group=this.getChild({name:child.contentGroup}),index=this.indexOf(group);this.modify(lang.hitch(this,function(){group.removeChild(child);this.addChild(child,index);}));},personalize:function(child){var index=this.indexOf(child);this.removeChild(child);var group=new _17a3({name:"group_"+Date.now(),expandOnAdd:true});child.set("ensurePersonalization",true);group.addChild(child);this.addChild(group,index);},_valueGetter:function(){var value=[];array.forEach(this.getChildren(),function(child){value=value.concat(child.serialize());});return value;},_valueSetter:function(value){this._transformValueToModels(value);},_selectedItemSetter:function(value){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=value;},_transformValueToModels:function(value){this.modify(function(){var _17b3=this.getChildren();for(var i=_17b3.length-1;i>=0;i--){this.removeChild(_17b3[i]);}this._groups={};array.forEach(value,function(child){var model=new _17a2(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){var group=this._groups[model.contentGroup];if(!group){group=this._createGroup(model.contentGroup);this.addChild(group);}group.addChild(model,group.getChildren().length);}else{this.addChild(model);}},this);},this,false);},_createGroup:function(name){var group=new _17a3({name:name});this._groups[name]=group;return group;},_hash:function(child){return (child.contentLink||child.name)+"_"+_17a0();}});});},"dojox/uuid/generateRandomUuid":function(){define("dojox/uuid/generateRandomUuid",["./_base"],function(){dojox.uuid.generateRandomUuid=function(){var _17b4=16;function _17b5(){var _17b6=Math.floor((Math.random()%1)*Math.pow(2,32));var _17b7=_17b6.toString(_17b4);while(_17b7.length<8){_17b7="0"+_17b7;}return _17b7;};var _17b8="-";var _17b9="4";var _17ba="8";var a=_17b5();var b=_17b5();b=b.substring(0,4)+_17b8+_17b9+b.substring(5,8);var c=_17b5();c=_17ba+c.substring(1,4)+_17b8+c.substring(4,8);var d=_17b5();var _17bb=a+_17b8+b+_17b8+c+d;_17bb=_17bb.toLowerCase();return _17bb;};return dojox.uuid.generateRandomUuid;});},"dojox/uuid/_base":function(){define("dojox/uuid/_base",["dojo/_base/kernel","dojo/_base/lang"],function(dojo){dojo.getObject("uuid",true,dojox);dojox.uuid.NIL_UUID="00000000-0000-0000-0000-000000000000";dojox.uuid.version={UNKNOWN:0,TIME_BASED:1,DCE_SECURITY:2,NAME_BASED_MD5:3,RANDOM:4,NAME_BASED_SHA1:5};dojox.uuid.variant={NCS:"0",DCE:"10",MICROSOFT:"110",UNKNOWN:"111"};dojox.uuid.assert=function(_17bc,_17bd){if(!_17bc){if(!_17bd){_17bd="An assert statement failed.\n"+"The method dojox.uuid.assert() was called with a 'false' value.\n";}throw new Error(_17bd);}};dojox.uuid.generateNilUuid=function(){return dojox.uuid.NIL_UUID;};dojox.uuid.isValid=function(_17be){_17be=_17be.toString();var valid=(dojo.isString(_17be)&&(_17be.length==36)&&(_17be==_17be.toLowerCase()));if(valid){var _17bf=_17be.split("-");valid=((_17bf.length==5)&&(_17bf[0].length==8)&&(_17bf[1].length==4)&&(_17bf[2].length==4)&&(_17bf[3].length==4)&&(_17bf[4].length==12));var _17c0=16;for(var i in _17bf){var part=_17bf[i];var _17c1=parseInt(part,_17c0);valid=valid&&isFinite(_17c1);}}return valid;};dojox.uuid.getVariant=function(_17c2){if(!dojox.uuid._ourVariantLookupTable){var _17c3=dojox.uuid.variant;var _17c4=[];_17c4[0]=_17c3.NCS;_17c4[1]=_17c3.NCS;_17c4[2]=_17c3.NCS;_17c4[3]=_17c3.NCS;_17c4[4]=_17c3.NCS;_17c4[5]=_17c3.NCS;_17c4[6]=_17c3.NCS;_17c4[7]=_17c3.NCS;_17c4[8]=_17c3.DCE;_17c4[9]=_17c3.DCE;_17c4[10]=_17c3.DCE;_17c4[11]=_17c3.DCE;_17c4[12]=_17c3.MICROSOFT;_17c4[13]=_17c3.MICROSOFT;_17c4[14]=_17c3.UNKNOWN;_17c4[15]=_17c3.UNKNOWN;dojox.uuid._ourVariantLookupTable=_17c4;}_17c2=_17c2.toString();var _17c5=_17c2.charAt(19);var _17c6=16;var _17c7=parseInt(_17c5,_17c6);dojox.uuid.assert((_17c7>=0)&&(_17c7<=16));return dojox.uuid._ourVariantLookupTable[_17c7];};dojox.uuid.getVersion=function(_17c8){var _17c9="dojox.uuid.getVersion() was not passed a DCE Variant UUID.";dojox.uuid.assert(dojox.uuid.getVariant(_17c8)==dojox.uuid.variant.DCE,_17c9);_17c8=_17c8.toString();var _17ca=_17c8.charAt(14);var _17cb=16;var _17cc=parseInt(_17ca,_17cb);return _17cc;};dojox.uuid.getNode=function(_17cd){var _17ce="dojox.uuid.getNode() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_17cd)==dojox.uuid.version.TIME_BASED,_17ce);_17cd=_17cd.toString();var _17cf=_17cd.split("-");var _17d0=_17cf[4];return _17d0;};dojox.uuid.getTimestamp=function(_17d1,_17d2){var _17d3="dojox.uuid.getTimestamp() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_17d1)==dojox.uuid.version.TIME_BASED,_17d3);_17d1=_17d1.toString();if(!_17d2){_17d2=null;}switch(_17d2){case "string":case String:return dojox.uuid.getTimestamp(_17d1,Date).toUTCString();break;case "hex":var _17d4=_17d1.split("-");var _17d5=_17d4[0];var _17d6=_17d4[1];var _17d7=_17d4[2];_17d7=_17d7.slice(1);var _17d8=_17d7+_17d6+_17d5;dojox.uuid.assert(_17d8.length==15);return _17d8;break;case null:case "date":case Date:var _17d9=3394248;var _17da=16;var _17db=_17d1.split("-");var _17dc=parseInt(_17db[0],_17da);var _17dd=parseInt(_17db[1],_17da);var _17de=parseInt(_17db[2],_17da);var _17df=_17de&4095;_17df<<=16;_17df+=_17dd;_17df*=4294967296;_17df+=_17dc;var _17e0=_17df/10000;var _17e1=60*60;var _17e2=_17d9;var _17e3=_17e2*_17e1;var _17e4=_17e3*1000;var _17e5=_17e0-_17e4;var _17e6=new Date(_17e5);return _17e6;break;default:dojox.uuid.assert(false,"dojox.uuid.getTimestamp was not passed a valid returnType: "+_17d2);break;}};return dojox.uuid;});},"epi-cms/widget/overlay/Block":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/when","epi/shell/widget/overlay/_Base","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/overlay/_OverlayItemInfoMixin","epi-cms/contentediting/command/ContentAreaCommands","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!../templates/Block.html","dijit/form/DropDownButton","epi/shell/widget/ContextMenu"],function(_17e7,event,lang,_17e8,_17e9,on,when,_17ea,_17eb,_17ec,_17ed,_17ee,_17ef,_17f0,_17f1){return _17e7([_17ea,_17eb,_17ec,_17ed],{templateString:_17f1,res:_17f0,_setMissingRendererAttr:function(value){_17e8.toggle(this.domNode,"epi-overlay-item-missing-renderer",value);},buildRendering:function(){this.inherited(arguments);_17e9.set(this.personalizedIcon,"display",this.viewModel.contentGroup?"":"none");},postCreate:function(){this.inherited(arguments);this._injectDynamicStyles();this.commandProvider=this.commandProvider||new _17ee({model:this.viewModel});this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_17f2,_17f3,_17f4){when(_17ef.getMissingLanguageMessage(this.viewModel.content),lang.hitch(this,function(_17f5){_17e9.set(this.warningIcon,"display",_17f5?"":"none");}));_17e9.set(this.iconsContainer,"display",this.viewModel.contentGroup||_17f4?"":"none");})));this.viewModel.loadStatus();this.contextMenu.addProvider(this.commandProvider);if(this.blockInfo&&this.blockInfo.missingrenderer){this.set("missingRenderer",this.blockInfo.missingrenderer);}this.own(on(this.domNode,"click",lang.hitch(this.viewModel,"set","selected",true)),on(this.settingsButton,"click",lang.hitch(this,"_onContextMenuClick")),on(this.domNode,"mouseout",lang.hitch(this,function(e){if(this.contextMenu&&this.contextMenu.isShowingNow){event.stop(e);}})));},_injectDynamicStyles:function(){var node=this.sourceItemNode,_17f6=_17e9.get(node,"display"),_17f7=/inline|inline-block/.test(_17f6)?"-inline":"";_17e8.add(node,"epi-injected-minSize"+_17f7);},_onContextMenuClick:function(){this.commandProvider.set("model",this.viewModel);this.viewModel.set("selected",true);return false;}});});},"epi-cms/widget/overlay/_OverlayItemInfoMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojo/when","dojo/mouse","epi/shell/TypeDescriptorManager","epi/shell/widget/overlay/OverlayItemInfo","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_17f8,lang,_17f9,on,when,mouse,_17fa,_17fb,_17fc){return _17f8(null,{disableTooltip:false,useIconOnBlock:false,postCreate:function(){this.own(this.viewModel.watch("contentStatus",lang.hitch(this,"_setupIcon")));this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_17fd,_17fe,_17ff){this.set("statusMessage",_17ff);})));this.subscribe("/dnd/start",lang.hitch(this,function(){if(!this.disableTooltip){this._set("disableTooltip",true);this._showStatusMessage(false);}}));this.subscribe("/dnd/cancel",lang.hitch(this,function(){this._set("disableTooltip",false);}));this.subscribe("/dnd/drop",lang.hitch(this,function(){this._set("disableTooltip",false);}));var node=this.get("containerDomNode");if(node){this.own(on(node,mouse.enter,lang.hitch(this,function(){this._showStatusMessage(!this.get("disableTooltip"));})));this.own(on(node,mouse.leave,lang.hitch(this,function(){this._showStatusMessage(false);})));}this.inherited(arguments);},destroy:function(){if(this._overlayItemInfo){this._overlayItemInfo.destroyRecursive();this._overlayItemInfo=null;}this.inherited(arguments);},_setStatusIconAttr:function(_1800){var _1801=this.get("overlayItemInfo");if(!_1801){return;}_1801.set("statusIcon",_1800);},_setStatusMessageAttr:function(_1802){var _1803=this.get("overlayItemInfo");if(!_1803){return;}_1803.set("statusMessage",_1802);},_getContainerDomNodeAttr:function(){return this.containerDomNode||this.domNode;},_getOverlayItemInfoAttr:function(){if(!this._overlayItemInfo){this._overlayItemInfo=new _17fb();_17f9.place(this._overlayItemInfo.domNode,this.get("containerDomNode"));}return this._overlayItemInfo;},_setupIcon:function(){var _1804,_1805,_1806,_1807;_1804=this.get("overlayItemInfo");_1804.set("class",!this.viewModel.get("isVisibleOnSite")?"epi-overlay-content-invisible":"");var _1808=(this.viewModel.content&&this.viewModel.content.typeIdentifier)||this.viewModel.typeIdentifier;if(this.viewModel.get("isVisibleOnSite")&&_1808){_1805=_17fa.getValue(_1808,"useIconOnBlock");_1806=_17fa.getValue(_1808,"iconClass");_1807=_17fa.getValue(_1808,"description");if(_1805){_1804.set("class","epi-overlay-content-info");this.set("useIconOnBlock",true);this.set("statusIcon",_1806);this.set("statusMessage",_1807);}}},_showStatusMessage:function(_1809){if(this._overlayItemInfo){this._overlayItemInfo.showStatusMessage(_1809);}}});});},"epi/shell/widget/overlay/OverlayItemInfo":function(){require({cache:{"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>"}});define("epi/shell/widget/overlay/OverlayItemInfo",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/html/entities","epi/string","epi/shell/widget/Tooltip","dojo/text!./templates/OverlayItemInfo.html"],function(array,_180a,lang,_180b,_180c,_180d,_180e,_180f,_1810,_1811,_1812,_1813){return _180a([_180e,_180f],{templateString:_1813,postCreate:function(){this.inherited(arguments);this.showStatusMessage(false);},destroy:function(){this.inherited(arguments);this._destroyTooltip();},showStatusMessage:function(_1814){if(this._tooltip){_1814?this._tooltip.open(this.domNode):this._tooltip.close();}},_setStatusIconAttr:function(_1815){var _1816=lang.isArray(_1815);if(_1816){array.forEach(_1815,function(_1817){_180b.add(this.highlightArea,_1817);},this);}else{_180b.add(this.highlightArea,_1815);}},_setStatusMessageAttr:function(_1818){if(!_1818){return;}var _1819=lang.isArray(_1818);if(this._tooltip){if(_1819){this._tooltip.tooltipRows=_1818;}else{this._tooltip.label=_1810.encode(_1818);}}else{var _181a=_180c.create("div",{"class":"epi-overlay-content-tooltip",innerHTML:_1811.toHTML(_1810.encode(_1818))}),_181b=_1819?{tooltipRows:_1818}:{label:_181a.outerHTML};this._tooltip=new _1812(_181b);}},_destroyTooltip:function(){if(this._tooltip){this._tooltip.destroyRecursive();this._tooltip=null;}}});});},"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\r\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\r\n</span>","epi-cms/contentediting/command/ContentAreaCommands":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","./BlockRemove","./BlockEdit","./MoveVisibleToPrevious","./MoveVisibleToNext","./Personalize","./SelectDisplayOption"],function(array,_181c,_181d,_181e,Edit,_181f,_1820,_1821,_1822){return _181c([_181d],{commands:null,constructor:function(){this.commands=[new Edit(),new _1822(),new _1821(),new _181f(),new _1820(),new _181e()];},_modelSetter:function(model){this.model=model;array.forEach(this.commands,function(_1823){_1823.set("model",model);});}});});},"epi-cms/contentediting/command/BlockRemove":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1824,epi,_1825){return _1824([_1825],{name:"remove",label:epi.resources.action.remove,tooltip:epi.resources.action.remove,_execute:function(){this.model.remove();},_onModelValueChange:function(){this.set("canExecute",!!this.model&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/_ContentAreaCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_1826,lang,_1827){return _1826([_1827],{_onModelChange:function(){var model=this.model;if(this._handles){for(var i=0;i<this._handles.length;i++){this._handles[i].remove();}}this._handles=[];if(!model){this.set("canExecute",false);return;}this._watch("readOnly",function(){this._onModelValueChange();},this);this._onModelValueChange();},_watch:function(_1828,_1829,scope){if(scope){this._handles.push(this.model.watch(_1828,lang.hitch(scope,_1829)));}else{this._handles.push(this.model.watch(_1828,_1829));}},_getItem:function(){return this.model.contentGroup?this.model.parent:this.model;},_getContainer:function(){var _182a=function(item){if(item.parent){return _182a(item.parent);}return item;};return _182a(this.model);},_onModelValueChange:function(){}});});},"epi-cms/contentediting/command/BlockEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_182b,lang,topic,when,epi,_182c,_182d,_182e,_182f){return _182b([_182d],{name:"edit",label:epi.resources.action.edit,tooltip:epi.resources.action.edit,iconClass:"epi-iconPen",category:"menuWithSeparator",constructor:function(){this.contentActionSupport=this.contentActionSupport||_182e;var _1830=_182c.resolve("epi.storeregistry");this._store=_1830.get("epi.cms.content.light");},_execute:function(){var _1831=this.model.contentLink;topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1831},{});},_onModelValueChange:function(){var item=this.model;if(!item||!item.contentLink){this.set("canExecute",false);return;}var _1832=item&&this._store.get(item.contentLink);when(_1832,lang.hitch(this,function(_1833){this.set("canExecute",_1833&&!_1833.isDeleted);if(_1833&&_1833.accessMask){if(this.contentActionSupport.hasAccess(_1833.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_182f.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_182f.view);this.set("iconClass","epi-iconSearch");}}}));}});});},"epi-cms/contentediting/command/MoveVisibleToPrevious":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToPrevious"],function(array,_1834,_1835){return _1834([_1835],{_execute:function(){this._getContainer().moveVisible(this._getItem(),false);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1836=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1836,this._getItem());this.set("canExecute",index>0);}});});},"epi-cms/contentediting/command/MoveToPrevious":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1837,epi,_1838){return _1837([_1838],{label:epi.resources.action.moveup,tooltip:epi.resources.action.moveup,iconClass:"epi-iconUp",_execute:function(){this.model.movePrevious();},_onModelChange:function(){this.inherited(arguments);this._watch("canMovePrevious",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMovePrevious")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/MoveVisibleToNext":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToNext"],function(array,_1839,_183a){return _1839([_183a],{_execute:function(){this._getContainer().moveVisible(this._getItem(),true);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _183b=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_183b,this._getItem());this.set("canExecute",index!==-1&&index<_183b.length-1);}});});},"epi-cms/contentediting/command/MoveToNext":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_183c,epi,_183d){return _183c([_183d],{label:epi.resources.action.movedown,tooltip:epi.resources.action.movedown,iconClass:"epi-iconDown",category:"menuWithSeparator",_execute:function(){this.model.moveNext();},_onModelChange:function(){this.inherited(arguments);this._watch("canMoveNext",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMoveNext")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/Personalize":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_183e,_183f,_1840,_1841){return _183e([_1840],{label:_1841.label,iconClass:"epi-iconUsers",category:"menuWithSeparator",_execute:function(){if(!this.model.contentGroup){this.model.personalize();}},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.contentGroup&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/SelectDisplayOption":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/widget/DisplayOptionSelector","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions"],function(_1842,lang,when,_1843,_1844,_1845,_1846,_1847){return _1842([_1844],{label:_1847.label,category:"popup",_labelAutomatic:lang.replace(_1847.label,[_1847.automatic]),constructor:function(){this.popup=new _1846();},postscript:function(){this.inherited(arguments);if(!this.store){var _1848=_1843.resolve("epi.storeregistry");this.store=_1848.get("epi.cms.displayoptions");}when(this.store.get(),lang.hitch(this,function(_1849){this._setCommandAvailable(_1849);this.popup.set("displayOptions",_1849);}));},_onModelChange:function(){this.inherited(arguments);var _184a=this.popup.displayOptions,_184b=this.model.get("displayOption"),_184c=_184a&&_184a.length>0;_184c=_184c&&(this.model instanceof _1845);this._setCommandAvailable(_184a);if(!_184c){this.set("label",this._labelAutomatic);return;}this.popup.set("model",this.model);if(!_184b){this.set("label",this._labelAutomatic);}else{this._setLabel(_184b);}this._watch("displayOption",function(_184d,_184e,_184f){if(!_184f){this.set("label",this._labelAutomatic);}else{this._setLabel(_184f);}},this);},_setCommandAvailable:function(_1850){this.set("isAvailable",_1850&&_1850.length>0&&this.model instanceof _1845);},_setLabel:function(_1851){when(this.store.get(_1851),lang.hitch(this,function(_1852){this.set("label",lang.replace(_1847.label,[_1852.name]));}),lang.hitch(this,function(error){this.set("label",this._labelAutomatic);}));},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.get("readOnly"));}});});},"epi-cms/widget/DisplayOptionSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/MenuSeparator","epi-cms/widget/SelectorMenuBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions","epi/shell/widget/RadioMenuItem"],function(array,_1853,lang,when,_1854,_1855,_1856,_1857){return _1853([_1855],{model:null,headingText:_1856.title,_rdAutomatic:null,_separator:null,postCreate:function(){this.inherited(arguments);this.own(this._rdAutomatic=new _1857({label:_1856.automatic,value:""}));this.addChild(this._rdAutomatic);this._rdAutomatic.on("change",lang.hitch(this,this._restoreDefault));this.own(this._separator=new _1854({baseClass:"epi-menuSeparator"}));this.addChild(this._separator);},_restoreDefault:function(){this.model.modify(function(){this.model.set("displayOption",null);},this);},_setModelAttr:function(model){this._set("model",model);this._setup();},_setDisplayOptionsAttr:function(_1858){this._set("displayOptions",_1858);this._setup();},_setup:function(){if(!this.model||!this.displayOptions){return;}this._removeMenuItems();var _1859=this.model.get("displayOption");array.forEach(this.displayOptions,function(_185a){var item=new _1857({label:_185a.name,iconClass:_185a.iconClass,displayOptionId:_185a.id,checked:_1859===_185a.id,title:_185a.description});this.own(item.watch("checked",lang.hitch(this,function(_185b,_185c,_185d){if(!_185d){return;}this.model.modify(function(){this.model.set("displayOption",_185a.id);},this);})));this.addChild(item);},this);this._rdAutomatic.set("checked",!_1859);},_removeMenuItems:function(){var items=this.getChildren();items.forEach(function(item){if(item===this._rdAutomatic||item===this._separator){return;}this.removeChild(item);item.destroy();},this);}});});},"url:epi-cms/widget/templates/Block.html":"<div class=\"dojoDndItem epi-overlay-block\">\r\n    <div data-dojo-attach-point=\"containerDomNode\"></div>\r\n    <span class=\"epi-personalized\" data-dojo-attach-point=\"iconsContainer\">\r\n        <span class=\"epi-overlayControls epi-mediumButton \">\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconWarning\" data-dojo-attach-point=\"warningIcon\"></span>\r\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconUsers\" data-dojo-attach-point=\"personalizedIcon\"></span>\r\n        </span>\r\n    </span>\r\n    <button class=\"epi-chromelessButton epi-overlayControls epi-settingsButton epi-mediumButton\" data-dojo-attach-point=\"settingsButton\" data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props=\"showLabel:false, title:'${res.settingstooltip}', iconClass:'epi-iconContextMenu'\">\r\n        <div data-dojo-attach-point=\"contextMenu\" data-dojo-type=\"epi/shell/widget/ContextMenu\"></div>\r\n    </button>\r\n</div>","epi-cms/contentediting/command/MoveOutsideGroup":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_185e,_185f,_1860){return _185e([_185f],{label:_1860.moveoutsidegroup,tooltip:_1860.moveoutsidegroup,iconClass:"",category:"menuWithSeparator",_execute:function(){this.model.moveOutsideGroup();},_onModelValueChange:function(){this.set("canExecute",this.model.contentGroup&&!this.model.get("readOnly"));}});});},"url:epi-cms/contentediting/editors/templates/ContentAreaEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\r\n    <div data-dojo-attach-point=\"treeNode\"></div>\r\n    <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/ItemCollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/keys","dojo/mouse","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/dgrid/Formatter","epi/shell/dnd/Target","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/ContextMenu","epi/shell/TypeDescriptorManager","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/extension/events","epi-cms/contentediting/command/NewItem","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/contentediting/command/ItemCollectionCommands","epi-cms/widget/_HasChildDialogMixin","./_TextWithActionLinksMixin","dojo/text!./templates/ItemCollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.itemcollection"],function(array,_1861,lang,event,_1862,_1863,_1864,_1865,_1866,keys,mouse,on,query,topic,when,_1867,_1868,_1869,_186a,_186b,_186c,_186d,_186e,_186f,_1870,_1871,_1872,DnD,_1873,_1874,_1875,_1876,_1877,_1878,_1879,_187a){return _1861([_1869,_1867,_1868,_186c,_1877,_1878],{baseClass:"epi-item-collection-editor",multiple:true,res:_187a,actionsResource:_187a,templateString:_1879,value:null,model:null,contextMenu:null,grid:null,commandProviderClass:_1876,_newItemCommand:null,_gridClass:_1861([_1870,_186a,_1871,DnD,_186f]),_mouseOverClass:"epi-dgrid-mouseover",actionsVisible:true,customTypeIdentifier:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.setupAllowedTypes();},postCreate:function(){this.inherited(arguments);this.set("model",new _1875(this.value,{itemModelType:this.itemModelType,readOnly:this.readOnly}));this.setupCommands();this.setupList();this.setupActionContainer();this.setupEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},setupActionContainer:function(){this.own(this._dndTarget=new _186b(this.actionsContainer,{accept:this.get("allowedDndTypes"),isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.setupActionLinks(this.actionsContainer);this._displayActionsContainer();},setupCommands:function(){this.contextMenu=this.contextMenu||new _186d();this.commandProvider=this.commandProvider||new this.commandProviderClass({model:this.model,commandOptions:this.commandOptions});this.contextMenu.addProvider(this.commandProvider);this.own(this.contextMenu,this.commandProvider,this._newItemCommand=new _1874({model:this.model,dialogContentParams:this.commandOptions?this.commandOptions.dialogContentParams:{}}));},setupList:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:this.res?this.res.menutooltip:""}},_187b=function(data,_187c,row){return "<div class='epi-rowIcon'><span class='dijitInline dijitIcon epi-iconLink epi-objectIcon'></span></div>"+data;},_187d={selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",formatters:[_1872.contentItemFactory("text","title","typeIdentifier",menu),_187b],dndParams:{copyOnly:true,accept:this.get("allowedDndTypes"),creator:lang.hitch(this,this._dndNodeCreator),isSource:!this.readOnly},dndSourceTypes:this.customTypeIdentifier?[this.customTypeIdentifier]:[],consumer:this},_187e=function(_187f){var types=_186e.getAndConcatenateValues(this.dndSourceTypes,"dndTypes");if(types.length===0){types=this.dndSourceTypes;}return types;};if(this.customTypeIdentifier){_187d._getDndType=_187e;}this.own(this.grid=new this._gridClass(_187d,this.itemsContainer));this.grid.set("showHeader",false);this.grid.renderArray(this.model.get("data"));this.grid.startup();},setupEvents:function(){var self=this,_1880=on.selector;this.own(self.model.on("selectedItem",lang.hitch(this,this.focus)),self.model.on("initCompleted",lang.hitch(this,this._renderUI)),self.grid.on(_1880(".dgrid-row",mouse.enter),function(e){_1863.add(self,self._mouseOverClass);}),self.grid.on(_1880(".dgrid-row",mouse.leave),function(e){_1863.remove(self,self._mouseOverClass);}),self.grid.on("dgrid-select",function(e){self.model.set("selectedItem",e.rows[0].data);self.commandProvider.set("model",self.model);}),self.grid.on(_1880(".dgrid-row",_1873.keys.del),function(e){self.model.remove();}),self.grid.on(_1880(".dgrid-row",_1873.keys.shiftf10),function(e){self._showContextMenu(e);}),self.grid.on(_1880(".dgrid-row",_1873.contextmenu),function(e){var item=self.grid.row(e).data;self.model.set("selectedItem",item);self.select(item);self._showContextMenu(e);}),self.grid.on(".epi-iconContextMenu:click",function(e){self.contextMenu.scheduleOpen(self,null,{x:e.pageX,y:e.pageY});}),_1862.around(self.grid.dndSource,"checkAcceptance",function(_1881){return function(_1882,nodes){return !self.readOnly&&_1881.apply(self.grid.dndSource,arguments);};}),_1862.after(self.grid.dndSource,"onDropData",function(_1883,_1884,nodes,copy){var i;if(self.grid.dndSource===_1884){for(i=0;i<nodes.length;i++){self.model.moveTo(self.grid.dndSource.getItem(nodes[i].id).data,self.grid.dndSource.current!=null?self.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);}}else{var item;for(i=0;i<_1883.length;i++){when(_1883[i].data,lang.hitch(this,function(_1885){self.model.addTo(_1885,self.grid.dndSource.current!=null?this.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);if(_1884&&_1884.grid&&_1884.grid.consumer&&_1884.grid.consumer!==self){_1884.grid.consumer.model.set("selectedItem",_1885);_1884.grid.consumer.model.remove();}}));}}},true),_1862.around(self.grid,"insertRow",lang.hitch(self,self._aroundInsertRow)),this.model.on("changed",lang.hitch(this,function(){this.onChange(this.value=this.model.get("value")||[]);this._renderUI();this.focus();})),_1862.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_1886,nodes,copy){var _1887=this.grid.dndSource,_1888=_1887.accept&&_1887.checkAcceptance(_1886,nodes);_1863[_1888?"remove":"add"](this.container,"dojoDndTargetDisabled");}),true),_1862.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1889,_188a,nodes,copy){var item;for(var i=0;i<_1889.length;i++){when(_1889[i].data,lang.hitch(this,function(_188b){this.model.addTo(_188b,null,false);if(_188a&&_188a.grid&&_188a.grid.consumer&&_188a.grid.consumer!==this){_188a.grid.consumer.model.set("selectedItem",_188b);_188a.grid.consumer.model.remove();}}));}this.focus();}),true));var _188c=this.commandProvider.commands.concat(this._newItemCommand);_188c.forEach(function(_188d){this.own(_1862.after(_188d,"onDialogOpen",function(){self.set("isShowingChildDialog",true);self.validate();}),_1862.after(_188d,"onDialogHideComplete",function(){self.set("isShowingChildDialog",false);self.focus();}));},this);},executeAction:function(_188e){if(_188e==="createnewitem"){if(this._newItemCommand){this._newItemCommand.execute();}}},setupAllowedTypes:function(){var _188f=this.itemConverterKey;this.allowedDndTypes=this.allowedDndTypes||[];if(_188f){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_188f;});}if(this.customTypeIdentifier){this.allowedDndTypes.unshift(this.customTypeIdentifier);}},focus:function(){if(this.grid&&this.value&&this.value.length>0){this.grid.focus();if(this.model){var _1890=this.model.get("selectedItem"),_1891=this.model.getItemIndex(_1890);if(_1890){this.grid.focus(this.grid.row(_1891).element);}}}else{this.textWithLinks.focus();}},select:function(item){this.grid.clearSelection();if(item){this.grid.select(this.model.getItemIndex(item));}},isValid:function(){return (!this.required||(this.model&&this.model.get("value").length>0));},_onBlur:function(){if(this.contextMenu&&this.contextMenu.isShowingNow){return;}this.inherited(arguments);},_getValueAttr:function(){return this.model.get("value");},_setValueAttr:function(val){this._set("value",val);if(!val||!(val instanceof Array)){this._set("value",[]);}if(this._started){this.model?this.model.set("data",this.value):(this.model=new _1875(this.value,{readOnly:this.readOnly}));this._renderUI();}},_setReadOnlyAttr:function(_1892){this._set("readOnly",_1892);this._displayActionsContainer();if(this.model){this.model.set("readOnly",_1892);}},_dndNodeCreator:function(item,hint){var _1893=this.allowedDndTypes,node=_1864.create("div").appendChild(document.createTextNode(item.text));if(item.typeIdentifier){_1893=_186e.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}return {node:node,type:_1893,data:item};},_aroundInsertRow:function(_1894){return lang.hitch(this,function(_1895,_1896,_1897,i,_1898){var row=_1894.apply(this.grid,arguments);var _1899=this.model.get("selectedItem");if(_1899&&_1899.id===_1895.id){this.select(_1899);}return row;});},_renderUI:function(){this.grid.refresh();this.grid.renderArray(this.model.get("data"));},_showContextMenu:function(e){if(this.readOnly){return;}var _189a=this.model.get("selectedItem"),_189b=this.model.getItemIndex(_189a);if(_189a){event.stop(e);this.contextMenu.scheduleOpen(this,null,_1866.position(query(".epi-iconContextMenu",this.grid.row(_189b).element)[0],true));}},_displayActionsContainer:function(){_1865.set(this.actionsContainer,"display",this.readOnly||!this.actionsVisible?"none":"");}});});},"epi-cms/contentediting/command/NewItem":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_189c,_189d,_189e,_189f){return _189c([_189d,_189e],{dialogContentClass:_189f,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.set("value",null);this.showDialog();},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("canExecute",true);},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){this.model.addTo(this.value,null,null);}}});});},"epi-cms/contentediting/command/_CommandWithDialogMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","dijit/Destroyable","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","epi/i18n!epi/nls/episerver.shared"],function(array,_18a0,lang,_18a1,when,_18a2,_18a3,_18a4,_18a5){return _18a0([_18a2],{res:_18a4,title:null,dialogClass:"epi-dialog-portrait",dialogContentClass:null,dialogParams:null,dialogContentParams:null,dialogContent:null,defaultActionsVisible:true,confirmActionText:_18a5.action.ok,cancelActionText:_18a5.action.cancel,value:null,_dialog:null,_getTitle:function(){return this.title||lang.replace(this.value?this.res.title.template.edit:this.res.title.template.create,this.res.title.action);},onDialogOpen:function(){},onDialogExecute:function(){},onDialogCancel:function(){},onDialogHideComplete:function(){},showDialog:function(){if(this.dialogContent){this.dialogContent.destroy();this.dialogContent=null;}this.dialogContent=new this.dialogContentClass(this.dialogContentParams);this._dialog=new _18a3(lang.mixin({title:this._getTitle(),dialogClass:this.dialogClass,content:this.dialogContent,defaultActionsVisible:this.defaultActionsVisible,confirmActionText:this.confirmActionText,cancelActionText:this.cancelActionText},this.dialogParams));this._dialog.startup();this.dialogContent.set("value",this.value);this.own(this.dialogContent,_18a1.after(this._dialog,"onExecute",lang.hitch(this,this.onDialogExecute),true),_18a1.after(this._dialog,"onCancel",lang.hitch(this,this.onDialogCancel),true),_18a1.after(this._dialog,"onHide",lang.hitch(this,this.onDialogHideComplete),true),this._dialog.watch("open",lang.hitch(this,function(name,_18a6,_18a7){if(!_18a7){return;}this.onDialogOpen();})));this._dialog.show();}});});},"epi-cms/widget/LinkEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dijit/_CssStateMixin","epi","epi/dependency","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/viewmodel/LinkEditorViewModel","epi-cms/widget/HyperLinkSelector"],function(array,_18a8,lang,_18a9,_18aa,_18ab,epi,_18ac,_18ad,_18ae,_18af,_18b0,_18b1,_18b2){return _18a8([_18ae,_18af,_18ad,_18ab,_18b0],{_metadataManager:null,modelClassName:_18b1,hiddenFields:[],postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this._metadataManager=this._metadataManager||_18ac.resolve("epi.shell.MetadataManager");if(!this.model&&this.modelClassName){var _18b3=_18a8(this.modelClassName);this.model=new _18b3();}this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog({action:"ok"});}})},{name:"delete",label:epi.resources.action.deletelabel,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){array.forEach(this.form._getDescendantFormWidgets(),function(_18b4){_18b4.set("value","");},this);this.executeDialog({action:"delete"});})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];},postCreate:function(){if(this.modelType){this.metadata=this._metadataManager.getMetadataForType(this.modelType);}this.inherited(arguments);},_setValueAttr:function(value){this.inherited(arguments);this._handleActions(value);},onFormCreated:function(_18b5){array.forEach(this.form._getDescendantFormWidgets(),function(_18b6){if(this.hiddenFields&&this.hiddenFields.indexOf(_18b6.name)>-1){var _18b7=this._getAncestorNode(_18b6.domNode,"epi-form-container__section__row");_18a9.set(_18b7,{display:"none"});_18b6.set("required",false);}},this);this._handleActions(this.value);},_handleActions:function(value){if(this.hasAction("delete")){this.setActionProperty("delete","disabled",this.model._isEmptyObject(value));}},getFormWidget:function(_18b8){var _18b9=array.filter(this.form._getDescendantFormWidgets(),function(_18ba){return _18ba&&_18ba.name===_18b8;},this);return _18b9?_18b9[0]:null;},_getAncestorNode:function(node,_18bb){var _18bc=node?node.parentNode:null;if(!_18bc){return null;}if(!_18aa.contains(_18bc,_18bb)){return this._getAncestorNode(_18bc,_18bb);}return _18bc;},getActions:function(){return this._actions;},isValidValue:function(){return array.every(this.form._getDescendantFormWidgets(),function(_18bd){return _18bd.get("required")?!!_18bd.get("value"):true;});}});});},"epi-cms/widget/viewmodel/LinkEditorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/shell/_StatefulGetterSetterMixin","epi/dependency"],function(array,_18be,_18bf,lang,_18c0,topic,_18c1,when,_18c2,_18c3){return _18be([_18c1,_18c2],{_isEmptyObject:function(obj){for(var i in obj){if(obj[i]&&obj[i]!==""){return false;}}return true;}});});},"epi-cms/widget/HyperLinkSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/when","dojo/promise/all","dojo/string","dijit/_Widget","dijit/_Container","epi/dependency","epi/Url","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/contentediting/editors/SelectionEditor","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel","epi-cms/form/EmailValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","dojo/text!./templates/_HyperLinkLanguageField.html"],function(array,_18c4,lang,_18c5,_18c6,_18c7,_18c8,when,all,_18c9,_18ca,_18cb,_18cc,Url,_18cd,_18ce,_18cf,_18d0,_18d1,_18d2,_18d3){return _18c4([_18ca,_18cb,_18cd],{value:null,showLanguageSelector:true,_hasBeenBlurred:false,modelClassName:_18d0,modelBindingMap:{wrapperSettings:["wrapperSettings"],selectedWrapper:["selectedWrapper"]},_languageSelector:null,_languageSelectorWrapperNode:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _18d4=_18c4(this.modelClassName);this.model=new _18d4({providers:this.providers});}this._languageStore=this._languageStore||_18cc.resolve("epi.storeregistry").get("epi.cms.language");},buildRendering:function(){this.inherited(arguments);this._createLanguageSelector();},startup:function(){this.inherited(arguments);this._languageSelector.startup();var self=this,_18d5=this._languageSelector;when(this._languageStore.get(),function(_18d6){if(self.get("showLanguageSelector")){if(_18d6.length<=1){self._toggleLanguageSelector(false);}else{self._toggleLanguageSelector(true);}}var _18d7=_18d6.map(function(_18d8){return {text:_18d8.name,value:_18d8.languageId};});_18d7.splice(0,0,{text:_18d2.automaticlanguage,value:""});_18d5.set("selections",_18d7);_18d5.set("value","");self._createInputWrappers();});},onSelectorsCreated:function(_18d9){},_setShowLanguageSelectorAttr:function(value){this._set("showLanguageSelector",value);this._toggleLanguageSelector(value);},_setSelectedWrapperAttr:function(_18da){if(!_18da){return;}array.forEach(this.wrappers,function(_18db){_18db.set("selected",false);});_18da.set("selected",true);var _18dc=true;if(_18da.settings.isContentLink){_18dc=false;}this._languageSelector.set("disabled",_18dc);},_createLanguageSelector:function(){this.own(this._languageSelector=new _18cf());this._languageSelectorWrapperNode=_18c8.toDom(_18c9.substitute(_18d3,{id:this._languageSelector.id,language:_18d2.language}));_18c8.place(this._languageSelectorWrapperNode,this.domNode,"first");this._languageSelector.placeAt(this._languageSelectorWrapperNode,"last");},_toggleLanguageSelector:function(_18dd){_18c7.toggle(this._languageSelectorWrapperNode,"dijitHidden",!_18dd);},_createInputWrappers:function(){var _18de=this.model.wrapperSettings,_18df=[],self=this;_18de.forEach(function(_18e0){var def=new _18c5();_18df.push(def.promise);require([_18e0.widgetType],function(ctor){var _18e1=new _18ce(lang.mixin(_18e0,{groupName:_18e0.groupName+this.id,inputWidgetCtor:ctor,required:self.required}));self.own(_18e1.on("radioButtonChange",lang.hitch(this,function(){self.set("selectedWrapper",_18e1);_18e1.focus();})));if(_18e0.invisible){_18c6.set(_18e1.domNode,{display:"none"});}def.resolve(_18e1);});},this);when(all(_18df),function(_18e2){if(_18e2.length===0){return;}_18e2.forEach(function(_18e3){self.addChild(_18e3);});self.set("wrappers",_18e2);var value=self.get("value");if(value){self._setValueForWidgets(value);}else{self.set("selectedWrapper",_18e2[0]);}self.onSelectorsCreated(self);});},_getSelectedWrapper:function(){return array.filter(this.wrappers,function(_18e4){return _18e4.get("selected");})[0];},_getValueAttr:function(){var _18e5=this._getSelectedWrapper();if(_18e5){if(_18e5.inputWidget&&_18e5.settings.isContentLink){return this.model.getUrlValue(_18e5.inputWidget.get("permanentLink"),this._languageSelector.get("value"),this.value);}else{return _18e5.get("value");}}return this.value;},_setValueAttr:function(value){this._set("value",value);this._setValueForWidgets(value);},_setValueForWidgets:function(value){var _18e6=this.get("wrappers");if(!_18e6){return;}array.forEach(_18e6,function(_18e7){_18e7.set("value",null);});if(!value){return;}var url=new Url(this.value);this._languageSelector.set("value",url.getQueryParameterValue("epslanguage"));when(this.model.getContentData(value),lang.hitch(this,function(_18e8){if(_18e8){array.every(_18e6,function(_18e9){if(_18e9&&_18e9.settings.isContentLink){if(array.some(_18e9.settings.allowedTypes,lang.hitch(this,function(_18ea){return this.model.isBaseTypeIdentifier(_18e8.typeIdentifier,_18ea);}))){_18e9.set("value",_18e8.contentLink);this.set("selectedWrapper",_18e9);return false;}}return true;},this);}else{array.every(_18e6,function(_18eb){if(_18eb&&!_18eb.settings.isContentLink){var _18ec=_18eb.inputWidget;if(_18ec&&this._isValidEditorWidget(value,_18ec)&&_18ec.validator(value,_18ec.constraints)){_18eb.set("value",value);this.set("selectedWrapper",_18eb);return false;}}return true;},this);}}));},_isValidEditorWidget:function(value,_18ed){if(_18ed instanceof _18d1){return Url(value).scheme==="mailto";}return true;},validate:function(){var _18ee=this._getSelectedWrapper();if(_18ee){_18ee._hasBeenBlurred=this._hasBeenBlurred;return _18ee.validate();}return false;},focus:function(){var _18ef=this._getSelectedWrapper();if(_18ef){_18ef.focus();}},reset:function(){this._hasBeenBlurred=false;this.set("value",null);}});});},"epi-cms/widget/_HyperLinkFieldItem":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Contained","epi/string","dojo/text!./templates/_HyperLinkFieldItem.html"],function(_18f0,lang,_18f1,_18f2,_18f3,_18f4,_18f5){return _18f0([_18f1,_18f3,_18f2],{templateString:_18f5,inputWidget:null,inputWidgetCtor:null,settings:null,_hasBeenBlurred:false,buildRendering:function(){this.inherited(arguments);var _18f6=lang.mixin({value:this.get("value")||null},this.settings);this.own(this.inputWidget=new this.inputWidgetCtor(_18f6).placeAt(this.domNode));},_onRadioButtonChange:function(evt){this.onRadioButtonChange(this,evt);},onRadioButtonChange:function(_18f7,evt){},validate:function(){if(this.inputWidget){this.inputWidget._hasBeenBlurred=this._hasBeenBlurred;return this.inputWidget.validate();}return true;},_setValueAttr:function(value){this._set("value",value);if(this.inputWidget){this.inputWidget.set("value",value);}},_getValueAttr:function(){if(this._started&&this.inputWidget){return this.inputWidget.get("value");}return this.value;},_setRequiredAttr:function(val){this._set("required",val);if(this.inputWidget){this.inputWidget.set("required",val);}},_setSelectedAttr:function(value){this._set("selected",value);if(this.inputWidget){this.inputWidget.set("disabled",!value);if(!value){this.inputWidget.set("state","");}}this.radioNode.checked=value;},_getSelectedAttr:function(){return this.radioNode.checked;},_setShowAllLanguagesAttr:function(val){this._set("showAllLanguages",val);if(this.inputWidget){this.inputWidget.set("showAllLanguages",val);}},focus:function(){if(this.inputWidget){this.inputWidget.focus();}}});});},"url:epi-cms/widget/templates/_HyperLinkFieldItem.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\r\n    <label for=\"${id}_${name}\">\r\n        <input type=\"radio\" name=\"${groupname}\" id=\"${id}_${name}\" value=\"${name}\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-attach-event=\"onchange:_onRadioButtonChange\" data-dojo-attach-point=\"radioNode\" />\r\n        ${displayName}\r\n    </label>\r\n</div>","epi-cms/contentediting/editors/SelectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/on","dojox/html/entities","dijit/form/Select","dijit/MenuItem","dijit/MenuSeparator","epi/shell/layout/_LayoutWidget","epi/shell/widget/_ValueRequiredMixin"],function(array,_18f8,lang,_18f9,on,_18fa,_18fb,_18fc,_18fd,_18fe,_18ff){return _18f8([_18fe,_18fb,_18ff],{actualValue:null,value:null,maxHeight:-1,postMixInProperties:function(){this.inherited(arguments);this.set("selections",this.selections);this.actualValue=this.value;},_setSelectionsAttr:function(_1900){this.set("options",array.map(_1900,function(item){return {label:_18fa.encode(item.text),value:item.value,selected:(item.value===this.value)||(!item.value&&!this.value)};},this));},postCreate:function(){this.inherited(arguments);on(this,"change",lang.hitch(this,function(){if(!this.disabled){this.validate();}this.onLayoutChanged();}));},_getMenuItemForOption:function(_1901){if(_1901.type==="separator"){return new _18fd();}else{var click=lang.hitch(this,"_setValueAttr",_1901);var item=new _18fc({option:_1901,label:_1901.label||this.emptyLabel,onClick:click,disabled:_1901.disabled||false});item.focusNode.setAttribute("role","listitem");return item;}},_getValueFromOpts:function(){var _1902=this.getOptions()||[];if(!this.multiple&&_1902.length){var _1903=array.filter(_1902,function(i){return i.selected;})[0];if(_1903&&_1903.value!==undefined){return _1903.value;}else{return null;}}else{if(this.multiple){return array.map(array.filter(_1902,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_setValueAttr:function(value,_1904){var _1905=this.getOptions()||[];if(value===null||typeof value!="object"){value=array.filter(_1905,function(i){return (i.value===value)||(!i.value&&!value);});}if(!lang.isArray(value)){value=[value];}if(this._onChangeActive){var _1906=value[0]?value[0].value:null;this._pendingOnChange=this.actualValue!==_1906;this.actualValue=_1906;}array.forEach(_1905,function(i){i.selected=array.some(value,function(v){return v.value===i.value;});});var val=array.map(value,function(i){return i.value;}),disp=array.map(value,function(i){return i.label;});this._set("value",this.multiple?val:val[0]);this._setDisplay(this.multiple?disp:disp[0]);this._updateSelection();this._handleOnChange(this.value,_1904);},_updateSelection:function(){this._set("value",this._getValueFromOpts());var value=this.value;if(value!==undefined){if(!lang.isArray(value)){value=[value];}array.forEach(this._getChildren(),function(child){var _1907=array.some(value,function(v){return child.option&&(v===child.option.value);});child.domNode.setAttribute("aria-selected",_1907);},this);}},validator:function(value,flags){}});});},"epi-cms/widget/viewmodel/HyperLinkSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/io-query","dojo/dom-style","dojo/dom-construct","dojo/when","epi/string","epi/Url","epi/shell/TypeDescriptorManager","epi/shell/_StatefulGetterSetterMixin","epi-cms/core/PermanentLinkHelper"],function(array,_1908,lang,_1909,_190a,_190b,_190c,when,_190d,Url,_190e,_190f,_1910){return _1908([_1909,_190f],{_setProvidersAttr:function(_1911){var _1912=[];array.forEach(_1911,lang.hitch(this,function(_1913){_1912.push({name:_1913.name,displayName:_1913.displayName?_1913.displayName:_1913.name,title:_1913.title?_1913.title:"",groupname:"hyperLink_",widgetType:_1913.widgetType,invisible:_1913.invisible,settings:lang.mixin({roots:_1913.roots,allowedTypes:_1913.linkableTypes,isContentLink:(_1913.linkableTypes&&_1913.linkableTypes.length>0),allowedDndTypes:[],disabled:true,value:null,searchArea:_1913.searchArea},_1913.widgetSettings)});}));this.set("wrapperSettings",_1912);},getContentData:function(value){if(value){return _1910.getContent(value,{allLanguages:true});}return null;},isBaseTypeIdentifier:function(type,base){return _190e.isBaseTypeIdentifier(type,base);},getUrlValue:function(_1914,_1915,_1916){if(!_1914){return "";}var url=new Url(_1914);if(_1916){var _1917=new Url(_1916);if(this._areEqual(_1917,url)){url.query=lang.mixin(_1917.query,url.query);}}if(_1915===""){delete url.query.epslanguage;}else{url.query.epslanguage=_1915;}return url.toString();},_areEqual:function(url1,url2){return url1.scheme===url2.scheme&&url1.authority===url2.authority&&url1.path===url2.path&&url1.fragment===url2.fragment;}});});},"epi-cms/core/PermanentLinkHelper":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/when","epi/dependency"],function(_1918,_1919,lang,when,_191a){return {getContent:function(link,_191b){if(!link){return null;}var _191c=_191a.resolve("epi.storeregistry"),store=_191c.get("epi.cms.content.light"),query=lang.mixin({query:"getcontentbypermanentlink",permanentLink:link},_191b||{});return when(store.query(query)).then(lang.hitch(this,function(_191d){return _191d&&_191d instanceof Array?_191d[0]:_191d;}));}};});},"epi-cms/form/EmailValidationTextBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/ValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.form.emailvalidation"],function(_191e,lang,_191f,res){var _1920=_191e([_191f],{invalidMessage:res.invalidmessage,addMailTo:false,validator:function(value,_1921){value=value||"";if(!this.required&&this._isEmpty(value)){return true;}value=value.replace(/\\.{1}/g,"replaced").replace(/".*?"/g,"replaced");return _1920.validationRegex.test(value);},_getValueAttr:function(){var value=this.inherited(arguments);if(this.addMailTo){value=value?lang.trim(value):"";if(value&&value.indexOf("mailto:")!==0){value="mailto:"+value;}}return value;},_setValueAttr:function(value){value=value?value.replace("mailto:",""):"";this.inherited(arguments,[value]);}});_1920.validationRegex=/.+@.+\..+/i;return _1920;});},"url:epi-cms/widget/templates/_HyperLinkLanguageField.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\n    <label for=\"${id}\">${language}</label>\n</div>","epi-cms/contentediting/viewmodel/ItemCollectionViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin","epi-cms/contentediting/viewmodel/LinkItemModel"],function(_1922,lang,_1923,all,when,_1924,_1925){return _1922([_1924],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(data,_1926){_1922.safeMixin(this,_1926);},postscript:function(data){require([this.itemModelType],lang.hitch(this,function(_1927){this.itemModelClass=_1927;this._instanceId=new Date().getTime();this._init(data);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var index=this.getItemIndex(this._selectedItem);this._data.splice(index,1);var len=this._data.length;this.set("selectedItem",this._data[index>=len?len-1:index]||null);this.emit("changed");},addTo:function(_1928,item,_1929){if(!_1928){return false;}if(this.getItemIndex(_1928)>=0){this.moveTo(_1928,null,false);this.emit("changed");}else{var self=this;when(self._createItemModel(_1928),function(model){if(!item){self._data.push(model);}else{var _192a=self.getItemIndex(item)+(_1929?0:1);self._data.splice(_192a,0,model);}self.emit("changed",{uiChanged:false});});}},moveTo:function(_192b,item,_192c){if(!_192b&&!this._selectedItem){return false;}this.set("selectedItem",_192b||this._selectedItem);var _192d=this.getItemIndex(this._selectedItem);this._data.splice(_192d,1);var _192e=(item?this.getItemIndex(item):(this._data.length-1))+(_192c?0:1);this._data.splice(_192e,0,this._selectedItem);this.emit("changed");},updateItemData:function(item){var index=this.getItemIndex(this._selectedItem);if(index<0){return;}var self=this;when(self._createItemModel(item),function(model){self._selectedItem=self._data[index]=model;self.emit("changed");});},swap:function(_192f,_1930){if(!this._data[_192f]||!this._data[_1930]){return false;}var temp=this._data[_192f];this._data[_192f]=this._data[_1930];this._data[_1930]=temp;return true;},getItemIndex:function(item){var index=-1;if(!item||!(item instanceof this.itemModelClass)){return index;}this._data.some(function(i,o){if(i.id===item.id){index=o;return true;}return false;},this);return index;},_init:function(data){var self=this,_1931;this.set("selectedItem",null);if(!(data instanceof Array)){this._data=[];}else{_1931=data.map(function(item){return this._createItemModel(item);},this);all(_1931).then(function(_1932){self._data=_1932;self.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(item){var _1933=this.itemModelClass,id={id:this._generateItemId()},model,dfd=new _1923();if(this.getItemIndex(item)>=0){return item;}if(item instanceof _1933){model=lang.mixin(lang.clone(item),id);}else{model=new _1933(lang.mixin(lang.clone(item),id));}when(model.parse(true),function(){dfd.resolve(model);});return dfd;},_move:function(_1934){var index=this.getItemIndex(this._selectedItem);if(index<0){return false;}return this.swap(index,index+_1934);},_canMoveNextGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>=0&&index<(this._data.length-1));},_canMovePreviousGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>0&&index<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(item){return item.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(data){this._init(data);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(value){this._selectedItem=value;}});});},"epi-cms/contentediting/viewmodel/LinkItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi/Url","epi-cms/contentediting/viewmodel/CollectionItemModel","epi-cms/core/PermanentLinkHelper"],function(_1935,lang,_1936,when,Url,_1937,_1938){return _1935([_1937],{titleKey:"publicUrl",publicUrl:null,permanentUrl:null,_defaultDataStoreName:"epi.cms.content.light",serialize:function(){return {text:this.text,href:this.href||this.url,target:this.target||null,title:this.title||"",publicUrl:this.publicUrl,typeIdentifier:this.typeIdentifier||""};},_buildPublicUrl:function(url){var _1939=new Url(url);if(!_1939.scheme){_1939=new Url("",{scheme:window.location.protocol,authority:window.location.hostname,path:url});}return _1939.toString();},_publicUrlGetter:function(){return this._buildPublicUrl(this.publicUrl||this.url||this.href);},_permanentUrlSetter:function(value){this.href=this.permanentUrl=value;},_onTryUpdateItemModel:function(){if(!this.typeIdentifier){return when(_1938.getContent(this.href),lang.hitch(this,function(_193a){if(_193a){this._parseFromContent(_193a);}}));}},_parseFromContent:function(_193b){if(_193b){this.typeIdentifier=_193b.typeIdentifier;this.publicUrl=this._buildPublicUrl(_193b.publicUrl);}}});});},"epi-cms/contentediting/viewmodel/CollectionItemModel":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_193c,_193d){return _193c([_193d],{id:null,textKey:"text",titleKey:null,iconTypeKey:"typeIdentifier",typeIdentifier:null,serialize:function(){},parse:function(_193e){if(_193e){return this._onTryUpdateItemModel();}return null;},_onTryUpdateItemModel:function(){},_getPropertyValue:function(_193f,_1940){if(_193f===_1940){return this[_193f];}return this.get(_193f);},_nameGetter:function(){return this._getPropertyValue(this.textKey,"name");},_textGetter:function(){return this._getPropertyValue(this.textKey,"text");},_titleGetter:function(){return this._getPropertyValue(this.titleKey,"title")||this._getPropertyValue(this.textKey,"title");},_iconTypeIdentifierGetter:function(){return this._getPropertyValue(this.iconTypeKey,"iconTypeIdentifier");}});});},"epi-cms/contentediting/command/ItemCollectionCommands":function(){define(["dojo/_base/declare","./BlockRemove","./ItemEdit","./MoveToPrevious","./MoveToNext","./ContentAreaCommands"],function(_1941,_1942,Edit,_1943,_1944,_1945){return _1941([_1945],{constructor:function(_1946){var _1947=_1946?_1946.commandOptions:{};this.commands=[new Edit(_1947),new _1943(_1947),new _1944(_1947),new _1942(_1947)];}});});},"epi-cms/contentediting/command/ItemEdit":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1948,_1949,_194a,_194b){return _1948([_1949,_194a],{dialogContentClass:_194b,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.showDialog();},_onModelValueChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("value",this.model.get("selectedItem"));this.set("canExecute",this.model.get("canEdit"));},onDialogExecute:function(_194c){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){if(_194c&&_194c.action==="delete"){this.model.remove();}else{this.model.updateItemData(this.value);}}}});});},"url:epi-cms/contentediting/editors/templates/ItemCollectionEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\r\n    <!-- To reuse styling of content area we wrap into a div that include content area class -->\r\n    <div class=\"epi-content-area-editor\" data-dojo-attach-point=\"container\">\r\n        <div data-dojo-attach-point=\"itemsContainer\"></div>\r\n        <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableDateTimeEditor":function(){define(["dojo/_base/declare","epi/datetime","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/contentediting/editors/_PreviewableEditor"],function(_194d,_194e,_194f,_1950){return _194d([_1950],{required:false,controlParams:["required"],buildRendering:function(){this.control=new _194f({datePackage:null});this.inherited(arguments);},_setLabelValueAttr:function(value){this.inherited(arguments,[_194e.toUserFriendlyHtml(value)]);}});});},"epi-cms/contentediting/editors/_PreviewableEditor":function(){define(["dojo/_base/array","dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi","dojo/text!./templates/_PreviewableEditor.html","dojox/html/entities"],function(array,event,_1951,lang,_1952,_1953,dijit,_1954,_1955,_1956,_1957,_1958,epi,_1959,_195a){return _1951([_1955,_1954,_1956,_1957],{value:null,changeLabel:epi.resources.action.change,templateString:_1959,control:null,controlParams:[],state:"",_setLabelValueAttr:function(value){this._set("labelValue",value);this.labelNode.innerHTML=value;},_setIsEmptyAttr:function(_195b){this._set("isEmpty",_195b);if(_195b){_1952.add(this.domNode,"epi-state-empty");}else{_1952.remove(this.domNode,"epi-state-empty");}},_setValueAttr:function(value){this._set("value",value);this.control.set("value",value);this.set("labelValue",typeof (value)=="string"?_195a.encode(value):value);this.set("isEmpty",!value);},onChange:function(val){},buildRendering:function(){this.inherited(arguments);if(!this.control){this.control=new _1958();this.own(this.control);}this.control.placeAt(this.domNode,"first");},postCreate:function(){this.inherited(arguments);this._setDisplay(false);this.connect(this.labelNode,"onclick",this._onChangeNodeClick);this.connect(this.changeNode,"onclick",this._onChangeNodeClick);this.connect(this.control,"onChange",this._onControlChange);this.connect(this.control,"onBlur",this._onControlBlur);this.own(this.control.watch("state",lang.hitch(this,function(name,old,value){this.set("state",value);})));this.control.validate();this.set("state",this.control.state);array.forEach(this.controlParams,function(_195c){this.control.set(_195c,this.get(_195c));},this);},onBlur:function(){this._setDisplay(false);},_setDisplay:function(_195d){if(!_195d&&!this.validate()){return;}this.showControl=_195d;_1953.set(this.labelNode,"display",_195d?"none":"");_1953.set(this.control.domNode,"display",_195d?"":"none");if(!this.readOnly){_1953.set(this.changeNode,"display",_195d?"none":"");}},focus:function(){if(this.showControl){this.control.focus();}else{this.changeNode.focus();}},_onControlChange:function(value){this._set("value",value);this.set("labelValue",typeof (value)=="string"?_195a.encode(value):value);this.set("isEmpty",!value);this.onChange(value);},_onControlBlur:function(){this._setDisplay(false);},_onChangeNodeClick:function(e){event.stop(e);this._setDisplay(true&&!this.readOnly);dijit.selectInputText(this.control.focusNode);},_setReadOnlyAttr:function(_195e){this._set("readOnly",_195e);_1953.set(this.changeNode,"display",this.readOnly?"none":"");this.readOnly&&this._setDisplay(false);},validate:function(){return this.control.validate();},isValid:function(){return this.control.isValid();},getErrorMessage:function(){return this.control.getErrorMessage();}});});},"url:epi-cms/contentediting/editors/templates/_PreviewableEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\r\n    <span data-dojo-attach-point=\"labelNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\r\n    <a href=\"#\" data-dojo-attach-point=\"changeNode, focusNode\" class=\"epi-previewableTextBox-link epi-functionLink\">${changeLabel}</a>\r\n</div>\r\n","epi-cms/contentediting/editors/PreviewableTextEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/form/ValidationTextBox","epi-cms/contentediting/editors/_PreviewableEditor"],function(array,_195f,_1960,_1961,_1962){return _195f([_1962],{required:false,intermediateChanges:false,controlParams:["intermediateChanges","regExp","required","invalidMessage"],_getRegExpAttr:function(){return this.regExp||"";}});});},"epi-cms/contentediting/editors/ShortcutEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/ShortcutDialog","../viewmodel/ShortcutDialogViewModel","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_1963,lang,_1964,_1965,_1966,_1967,_1968,_1969,epi,_196a,_196b,_196c,_196d,_196e,_196f){return _1963([_1966,_1967,_1968,_196d],{templateString:"<div class=\"dijitInline\">                            <span data-dojo-attach-point=\"shortcutTypeNameNode\" class=\"dijitInline\"></span> <div class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink\" data-dojo-attach-point=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_showDialog\" >${resources.action.manage}</div>                          </div>",resources:epi.resources,value:null,contentLink:null,metadata:null,watchHandlers:null,destroy:function(){if(this.button){this.button.destroyRecursive();}this.inherited(arguments);},onChange:function(value){},_showDialog:function(){var _1970=new _196b({metadata:this.metadata,contentLink:this.contentLink,value:this.value,model:new _196c({contentLink:this.contentLink,contentName:this.contentName,value:this.value})});var _1971=new _196a({defaultActionsVisible:false,confirmActionText:_196f.action.save,content:_1970,title:_196e.dialogtitle});_1971.connect(_1971,"onExecute",lang.hitch(this,function(value){this.set("value",_1970.get("value"));this.onChange(_1970.get("value"));}));_1971.connect(_1971,"onHide",lang.hitch(this,function(){this.isShowingChildDialog=false;}));this.isShowingChildDialog=true;_1971.show();},_setShortcutTypeNameAttr:{node:"shortcutTypeNameNode",type:"innerHTML"},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1965.set(this.button.domNode,"display",value?"none":"");},_setValueAttr:function(value){this._set("value",value);this.set("ShortcutTypeName",value&&value.pageShortcutTypeName?value.pageShortcutTypeName:"");}});});},"epi-cms/contentediting/ShortcutDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/html","dijit/_CssStateMixin","dojox/validate/regexp","epi-cms/widget/Breadcrumb","epi-cms/contentediting/PageShortcutTypeSupport","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ShortcutDialog.html","epi/i18n!epi/nls/episerver.shared"],function(_1972,lang,_1973,_1974,html,_1975,_1976,_1977,_1978,_1979,_197a,_197b,_197c,_197d,_197e){return _1972([_197a,_197c,_1979,_1975,_197b],{templateString:_197d,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",_externalLinkWidget:null,_shortcutLinkWidget:null,_shortcutTypeWidget:null,_targetFrameWidget:null,_switchLinkTypeFirstRunDone:false,modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],enableSaveButton:["enableSaveButton"],enableShortcutLink:["enableShortcutLink"],enableExternalLink:["enableExternalLink"],clearExternalLink:["clearExternalLink"],enableOpenIn:["enableOpenIn"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_setContentLinkAttr:function(value){this.breadcrumb.set("contentLink",value);},_setContentNameAttr:{node:"contentNameNode",type:"innerHTML"},_setEnableSaveButtonAttr:function(value){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!value);}},_setEnableShortcutLinkAttr:function(value){if(this._shortcutLinkWidget){this._shortcutLinkWidget.set("required",value);this._shortcutLinkWidget.set("state","");var _197f=this._getAncestorNode(this._shortcutLinkWidget.domNode,"epi-form-container__section__row");if(_197f){_1973.set(_197f,"display",value?"":"none");}}},_setEnableExternalLinkAttr:function(value){if(this._externalLinkWidget){this._externalLinkWidget.set("required",value);this._externalLinkWidget.set("disabled",!value);this._externalLinkWidget._set("state","");var _1980=this._getAncestorNode(this._externalLinkWidget.domNode,"epi-form-container__section__row");if(_1980){_1973.set(_1980,"display",value?"":"none");}}},_setEnableOpenInAttr:function(value){if(this._targetFrameWidget){var _1981=this._getAncestorNode(this._targetFrameWidget.domNode,"epi-form-container__section__row");if(_1981){_1973.set(_1981,"display",value?"":"none");}}},_getAncestorNode:function(node,_1982){var _1983=node?node.parentNode:null;if(!_1983){return null;}if(!_1974.contains(_1983,_1982)){return this._getAncestorNode(_1983,_1982);}return _1983;},_setClearExternalLinkAttr:function(value){if(this._externalLinkWidget&&value&&!this._switchLinkTypeFirstRunDone){this._externalLinkWidget.reset();this._switchLinkTypeFirstRunDone=true;}},onFieldCreated:function(_1984,_1985){switch(_1984){case "pageLinkURL":this._externalLinkWidget=_1985;this.connect(this._externalLinkWidget.domNode,"onkeyup",lang.hitch(this,function(evt){this.model.set("enableSaveButton",true);}));break;case "pageShortcutLink":this._shortcutLinkWidget=_1985;this._shortcutLinkWidget.set("contentLink",this.model.get("contentLink"));break;case "pageShortcutType":this._shortcutTypeWidget=_1985;break;case "pageTargetFrame":this._targetFrameWidget=_1985;break;default:break;}},onChange:function(value){this.inherited(arguments);this.model.set("intermediateValue",lang.mixin(value,{pageShortcutTypeName:this._shortcutTypeWidget?this._shortcutTypeWidget.get("displayedValue"):""}));var _1986=this._shortcutTypeWidget&&this._shortcutTypeWidget.get("value");if(_1986===_1978.pageShortcutTypes.Shortcut){this._shortcutLinkWidget&&this._shortcutLinkWidget.set("canSelectOwnerContent",false);}},_getValueAttr:function(){return this.model.get("intermediateValue");},getActions:function(){this._actions=[{name:"save",label:_197e.action.save,settings:{type:"button",disabled:true,"class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}else{this.model.set("enableSaveButton",false);}})},{name:"cancel",label:_197e.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"dojox/validate/regexp":function(){define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_1987,dojox){var _1988=lang.getObject("validate.regexp",true,dojox);_1988=dojox.validate.regexp={ipAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowDottedDecimal!="boolean"){flags.allowDottedDecimal=true;}if(typeof flags.allowDottedHex!="boolean"){flags.allowDottedHex=true;}if(typeof flags.allowDottedOctal!="boolean"){flags.allowDottedOctal=true;}if(typeof flags.allowDecimal!="boolean"){flags.allowDecimal=true;}if(typeof flags.allowHex!="boolean"){flags.allowHex=true;}if(typeof flags.allowIPv6!="boolean"){flags.allowIPv6=true;}if(typeof flags.allowHybrid!="boolean"){flags.allowHybrid=true;}var _1989="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var _198a="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";var _198b="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";var _198c="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";var hexRE="0[xX]0*[\\da-fA-F]{1,8}";var _198d="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";var _198e="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var a=[];if(flags.allowDottedDecimal){a.push(_1989);}if(flags.allowDottedHex){a.push(_198a);}if(flags.allowDottedOctal){a.push(_198b);}if(flags.allowDecimal){a.push(_198c);}if(flags.allowHex){a.push(hexRE);}if(flags.allowIPv6){a.push(_198d);}if(flags.allowHybrid){a.push(_198e);}var _198f="";if(a.length>0){_198f="("+a.join("|")+")";}return _198f;},host:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowIP!="boolean"){flags.allowIP=true;}if(typeof flags.allowLocal!="boolean"){flags.allowLocal=false;}if(typeof flags.allowPort!="boolean"){flags.allowPort=true;}if(typeof flags.allowNamed!="boolean"){flags.allowNamed=false;}var _1990="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";var _1991="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";var _1992=flags.allowPort?"(\\:\\d+)?":"";var _1993="((?:"+_1990+"\\.)+"+_1991+"\\.?)";if(flags.allowIP){_1993+="|"+_1988.ipAddress(flags);}if(flags.allowLocal){_1993+="|localhost";}if(flags.allowNamed){_1993+="|^[^-][a-zA-Z0-9_-]*";}return "("+_1993+")"+_1992;},url:function(flags){flags=(typeof flags=="object")?flags:{};if(!("scheme" in flags)){flags.scheme=[true,false];}var _1994=_1987.buildGroupRE(flags.scheme,function(q){if(q){return "(https?|ftps?)\\://";}return "";});var _1995="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";return _1994+_1988.host(flags)+_1995;},emailAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowCruft!="boolean"){flags.allowCruft=false;}flags.allowPort=false;var _1996="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";var _1997=_1996+"@"+_1988.host(flags);if(flags.allowCruft){_1997="<?(mailto\\:)?"+_1997+">?";}return _1997;},emailAddressList:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.listSeparator!="string"){flags.listSeparator="\\s;,";}var _1998=_1988.emailAddress(flags);var _1999="("+_1998+"\\s*["+flags.listSeparator+"]\\s*)*"+_1998+"\\s*["+flags.listSeparator+"]?\\s*";return _1999;},numberFormat:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.format=="undefined"){flags.format="###-###-####";}var _199a=function(_199b){return _1987.escapeString(_199b,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");};return _1987.buildGroupRE(flags.format,_199a);},ca:{postalCode:function(){return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";},province:function(){return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";}},us:{state:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowTerritories!="boolean"){flags.allowTerritories=true;}if(typeof flags.allowMilitary!="boolean"){flags.allowMilitary=true;}var _199c="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";var _199d="AS|FM|GU|MH|MP|PW|PR|VI";var _199e="AA|AE|AP";if(flags.allowTerritories){_199c+="|"+_199d;}if(flags.allowMilitary){_199c+="|"+_199e;}return "("+_199c+")";}}};return _1988;});},"dojox/main":function(){define("dojox/main",["dojo/_base/kernel"],function(dojo){return dojo.dojox;});},"url:epi-cms/contentediting/templates/ShortcutDialog.html":"<div class=\"epi-form-container\">\r\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\r\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\r\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\r\n</div>","epi-cms/contentediting/viewmodel/ShortcutDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi-cms/contentediting/PageShortcutTypeSupport","epi/epi","epi/shell/_StatefulGetterSetterMixin"],function(_199f,_19a0,_19a1,_19a2,epi,_19a3){return _199f([_19a0,_19a3],{value:null,intermediateValue:null,savedValue:null,contentLink:null,contentName:null,enableSaveButton:null,enableShortcutLink:null,enableExternalLink:null,enableOpenIn:true,postscript:function(){this.inherited(arguments);this.set("savedValue",this.value);},_setIntermediateValueAttr:function(value){this._set("intermediateValue",value);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.savedValue));this.set("enableShortcutLink",value&&(value.pageShortcutType===_19a2.pageShortcutTypes.Shortcut||value.pageShortcutType===_19a2.pageShortcutTypes.FetchData)?true:false);this.set("enableExternalLink",value&&value.pageShortcutType===_19a2.pageShortcutTypes.External?true:false);this.set("clearExternalLink",value&&value.pageShortcutType===_19a2.pageShortcutTypes.External&&this.savedValue.pageShortcutType!==_19a2.pageShortcutTypes.External?true:false);this.set("enableOpenIn",value&&!(value.pageShortcutType===_19a2.pageShortcutTypes.FetchData||value.pageShortcutType===_19a2.pageShortcutTypes.Inactive||value.pageShortcutType===_19a2.pageShortcutTypes.Normal));},_setSavedValueAttr:function(value){this._set("savedValue",value);this.set("enableSaveButton",false);},save:function(){this.set("savedValue",this.intermediateValue);}});});},"epi-cms/contentediting/editors/TinyMCEEditor":function(){define(["dojo/_base/config","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojo/sniff","dojox/html/entities","dijit/_TemplatedMixin","dijit/focus","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/Target","epi/shell/layout/_LayoutWidget","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_DndStateMixin","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/_UserResizable","epi/shell/widget/dialog/Alert","dojo/text!./templates/TinyMCEEditor.html","epi/i18n!epi/cms/nls/tinymce","epi/i18n!epi/cms/nls/episerver.tinymce"],function(_19a4,_19a5,lang,win,_19a6,_19a7,_19a8,_19a9,keys,on,when,has,_19aa,_19ab,_19ac,_19ad,_19ae,_19af,_19b0,_19b1,_19b2,_19b3,_19b4,_19b5,Alert,_19b6,_19b7,_19b8){return _19a5([_19b0,_19ab,_19b4,_19b5,_19b2,_19b3],{baseClass:"epiTinyMCEEditor",width:null,height:null,value:null,intermediateChanges:true,templateString:_19b6,settings:null,dirtyCheckInterval:2000,autoResizable:false,isResized:false,tinymceRendered:null,dropTarget:null,readOnly:false,_fullScreenEditor:null,_dirtyCheckTimeout:null,_editorValue:null,postMixInProperties:function(){this.inherited(arguments);if(this.autoResizable){this.height=0;}this.tinymceRendered=new _19a9();},postCreate:function(){this.own(this.dropTarget=new _19af(this.dndOverlay,{accept:this.allowedDndTypes,createItemOnDrop:false,readOnly:this.readOnly}));this.connect(this.dropTarget,"onDropData","onDropData");this.connect(this.dndOverlay,"onmousemove","_onOverlayMouseMove");this.inherited(arguments);},startup:function(){if(this._started){return;}this.inherited(arguments);if(!window.tinymce){require(["tinymce/tiny_mce_src"],lang.hitch(this,function(){var res=lang.mixin({},_19b7,_19b8);tinymce.addI18n({en:res});this._loadLegacyPlugins().then(lang.hitch(this,this._initTinyMCE));}));}else{this._initTinyMCE();}},destroy:function(){if(has("trident")){this._refocus();}if(this._destroyed){return;}this._cancelDirtyCheckInterval();var ed=this.getEditor();if(ed&&ed.getParam("fullscreen_is_enabled")){var _19b9=tinymce.get(ed.getParam("fullscreen_editor_id"));_19b9.plugins.fullscreen.saveState(ed);}ed&&ed.remove();this.inherited(arguments);},_loadLegacyPlugins:function(){var dfd=new _19a9();this.legacyPlugins.forEach(function(_19ba){var url=_19ad.getActionPath({moduleArea:"Util",path:"Editor/tinymce/plugins/"+_19ba+"/"+(_19a4.isDebug?"editor_plugin_src.js":"editor_plugin.js")});tinymce.PluginManager.load(_19ba,url);});tinymce.ScriptLoader.loadQueue(function(){dfd.resolve();});return dfd.promise;},canAccept:function(){return !_19a7.contains(this.dndOverlay,"dojoDndTargetDisabled");},_onDndStart:function(){_19a6.set(this.dndOverlay,"display","block");this.inherited(arguments);},_onDndCancel:function(){_19a6.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onDndDrop:function(){_19a6.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onOverlayMouseMove:function(evt){this._dragPosition={x:evt.pageX,y:evt.pageY};},onDropData:function(_19bb,_19bc,nodes,copy){var _19bd=_19bb?(_19bb.length?_19bb[0]:_19bb):null;if(!_19bd){return;}if(this.onDropping){this.onDropping();}this._dropDataProcessor(_19bd);},_dropDataProcessor:function(_19be){when(_19be.data,lang.hitch(this,function(model){var self=this,type=_19be.type,ed=this.getEditor();function _19bf(url){ed.focus();ed.execCommand("CreateLink",false,url);};function _19c0(html){ed.focus();if(ed.execCommand("mceInsertContent",false,html)){self._onChange(ed.getContent());}};function _19c1(data){if(!ed.selection.isCollapsed()){_19bf(data.url);}else{var _19c2="<a href=\"{0}\" title=\"{1}\">{1}</a>";_19c0(lang.replace(_19c2,[data.url,_19aa.encode(data.text)]));}};function _19c3(data){var _19c4="<img alt=\"{alt}\" src=\"{src}\" width=\"{width}\" height=\"{height}\" />";var _19c5=data.previewUrl||data.url;var _19c6=_19a8.create("img",{src:_19c5,style:{display:"none;"}},win.body(),"last");on.once(_19c6,"load",function(){_19c0(lang.replace(_19c4,{alt:this.alt,width:this.width,height:this.height,src:_19c5}));_19a8.destroy(_19c6);});};if(type&&type.indexOf("link")!==-1){_19c1(model);return;}else{if(type&&type.indexOf("fileurl")!==-1){_19c3(model);return;}}var _19c7=model.typeIdentifier;var _19c8=_19b1.getValue(_19c7,"editorDropBehaviour");if(_19c8){if(_19c8===1){var html="<div data-contentlink=\""+model.contentLink+"\" data-classid=\"36f4349b-8093-492b-b616-05d8964e4c89\" class=\"mceNonEditable epi-contentfragment\">"+model.name+"</div>";_19c0(html);return;}var _19c9,_19ca=_19b1.getInheritanceChain(_19c7);for(var i=0;i<_19ca.length;i++){var _19cb=_19ca[i];_19c9=_19ae.getConverter(_19cb,_19cb+".link");if(_19c9){break;}}if(!_19c9){return;}when(_19c9.convert(_19c7,_19c7+".link",model),lang.hitch(this,function(data){if(!data.url){var _19cc=new Alert({description:_19b8.notabletocreatelinkforpage});_19cc.show();this.own(_19cc);}else{switch(_19c8){case 2:_19c1(data);break;case 3:_19c3(data);break;}}}));}}));_19a6.set(this.dndOverlay,{display:"none"});},_onFocus:function(){this.inherited(arguments);this.focus();},focus:function(){var ed=this.getEditor();if(ed){when(this.tinymceRendered,lang.hitch(this,function(){_19ac.focus(ed.contentWindow.frameElement);ed.focus();}));}},getEditor:function(){if(typeof tinymce==="undefined"||tinymce===null){return null;}var ed=this._fullScreenEditor;if(ed&&ed.id==="mce_fullscreen"){return ed;}return tinymce.get(this.editorFrame.id);},getEditorDOM:function(){return (typeof tinymce!=="undefined"&&tinymce!==null)?tinymce.DOM:null;},resizeEditor:function(){var ed=this.getEditor(),_19cd=0,_19ce=(tinymce.isIE?document.body.clientHeight:window.innerHeight)-200,_19cf=(tinymce.isIE?document.body.clientWidth:window.innerWidth)-200,d=ed.getDoc(),b=d.body,DOM=tinymce.DOM,_19d0=this.height,_19d1=this.width,_19d2,_19d3;_19d2=b.scrollHeight;_19d3=b.scrollWidth;if(_19d2>_19cd){_19d0=_19d2;}if(_19d2>_19ce){_19d0=_19ce;}if(_19d3>_19cf){_19d1=_19cf;}DOM.setStyle(ed.contentWindow.frameElement,"height",_19d0+80+"px");if(ed.getBody().scrollWidth!==ed.getBody().offsetWidth){var _19d4=20;if(_19d0===_19ce){_19d4=30;}DOM.setStyle(ed.contentWindow.frameElement,"width",ed.getBody().scrollWidth+_19d4+"px");}this.isResized=true;},_setValueAttr:function(_19d5){var ed=this.getEditor(),_19d6=_19d5||"";this._set("value",_19d5);if(ed&&ed.initialized){ed.setContent(_19d6);}else{this.editorFrame.value=_19d6;}},_updateTinySettings:function(){this.settings=lang.mixin(this.settings,{mode:"exact",width:this.width,height:this.height,relative_urls:false,elements:this.editorFrame.id,readonly:this.readOnly});},_initTinyMCE:function(){this._updateTinySettings();if(this.legacyPlugins&&this.legacyPlugins.length>0){this.settings.plugins=this.settings.plugins+","+this.legacyPlugins.join(",");}if(typeof tinymce!=="undefined"){tinymce.dom.Event.domLoaded=true;this._setupHandle=tinymce.onAddEditor.add(lang.hitch(this,this._onAddEditor));tinymce.init(this.settings);}else{console.error("Couldn't initialize the editor");}},_isFullScreen:function(ed){return ed.editorId==="mce_fullscreen";},_onAddEditor:function(_19d7,ed){if(this.editorFrame&&ed.id===this.editorFrame.id){this._setupEditorEventHandling(_19d7,ed);}else{if(this.editorFrame&&ed.settings.fullscreen_editor_id===this.editorFrame.id){this._setupEditorEventHandling(_19d7,ed);this._fullScreenEditor=ed;}}},_handlePopupWindow:function(ed){ed.windowManager.onOpen.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));var _19d8=lang.hitch(this,function(){this.focus();this.isShowingChildDialog=this._isFullScreen(ed);if(!this.isShowingChildDialog){this._onChange(ed.getContent());}});ed.windowManager.onClose.add(lang.hitch(this,function(){setTimeout(_19d8);}));},_handlePopupMenu:function(ed){var _19d9;for(var i in ed.controlManager.controls){_19d9=ed.controlManager.controls[i];if(_19d9.onRenderMenu){_19d9.onRenderMenu.add(lang.hitch(this,function(_19da,menu){menu.onShowMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));menu.onHideMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=this._isFullScreen(ed);}));}));}}},_setupEditorEventHandling:function(_19db,ed){ed.onInit.add(lang.hitch(this,function(){!this.tinymceRendered.isResolved()&&this.tinymceRendered.resolve();this.own(_19ac.registerIframe(ed.contentWindow.frameElement));this._handlePopupMenu(ed);this._handlePopupWindow(ed);if(this.autoResizable){setTimeout(lang.hitch(this,this.resizeEditor),200);}else{this.set("isResized",true);}this._startDirtyCheckInterval();if(ed&&ed.selection){ed.selection.onSetContent.add(lang.hitch(this,function(_19dc,args){var isSet=args.set;if(isSet){this._onChange(ed.getContent());}}));}}));ed.onChange.add(lang.hitch(this,function(ed,e){this._onChange(ed.getContent());}));ed.onSetContent.add(lang.hitch(this,"onSetContent"));ed.onRemove.add(lang.hitch(this,"onEditorRemoved"));ed.onRedo.add(lang.hitch(this,"onRedo"));ed.onUndo.add(lang.hitch(this,"onUndo"));ed.onBeforeExecCommand.add(lang.hitch(this,function(ed,cmd,ui,val,a){this._onChange(ed.getContent());if(cmd==="mceFullScreen"&&ed.id!=="mce_fullscreen"){this.isShowingChildDialog=!this._isFullScreen(ed);}else{if(cmd==="mceFullScreen"&&ed.id==="mce_fullscreen"){this._fullScreenEditor=null;}}}));},onSetContent:function(ed,e){var _19dd=ed.getContent(),_19de=this.get("_editorValue")!==_19dd;e.initial&&this.set("_editorValue",_19dd);if(_19de){this.validate();this.onLayoutChanged();}},onEditorRemoved:function(ed){},_isMetaKey:function(e){if(e.keyCode===keys.CTRL||e.keyCode===keys.ALT||e.keyCode===keys.SHIFT||e.keyCode===keys.META){return true;}return false;},_onChange:function(val){var _19df=this.get("_editorValue")!==val;if(_19df){this._set("value",val);this.set("_editorValue",val);if(this.validate()){this.onChange(val);}}},onChange:function(val){},_stopEditing:function(){var ed=this.getEditor(),val=ed.getContent();this.displayMessage(null);if(ed&&ed.undoManager&&ed.undoManager.typing){ed.undoManager.typing=0;ed.undoManager.add();}this._onChange(val);},_onBlur:function(){this._stopEditing();this.inherited(arguments);},_cancelDirtyCheckInterval:function(){if(this._dirtyCheckTimeout){clearTimeout(this._dirtyCheckTimeout);this._dirtyCheckTimeout=null;}},_startDirtyCheckInterval:function(){if(this._destroyed||!this.intermediateChanges){return;}this._cancelDirtyCheckInterval();this._dirtyCheck();this._dirtyCheckTimeout=setTimeout(lang.hitch(this,this._startDirtyCheckInterval),this.dirtyCheckInterval);},_dirtyCheck:function(){var ed=this.getEditor();var _19e0=lang.getObject("plugins.spellchecker.active",false,ed)||false;if(ed&&!_19e0){this._onChange(ed.getContent());}},onRedo:function(ed,level){},onUndo:function(ed,level){},_refocus:function(){var focEl=document.activeElement;var input=document.createElement("input");input.type="text";input.style.position="absolute";input.style.left="-9000px";input.style.height="0";input.style.width="0";document.getElementsByTagName("body")[0].appendChild(input);input.focus();if(focEl){focEl.focus();}else{input.blur();}input.parentNode.removeChild(input);input=focEl=null;}});});},"epi-cms/widget/_DndStateMixin":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/aspect","dojo/dom-class"],function(dojo,array,_19e1,lang,_19e2,_19e3,_19e4){return _19e1([],{baseDndStateClass:"epi-dropTarget",dndStateClass:null,dropTarget:null,_aspectAfterHandler:null,postCreate:function(){this.subscribe("/dnd/start","_onDndStart");this.subscribe("/dnd/cancel","_onDndCancel");this.subscribe("/dnd/drop","_onDndDrop");if(this.dropTarget){this._aspectAfterHandler=_19e3.after(this.dropTarget,"onDndStart",lang.hitch(this,"_onAfterDndStart"));}},_getDndStateClassAttr:function(){var _19e5=this.canAccept()?"Enabled":"Disabled";this.dndStateClass=this.baseDndStateClass+_19e5;return this.dndStateClass;},canAccept:function(){return false;},_onDndStart:function(){if(!this.dropTarget){_19e4.add(this.domNode,this.get("DndStateClass"));}},_onAfterDndStart:function(){_19e4.add(this.domNode,this.get("DndStateClass"));},_onDndCancel:function(){_19e4.remove(this.domNode,this.dndStateClass);},_onDndDrop:function(){_19e4.remove(this.domNode,this.dndStateClass);},destroy:function(){this.inherited(arguments);if(this._aspectAfterHandler){this._aspectAfterHandler.remove();this._aspectAfterHandler=null;}}});});},"epi-cms/widget/_UserResizable":function(){define(["dojo/_base/declare"],function(_19e6){return _19e6(null,{onResizeStart:function(){},onResizeStop:function(){}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEEditor.html":"<div id=\"widget_${id}\">\r\n    <div style=\"display: inline-block\" data-dojo-attach-point=\"stateNode, tooltipNode\">\r\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none;\"></textarea>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\r\n</div>\r\n","epi-cms/contentediting/editors/TinyMCEOverlayItem":function(){define(["dojo/_base/declare","epi/shell/widget/overlay/Item"],function(_19e7,Item){return _19e7([Item],{postMixInProperties:function(){this.inherited(arguments);this.allowedDndTypes=[];}});});},"epi-cms/contentediting/editors/TinyMCEInlineEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/on","dojo/sniff","epi/string","epi-cms/contentediting/_HasFloatingComponent","epi-cms/contentediting/editors/TinyMCEEditor","dojo/text!./templates/TinyMCEInlineEditor.html"],function(array,_19e8,lang,dom,_19e9,_19ea,_19eb,_19ec,on,sniff,_19ed,_19ee,_19ef,_19f0){return _19e8([_19ee,_19ef],{baseClass:"epiTinyMCEInlineEditor",autoResizable:true,templateString:_19f0,inlineSettings:null,supportCustomDnd:true,_lastRng:null,_maxCheckRenderedTime:10,_editorIframe:null,onEditorBlur:function(){this._stopEditing();},onEditorResizing:function(_19f1){},onEditorResized:function(_19f2){},isEditing:function(){return this.domNode&&_19eb.get(this.domNode,"display").toLowerCase()!=="none";},startup:function(){this._checkingTime=0;if(this._started){return;}this.inherited(arguments);if(!this.ready){return;}this.own(this.watch("state",lang.hitch(this,function(name,_19f3,_19f4){on.emit(this.domNode,"editorstatechanged",_19f4);})));},destroy:function(){this._clearLocalDefers();this._externalToolbar=this._toolbarSizeBox=this._toolbarRelativeContainer=this._toolbarRefContainer=null;this._latestButtonIds=this._editorIframe=this._toolbarFinishRender=null;this._lastRng=null;this.inherited(arguments);},focus:function(){this.inherited(arguments);var _19f5=this.getEditor();if(!_19f5){return;}if(!sniff("trident")){_19f5.selection.setRng(this._lastRng||_19f5.selection.getRng());}this.resizeEditor();},resizeEditor:function(){if(_19eb.get(this.containerNode,"display")==="none"){this.onEditorResized();return;}var _19f6=this.getEditor(),style={height:"auto"},_19f7=this._getEditorIframe();_19eb.set(_19f7,style);style.height=_19f6.getBody().parentNode.scrollHeight+"px";this.onEditorResizing({style:style});_19eb.set(_19f7,style);this.onEditorResized(lang.hitch(this,this._floatToolbar));this.isResized=true;},tryToStopEditing:function(){if(sniff("trident")){this._refocus();}},_onBlur:function(){},_updateTinySettings:function(){this.inherited(arguments);this.settings.width=this.settings.height="100%";this.settings=lang.mixin(this.settings,this.inlineSettings);},_setupEditorEventHandling:function(_19f8,_19f9){this.inherited(arguments);this._disableSetTopStyle();this._appendEditorResizeHandler(_19f9);this._appendEditorFloatToolbarHandler(_19f9);(sniff("ie")||sniff("trident"))&&_19f9.onNodeChange.add(lang.hitch(this,function(_19fa){this._lastRng=_19fa.selection.getRng();}));},_clearLocalDefers:function(){this._deferToolbarFullSize&&this._deferToolbarFullSize.remove();this._deferOnKeyUp&&this._deferOnKeyUp.remove();},_appendEditorResizeHandler:function(_19fb){var _19fc=lang.hitch(this,this.resizeEditor);_19fb.onChange.add(_19fc);_19fb.onSetContent.add(_19fc);_19fb.onPaste.add(_19fc);_19fb.onPostRender.add(_19fc);_19fb.onKeyUp.add(lang.hitch(this,function(){this._clearLocalDefers();this._deferOnKeyUp=this.defer(_19fc,10);}));_19fb.onExecCommand.add(lang.hitch(this,function(ed,cmd){if(cmd==="mceFullScreen"&&this._isFullScreen(tinyMCE.activeEditor)){_19e9.remove(tinyMCE.activeEditor.getBody(),this.settings.body_class);}}));},_appendEditorFloatToolbarHandler:function(_19fd){_19fd.onInit.add(lang.hitch(this,this._showEditorToolbar));_19fd.onActivate.add(lang.hitch(this,this._floatToolbar));_19fd.onMouseUp.add(lang.hitch(this,this._floatToolbar));},_showEditorToolbar:function(_19fe){if(!_19fe){return;}this.focus();_19fe.dom.show(this._getExternalToolbar());this._floatToolbar();},_disableSetTopStyle:function(){this.own(_19ec.before(this.getEditorDOM(),"setStyle",lang.hitch(this,function(n,na,v){if(n===this._getExternalToolbar()&&na==="top"){return [];}return;})));},_floatToolbar:function(){this._clearLocalDefers();if(!this._getExternalToolbar()){return;}if(!this._isToolbarRendered()){this._deferToolbarFullSize=this.defer(this._floatToolbar,100);return;}this.onComponentFloat(this._getComponentFloatInfo());},_getComponentFloatInfo:function(){return {componentInfo:{component:this._getExternalToolbar(),componentSizeBox:lang.hitch(this,function(){return this._toolbarSizeBox||(this._toolbarSizeBox=dom.byId(this.editorFrame.id+"_tblext"));})(),relativeContainer:lang.hitch(this,function(){return this._toolbarRelativeContainer||(this._toolbarRelativeContainer=this._getExternalToolbar().parentNode);})(),refContainer:lang.hitch(this,function(){return this._toolbarRefContainer||(this._toolbarRefContainer=dom.byId(this.editorFrame.id+"_parent"));})()},floatingInfo:{refreshPosition:false}};},_isToolbarRendered:function(){if(this._checkingTime>this._maxCheckRenderedTime){return true;}this._checkingTime++;var _19ff=null,_1a00=0;return this._toolbarFinishRender||(this._toolbarFinishRender=this._getToolbarLatestButtonIds().every(function(_1a01){_19ff=dom.byId(this.editorFrame.id+"_"+_1a01);_1a00=_19ff&&_19ea.position(_19ff).w;return _1a00!==0;},this));},_getToolbarLatestButtonIds:function(){if(this._latestButtonIds){return this._latestButtonIds;}this._latestButtonIds=[];var _1a02=null;for(var _1a03 in this.settings){if(_1a03.toLowerCase().indexOf("theme_advanced_button")!==-1){_1a02=this.settings[_1a03].split(",").pop();if(!_19ed.isNullOrEmpty(_1a02)){this._latestButtonIds.push(_1a02);}}}return this._latestButtonIds;},_getExternalToolbar:function(){return this._externalToolbar||(this._externalToolbar=dom.byId(this.editorFrame.id+"_external"));},_getEditorIframe:function(){return this._editorIframe||(this._editorIframe=dom.byId(this.editorFrame.id+"_ifr"));}});});},"epi-cms/contentediting/_HasFloatingComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-style"],function(_1a04,lang,_1a05,_1a06){return _1a04(null,{componentGutter:7,_floatingComponentSize:null,_floatingComponent:null,_floatingComponentSizeBox:null,_floatingRelativeContainer:null,_floatingRefContainer:null,onComponentFloat:function(_1a07){this._floatingComponent=_1a07.componentInfo.component;this._floatingComponentSizeBox=_1a07.componentInfo.componentSizeBox;this._floatingRelativeContainer=_1a07.componentInfo.relativeContainer;this._floatingRefContainer=_1a07.componentInfo.refContainer;},getComponentInfo:function(){return {component:this._floatingComponent,componentSize:this._getFloatingComponentSize(),relativeContainer:this._floatingRelativeContainer,refContainer:this._floatingRefContainer};},destroy:function(){this._floatingComponentSizeBox=this._floatingComponent=this._floatingRelativeContainer=this._floatingRefContainer=null;this._floatingComponentSize=null;this.inherited(arguments);},_getFloatingComponentSize:function(){if(this._floatingComponentSize){return this._floatingComponentSize;}var _1a08=_1a05.getMarginBox(this._floatingComponentSizeBox);return this._floatingComponentSize={height:parseInt(_1a08.h,10)+this.componentGutter,width:parseInt(_1a08.w,10)};}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEInlineEditor.html":"<div id=\"widget_${id}\" style=\"position: relative; overflow: visible;\">\r\n    <div data-dojo-attach-point=\"stateNode, tooltipNode\">\r\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none; visibility: hidden; position: absolute; top:0; left:0; bottom:0; right:0;\"></textarea>\r\n    </div>\r\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\r\n</div>\r\n","epi-cms/contentediting/FloatingEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/topic","dijit/focus","epi/dependency","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1a09,lang,_1a0a,_1a0b,topic,_1a0c,_1a0d,_1a0e,_1a0f){return _1a09([_1a0f],{formContainerWidgetType:"epi/shell/widget/FormContainer",isOverlayDisabled:true,isUndoDisabled:true,_overlayContainer:null,postCreate:function(){this.inherited(arguments);var self=this;this.own(topic.subscribe("/epi/shell/context/request",function(_1a10,_1a11){if(!_1a11.contextIdSyncChange){self.tryToStopEditing(false);self._destroyDialog();}}),topic.subscribe("/epi/shell/action/changeview",function(){self._removeEditingFeatures();}));},destroy:function(){this._removeEditingFeatures();this._destroyDialog();this.inherited(arguments);},startEdit:function(_1a12){lang.mixin(this.editorParams,_1a12);var self=this;self._destroyDialog();return self._setupDialog().then(function(){self.own(_1a0a.after(self._dialog,"onAfterShow",function(){self._startEdit(_1a12);self._onTryToStopWithInvalidValue();}));return self._dialog.show();});},_createDialog:function(_1a13){return new _1a0e({title:this.propertyDisplayName,content:_1a13,duration:350,snapToNode:this.blockDisplayNode,positioner:_1a0d.resolve("epi.shell.layout.PositioningUtility"),showButtonContainer:false});},_setBlockDisplayNodeAttr:function(node){this.inherited(arguments);var _1a14=this._dialog;if(_1a14){_1a14.set("snapToNode",node);}},_setupDialog:function(){var _1a15={};var _1a16=function(_1a17,_1a18){_1a15[_1a17]=_1a18;};var _1a19=lang.hitch(this,function(_1a1a){for(var _1a1b in _1a15){var _1a1c=_1a15[_1a1b];_1a1c.set("parent",this);}_1a15=null;});var _1a1d=lang.mixin({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){lang.mixin(_1a1d,{onFieldCreated:_1a16,onFormCreated:_1a19,doLayout:false});}var _1a1e=new _1a0b();require([this.editorWidgetType],lang.hitch(this,function(_1a1f){var _1a20=new _1a1f(_1a1d);this.editorWidget=_1a20;var _1a21=this._createDialog(_1a20);this._handlers=[this.connect(_1a21,"onButtonClose",this._onButtonClose),this.connect(_1a21,"onCancel",this._onDialogCancel),this.connect(_1a21.doneButtonNode,"onClick",this._onButtonClose),this.connect(_1a20,"onChange",this._onChange),this.connect(_1a20,"onKeyPress","_onEditorKeyPress")];this._dialog=_1a21;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}_1a1e.resolve();}));return _1a1e.promise;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){array.forEach(this._handlers,function(_1a22){_1a22.remove();});this._handlers=null;if(this._dialog){this._dialog.destroy();this._dialog=null;}if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}},_removeEditingFeatures:function(){var _1a23=this._dialog;if(_1a23&&_1a23.open){_1a23.hide();}},_onTryToStopWithInvalidValue:function(){_1a0c.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){this.tryToStopEditing(false);}});});},"epi/shell/widget/dialog/LightWeight":function(){require({cache:{"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/dialog/LightWeight",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-style","dojo/has","dijit/focus","dijit/DialogUnderlay","dijit/Dialog","epi/shell/widget/dialog/_DialogMixin","dijit/_WidgetsInTemplateMixin","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/LightWeight.html"],function(_1a24,lang,_1a25,_1a26,_1a27,has,focus,_1a28,_1a29,_1a2a,_1a2b,_1a2c,_1a2d){return _1a24([_1a29,_1a2a,_1a2b],{templateString:_1a2d,buttonCloseText:_1a2c.action.close,buttonDoneText:_1a2c.action.done,buttonLearnMoreText:_1a2c.action.learnmore,useGlassUnderlay:false,_glassUnderlay:null,"class":"epi-lfw-dialog",snapToNode:null,positioner:null,showButtonContainer:true,destroy:function(){this._interval&&clearInterval(this._interval);this.inherited(arguments);},show:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterShow));},_size:function(){var _1a2e=this._relativePosition&&this._relativePosition.id;_1a27.set(this.containerNode,"overflow","visible");this.inherited(arguments);_1a27.set(this.containerNode,"overflow","auto");if(this.positioner){var obj={snapTo:this.snapToNode,transformIndex:_1a2e};this._relativePosition=this.positioner.findPosition(this.domNode,obj);}},resize:function(){this._size();this._position();},_onAfterShow:function(){function _1a2f(){var _1a30=_1a26.position(this.domNode),_1a31=this._relativePosition;if(_1a31&&(Math.abs(_1a31.w-_1a30.w)>8||Math.abs(_1a31.h-_1a30.h)>8)){this.resize();}};if(this.content&&this.content.focus){this.content.focus();}if(this.useGlassUnderlay){this._createUnderlay();}else{if(this._moveable&&!this._attachedMoveEvents){this.connect(this._moveable,"onMoveStart",lang.hitch(this,this._createUnderlay));this.connect(this._moveable,"onMoveStop",lang.hitch(this,this._removeUnderlay));this._attachedMoveEvents=true;}if(this.content&&this.content.onResizeStart&&this.content.onResizeStop&&!this._attachedContentResizeEvents){this.own(_1a25.after(this.content,"onResizeStart",lang.hitch(this,this._createUnderlay)),_1a25.after(this.content,"onResizeStop",lang.hitch(this,this._removeUnderlay)));this._attachedContentResizeEvents=true;}}this._interval=setInterval(lang.hitch(this,_1a2f),250);this.onAfterShow();},_createUnderlay:function(){var _1a32=this.containerNode,_1a33=_1a27.get(_1a32,"width");if(has("trident")){var _1a34=_1a32.offsetWidth-_1a32.clientWidth;_1a33+=_1a26.getPadBorderExtents(_1a32).w+_1a34;}_1a27.set(_1a32,{width:_1a33+"px"});if(this._glassUnderlay){this._glassUnderlay.show();}else{this.own(this._glassUnderlay=new _1a28());this._glassUnderlay.show();var _1a35=_1a27.get(this.domNode,"zIndex");_1a27.set(this._glassUnderlay.domNode,"zIndex",_1a35-1);_1a27.set(this._glassUnderlay.domNode,"opacity","0");}},_endDrag:function(){this.inherited(arguments);this._relativePosition.id=this.positioner.userSetTransformId;},_removeUnderlay:function(){this._glassUnderlay.hide();},_onContainerNodeClick:function(e){if(e.target===this.containerNode){this._getFocusItems();this._firstFocusItem&&focus.focus(this._firstFocusItem);}},_setSnapToNodeAttr:function(node){this.snapToNode=null;this._set("snapToNode",node);},onButtonClose:function(){},onAfterShow:function(){},onAfterHide:function(){},hide:function(){this._interval&&clearInterval(this._interval);this._interval=null;return this.inherited(arguments).then(lang.hitch(this,this._onAfterHide));},_onAfterHide:function(){if(this.useGlassUnderlay){this._removeUnderlay();}this.onAfterHide();},layout:function(){if(this._glassUnderlay&&_1a27.get(this._glassUnderlay.domNode,"display")!=="none"){this._glassUnderlay.layout();}var _1a36=_1a28._singleton;var _1a37=_1a36?_1a27.get(_1a36.domNode,"display"):null;this.inherited(arguments);if(_1a36){_1a27.set(_1a36.domNode,"display",_1a37);}},_setShowButtonContainerAttr:function(_1a38){this._set("showButtonContainer",_1a38);_1a27.set(this.buttonContainerNode,"display",_1a38?"":"none");},_checkIfSingleChild:function(){this._singleChild=null;}});});},"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\r\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\r\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\r\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\r\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\r\n        </span>\r\n    </div>\r\n    <div class=\"dijitDialogPaneContent\">\r\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\r\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\r\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n","epi-cms/contentediting/OverlayBasedEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/_EditorWrapperBase"],function(_1a39,lang,on,_1a3a,_1a3b){return _1a39([_1a3b],{destroy:function(){this._iframeWithOverlay=null;this.inherited(arguments);},_onEditorResize:function(_1a3c){},_onEditorResizeFinished:function(_1a3d){},_getOverlayItemAttr:function(){return this.overlayItem||this.editorParams.overlayItem;},_getIframeWithOverlayAttr:function(){if(this._iframeWithOverlay){return this._iframeWithOverlay;}var _1a3e=null,_1a3f=this.overlayItem;while(_1a3f){if(_1a3f instanceof _1a3a){_1a3e=_1a3f;break;}_1a3f=_1a3f.getParent();}return this._iframeWithOverlay=_1a3e;}});});},"epi-cms/contentediting/FlyoutEditorWrapper":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/number","epi/shell/widget/IframeWithOverlay","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/FloatingEditorWrapper"],function(_1a40,_1a41,lang,_1a42,_1a43,_1a44,_1a45,_1a46,_1a47,_1a48){return _1a41([_1a48],{_eventHandlers:null,constructor:function(){this._eventHandlers=[];},_createDialog:function(_1a49){var _1a4a=function(_1a4b){if(!this.open||!_1a4b){return;}this._containerNodeCS=this._containerNodeCS||_1a44.getComputedStyle(this.containerNode);if(!this._dialogChromeSize){this._chromeHeight=_1a43.getMarginBox(this.domNode).h-_1a43.getMarginBox(this.containerNode).h;}_1a43.setMarginBox(this.containerNode,{h:_1a4b.h-this._chromeHeight},this._containerNodeCS);_1a44.set(this.domNode,{top:_1a4b.t+"px",left:_1a4b.l+"px"});};var _1a4c=new _1a47({title:this.propertyDisplayName,content:_1a49,duration:350,draggable:false,closeIconVisible:false,region:"trailing",resize:_1a4a,overlayItem:this.overlayItem,_position:function(){},_size:function(){}});_1a42.add(_1a4c.domNode,"epi-floatingEditorWrapperDialog");_1a42.remove(_1a4c.domNode,"epi-lfw-dialog--dark");_1a4c.placeAt(this.get("iframeWithOverlay"));_1a44.set(_1a4c.domNode,{top:"-10000px"});return _1a4c;},_disconnectLocal:function(_1a4d){if(lang.isArray(_1a4d)){var _1a4e;while((_1a4e=_1a4d.pop())){_1a40.disconnect(_1a4e);}}},_removeEditingFeatures:function(){this.inherited(arguments);this._disconnectLocal(this._eventHandlers);}});});},"epi-cms/contentediting/InlineEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1a4f,event,lang,_1a50,_1a51,on,when,_1a52){return _1a4f([_1a52],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},tryToStopEditing:function(){var _1a53=this.getEditorWidget();if(_1a53&&_1a53.isEditing()){_1a53.onEditorBlur();}this.inherited(arguments,[true]);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _1a54=new _1a51();var _1a55=lang.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_1a55.style=this._computeStyling();}require([this.editorWidgetType],lang.hitch(this,function(_1a56){var _1a57=this.editorWidget=new _1a56(_1a55);_1a57.placeAt(this.get("overlayItem").domNode);this.own(on(_1a57.domNode,"editorstatechanged",lang.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_1a57,"onClick",event.stop),this.connect(_1a57,"onEditorResizing",this._onEditorResizing),this.connect(_1a57,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_1a57,"onChange","_onEditorChange"));this._handlers.push(this.connect(_1a57,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_1a54.resolve(_1a57);}));return _1a54;},_computeStyling:function(){var _1a58=_1a50.getComputedStyle(this.blockDisplayNode),_1a59="line-height:"+_1a58.lineHeight+";",_1a5a=_1a50.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(prop){var _1a5b=_1a58["font"+prop],_1a5c=_1a5a["font"+prop];if(_1a5c!==_1a5b){_1a59+="font-"+prop+":"+_1a58["font"+prop]+";";}},this);var width=this.width;if(width==="100%"){_1a59+="width:100%;";}else{_1a59+="width:"+(width+(Number(width)===width?"px":""))+";";}_1a59+="position: absolute; left: 0px; top: 0px;";return _1a59;},_onEditorChange:function(value){this._onChange(value);},_onEditorResizing:function(_1a5d){},_onEditorResized:function(_1a5e){},_onEditorStateChanged:function(_1a5f){var _1a60=this.get("overlayItem");_1a60&&_1a60.set("error",_1a5f==="Error");},startEdit:function(){var _1a61=this.getInherited(arguments);when(this._getOrCreateEditor(),lang.hitch(this,function(_1a62){this._blockDisplayNodeOpacity=_1a50.get(this.blockDisplayNode,"opacity");_1a50.set(_1a62.domNode,{display:""});_1a50.set(this.blockDisplayNode,{opacity:0.5});_1a61.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_1a63){_1a63.remove();});},_onTryToStopWithInvalidValue:function(){},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_1a50.set(this.blockDisplayNode,{opacity:this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_1a50.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_1a64){var _1a65=this.get("overlayItem");if(!_1a65){return;}var _1a66=this.getEditorWidget();if(!_1a66||!_1a66.supportCustomDnd){return;}if(_1a64===true){_1a65.transferDndControlTo(_1a66);}else{_1a65.transferDndControlTo(_1a65);}},_toggleOverlayItemZIndex:function(_1a67){var _1a68=this.get("overlayItem");if(!_1a68||!_1a68.item){return;}var _1a69=parseInt(_1a50.get(_1a68.item,"zIndex"),10);_1a50.set(_1a68.item,{zIndex:_1a67===true?++_1a69:--_1a69});}});});},"epi-cms/contentediting/SettingsPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/when","dojo/dom-geometry","dijit/_Container","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","epi/shell/layout/SimpleContainer","dojo/text!./templates/SettingsPanel.html"],function(_1a6a,lang,array,_1a6b,when,_1a6c,_1a6d,_1a6e,_1a6f,_1a70,_1a71,_1a72,_1a73){return _1a6a([_1a70,_1a6d,_1a6e,_1a6f],{templateString:_1a73,contentViewModel:null,detailsWidgetIdentifier:"epi-cms/contentediting/ContentDetails",detailsModelIdentifier:"epi-cms/contentediting/viewmodel/ContentDetailsViewModel",detailsWidgetProperties:null,_contentDetailsDef:null,_contentDetailsModelDef:null,buildRendering:function(){this.inherited(arguments);var _1a74=this.detailsWidgetIdentifier;var _1a75=this.detailsModelIdentifier;var _1a76=new _1a6b();var _1a77=new _1a6b();require([_1a74,_1a75],lang.hitch(this,function(_1a78,_1a79){var _1a7a=new _1a78({},this.contentDetails);this.own(_1a7a);var model=new _1a79();this.own(model);_1a7a.set("model",model);_1a7a.startup();this.contentDetails=_1a7a;_1a76.resolve(_1a7a);_1a77.resolve(model);}));this._contentDetailsDef=_1a76;this._contentDetailsModelDef=_1a77;},_setContentViewModelAttr:function(_1a7b){this._set("contentViewModel",_1a7b);when(this._contentDetailsModelDef,function(model){model.set("dataModel",_1a7b);});},addChild:function(w){if(this.detailsWidgetProperties){var _1a7c=array.filter(this.detailsWidgetProperties,function(item){return item.propertyName===w.name;});if(_1a7c.length>0){when(this._contentDetailsDef,lang.hitch(this,function(_1a7d){_1a7d.addChild(w,_1a7c[0].options);}));return;}}this.widgetContainer.addChild(w);}});});},"url:epi-cms/contentediting/templates/SettingsPanel.html":"<div class=\"epi-documentHeader\">\r\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\r\n    <div data-dojo-attach-point=\"contentDetails\"></div>\r\n</div>","epi-cms/contentediting/ValidationTextboxWithWarning":function(){define(["dojo/_base/declare","dojox/validate/regexp","dijit/form/ValidationTextBox"],function(_1a7e,_1a7f,_1a80){return _1a7e([_1a80],{regExpForWarning:null,acceptUrl:false,acceptMailAddress:false,_refreshState:function(){if(!this._created){return;}this.focused?this._validateWhenTyping():this.validate(false);},_isValidWhenTyping:function(){var value=this.textbox.value;return (this.acceptUrl&&(new RegExp(_1a7f.url({scheme:true}))).test(value))||(this.acceptMailAddress&&(new RegExp("mailto\\:"+_1a7f.emailAddress())).test(value))||(this.regExpForWarning&&(new RegExp("^(?:"+this.regExpForWarning+")"+(this.required?"":"?")+"$")).test(value));},_validateWhenTyping:function(){var _1a81="";var _1a82=this.disabled||this.isValid(true);if(_1a82){this._maskValidSubsetError=true;}var _1a83=this._isEmpty(this.textbox.value);var _1a84=!_1a82&&this._isValidSubset();this._set("state",_1a82?(this._isValidWhenTyping()?"":"Incomplete"):(((_1a83||_1a84)&&this._maskValidSubsetError)?"Incomplete":"Error"));this.focusNode.setAttribute("aria-invalid",_1a82?"false":"true");if(this.state==="Error"){this._maskValidSubsetError=_1a84;_1a81=this.getErrorMessage(true);}else{if(this.state==="Incomplete"){_1a81=this.getPromptMessage(true);this._maskValidSubsetError=!this._hasBeenBlurred;}else{if(_1a83){_1a81=this.getPromptMessage(true);}}}this.set("message",_1a81);return _1a82;}});});},"epi-cms/contentediting/viewmodel/ContentDetailsViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/command/AccessRights","epi-cms/contentediting/command/LanguageSettings","epi-cms/contentediting/command/DynamicProperties","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/contentediting/viewmodel/_ContentViewModelObserver"],function(array,_1a85,lang,when,epi,_1a86,_1a87,_1a88,_1a89,_1a8a,_1a8b,_1a8c,_1a8d,_1a8e,_1a8f,_1a90){return _1a85([_1a90,_1a8c,_1a8d],{commandKey:"epi.cms.contentdetailsmenu",res:null,contentTypeName:null,contentId:null,visibleToEveryOne:null,existingLanguages:null,accessRightsCommand:null,languageSettingsCommand:null,dynamicPropertiesCommand:null,expirationCommand:null,constructor:function(_1a91){_1a85.safeMixin(this,_1a91);},postscript:function(){this.initializeCommandProviders();this.accessRightsCommand=new _1a89();this.languageSettingsCommand=new _1a8a();this.dynamicPropertiesCommand=new _1a8b();if(!this.expirationCommand){var _1a92=_1a87.resolve("epi.cms.contentEditing.command.Editing");this.expirationCommand=_1a92.manageExpiration;}if(!this.store){var _1a93=_1a87.resolve("epi.storeregistry");this.store=_1a93.get("epi.cms.contenttype");}this.inherited(arguments);},destroy:function(){this.accessRightsCommand.destroy();this.languageSettingsCommand.destroy();this.dynamicPropertiesCommand.destroy();this.inherited(arguments);},_setDataModelAttr:function(value){this.updateCommandModel(value);this.accessRightsCommand.set("model",value);this.languageSettingsCommand.set("model",value);this.dynamicPropertiesCommand.set("model",value);this.inherited(arguments);},onDataModelChange:function(name,_1a94,value){var _1a95=this.dataModel.contentData,_1a96=new _1a8f(_1a95.contentLink);this.set("contentId",_1a96.id);this.set("existingLanguages",array.map(_1a95.existingLanguageBranches,function(item){return {text:item.languageId,urlSegment:item.urlSegment,isCurrentLanguage:_1a95.currentLanguageBranch&&item.languageId===_1a95.currentLanguageBranch.languageId,contentLink:new _1a8f(item.commonDraftLink).createVersionUnspecificReference().toString()};}));this.set("visibleToEveryOne",_1a95.visibleToEveryOne);when(this.store.get(_1a95.contentTypeID),lang.hitch(this,function(type){this.set("contentTypeName",type.localizedName);}));this.set("commands",this.getCommands());},getCommands:function(){var _1a97=this.inherited(arguments);return [this.dynamicPropertiesCommand,this.languageSettingsCommand,this.expirationCommand].concat(_1a97);}});});},"epi-cms/contentediting/command/AccessRights":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.accessrights"],function(_1a98,_1a99,_1a9a,_1a9b){return _1a98([_1a9a],{name:"AccessRights",label:_1a9b.label,tooltip:_1a9b.tooltip,dialogPath:"Edit/EditSecurity.aspx",raiseCloseEvent:true,_onModelChange:function(){var _1a9c=this.model.contentData,_1a9d=_1a99.hasAccess(_1a9c.accessMask,_1a99.accessLevel.Administer),_1a9e=this.model.canChangeContent();this.set("canExecute",_1a9c.capabilities.securable&&_1a9d&&_1a9e);}});});},"epi-cms/contentediting/command/LanguageSettings":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.languagesettings"],function(_1a9f,_1aa0,_1aa1,_1aa2){return _1a9f([_1aa1],{name:"LanguageSettings",label:_1aa2.label,tooltip:_1aa2.tooltip,dialogPath:"Edit/LanguageSettings.aspx",raiseCloseEvent:true,_onModelChange:function(){var _1aa3=this.model.contentData,_1aa4=_1aa0.hasAccess(_1aa3.accessMask,_1aa0.accessLevel.Administer);this.set("canExecute",_1aa3.capabilities.languageSettings&&_1aa4);}});});},"epi-cms/contentediting/command/DynamicProperties":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.dynamicproperties"],function(_1aa5,_1aa6,_1aa7,_1aa8,_1aa9){return _1aa5([_1aa7],{label:_1aa9.label,tooltip:_1aa9.tooltip,dialogPath:"Edit/EditDynProp.aspx",raiseCloseEvent:true,postscript:function(){this.inherited(arguments);this.set("isAvailable",_1aa8.isDynamicPropertiesEnabled);},_onModelChange:function(){var _1aaa=this.model.contentData,_1aab=_1aa6.hasAccess(_1aaa.accessMask,_1aa6.accessLevel.Administer),_1aac=this.model.canChangeContent();this.set("canExecute",_1aaa.capabilities.dynamicProperties&&_1aab&&_1aac);}});});},"epi-cms/conversion/PropertyContentAreaConverter":function(){define(["dojo/_base/declare"],function(_1aad){return _1aad(null,{sourceDataType:"epi.cms.propertycontentarea",targetDataType:"runtimeType",registerDefaultConverters:function(_1aae){_1aae.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_1aaf,_1ab0,data){if(_1aaf===this.sourceDataType&&_1ab0===this.targetDataType){return data?data._unparsedString:data;}return null;}});});},"epi-cms/layout/CreateContentGroupContainer":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/shell/layout/SimpleContainer"],function(_1ab1,_1ab2,_1ab3){return _1ab1([_1ab3],{templateString:"<div class='epi-containerLayout clearfix'>                            <div class='epi-formsHeaderContainer'>                                <h2>${title}</h2>                            </div>                            <ul data-dojo-attach-point='containerNode'></ul>                        </div>"});});},"epi-cms/layout/EditLayoutContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/when","dijit/layout/TabContainer","dijit/registry","dojo/text!./templates/EditLayoutContainer.html"],function(array,_1ab4,_1ab5,when,_1ab6,_1ab7,_1ab8){return _1ab4([_1ab6],{templateString:_1ab8,postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this.tabPosition="top";},addChild:function(_1ab9,index){if(_1ab9.region==="top"){this.own(_1ab9.placeAt(this.topPaneContainerNode));}else{this.inherited(arguments);}},removeChild:function(_1aba){if(_1aba.region==="top"){if(this._descendantsBeingDestroyed){return;}if(this._started){this.layout();}}else{this.inherited(arguments);}},layout:function(){if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){return;}var _1abb=_1ab7.findWidgets(this.topPaneContainerNode);array.forEach(_1abb,function(_1abc){_1abc.resize();});return this.inherited(arguments);},selectChild:function(_1abd){if(_1abd.region==="top"){return;}else{return when(this.inherited(arguments)).then(function(_1abe){this.layout();return _1abe;}.bind(this));}}});});},"url:epi-cms/layout/templates/EditLayoutContainer.html":"<div class=\"dijitTabContainer\">\r\n    <div data-dojo-attach-point=\"topPaneContainerNode\"></div>\r\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\r\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\r\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\r\n</div>\r\n","epi-cms/legacy/LegacyFormEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi/shell/widget/dialog/Dialog","epi-cms/widget/_HasChildDialogMixin","epi/shell/widget/_ValueRequiredMixin","epi-cms/legacy/EditPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor"],function(_1abf,lang,_1ac0,_1ac1,_1ac2,_1ac3,_1ac4,epi,_1ac5,_1ac6,_1ac7,_1ac8,_1ac9,res){return _1abf([_1ac1,_1ac2,_1ac3,_1ac7,_1ac8],{localization:res,destroyOnHide:false,editorWidgetClass:_1ac9,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-legacyFormEditor\">                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.helptext}'\"></div>            </div>",editorWidget:null,value:null,multiple:false,contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,_dialog:null,onChange:function(){},postCreate:function(){this.inherited(arguments);lang.mixin(this.params,{contentLink:this.contentLink});},buildRendering:function(){this.inherited(arguments);if(this.output){this.output.set("disabled",true);}},destroy:function(){if(this._dialog){this._dialog.destroyRecursive();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.openButton.set("disabled",value);},_setValueAttr:function(value){this._set("value",value);if(this.editorWidget&&!epi.areEqual(value,this.editorWidget.get("value"))){this.editorWidget.set("value",value);}this.setDisplayValue(value);},_onChange:function(){var value=this.editorWidget.get("value");this.set("value",value);this.onChange(value);if(this._dialog&&this._dialog.open){this._dialog.hide();}},_onCancel:function(){this._dialog.hide();},_onDialogHide:function(){this.isShowingChildDialog=false;if(this.destroyOnHide){this.editorWidget=this._dialog=null;}},openEditor:function(){this.isShowingChildDialog=true;if(!this._dialog){this._createDialog();}this.editorWidget.set("value",this.value);this._dialog.show();},_createDialog:function(){var _1aca=this.editorWidgetClass;this.editorWidget=new _1aca(this.params);this._dialog=new _1ac6({destroyOnHide:this.destroyOnHide,content:this.editorWidget,title:this.editorWidget.title||this.label,defaultActionsVisible:false,dialogClass:"",contentClass:"epi-dialog-fullWidth"});this.connect(this.editorWidget,"onResize",lang.hitch(this,function(){this._dialog.resize();}));this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onCancel","_onCancel");this.connect(this._dialog,"onHide","_onDialogHide");},setDisplayValue:function(value){if(this.output){this.output.set("value",this.localization.helptext);}},focus:function(){this.openButton.focus();}});});},"epi-cms/legacy/EditPropertyWidget":function(){define(["epi","dojo","dijit","dojo/i18n","dojo/string","dojox/html/entities","epi-cms/contentediting/RenderManager","epi-cms/legacy/LegacyDialogWrapper","epi/routes"],function(epi,dojo,dijit,i18n,_1acb,_1acc,_1acd,_1ace,_1acf){return dojo.declare([_1ace],{editorFeatures:null,value:"",contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,fullName:null,_reloadOnNextEdit:false,onChange:function(_1ad0){},postMixInProperties:function(){this.features=dojo.mixin({width:400,height:30},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);var _1ad1={moduleArea:"LegacyCMS",path:"edit/EditProperty.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};dojo.mixin(_1ad1,this.contentLink?{id:this.contentLink}:{contentTypeId:this.contentTypeId,parentLink:this.parentLink});this.set("url",_1acf.getActionPath(_1ad1));},_setUrlAttr:function(url){this._currentUrl=url;var value=_1acc.encode(dojo.toJson(this.value));var _1ad2=_1acb.substitute("<html><body><form method=\"post\" action=\"${0}\" ><input type=\"hidden\" name=\"value\" value=\"${1}\" /></form></body></html>",[url,value]);this.containerIframe.contentDocument.write(_1ad2);this.containerIframe.contentDocument.forms[0].submit();},_onCallback:function(_1ad3){var _1ad4=_1ad3.value;var _1ad5=dojo.fromJson(_1ad4);if(this._oldStringValue===undefined){this._oldStringValue=dojo.toJson(this.value);}if(_1ad4!==this._oldStringValue){this._oldStringValue=dojo.toJson(_1ad5);this.value=_1ad5;this.onChange(_1ad5);}else{this.onCancel();}},resize:function(){this.inherited(arguments);if(this._reloadOnNextEdit){this._reloadOnNextEdit=false;this._reloadUrl(true);}},_setValueAttr:function(value){this._set("value",value);if(this._started){this._reloadOnNextEdit=true;}}});});},"epi-cms/legacy/LegacyDialogWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/query","dojo/string","dojo/when","dijit/_Contained","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/a11y","dijit/focus","dijit/layout/_LayoutWidget","epi/Url","epi/shell/widget/_ActionProviderWidget","epi-cms/legacy/_LegacyDialogObject","epi-cms/legacy/LegacyDialogPopup","epi/i18n!epi/cms/nls/episerver.shared.action"],function(array,_1ad6,lang,_1ad7,on,topic,_1ad8,_1ad9,_1ada,_1adb,_1adc,has,query,_1add,when,_1ade,_1adf,_1ae0,a11y,_1ae1,_1ae2,Url,_1ae3,_1ae4,_1ae5,_1ae6){return _1ad6([_1ae2,_1adf,_1ae0,_1ae3,_1ade],{_currentUrl:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showCloseButton:false,_isIframeInitialLoad:true,_iframeFocusRegistration:null,_scrollbarWidth:null,_iframeHandles:null,templateString:"        <div style=\"position: relative;\" tabindex=\"0\">            <iframe data-dojo-attach-point=\"containerIframe\" tabindex=\"-1\" frameborder=\"0\" style=\"border: none; position: absolute, top:0, left: 0;\" src=\"about:blank\" ></iframe>        </div>",_mappedButtons:null,postMixInProperties:function(){this.inherited(arguments);this._isIframeInitialLoad=true;this._iframeHandles=[];this.features=lang.mixin({width:320,height:240},this.features);},postCreate:function(){this.inherited(arguments);this._legacyDialog=this._createLegacyDialogObject(lang.hitch(this,function(){this.onCallback.apply(this,arguments);}),this.callbackArguments,this.dialogArguments,this.opener||window);this._resetIframeContainerSize();this.own(topic.subscribe("/IsInLegacyWrapper/NeedToBeCloseOnLoad",lang.hitch(this,function(_1ae7){this.onCancel();})));},startup:function(){this.inherited(arguments);if(this.containerIframe.attachEvent){this.containerIframe.attachEvent("onload",lang.hitch(this,this._onIframeLoad));}else{this.connect(this.containerIframe,"onload",lang.hitch(this,this._onIframeLoad));}},resize:function(){this.inherited(arguments);if(this._started){this._setIframeSizeFromDomNode();}},_setUrlAttr:function(value){var url=value||"about:blank";this._currentUrl=url;_1ad8.set(this.containerIframe,"src",url);},onCallback:function(_1ae8){},onLoad:function(){},onCancel:function(){},onMapDialogButton:function(_1ae9){return true;},onBeforePerformAction:function(_1aea){},getLegacyDialog:function(){return this._legacyDialog;},_focusIframeContent:function(){var _1aeb=this.containerIframe.contentWindow,doc=_1aeb&&_1aeb.document,_1aec=(doc&&a11y.getFirstInTabbingOrder(doc))||this.containerIframe;_1ae1.focus(_1aec);},_onIframeLoad:function(){if(!has("ie")){this._iframeFocusRegistration=_1ae1.registerIframe(this.containerIframe);}this._focusIframeContent();this._overrideLegacyDialogUtilities();var _1aed=this.containerIframe.contentWindow;this._iframeHandles.push(on(_1aed,"unload",lang.hitch(this,this._removeIframeHandles)));if(_1aed.EPi&&_1aed.EPi.ToolButton){this._iframeHandles.push(_1ad7.after(_1aed.EPi.ToolButton,"SetEnabled",lang.hitch(this,this._toolButtonChanged),true));}this._iframeHandles.push(_1ad7.after(this._legacyDialog,"ButtonChanged",lang.hitch(this,this._toolButtonChanged),true));this._mapDialogButtons();this._setTitle();var _1aee=query(".epi-contentContainer",this.containerIframe.contentWindow.document)[0];if(_1aee){_1ad9.add(_1aee,"epi-legacyDialog");}if(this.autoFit){this._calculateAndSetContentSize();}this.onResize();this.onResize();if(this.onLoad){this.onLoad.apply(this,arguments);}this._isIframeInitialLoad=false;},_removeIframeHandles:function(){array.forEach(this._iframeHandles,function(_1aef){_1aef.remove();});this._iframeHandles=[];this._mappedButtons=null;},_setTitle:function(){if(this.dialogTitle){this.title=this.dialogTitle;return;}var title=query("title",this.containerIframe.contentWindow.document)[0];if(title){this.title=_1add.trim(title.innerHTML);}},_getScrollbarWidth:function(){if(this._scrollbarWidth===null){var d=_1ada.create("div",{style:"position:absolute; top:-2000; left:-2000; width:100px; height:100px; overflow:scroll"},document.body);this._scrollbarWidth=d.offsetWidth-d.clientWidth;_1ada.destroy(d);}return this._scrollbarWidth;},_boxToStyle:function(size){return {width:size.w+"px",height:size.h+"px"};},_setIframeSizeFromDomNode:function(){_1adc.set(this.containerIframe,this._boxToStyle(_1adb.getContentBox(this.domNode)));},_setContentSize:function(size){_1adc.set(this.domNode,this._boxToStyle(size));this._setIframeSizeFromDomNode();},_calculateAndSetContentSize:function(_1af0){function _1af1(doc,dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};var _1af2=null;try{_1af2=this.containerIframe.contentWindow.document;}catch(e){return;}var _1af3=(_1af2.documentElement.scrollHeight-_1af2.documentElement.clientHeight)>0,_1af4=_1af3&&this.autoFit?this._getScrollbarWidth():0,_1af5={w:_1af1(_1af2,"Width")+_1af4,h:_1af1(_1af2,"Height")};this._setContentSize(_1af5);},_resetIframeContainerSize:function(){this._setContentSize({w:this.features.width,h:this.features.height});},_showNode:function(_1af6,show){if(!_1af6){return;}_1adc.set(_1af6,"display",show?"":"none");},_toolButtonChanged:function(_1af7,_1af8){if(typeof _1af7==="string"){var _1af9=lang.getObject("containerIframe.contentWindow.EPi",false,this);_1af7=_1af9&&_1af9._GetDomObject&&_1af9._GetDomObject(_1af7);}if(_1af7){if(this.hasAction(_1af7.id)){this.setActionProperty(_1af7.id,"disabled",_1af7.disabled);this.setActionProperty(_1af7.id,"visible",_1af7.style.display!=="none");this.setActionProperty(_1af7.id,"label",_1af7.value||_1af7.innerHTML);}var _1afa=this._mappedButtons[_1af7.id];if(_1afa){this._showNode(_1afa.containerNode,false);}}},_mapDialogButtons:function(){var _1afb=query(this.legacyButtonQuery||"[data-epi-dialog-button]",this.containerIframe.contentWindow.document);this.removeActions(this.getActions());this._mappedButtons={};array.forEach(_1afb,function(_1afc){var _1afd=_1ad8.get(_1afc,"data-epi-dialog-button"),_1afe=null;switch(_1afd){case "functioner":return;case "container":_1afe=query("[data-epi-dialog-button=\"functioner\"]",_1afc)[0];break;default:if(_1afc.tagName==="INPUT"){_1afe=_1afc;if(_1ad9.contains(_1afe.parentNode,"epi-cmsButton")){_1afc=_1afe.parentNode;}}else{_1afe=query("INPUT",_1afc)[0];}break;}this._mappedButtons[_1afe.id]={containerNode:_1afc,functionNode:_1afe};this._showNode(_1afc,false);when(this.onMapDialogButton(_1afe),lang.hitch(this,function(_1aff){if(_1aff){var label=_1afe.tagName==="INPUT"?_1afe.value:_1afe.innerHTML,title=_1afe.tagName==="INPUT"?_1ad8.get(_1afe,"title"):_1afe.innerHTML,_1b00={name:_1afe.id,label:label,disabled:_1afe.disabled,title:title,action:lang.hitch(this,function(){this.onBeforePerformAction(_1b00,_1afe);_1afe.click();})};this.addActions(_1b00);}}));},this);if(this.showCloseButton){this.addActions({name:"close",label:_1ae6.close,action:lang.hitch(this,this.onCancel)});}},_overrideLegacyDialogUtilities:function(){var _1b01=this.containerIframe.contentWindow;if(!_1b01.EPi){_1b01.EPi={};}_1b01.EPi.CreateDialog=lang.hitch(this,this._createLegacyDialogFnc);_1b01.EPi.GetDialog=lang.hitch(this,this._getLegacyDialogFnc);},_getLegacyDialogFnc:function(win){if(win){return win.EPi.GetDialog();}return this._legacyDialog;},_createLegacyDialogFnc:function(url,_1b02,_1b03,_1b04,_1b05,_1b06){var _1b07=new _1ae5({url:url,dialogArguments:_1b04,callbackArguments:_1b03,features:_1b05,opener:_1b06});_1b07.on("Callback",lang.hitch(this,function(){if(_1b02){_1b02.apply(this,arguments);}}));_1b07.show();return _1b07.legacyDialogObject;},_createLegacyDialogObject:function(_1b08,_1b09,_1b0a,_1b0b){var obj=new _1ae4({callbackMethod:_1b08,callbackArguments:_1b09,dialogArguments:_1b0a,_opener:_1b0b?_1b0b:window.top});try{this.containerIframe.contentWindow.opener=_1b0b;obj._dialog=this.containerIframe.contentWindow;}catch(e){obj._dialog=null;}return obj;},_reloadUrl:function(_1b0c){this._isIframeInitialLoad=_1b0c;if(this._isIframeInitialLoad){this._resetIframeContainerSize();}var url=new Url(this._currentUrl);lang.mixin(url.query,{"epi.preventCache":new Date().valueOf()});this.set("url",url.toString());},cleanup:function(){var _1b0d=this.containerIframe.contentWindow;_1b0d.EPi.CreateDialog=null;_1b0d.EPi.GetDialog=null;if(this._legacyDialog&&!this._legacyDialog.IsCleaned()){this._legacyDialog.Cleanup();}},destroy:function(){this.cleanup();if(this._iframeFocusRegistration){this._iframeFocusRegistration.remove();this._iframeFocusRegistration=null;}this.inherited(arguments);}});});},"epi-cms/legacy/_LegacyDialogObject":function(){define(["dojo/_base/declare","dojo/_base/kernel"],function(_1b0e,_1b0f){return _1b0e(null,{_dialog:null,constructor:function(_1b10){this.callbackMethod=_1b10.callbackMethod||null;this.callbackArguments=_1b10.callbackArguments||null;this.dialogArguments=_1b10.dialogArguments||null;this._opener=(_1b10.opener?_1b10.opener.top:window.top);while(this._opener.EPiOpenedDialog&&this._opener.EPiOpenedDialog._dialog){this._opener=this._opener.EPiOpenedDialog._dialog;}this._opener.EPiOpenedDialog=this;},Close:function(_1b11){if(typeof (this.callbackMethod)=="function"){(this.callbackMethod).call(this,_1b11,this.callbackArguments);}},ButtonChanged:function(_1b12){},Cleanup:function(){this._CleanDialog();if(this._opener){this._opener.EPiOpenedDialog=null;}delete this._opener;this.callbackMethod=null;this.callbackArguments=null;delete this.callbackMethod;delete this.callbackArguments;this._cleaned=true;},IsCleaned:function(){return this._cleaned;},_CleanDialog:function(){for(var prop in this){if(prop!=="callbackMethod"&&prop!=="callbackArguments"&&prop!=="_opener"){this[prop]=null;delete this[prop];}}}});});},"epi-cms/project/Overview":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/_ContextMixin","./_ProjectView","./viewmodels/OverviewViewModel","dojo/text!./templates/Overview.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/Toolbar","dijit/form/Button","dijit/form/DropDownButton","dijit/layout/TabContainer","epi-cms/project/ActivityFeed","epi-cms/project/ProjectItemList","epi-cms/project/PublishMenu"],function(_1b13,lang,_1b14,on,when,_1b15,_1b16,_1b17,_1b18,res){return _1b13([_1b16],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],dndEnabled:["dndEnabled"],isActivitiesVisible:["isActivitiesVisible"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"],projectItemCountMessage:["projectItemCountMessage"],projectName:["projectName"]},res:res,templateString:_1b18,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"refresh-activities",this.activityFeed.refresh.bind(this.activityFeed)));},_createViewModel:function(){return new _1b17();},layout:function(){if(!this._started){return;}var _1b19=_1b14.getMarginBox(this.toolbar),size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1b19.h});this.tabs.resize(size);},_onShow:function(){this.model.set("isProjectOverviewActive",true);},onHide:function(){this.model.set("isProjectOverviewActive",false);},_close:function(){this.model.requestPreviousContext();},_setIsActivitiesVisibleAttr:function(_1b1a){this.itemList.toggleActivities(_1b1a);},_setProjectNameAttr:{node:"projectNameNode",type:"innerText"},_setProjectItemCountMessageAttr:{node:"toolbarTextNode",type:"innerText"}});});},"epi-cms/project/_ProjectView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/_ModelBindingMixin","./CreateNewDraftConfirmationDialog","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_1b1b,lang,_1b1c,_1b1d,_1b1e,on,when,_1b1f,_1b20,_1b21,_1b22,_1b23,_1b24,_1b25,res){return _1b1b([_1b21,_1b1f,_1b20,_1b24],{model:null,commandProvider:null,res:res,_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=this.commandProvider=this._createViewModel());}},_createViewModel:function(){},buildRendering:function(){this.inherited(arguments);this._setupList();this._setupProjectMenu();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();},_setupList:function(){var model=this.model,_1b26=this.itemList;function _1b27(_1b28){if(_1b28.existingProjectItems.length!==0){new _1b25({projectItems:_1b28.existingProjectItems,contentReferences:_1b28.contentReferences,onAction:function(_1b29){if(_1b29){model.addProjectItems(_1b28.contentReferencesToAdd).then(_1b26.setSelection.bind(_1b26));}}}).show();}else{if(_1b28.contentReferencesToAdd.length>0){model.addProjectItems(_1b28.contentReferencesToAdd);}}};this.own(on(this.model,"refresh",_1b26.refresh.bind(_1b26)),on(this.model,"selected-project-items-updated",function(_1b2a){_1b26.selectItems(_1b2a);}),on(this.domNode,"selection-changed",function(e){model.updateActivityFeed(e.items);}),on(this.domNode,"active-items-changed",function(e){model.set("selectedProjectItems",e.items);}),on(this.domNode,"itemaction",function(e){model.namedCommands.editProjectItem.execute();}),on(this.domNode,"itemremove",function(){model.namedCommands.removeProjectItem.execute().then(_1b26.focus.bind(_1b26));}),on(this.domNode,"itemsdropped",function(e){model.canAddContent(e.items).then(_1b27);}),on(this.model,"clear-selection",function(){_1b26.clearSelection();}));},_setupProjectMenu:function(){this.own(this._menuAssembler=new _1b22({configuration:[{builder:new _1b23({settings:{"class":"epi-flat epi-chromeless epi-chromeless--icon-only",showLabel:false}}),category:"projectButton",target:this.toolbarGroupNode},{builder:new _1b23({settings:{"class":"epi-flat epi-chromeless epi-chromeless--icon-only epi-floatRight",showLabel:false}}),category:"project-comments",target:this.projectCommentsToolbar},{builder:new _1b23({settings:{"class":"epi-flat epi-chromeless"}}),category:"project-activities",target:this.toolbarGroupNode}],commandSource:this.model}));},_publishMenuClickHandler:function(){this.model.refreshProject(false);},_setCreatedAttr:{node:"createdNode",type:"innerText"},_setCreatedByAttr:{node:"createdByNode",type:"innerText"},_setDndEnabledAttr:function(value){this.itemList.set("dndEnabled",value);},_setProjectItemQueryAttr:function(value){var store=value?this.model.projectItemStore:null;this.itemList.updateQuery(store,value);},_setProjectItemSortOrderAttr:function(value){this.itemList.set("sortOrder",value);},_setNotificationMessageAttr:function(value){this.itemList.set("notificationMessage",value);},_setProjectStatusAttr:function(value){this.projectStatusMessageNode.textContent=value;_1b1d.toggle(this.projectStatusMessageNode,"dijitHidden",!value);},_setContentLanguageAttr:function(value){this.itemList.set("contentLanguage",value);}});});},"epi-cms/project/CreateNewDraftConfirmationDialog":function(){define(["dojo/_base/declare","dojo/string","dgrid/Grid","epi/shell/widget/dialog/Confirmation","epi/string","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared","epi/i18n!epi/cms/nls/episerver.cms.components.project.newdraftconfirmation"],function(_1b2b,_1b2c,Grid,_1b2d,_1b2e,_1b2f,_1b30,_1b31,_1b32){return _1b2b([_1b2d],{projectItems:null,contentReferences:null,title:_1b32.allreadypartofproject,cancelActionText:_1b31.action.cancel,dialogClass:"epi-dialog-contentReferences epi-contentReferences",setFocusOnConfirmButton:false,buildRendering:function(){this.inherited(arguments);var _1b33={showHeader:true,"class":"epi-plain-grid epi-plain-grid--no-border",columns:{name:{sortable:false,label:_1b31.header.name,className:"epi-grid--30 epi-cursor--default",renderCell:function(_1b34,value,node,_1b35){var title=_1b34.name+", ID: "+_1b34.contentLink;node.innerHTML=_1b2f.statusFormatter(_1b30.contentItem(_1b34.typeIdentifier,"",value,title),_1b34,node,_1b35);}},path:{sortable:false,label:_1b32.path,className:"epi-grid--40 epi-cursor--default",formatter:_1b30.path},projectName:{sortable:false,className:"epi-grid--30 epi-cursor--default",label:_1b32.project,renderCell:function(_1b36,value,node,_1b37){node.textContent=_1b36.projectName;}}}};this.own(this.content=new _1b2b([Grid])(_1b33));this.content.renderArray(this.projectItems);this.set("description",_1b2c.substitute(_1b32.confirmationtext,[this.projectItems.length,this.contentReferences.length]));this.set("confirmActionText",this.projectItems.length===1?_1b32.addnewdraft:_1b32.addnewdrafts);},_size:function(){this.inherited(arguments);this.content.resize();}});});},"epi-cms/dgrid/listItemFormatters":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.project","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/ListItem.html"],function(_1b38,_1b39,_1b3a,_1b3b,_1b3c,res,_1b3d,_1b3e,_1b3f){var _1b40;function _1b41(item){return item.path?item.path.join(" > "):item.name;};function _1b42(item){if(!item.contentLanguage){return null;}return item.contentLanguage!==_1b40.contentLanguage?{language:item.contentLanguage}:null;};function _1b43(value,_1b44,node){var _1b45=_1b3b.accessLevel,_1b46="epi-statusIndicatorIcon epi-statusIndicator"+_1b44.status,title=_1b3b.versionLocalizations[_1b44.status]||"";if(_1b44.isDeleted){_1b46="epi-iconWarning epi-icon--warning";title=_1b3d.versionnotfound;_1b38.add(node,"epi-content--deleted");}else{if(!_1b3b.hasAccess(_1b44.accessMask,_1b45.Read)){_1b46="epi-iconLock";title=res.status.message.noreadaccess;_1b38.add(node,"epi-content--no-access");}else{if(!_1b3b.hasAccess(_1b44.accessMask,_1b45.Publish)){_1b46="epi-iconWarning epi-icon--warning";title=res.status.message.nopublishaccess;}}}return "<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon "+_1b46+"\" title=\""+title+"\"></span>"+value;};function _1b47(_1b48){return function formatter(value,_1b49,node,_1b4a){var _1b4b=_1b42(_1b49),name=value.name||"",_1b4c=_1b39.substitute(res.list.card.modifiedbyuser,{modified:_1b3c.localizedDate(_1b49.modified),userName:_1b3c.userName(_1b49.userName)}),_1b4d=(_1b3b.versionLocalizations[_1b49.status]||"")+(_1b49.delayPublishUntil?" "+_1b3c.localizedDate(_1b49.delayPublishUntil):""),map,_1b4e=_1b49.typeIdentifier;if(!_1b3b.hasAccess(_1b49.accessMask,_1b3b.accessLevel.Read)){name=res.status.message.notavailable;_1b4d=res.status.message.insufficient;_1b4c="";_1b4e="";}if(_1b49.isDeleted){_1b4d=_1b3d.versionnotfound;}map={iconResizer:_1b49.thumbnailUrl?"epi-card__icon epi-card__icon--thumbnailresizer":"epi-card__icon",icon:_1b49.thumbnailUrl?_1b3c.thumbnail(_1b49.thumbnailUrl):_1b4e&&_1b3c.contentIcon(_1b4e," epi-icon--large")||"",name:_1b3a.encode(name,_1b3a.html),nameTooltip:_1b3a.encode(_1b41(_1b49)||"",_1b3a.html),statusIcon:_1b43("",_1b49,node,_1b4a),status:_1b4d,menu:_1b3c.menu({title:_1b3e.action.options}),cardTitle:_1b4c,cardTitleTooltip:res.list.card.lastmodified,contentTypeDescription:_1b3c.contentTypeDescription(_1b4e)||"",languageBranch:_1b4b&&_1b4b.language||"",languageBranchClass:_1b4b&&_1b4b.language?"epi-card__language-branch":"epi-card__language-branch--hidden",commentsClass:_1b49.hasComments?"":"dijitHidden",commentsTooltip:res.list.card.hascomments};_1b38.add(node,_1b48);return _1b39.substitute(_1b3f,map);};};_1b40={contentLanguage:null,languageSelector:_1b42,titleSelector:_1b41,statusFormatter:_1b43,card:[_1b47("epi-card")],"card-compact":[_1b47("epi-card epi-card--compact")]};return _1b40;});},"url:epi-cms/dgrid/templates/ListItem.html":"<div class=\"epi-mo\">\n    <div class=\"epi-mo--img\">\n        <div class=\"dijitIcon ${iconResizer}\">${icon}</div>\n    </div>\n    <div class=\"epi-mo--body\">\n        <div class=\"epi-card__menu\">\n            ${menu}\n        </div>\n        <span class=\"epi-secondaryText dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\n        <div class=\"epi-card__info\">\n            <div class=\"dijitInline\">\n                <span class=\"epi-card__title\" title=\"${cardTitleTooltip}\">${cardTitle}</span>\n                <span class=\"epi-secondaryText\">\n                    ${contentTypeDescription}\n                    <span class=\"dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\n                </span>\n            </div>\n        </div>\n        <div class=\"dijitInline epi-card__title--ellipsis-wrapper\">\n            <div>\n                <span class=\"dijitInline epi-card__title dojoxEllipsis\" title=\"${nameTooltip}\">${name}</span>\n            </div>\n            ${statusIcon}<span class=\"epi-secondaryText\">${status}</span>\n            <span class=\"dijitInline dijitIcon epi-iconBubble epi-icon--warning ${commentsClass}\" title=\"${commentsTooltip}\"></span>\n        </div>\n    </div>\n</div>","epi-cms/project/viewmodels/OverviewViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/project/command/RefreshProjectItems","epi-cms/project/command/ToggleProjectActivities","./_ProjectViewModel","./ActivityFeedViewModel","./ProjectCommentViewModel","epi/i18n!epi/nls/episerver.cms.components.project.overview.eventfeed"],function(_1b4f,lang,topic,when,_1b50,_1b51,_1b52,_1b53,_1b54,_1b55,_1b56){return _1b4f([_1b53],{contextHistory:null,isProjectOverviewActive:false,_sortOrderProfileKey:"epi.project-overview-sort-order",_isActivitiesVisibleProfileKey:"epi.project-overview-is-activities-visible",postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_1b50.resolve("epi.cms.BackContextHistory");this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this.projectOverviewChanged)));this.activityFeedModel=new _1b54({noQueryMessage:_1b56.noquerymessage,noAccessMessage:_1b56.noaccessmessage,activitiesStore:this.activitiesStore});this.projectCommentFeedModel=new _1b55({noQueryMessage:_1b56.noquerymessage,activitiesStore:this.activitiesStore});},contextChanged:function(_1b57,_1b58){this.inherited(arguments);if(_1b57&&_1b57.type==="epi.cms.project"){var _1b59=parseInt(_1b57.id,10);when(this.projectStore.refresh(_1b59)).then(this.set.bind(this,"selectedProject"));}else{this.set("selectedProject",null);}},projectOverviewChanged:function(_1b5a){var _1b5b=this.get("isProjectOverviewActive"),_1b5c;if(_1b5b){if(_1b5a&&_1b5a.id){_1b5c="epi.cms.project:///"+_1b5a.id;topic.publish("/epi/shell/context/request",{uri:_1b5c},{sender:this});}else{this.requestPreviousContext();}}},requestPreviousContext:function(){this.contextHistory.closeAndNavigateBack(this);},_createProjectCommands:function(){var _1b5d=this.inherited(arguments);_1b5d.refreshProject=new _1b51({model:this,category:"project-comments",order:120});return _1b5d;},_createProjectItemCommands:function(){var _1b5e=this.inherited(arguments);_1b5e.sortProjectItems.set({category:"projectButton",iconClass:"epi-iconSort"});_1b5e.toggleProjectActivities=new _1b52({model:this,order:100});return _1b5e;},updateActivityFeed:function(_1b5f){this.activityFeedModel.set({selectedProjectId:this.selectedProject&&this.selectedProject.id,selectedProjectItems:_1b5f});},_selectedProjectSetter:function(_1b60){this.inherited(arguments);this._updateProjectFeedViewModel(_1b60);},_updateSelectedProjectDependencies:function(_1b61){this.inherited(arguments);this._updateProjectFeedViewModel(_1b61);},_updateProjectFeedViewModel:function(_1b62){this.projectCommentFeedModel.set({placeholderName:_1b62&&_1b62.name,selectedProjectId:_1b62&&_1b62.id});}});});},"epi-cms/project/command/RefreshProjectItems":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1b63,_1b64,res){return _1b63([_1b64],{label:res.refresh,iconClass:"epi-iconReload",category:"projectButton",canExecute:true,_execute:function(){this.model.refreshProject();this.model.refreshActivities();}});});},"epi-cms/project/command/_ProjectCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command","dijit/Destroyable"],function(_1b65,lang,_1b66,_1b67){return _1b65([_1b66,_1b67],{modelPropertyToWatch:"selectedProject",_onModelChange:function(){var model=this.model;this.set("canExecute",!!model);if(model){this.own(model.watch(this.modelPropertyToWatch,lang.hitch(this,"_setCanExecute")));this._setCanExecute();}},_setCanExecute:function(){}});});},"epi-cms/project/command/ToggleProjectActivities":function(){define(["dojo/_base/declare","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.activities.togglecommand.label"],function(_1b68,_1b69,_1b6a){return _1b68([_1b69],{canExecute:true,category:"project-activities",label:_1b6a.show,property:"isActivitiesVisible",_activeSetter:function(_1b6b){this.active=_1b6b;this.set("label",_1b6b?_1b6a.hide:_1b6a.show);}});});},"epi-cms/project/viewmodels/_ProjectViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/dom-class","dojo/promise/all","dojo/when","dojo/string","dijit/Destroyable","epi/epi","epi/datetime","epi/dependency","epi/username","epi/shell/_ContextMixin","epi/shell/xhr/errorHandler","../../contentediting/ContentActionSupport","epi/shell/command/withConfirmation","../command/AddProject","../command/PublishProject","../command/EditProjectItem","../command/ReadyToPublishProjectItem","../command/RefreshProjectItems","../command/RemoveProject","../command/RemoveProjectItem","../command/RemoveProjectScheduling","../command/RenameProject","../command/SortProjectItems","../command/ScheduleProject","epi/i18n!epi/nls/episerver.cms.components.project","epi/i18n!epi/nls/episerver.shared.action"],function(_1b6c,lang,_1b6d,_1b6e,_1b6f,_1b70,topic,_1b71,all,when,_1b72,_1b73,epi,_1b74,_1b75,_1b76,_1b77,_1b78,_1b79,_1b7a,_1b7b,_1b7c,_1b7d,_1b7e,_1b7f,_1b80,_1b81,_1b82,_1b83,_1b84,_1b85,res,_1b86){return _1b6c([_1b70,_1b73,_1b6f,_1b77],{commands:null,namedCommands:null,created:"",createdBy:"",profile:null,contentLanguage:"",dndEnabled:false,isActivitiesVisible:false,projectStore:null,projectSortOrder:null,projectItemStore:null,projectItemQuery:null,activitiesStore:null,projectItemSortOrder:null,projectStatus:"",projectName:"",notificationMessage:"",selectedProject:null,selectedProjectItems:null,projectItemCountMessage:"",placeholderState:"noProjects",_sortOrderProfileKey:"epi.project-sort-order",_isActivitiesVisibleProfileKey:"epi.project-is-activities-visible",_messages:null,constructor:function(){this.projectItemSortOrder=[];this.projectSortOrder=[{attribute:"created",descending:true}];this.selectedProjectItems=[];},postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1b75.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1b75.resolve("epi.storeregistry").get("epi.cms.project");this.projectItemStore=this.projectItemStore||_1b75.resolve("epi.storeregistry").get("epi.cms.project.item");this.activitiesStore=this.activitiesStore||_1b75.resolve("epi.storeregistry").get("epi.cms.activities");this.profile=this.profile||_1b75.resolve("epi.shell.Profile");this._messages=this.isProjectModeEnabled()?res.status.message:lang.mixin({},res.status.message,res.status["messagelegacy"]);this._createCommands();this.own(this.projectService.on("project-item-updated",lang.hitch(this,this._updateSelectedItems)),this.projectService.on("project-updated",lang.hitch(this,this._projectUpdated)));},initialize:function(){return all(when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _1b87=this._findSortOption("key",sort)||this.namedCommands.sortProjectItems.options[0];this._changeAttrValue("projectItemSortOrder",_1b87.value);})),when(this._loadSelectedProject(),lang.hitch(this,function(_1b88){this._updateSelectedProjectDependencies(_1b88);this._changeAttrValue("selectedProject",_1b88);})),when(this.profile.getContentLanguage(),lang.hitch(this,function(_1b89){this.set("contentLanguage",_1b89);})),when(this.profile.get(this._isActivitiesVisibleProfileKey),lang.hitch(this,function(_1b8a){if(typeof _1b8a==="boolean"){this.set("isActivitiesVisible",_1b8a);}})));},isProjectModeEnabled:function(){return this.projectService.isProjectModeEnabled;},getCommands:function(){return this.commands;},addProject:function(_1b8b){this.projectStore.add(_1b8b).then(lang.hitch(this,function(value){this.set("selectedProject",value);})).otherwise(_1b78.forXhr);},updateProject:function(_1b8c){this.projectStore.put(_1b8c).then(lang.hitch(this,"set","selectedProject")).otherwise(_1b78.forXhr);},publishProject:function(_1b8d,_1b8e){var self=this;return this.projectService.publishProject(_1b8d,_1b8e).then(function(_1b8f){return self._updateSelectedProjectAndRefreshContextRequest(_1b8f).then(function(){return _1b8f;});});},reactivateProject:function(_1b90){var self=this;if(isNaN(_1b90)){throw new Error("The given project ID is not a number.");}return this.projectService.reactivateProject(_1b90).then(function(_1b91){return self._updateSelectedProjectAndRefreshContextRequest(_1b91).then(function(){return _1b91;});});},refreshActivities:function(){this.emit("refresh-activities");},refreshProject:function(_1b92){var self=this;if(_1b92===undefined){_1b92=true;}if(this.selectedProject){return this.projectStore.refresh(this.selectedProject.id).then(function(value){self.set("selectedProject",value);if(_1b92){self.emit("refresh");}return value;},function(ex){self.set("selectedProject",null);});}if(_1b92){this.emit("refresh");}},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1b6e().resolve();}return store.remove(this.selectedProject.id).then(function(){self.set("selectedProject",null);});},canAddContent:function(_1b93){var _1b94=this.get("selectedProject").id;return this.projectService.canAddContent(_1b94,_1b93);},canPublishProject:function(_1b95){var _1b96;function _1b97(){return Object.keys(_1b96).some(function(key){if(key.indexOf("nopublishaccess")>-1){if(_1b96[key]>0){return true;}}});};function _1b98(state){return _1b96[state]>0;};_1b95=_1b95||this.selectedProject;_1b96=_1b95&&_1b95.itemStatusCount;if(this.isProjectModeEnabled()){return !!_1b95&&_1b95.itemStatusCount.checkedin>0;}else{return !!_1b95&&(_1b95.status==="active"||_1b95.status==="publishfailed")&&!_1b97()&&!_1b98("notcreated")&&!_1b98("rejected")&&!_1b98("checkedout")&&(_1b98("checkedin")||_1b98("published")||_1b98("previouslypublished")||_1b98("delayedpublish"));}},addProjectItems:function(_1b99,_1b9a){var _1b9b=this.get("selectedProject");_1b9a=_1b9a||(_1b9b&&_1b9b.id);if(!_1b9a){throw new Error("If no projectId is provided a selectedProject must be set in the context");}return this.projectService.addProjectItems(_1b9a,_1b99);},removeSelectedProjectItems:function(){var _1b9c=this.projectService.removeProjectItems(this.selectedProjectItems);_1b9c.then(lang.hitch(this,function(){this.emit("clear-selection");}));return _1b9c;},markProjectItemsAsReadyToPublish:function(){if(!this.selectedProjectItems.length){return new _1b6e().resolve();}var self=this;var _1b9d=this.selectedProjectItems.map(function(item){return item.id;});return this.projectService.markAsReadyToPublish(_1b9d).then(function(){when(self.getCurrentContext()).then(function(ctx){var _1b9e;self.selectedProjectItems.some(function(item){if(item.contentLink===ctx.id){_1b9e=item;return true;}});if(_1b9e){self.requestContextChange(_1b9e.contentLink);}});});},requestContextChange:function(_1b9f){var _1ba0=_1b9f.uri?_1b9f:{uri:"epi.cms.contentdata:///"+_1b9f};topic.publish("/epi/shell/context/request",_1ba0,{sender:this});},updateActivityFeed:function(_1ba1){},_projectUpdated:function(_1ba2){if(this.selectedProject&&this.selectedProject.id===_1ba2.id){this.set("selectedProject",_1ba2);}},_updateSelectedItems:function(item){var _1ba3=this.selectedProjectItems.length;for(var i=0;i<_1ba3;i++){if(this.selectedProjectItems[i].id===item.id){this.selectedProjectItems[i]=item;this.set("selectedProjectItems",this.selectedProjectItems);this.emit("selected-project-items-updated",this.selectedProjectItems);break;}}},_createCommands:function(){var _1ba4=lang.mixin(this._createProjectCommands(),this._createProjectItemCommands()),_1ba5;_1ba5=Object.keys(_1ba4).map(function(key){return _1ba4[key];}).sort(function(a,b){return a.sortOrder-b.sortOrder;});this.own.apply(this,_1ba5);this.set({commands:_1ba5,namedCommands:_1ba4});},_createProjectCommands:function(){return {addProject:new _1b7b({model:this,order:10}),renameProject:new _1b83({model:this,order:20}),removeProject:new _1b80({model:this,order:30,store:this.projectStore}),publishProject:new _1b7c({model:this,order:40}),scheduleProject:new _1b85({model:this,order:50}),removeProjectScheduling:_1b7a(new _1b82({model:this,order:60}),null,{title:res.command.removeschedulingprojectitem.title,description:res.command.removeschedulingprojectitem.confirmation,confirmActionText:_1b86.remove,cancelActionText:_1b86.cancel})};},_createProjectItemCommands:function(){return {readyToPublishProjectItem:new _1b7e({model:this,order:100}),editProjectItem:new _1b7d({model:this,order:110}),removeProjectItem:_1b7a(new _1b81({model:this,order:120}),null,{title:res.command.removeprojectitem.label,description:res.command.removeprojectitem.confirmation,confirmActionText:_1b86.remove,cancelActionText:_1b86.cancel}),sortProjectItems:new _1b84({model:this,order:130}),refreshProjectItems:new _1b7f({model:this,order:140})};},_loadSelectedProject:function(){return this.projectService.getCurrentProject();},_persistSelectedProject:function(_1ba6){this.profile.set(this._selectedProjectProfileKey,_1ba6&&_1ba6.id,{location:"server"});},_persistSortOrder:function(_1ba7){var _1ba8=this._findSortOption("value",_1ba7),key=_1ba8&&_1ba8.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_persistIsActivitiesPanelVisible:function(_1ba9){this.profile.set(this._isActivitiesVisibleProfileKey,_1ba9,{location:"server"});},_findSortOption:function(key,term){var _1baa=this.namedCommands.sortProjectItems.options,_1bab=null;term&&_1baa.some(function(item){if(term===item[key]){_1bab=item;return true;}});return _1bab;},_updateSelectedProjectDependencies:function(_1bac){var _1bad="",_1bae="",_1baf="",_1bb0=false,_1bb1="",_1bb2=null,_1bb3="",_1bb4="",_1bb5=this.isProjectModeEnabled();if(_1bac){_1bad=_1b74.toUserFriendlyString(new Date(_1bac.created));_1bae=_1b76.toUserFriendlyString(_1bac.createdBy,null,true);_1bb0=(_1bb5&&_1bac.status!=="publishing")||_1bac.status==="active"||_1bac.status==="publishfailed";_1bb2={projectId:_1bac.id};_1bb4=_1bac.name;if(!this.canPublishProject(_1bac)||_1bb5){_1bb3=this._messages[_1bac.status]||"";if(_1bac.status==="delayedpublished"&&!_1bb5){_1baf=_1b74.toUserFriendlyString(_1bac.delayPublishUntil);_1bb3=lang.replace(_1bb3,{date:_1baf});_1bb1=lang.replace(res.status.state.delayedpublished,{delayPublishUntil:_1baf});}}if(_1bac.status==="publishfailed"){_1bb1=this._getProjectFailedMessage(_1bac);}}this.set({created:_1bad,createdBy:_1bae,dndEnabled:_1bb0,notificationMessage:_1bb1,projectItemQuery:_1bb2,projectStatus:_1bb3,projectName:_1bb4});},_getProjectFailedMessage:function(_1bb6){var _1bb7=0,_1bb8="",_1bb9=res.notifications.publishfailed;_1bb7=this._getUnpublishedItems(_1bb6.itemStatusCount);if(_1bb7>0){_1bb8=lang.replace(_1bb7>1?_1bb9.notificationtextmultipleitems:_1bb9.notificationtextsingleitem,{failedItemsCount:_1bb7});}return _1bb8;},_getUnpublishedItems:function(_1bba){var count=0;Object.keys(_1bba).forEach(function(key){if(key.indexOf("checkedin")===0){count+=_1bba[key];}});return count;},_isActivitiesVisibleSetter:function(_1bbb){if(_1bbb===this.isActivitiesVisible){return;}this.isActivitiesVisible=_1bbb;this._persistIsActivitiesPanelVisible(_1bbb);},_selectedProjectSetter:function(_1bbc){_1bbc=lang.clone(_1bbc);if(epi.areEqual(this.selectedProject,_1bbc)){return;}if(this.selectedProject&&(!_1bbc||this.selectedProject.id!==_1bbc.id)){this.emit("clear-selection");}this.selectedProject=_1bbc;this._updateSelectedProjectDependencies(_1bbc);},_projectItemSortOrderSetter:function(_1bbd){if(_1bbd&&_1bbd===this.projectItemSortOrder){return;}this.projectItemSortOrder=_1bbd;this._persistSortOrder(_1bbd);},_updateSelectedProjectAndRefreshContextRequest:function(_1bbe){var self=this;self.set("selectedProject",_1bbe);return when(this.getCurrentContext()).then(function(_1bbf){self.requestContextChange(_1bbf);return _1bbf;});},_selectedProjectItemsSetter:function(_1bc0){this.selectedProjectItems=_1bc0;this._updateProjectCountMessage(_1bc0);},_updateProjectCountMessage:function(_1bc1){var items=_1bc1&&_1bc1.length>0?_1bc1.length:null,_1bc2="";function _1bc3(count,_1bc4){_1bc2=_1b72.substitute(res.notifications.selecteditems[_1bc4],{count:count});};if(items){if(items===1){_1bc3(items,"singular");}else{if(items>1){_1bc3(items,"plural");}}}this.set("projectItemCountMessage",_1bc2);}});});},"epi-cms/project/command/AddProject":function(){define(["dojo/_base/declare","./_ProjectCommand","epi-cms/project/ProjectDialogContent","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.newproject"],function(_1bc5,_1bc6,_1bc7,_1bc8,res){return _1bc5([_1bc6,_1bc8],{label:res.label,title:res.label,canExecute:true,iconClass:"epi-iconPlus",defaultActionsVisible:true,dialogClass:"epi-dialog-landscape",dialogContentClass:_1bc7,onDialogExecute:function(){this.model.addProject(this.dialogContent.get("value"));},_execute:function(){this.showDialog();}});});},"epi-cms/project/ProjectDialogContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","epi/dependency","epi/shell/widget/FormContainer","epi/shell/widget/dialog/_DialogContentMixin"],function(_1bc9,lang,keys,_1bca,_1bcb,_1bcc){return _1bc9([_1bcb,_1bcc],{_metadataManager:null,postMixInProperties:function(){this.inherited(arguments);if(!this.metadata){var _1bcd=this._metadataManager||_1bca.resolve("epi.shell.MetadataManager");this.metadata=_1bcd.getMetadataForType("EPiServer.Cms.Shell.UI.Rest.Projects.Internal.Models.ProjectViewModel");}},postCreate:function(){this.inherited(arguments);this.on("keypress",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&this.isValid()){this.executeDialog();}}));}});});},"epi-cms/project/command/PublishProject":function(){define(["dojo/_base/declare","dojo/string","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.publishproject"],function(_1bce,_1bcf,_1bd0,res){return _1bce([_1bd0],{category:"publishmenu-primary",label:res.label,isExecuting:false,_execute:function(){var model=this.model,self=this;self.set("isExecuting",true);model.publishProject(this.model.selectedProject.id).then(function(){self.set("isExecuting",false);},function(){self.set("isExecuting",false);});},_setCanExecute:function(){var _1bd1=this.model.selectedProject,_1bd2=_1bd1&&_1bd1.status,_1bd3=this.model.canPublishProject(_1bd1),_1bd4=this.model.isProjectModeEnabled();this.set({canExecute:_1bd3,isAvailable:_1bd4||(_1bd2!=="published"&&_1bd2!=="delayedpublished"),isExecuting:_1bd2==="publishing"});},_updateLabel:function(){var _1bd5=this.model&&this.model.selectedProject,_1bd6=(_1bd5&&_1bd5.itemStatusCount.checkedin)||0,data={count:_1bd6>0?_1bd6+" ":""},label;if(this.isExecuting){label=_1bd6===1?res.labelexecuting.singular:res.labelexecuting.plural;}else{if(!this.isAvailable){label=res.labelexecuted;}else{label=_1bd6===1?res.label.singular:res.label.plural;}}this.set("label",_1bcf.substitute(label,data));},_isExecutingSetter:function(value){this.isExecuting=value;this._updateLabel();}});});},"epi-cms/project/command/EditProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1bd7,_1bd8,_1bd9,_1bda){return _1bd7([_1bd9],{category:"menuWithSeparator",iconClass:"epi-iconPen",label:_1bda.edit,modelPropertyToWatch:"selectedProjectItems",_execute:function(){var _1bdb=this.model.selectedProjectItems[0];this.model.requestContextChange(_1bdb.contentLink);},_setCanExecute:function(){var _1bdc=false,_1bdd;var items=this.model&&this.model.selectedProjectItems;this.set("label",_1bda.edit);this.set("iconClass","epi-iconPen");if(items&&items.length===1){_1bdd=_1bd8.getPermissionMap(items[0].accessMask);if(_1bdd.Read&&!_1bdd.Edit){_1bdc=_1bdd.Read;this.set("label",_1bda.view);this.set("iconClass","epi-iconSearch");}else{_1bdc=_1bdd.Edit;}}this.set("canExecute",!!_1bdc);}});});},"epi-cms/project/command/ReadyToPublishProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readytopublishprojectitem","epi-cms/project/command/_ProjectCommand"],function(_1bde,_1bdf,_1be0,_1be1){return _1bde([_1be1],{category:"menuWithSeparator",label:_1be0.label,modelPropertyToWatch:"selectedProjectItems",_execute:function(){return this.model.markProjectItemsAsReadyToPublish();},_setCanExecute:function(){var items=this.model&&this.model.selectedProjectItems,_1be2=_1bdf.versionStatus,_1be3=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&(item.status===_1be2.CheckedOut||item.status===_1be2.Rejected)&&_1bdf.hasAccess(item.accessMask,_1bdf.accessLevel.Edit);});this.set("canExecute",!!_1be3);}});});},"epi-cms/project/command/RemoveProject":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","./RemoveProjectConfirmation","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","./_ProjectCommand"],function(_1be4,lang,on,when,_1be5,res,_1be6){return _1be4([_1be6],{category:"context",label:res.label,iconClass:"epi-iconTrash",_execute:function(){var _1be7=this.model[this.modelPropertyToWatch];this.model.projectService.hasScheduledProjectItems(_1be7.id).then(this._createRemoveProjectConfirmationDialog.bind(this));},_createRemoveProjectConfirmationDialog:function(_1be8){var _1be9=this.model[this.modelPropertyToWatch].status==="delayedpublished",_1bea=new _1be5({isScheduledProject:_1be8&&_1be9});on.once(_1bea,"execute",lang.hitch(this,"_removeProject"));_1bea.show();},_removeProject:function(_1beb){var model=this.model,_1bec=!_1beb&&this.model.reactivateProject(model[this.modelPropertyToWatch].id);when(_1bec).then(function(){return model.removeProject();}).otherwise(function(error){console.error("An error occured while removing the project.",error);});},_setCanExecute:function(){var _1bed=this.model[this.modelPropertyToWatch];this.set("canExecute",!!_1bed&&!_1bed.isDeleted);}});});},"epi-cms/project/command/RemoveProjectConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","epi/i18n!epi/nls/episerver.shared.action","epi/shell/widget/dialog/Confirmation"],function(_1bee,lang,_1bef,_1bf0,_1bf1){return _1bee([_1bf1],{isScheduledProject:false,dialogClass:"epi-dialog-confirm epi-dialog--wide",postMixInProperties:function(){this.inherited(arguments);this.title=this.isScheduledProject?_1bef.scheduledlabel:_1bef.label;this.description=this.isScheduledProject?_1bef.scheduledconfirmation:_1bef.confirmation;},getActions:function(){var _1bf2={name:"keepScheduling",label:this.isScheduledProject?_1bef.deleteandkeepscheduling:_1bf0.deletelabel,action:lang.hitch(this,"onExecute",true)},_1bf3={name:"removeScheduling",label:_1bef.deleteandremovescheduling,action:lang.hitch(this,"onExecute",false)},_1bf4={name:"cancel",label:_1bf0.cancel,action:lang.hitch(this,this.onCancel),settings:{"class":"Salt",firstFocusable:true}};return this.isScheduledProject?[_1bf2,_1bf3,_1bf4]:[_1bf2,_1bf4];}});});},"epi-cms/project/command/RemoveProjectItem":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.removeprojectitem"],function(_1bf5,_1bf6,res){return _1bf5([_1bf6],{category:"itemContext",label:res.label,modelPropertyToWatch:"selectedProjectItems",_execute:function(){return this.model.removeSelectedProjectItems();},_setCanExecute:function(){var self=this,model=this.model,_1bf7=model&&model.selectedProjectItems&&model.selectedProjectItems.length,_1bf8=model.selectedProject;this.set("canExecute",false);this.model.projectService.getCurrentProject().then(function(_1bf9){var _1bfa=_1bf8&&(_1bf8.status==="active"||_1bf8.status==="publishfailed"||_1bf9);self.set("canExecute",!!(_1bf7&&_1bfa));});}});});},"epi-cms/project/command/RemoveProjectScheduling":function(){define(["dojo/_base/declare","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1bfb,_1bfc,res){return _1bfb([_1bfc],{category:"publishmenu",iconClass:"epi-iconClose",label:res.removeschedulingprojectitem.label,postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.removeschedulingproject.label);}},_execute:function(){var model=this.model;return model.reactivateProject(model.selectedProject.id);},_setCanExecute:function(){var _1bfd=this.model.selectedProject,_1bfe;_1bfe=!!_1bfd&&(this.model.isProjectModeEnabled()?_1bfd.itemStatusCount.delayedpublish>0:_1bfd.status==="delayedpublished");this.set("canExecute",_1bfe);this.set("isAvailable",_1bfe);}});});},"epi-cms/project/command/RenameProject":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/project/ProjectDialogContent","epi-cms/project/command/_ProjectCommand","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.renameproject"],function(_1bff,lang,_1c00,_1c01,_1c02,_1c03){return _1bff([_1c01,_1c02],{category:"context",dialogClass:"epi-dialog-landscape",dialogContentClass:_1c00,label:_1c03.label,title:_1c03.label,iconClass:"epi-iconRename",onDialogExecute:function(){var value=lang.mixin(this.value,this.dialogContent.get("value"));this.model.updateProject(value);},_execute:function(){this.showDialog();},_setCanExecute:function(){var _1c04=this.model[this.modelPropertyToWatch];this.set("canExecute",!!_1c04&&!_1c04.isDeleted);this.set("value",lang.clone(_1c04));}});});},"epi-cms/project/command/SortProjectItems":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort","epi/shell/command/OptionCommand"],function(_1c05,_1c06,_1c07){return _1c05([_1c07],{category:"context",label:_1c06.label,options:null,property:"projectItemSortOrder",constructor:function(){this.options=[{label:_1c06.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_1c06.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_1c06.status,key:"+Status",value:[{attribute:"status",descending:false},{attribute:"name",descending:false}]},{label:_1c06.type,key:"+PrimaryTypeIdentifier",value:[{attribute:"primaryTypeIdentifier",descending:false},{attribute:"name",descending:false}]},{label:_1c06.modifieddescending,key:"-Modified",value:[{attribute:"modified",descending:true},{attribute:"name",descending:false}]},{label:_1c06.modifiedascending,key:"+Modified",value:[{attribute:"modified",descending:false},{attribute:"name",descending:false}]}];}});});},"epi-cms/project/command/ScheduleProject":function(){define(["dojo/_base/declare","./_ProjectCommand","../ProjectSchedulingDialog","../ProjectSchedulingDialogViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1c08,_1c09,_1c0a,_1c0b,res){return _1c08([_1c09],{category:"publishmenu",label:res.scheduleprojectitem.label,iconClass:"epi-iconClock",postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.scheduleproject.label);}},_execute:function(){var model=this.model,_1c0c=model.selectedProject,_1c0d=new _1c0b({title:_1c0c.name,query:{projectId:_1c0c.id,scheduled:true}}),_1c0e=new _1c0a({model:_1c0d});_1c0e.on("execute",function(){model.publishProject(_1c0c.id,_1c0d.dateValue);});_1c0e.show();},_setCanExecute:function(){this.set("canExecute",this.model.canPublishProject());this._updateIsAvailable();},_updateIsAvailable:function(){var _1c0f,_1c10=this.model.selectedProject,_1c11=_1c10&&_1c10.status;if(this.model.isProjectModeEnabled()){_1c0f=true;}else{_1c0f=_1c11!=="published"&&_1c11!=="delayedpublished";}this.set("isAvailable",_1c0f);}});});},"epi-cms/project/ProjectSchedulingDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","epi-cms/contentediting/ScheduledPublishSelector","epi/shell/widget/DelayableStandby","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject"],function(_1c12,lang,_1c13,on,_1c14,_1c15,_1c16,res){return _1c12([_1c16],{dialogClass:"epi-dialog-contentReferences",title:res.label,defaultActionsVisible:false,_contentLoaded:null,constructor:function(){this._contentLoaded=new _1c13();},buildRendering:function(){this.inherited(arguments);this.own(this.content=new _1c14({model:this.model}),this._standby=new _1c15({target:document.body,zIndex:999}).placeAt(document.body),on.once(this.content,"contentreferencegrid-loading-complete",this._contentLoaded.resolve));},show:function(){var _1c17=arguments;if(!this._started){this.startup();}this._standby.show();return this._contentLoaded.then(lang.hitch(this,function(){this._standby.hide();return this.inherited(_1c17);}));}});});},"epi-cms/project/ProjectSchedulingDialogViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/dependency","dojo/topic","epi-cms/dgrid/formatters","./ContentReferenceGridModel","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject","epi/i18n!epi/cms/nls/episerver.cms.components.project.contentreferencelist","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_1c18,lang,_1c19,topic,_1c1a,_1c1b,_1c1c,_1c1d,_1c1e,_1c1f,res){return _1c18([_1c1b,_1c1c],{dateLabel:res.publishchangeson,notificationText:res.alreadyscheduleditems,_totalItemsSetter:function(value){this.totalItems=value;if(value){var _1c20=(value===1?_1c1e.itemintotal:_1c1e.itemsintotal);this.set("resultSummary",lang.replace(_1c20,[value]));}},onItemClicked:function(item){topic.publish("/epi/shell/context/request",{uri:item.contentUri});},postscript:function(){this.inherited(arguments);this.store=this.store||_1c19.resolve("epi.storeregistry").get("epi.cms.project.item");this.columns={primaryTypeIdentifier:{label:"",className:"epi-grid-column--snug epi-cursor--default",formatter:_1c1a.contentIcon},name:{label:"",className:"epi-grid--30 epi-cursor--default"},path:{label:"",formatter:_1c1a.path,className:"epi-grid--35 epi-cursor--default"},delayPublishUntil:{label:"",formatter:_1c1a.localizedDate,className:"epi-grid--25 epi-grid-column--centered epi-cursor--default dgrid-column-treePath"},contentUri:{formatter:function(){return "<a class=\"epi-visibleLink\">"+_1c1f.view+"</a>";},className:"dgrid-column-view"}};}});});},"epi-cms/project/ContentReferenceGridModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_1c21,_1c22){return _1c21([_1c22],{onItemClicked:function(item){},resultSummary:"",notificationText:"",store:null,query:null,columns:null,totalItems:null});});},"epi-cms/project/viewmodels/ActivityFeedViewModel":function(){define(["dojo/_base/declare","./_ProjectFeedViewModel"],function(_1c23,_1c24){return _1c23([_1c24],{_contentLink:null,postscript:function(){this.inherited(arguments);this.set("noDataMessage",this.noQueryMessage);},_selectedProjectItemsSetter:function(_1c25){_1c25=_1c25||[];var _1c26=_1c25.filter(function(item){return !!item.contentLink;});var _1c27=_1c25.length===1&&_1c26.length===1;this.set("isSingleItemSelected",_1c27);var _1c28=_1c27?_1c26[0].name:"";this.set("placeholderName",_1c28);this._contentLink=_1c27?_1c26[0].contentLink:null;this.set("noDataMessage",_1c25.length?this.noAccessMessage:this.noQueryMessage);this.set("store",_1c26.length?this.activitiesStore:null);var query={contentReferences:_1c26.map(function(item){return item.contentLink;}),projectId:this.selectedProjectId};this.set("query",_1c26.length?query:null);}});});},"epi-cms/project/viewmodels/_ProjectFeedViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/project/viewmodels/_ActivityViewModel","dojo/Evented"],function(_1c29,lang,_1c2a,_1c2b,_1c2c){return _1c29([_1c2b,_1c2c],{hideOnPost:false,isEditEnabled:false,isSingleItemSelected:false,readOnly:false,selectedProjectId:null,noDataMessage:"",_save:function(_1c2d){var _1c2e=this.activityService.addMessage(this.selectedProjectId,this._contentLink,_1c2d);_1c2e.then(this.emit.bind(this,"save"));return _1c2e;},_placeholderNameSetter:function(_1c2f){this.placeholderName=_1c2f;var _1c30=_1c2f?lang.replace(_1c2a.textareaplaceholder,{name:_1c2f}):"";this.set("placeholderText",_1c30);}});});},"epi-cms/project/viewmodels/_ActivityViewModel":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/regexp","dojo/when","dojox/html/entities","epi/dependency","epi/string","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.notification.autocomplete"],function(_1c31,_1c32,all,_1c33,when,_1c34,_1c35,_1c36,_1c37,_1c38,_1c39,_1c3a){return _1c31([_1c37],{activityService:null,editLabel:_1c39.edit,sendLabel:_1c39.post,resetLabel:_1c39.cancel,errorMessage:"",isEditEnabled:true,readOnly:true,hideOnPost:true,placeholderText:"",noNotificationUserMessage:_1c3a.nodatamessage,notificationUserStore:null,postscript:function(){this.inherited(arguments);this.activityService=this.activityService||_1c35.resolve("epi.cms.ActivityService");this.profile=this.profile||_1c35.resolve("epi.shell.Profile");this.notificationUserStore=this.notificationUserStore||_1c35.resolve("epi.storeregistry").get("epi.cms.notification.users");},save:function(_1c3b){var _1c3c=this._save(_1c3b);_1c3c.otherwise(this._handleError.bind(this));return _1c3c;},_save:function(_1c3d){},_handleError:function(){this.set("errorMessage",_1c38.errormessage);},_isEditEnabledGetter:function(){if(this.message){return (this.author||this.changedBy)===this.profile.userName;}return this.isEditEnabled;},_messageSetter:function(_1c3e){this.message=_1c3e;this._changeAttrValue("formattedMessage",this.get("formattedMessage"));},_formattedMessageGetter:function(){var _1c3f=this.message;var map=_1c34.html;_1c3f=_1c3f&&_1c34.encode(_1c3f,map);_1c3f=_1c3f&&_1c3f.replace(/(\\n)/ig,"");if(!_1c3f||!this.notificationUserStore){return new _1c32().resolve(_1c36.toHTML(_1c3f));}var regex=/\B@([^\s":;|=,+*?<>[\]\/\\]+)/g,_1c40=_1c3f.match(regex)||[],_1c41={},_1c42=_1c40.map(function(match){var _1c43=match.replace(/^@/,""),_1c44=encodeURIComponent(_1c43);return when(this.notificationUserStore.get(_1c44)).then(function(user){_1c41[_1c43]=user.displayName;}).otherwise(function(){});}.bind(this));return all(_1c42).then(function(){_1c3f=_1c3f.replace(regex,function(match,key){return _1c41[key]?"<strong>"+_1c36.encodeForWebString(_1c41[key])+"</strong>":match;});return _1c36.toHTML(_1c3f);});}});});},"epi-cms/project/viewmodels/ProjectCommentViewModel":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.activities.commentfeed","./_ProjectFeedViewModel"],function(_1c45,_1c46,_1c47){return _1c45([_1c47],{isSingleItemSelected:true,noDataMessage:_1c46.nodatamessage,_selectedProjectIdSetter:function(_1c48){this.selectedProjectId=_1c48;this.set("store",_1c48?this.activitiesStore:null);this.set("query",{projectId:_1c48,activityType:"ProjectMessageActivity"});}});});},"url:epi-cms/project/templates/Overview.html":"<div class=\"epi-project-overview\">\n    <div data-dojo-attach-point=\"toolbar\" class=\"epi-project-overview__toolbar epi-viewHeaderContainer epi-editToolbarMedium\">\n        <h2 class=\"dijitInline\">\n            <div class=\"dijitInline epi-iconObjectProject epi-icon--large\"></div>\n            <span data-dojo-attach-point=\"projectNameNode\"></span>\n        </h2>\n        <div class=\"epi-project-overview__toolbar__trailing\">\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\n                 data-dojo-attach-point=\"publishContainer\"\n                 data-dojo-props=\"showLabel: true, label: this.res.overview.publishdropdown.label\"\n                 data-dojo-attach-event=\"onClick:_publishMenuClickHandler\"\n                 class=\"epi-mediumButton epi-button--bold\">\n                <span></span>\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\n                     data-dojo-attach-point=\"publishMenu\"\n                     data-dojo-props=\"commandSource: this.model\">\n                    <section data-epi-section=\"primarySection\">\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\n                    </section>\n                    <section data-epi-section=\"statusSection\">\n                        <ul>\n                            <li>\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\n                            </li>\n                        </ul>\n                    </section>\n                </div>\n            </div>\n            <button data-dojo-type=\"dijit/form/Button\"\n                    data-dojo-attach-point=\"closeButton\"\n                    data-dojo-attach-event=\"onClick:_close\"\n                    data-dojo-props=\"showLabel: true, label: this.res.overview.closebutton.label\"\n                    class=\"epi-mediumButton epi-button--bold\"></button>\n        </div>\n    </div>\n\n    <div data-dojo-attach-point=\"tabs\" data-dojo-type=\"dijit/layout/TabContainer\">\n        <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\n             data-dojo-attach-point=\"itemList\"\n             data-dojo-props=\"title: this.res.overview.title, commandSource: this.model, res: this.res.overview\">\n\n                <section data-epi-section=\"toolbarSection\">\n                    <div data-dojo-attach-point=\"toolbarTextNode\" class=\"epi-project-item-list__item-count-message-node\"></div>\n                    <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n                </section>\n                <section data-epi-section=\"activitySection\">\n                    <div data-dojo-type=\"epi-cms/project/ActivityFeed\"\n                         data-dojo-attach-point=\"activityFeed\"\n                         data-dojo-props=\"model: this.model.activityFeedModel\"></div>\n                </section>\n        </div>\n\n        <div data-dojo-type=\"epi-cms/project/ActivityFeed\"\n             data-dojo-attach-point=\"projectComments\"\n             data-dojo-props=\"title: this.res.comments.title, model: this.model.projectCommentFeedModel\"\n             class=\"epi-project-comment-feed\">\n            <div data-dojo-type=\"dijit/Toolbar\"\n                 data-dojo-attach-point=\"projectCommentsToolbar\"\n                 class=\"epi-project-item-list__toolbar epi-flatToolbar\">\n            </div>\n         </div>\n    </div>\n</div>\n","epi-cms/project/ActivityFeed":function(){define(["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/focus","dijit/registry","dgrid/util/misc","epi/dependency","dijit/_WidgetBase","dijit/_CssStateMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","epi-cms/project/Activity","epi-cms/project/ActivityCommentForm"],function(_1c49,_1c4a,_1c4b,_1c4c,_1c4d,_1c4e,_1c4f,misc,_1c50,_1c51,_1c52,_1c53,_1c54,_1c55,_1c56,_1c57,_1c58){var _1c59=_1c49([_1c55,_1c56]);return _1c49([_1c51,_1c52,_1c53,_1c54],{baseClass:"epi-activity-feed",noDataMessage:"",query:null,queryOptions:null,modelBindingMap:{isSingleItemSelected:["isSingleItemSelected"],query:["query"],noDataMessage:["noDataMessage"]},postMixInProperties:function(){this.inherited(arguments);this.activityService=this.activityService||_1c50.resolve("epi.cms.ActivityService");this.queryOptions=this.queryOptions||{sort:[{attribute:"created",descending:true}]};},buildRendering:function(){this.inherited(arguments);this.commentForm=new _1c58({model:this.model});_1c4b.add(this.commentForm.domNode,"epi-card");this.list=new _1c59({className:"dgrid--centered-no-data-message",cleanEmptyObservers:false,insertRow:this._insertRow,removeRow:this._removeRow,renderRow:this._renderRow.bind(this),keepScrollPosition:true});this.list.bodyNode.tabIndex=0;this.own(this.commentForm,this.model.on("save",this.focus.bind(this)),_1c4a.around(this.list,"resize",this._resizeList.bind(this)));this.commentForm.placeAt(this.list.bodyNode,"first");this.domNode.appendChild(this.list.domNode);this.list.resize();},startup:function(){this.inherited(arguments);this.commentForm.startup();this.list.startup();},focus:function(){_1c4e.focus(this.list.bodyNode);},refresh:function(){this.list.refresh();},_insertRow:function(){var row=this.inherited(arguments),_1c5a=_1c4f.byNode(row);_1c5a.startup();return row;},_removeRow:function(_1c5b,_1c5c){this.inherited(arguments);var _1c5d=_1c5b.element||_1c5b,_1c5e=_1c4f.byNode(_1c5d);if(_1c5e){_1c5e.destroy(_1c5c);}},_renderRow:function(value){var _1c5f=new _1c57({activity:value});_1c4b.add(_1c5f.domNode,"epi-card");return _1c5f.domNode;},_resizeList:function(_1c60){return function(){_1c60.apply(this.list,arguments);var _1c61=this.model.isSingleItemSelected?_1c4c.getMarginBox(this.commentForm.domNode).h:0;_1c4d.set(this.list.contentNode,"height","calc(100% - "+_1c61+"px)");}.bind(this);},_setNoDataMessageAttr:function(_1c62){this.noDataMessage=_1c62;this.list.set("noDataMessage",_1c62);},_setQueryAttr:function(query){this._set("query",query);if(!this._queryFunction){this._queryFunction=misc.debounce(this._setQueryCallback.bind(this),null,200);}this._queryFunction(this.model.store,query);},_setQueryCallback:function(store,query){if(this._destroyed){return;}var _1c63=this.model.isSingleItemSelected;_1c4b.toggle(this.domNode,"epi-activity-feed--single-item",_1c63);_1c4b.toggle(this.commentForm.domNode,"dijitHidden",!_1c63);this.list.set("store",store,query,this.queryOptions);this.list.resize();}});});},"epi-cms/project/Activity":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/datetime","epi/shell/TypeDescriptorManager","epi/username","epi-cms/ApplicationSettings","./ActivityComment","./viewmodels/ActivityViewModel","./viewmodels/ActivityCommentViewModel","./viewmodels/MessageActivityViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/Activity.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/project/ActivityCommentForm"],function(_1c64,lang,_1c65,_1c66,_1c67,_1c68,_1c69,_1c6a,_1c6b,_1c6c,_1c6d,_1c6e,_1c6f,_1c70,_1c71,_1c72,_1c73){return _1c64([_1c6e,_1c6f,_1c70,_1c71],{templateString:_1c72,model:null,modelBindingMap:{upsertActivityComment:["upsertActivityComment"]},buildRendering:function(){this.inherited(arguments);var _1c74=this.activity;var model=new _1c6b({id:_1c74.id,hasMessage:!!_1c74.message,upsertActivityComment:null});this.commentForm.set("model",model);this.set("model",model);var title=_1c74.name;var _1c75=_1c74.language;if(_1c75&&_1c75!==_1c69.currentContentLanguage){title=lang.replace("{0} ({1})",[title,_1c75]);}this.titleNode.textContent=title;var _1c76=_1c67.getValue(_1c74.typeIdentifier,"iconClass");_1c65.add(this.iconNode,_1c76||"epi-iconProject");var _1c77=lang.replace("epi-icon{0} epi-icon--{1}",[_1c74.actionIcon,_1c74.actionColor]);_1c65.add(this.actionIconNode,_1c77);_1c65.add(this.actionNode,"epi-event--"+_1c74.actionColor);var _1c78=_1c74.delayPublishUntil?_1c73.delaypublishmessagetemplate:_1c73.messagetemplate;this.actionTextNode.textContent=lang.replace(_1c78,{event:_1c74.actionText,delaypublish:_1c66.toUserFriendlyString(_1c74.delayPublishUntil),user:_1c68.toUserFriendlyString(_1c74.changedBy),date:_1c66.toUserFriendlyString(_1c74.created)});if(_1c74.message){_1c65.add(this.domNode,"epi-activity__message");this.own(this._messageForm=new _1c6a({model:new _1c6d(_1c74)},this.messageNode));}if(_1c74.comments){_1c74.comments.forEach(function(_1c79){this.set("upsertActivityComment",_1c79);},this);}},startup:function(){this.inherited(arguments);this._messageForm&&this._messageForm.startup();},_getActivityCommentComponent:function(_1c7a){var index=-1;var _1c7b=null;var _1c7c=this.getChildren()||[];for(var i=0;i<_1c7c.length;i++){index=i;var _1c7d=_1c7c[i];if(_1c7d.get("model").id===_1c7a){_1c7b=_1c7d;break;}}return {position:(_1c7b!==null?index:-1),activityComment:_1c7b};},_setUpsertActivityCommentAttr:function(_1c7e){if(!_1c7e){return;}var _1c7f=this._getActivityCommentComponent(_1c7e.id);var _1c80=_1c7f.activityComment;var _1c81=(_1c7f.position===-1?this.getChildren().length:_1c7f.position);if(_1c80){var _1c82=new Date(_1c80.get("model").lastUpdated).getTime();var _1c83=new Date(_1c7e.lastUpdated).getTime();if(_1c82===_1c83){return;}this.removeChild(_1c80);_1c80.destroyRecursive();}var _1c84=new _1c6a({model:new _1c6c(_1c7e)});this.addChild(_1c84,_1c81);}});});},"epi-cms/project/ActivityComment":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityComment.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity.message","./ActivityCommentForm","dijit/form/Button"],function(_1c85,lang,_1c86,_1c87,_1c88,_1c89,_1c8a,_1c8b,_1c8c,_1c8d,_1c8e){return _1c85([_1c89,_1c8a,_1c8b,_1c8c],{templateString:_1c8d,modelBindingMap:{hasChanged:["hasChanged"]},_setHasChangedAttr:function(_1c8f){this._set("hasChanged",_1c8f);var _1c90=lang.replace(_1c8e.editedformat,{updated:_1c87.toUserFriendlyString(this.model.lastUpdated)});this.editedIconNode.title=_1c90;_1c86.toggle(this.editedIconNode,"dijitHidden",!_1c8f);},buildRendering:function(){this.inherited(arguments);var user=this.model.changedBy||this.model.author;this.usernameNode.textContent=_1c88.toUserFriendlyString(user,null,false,false,true);this.timestampNode.textContent=_1c87.toUserFriendlyString(this.model.created);}});});},"url:epi-cms/project/templates/ActivityComment.html":"<div class=\"epi-activity-comment\">\n    <header>\n        <span class=\"dijitReset dijitInline epi-username\" data-dojo-attach-point=\"usernameNode\"></span>\n        <span class=\"dijitReset dijitInline epi-event__timestamp\" data-dojo-attach-point=\"timestampNode\"></span>\n        <span class=\"dijitReset dijitInline epi-iconEdited\" data-dojo-attach-point=\"editedIconNode\"></span>\n    </header>\n    <div data-dojo-type=\"epi-cms/project/ActivityCommentForm\"\n         data-dojo-props=\"model: this.model\"\n         data-dojo-attach-point=\"commentForm\"></div>\n</div>\n","epi-cms/project/ActivityCommentForm":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_FocusMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityCommentForm.html","epi/shell/widget/AutoCompleteTextarea","dijit/form/Button"],function(_1c91,_1c92,_1c93,_1c94,_1c95,_1c96,_1c97,_1c98){return _1c91([_1c93,_1c94,_1c95,_1c96,_1c97],{templateString:_1c98,readOnly:null,hideOnPost:null,isEditEnabled:true,errorMessage:"",modelBindingMap:{readOnly:["readOnly"],editLabel:["editLabel"],isEditEnabled:["isEditEnabled"],hideOnPost:["hideOnPost"],errorMessage:["errorMessage"],placeholderText:["placeholder"],sendLabel:["sendLabel"],resetLabel:["resetLabel"],message:["value"],formattedMessage:["displayValue"],noNotificationUserMessage:["noNotificationUserMessage"],notificationUserStore:["notificationUserStore"]},postCreate:function(){this.inherited(arguments);this._commentChanged(this.get("value"));this._commentTextarea.on("save",this._postComment.bind(this));},_setModelAttr:function(model){this.inherited(arguments);this._toggleFormsButtonVisibility(!model.readOnly&&this.get("value")!=="");},_setErrorMessageAttr:function(_1c99){this._set("errorMessage",_1c99);this._errorMessage.textContent=_1c99;},_setSendLabelAttr:function(_1c9a){this._set("sendLabel",_1c9a);if(_1c9a){this._postButton.set("label",_1c9a);}},_setResetLabelAttr:function(_1c9b){this._set("resetLabel",_1c9b);if(_1c9b){this._resetButton.set("label",_1c9b);}},_setEditLabelAttr:function(_1c9c){this._set("editLabel",_1c9c);if(_1c9c){this._editButton.set("label",_1c9c);}},_setIsEditEnabledAttr:function(_1c9d){this._set("isEditEnabled",_1c9d);if(this._editButton){_1c92.toggle(this._editButton.domNode,"dijitHidden",!this.isEditEnabled);}},_setNoNotificationUserMessageAttr:function(_1c9e){this._commentTextarea.set("noDataMessage",_1c9e);},_setNotificationUserStoreAttr:function(store){this._set("notificationUserStore",store);this._commentTextarea.set("store",store);},_setPlaceholderAttr:function(_1c9f){this._commentTextarea.set("placeholder",_1c9f);},_setReadOnlyAttr:function(_1ca0){this._set("readOnly",_1ca0);_1c92.toggle(this._commentTextarea.domNode,"dijitHidden",this.readOnly);if(this.readOnly){this._toggleFormsButtonVisibility(false);}},_setValueAttr:function(value){this._set("value",value);this._commentTextarea.set("value",value);},_setDisplayValueAttr:function(_1ca1){_1ca1.then(function(value){this.commentNode.innerHTML=value;}.bind(this));},_getValueAttr:function(){return this._commentTextarea.get("value");},_commentChanged:function(_1ca2){this._started&&this._postButton.set("disabled",!_1ca2||_1ca2===this.model.message);},_commentFocused:function(){this._toggleFormsButtonVisibility(true);},_reset:function(){if(this._destroyed){return;}this.hideOnPost&&this._toggleWriteComment();this.model.set("errorMessage","");this._commentTextarea.reset();this._toggleFormsButtonVisibility(false);},_postComment:function(){var value=this._commentTextarea.get("value");if(value.trim().length===0){return;}if(value===this.model.message||this._postButton.get("disabled")){this._reset();return;}this._postButton.set("disabled",true);var delay=10;this.defer(function(){_1c92.add(this._postButton.domNode,"epi-button--loading");}.bind(this),delay);this.model.save(value).then(this._reset.bind(this)).always(function(){if(!this._destroyed){this._postButton.set("disabled",false);_1c92.remove(this._postButton.domNode,"epi-button--loading");}}.bind(this));},_toggleWriteComment:function(){_1c92.toggle(this._commentTextarea.domNode,"dijitHidden");_1c92.toggle(this._editButton.domNode,"dijitHidden");_1c92.toggle(this.commentNode,"dijitHidden");if(this._commentTextarea.isFocusable()){this._commentTextarea.focus();this._commentTextarea.setCaretLast();}if(this._editButton.isFocusable()){this._editButton.focus();}},_toggleFormsButtonVisibility:function(_1ca3){_1c92.toggle(this._commentFormButtons,"dijitHidden",!_1ca3);}});});},"url:epi-cms/project/templates/ActivityCommentForm.html":"<div class=\"epi-activity-comment-form\">\n    <div class=\"epi-activity-comment__message\"\n         data-dojo-attach-point=\"commentNode\"></div>\n    <div data-dojo-attach-point=\"_commentTextarea, focusNode\"\n         data-dojo-attach-event=\"onChange:_commentChanged, onFocus: _commentFocused\"\n         data-dojo-props=\"intermediateChanges: true, tagProperty: 'userName', displayProperty: 'displayName'\"\n         data-dojo-type=\"epi/shell/widget/AutoCompleteTextarea\" class=\"epi-autocomplete-textarea--chat-icon\"></div>\n    <div class=\"epi-activity-comment-form__buttons dijitHidden\"\n         data-dojo-attach-point=\"_commentFormButtons\">\n        <span class=\"epi-activity-feed__error-message\"\n              data-dojo-attach-point=\"_errorMessage\"></span>\n        <button data-dojo-type=\"dijit/form/Button\"\n                class=\"epi-primary\"\n                data-dojo-attach-event=\"onClick:_postComment\"\n                data-dojo-props=\"disabled: true\"\n                data-dojo-attach-point=\"_postButton\"></button>\n        <button data-dojo-type=\"dijit/form/Button\"\n                class=\"epi-chromeless epi-chromeless--text-only\"\n                data-dojo-attach-point=\"_resetButton\"\n                data-dojo-attach-event=\"onClick: _reset\"></button>\n    </div>\n    <button data-dojo-type=\"dijit/form/Button\"\n            class=\"epi-chromeless epi-chromeless--text-only epi-text--small\"\n            data-dojo-attach-point=\"_editButton\"\n            data-dojo-attach-event=\"onClick: _toggleWriteComment\"></button>\n</div>\n","epi/shell/widget/AutoCompleteTextarea":function(){define("epi/shell/widget/AutoCompleteTextarea",["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-style","dojo/dom-geometry","dijit/form/_FormValueWidget","dijit/_WidgetsInTemplateMixin","dijit/form/_TextBoxMixin","dgrid/OnDemandList","dgrid/Selection","dgrid/util/misc","put-selector/put","dijit/popup","epi/shell/dgrid/selection/Extensions","dijit/form/Textarea"],function(_1ca4,lang,keys,_1ca5,_1ca6,_1ca7,_1ca8,_1ca9,_1caa,_1cab,misc,put,popup,_1cac){var _1cad=_1ca4([_1caa,_1cab,_1cac]);return _1ca4([_1ca7,_1ca8],{templateString:"<div><div data-dojo-type='dijit/form/Textarea' data-dojo-attach-point='_textArea, focusNode'></div><div data-dojo-attach-point='_listNode'></div></div>",baseClass:"epi-autocomplete-textarea",value:null,store:null,placeholder:"",tagProperty:"",displayProperty:"",noDataMessage:"",_setIdAttr:"domNode",buildRendering:function(){this.inherited(arguments);var _1cae=this._textArea;this.own(_1cae.on("keyup",lang.hitch(this,"_onKeyUp")),_1cae.on("keydown",lang.hitch(this,"_onKeyDown")),_1cae.on("change",lang.hitch(this,"_handleOnChange")),this.on("blur",this._closePopup.bind(this)),this._selectList=new _1cad({className:"epi-autocomplete-list",selectionMode:"single",renderRow:this._renderRow.bind(this)},this._listNode),this._selectList.on(".dgrid-row:click",this._insertSelection.bind(this)),this._selectList.on("dgrid-refresh-complete",lang.hitch(this._selectList,"moveSelectionDown")));popup.moveOffScreen(this._selectList);},startup:function(){this.inherited(arguments);this._selectList.startup();},focus:function(){if(this.isFocusable()){this.inherited(arguments);}},setCaretLast:function(){if(this._textArea.value){_1ca9.selectInputText(this._textArea.domNode,this._textArea.value.length);}},reset:function(){this._textArea.reset();},_setIntermediateChangesAttr:function(_1caf){this._set("intermediateChanges",_1caf);this._textArea.set("intermediateChanges",_1caf);},_setNoDataMessageAttr:function(_1cb0){this._selectList.set("noDataMessage",_1cb0);},_setPlaceholderAttr:function(_1cb1){this._set("placeholder",_1cb1);this._textArea.set("placeholder",_1cb1);},_setValueAttr:function(value){this._set("value",value);this._textArea.set({value:value,_resetValue:value});},_getValueAttr:function(){return this._textArea.get("value");},_onKeyUp:function(e){if(!this.store){return;}var key=e.keyCode;switch(key){case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.HOME:case keys.END:case keys.UP_ARROW:case keys.DOWN_ARROW:case keys.CTRL:case keys.ALT:case keys.SHIFT:return;}var _1cb2=this._textArea.textbox,_1cb3=_1cb2.selectionStart,value=_1cb2.value;if(value[_1cb3-1]==="@"&&(_1cb3===1||/\s/.test(value[_1cb3-2]))){this._tagStart=_1cb3-1;this._openPopup();}if(this._isPopupOpen){var _1cb4=key===keys.ESCAPE,_1cb5=typeof this._tagStart=="number"&&value[this._tagStart]!=="@";if(_1cb4||_1cb5){this._closePopup();return;}if(key===keys.ENTER||key===keys.TAB){this._insertSelection();return;}this._tagEnd=_1cb3;var query=value.substring(this._tagStart+1,_1cb3);this._setQuery(query);}},_setQuery:function(query){query=(query||"").trim();if(!query){return;}if(!this._queryFunction){var _1cb6=function(query){this._selectList.set("store",this.store,query);};this._queryFunction=misc.debounce(_1cb6.bind(this),null,200);}this._queryFunction({query:query});},_onKeyDown:function(e){var _1cb7=this._selectList,key=e.keyCode;if(this._isPopupOpen){switch(key){case keys.UP_ARROW:e.preventDefault();_1cb7.moveSelectionUp();break;case keys.DOWN_ARROW:e.preventDefault();_1cb7.moveSelectionDown();break;case keys.ESCAPE:case keys.ENTER:case keys.TAB:e.preventDefault();break;}return;}if(key===keys.ENTER&&!e.shiftKey){this.emit("save");e.preventDefault();}},_insertSelection:function(){var _1cb8=this._textArea.textbox,_1cb9=this._selectList,_1cba=this._tagEnd,value=_1cb8.value;var _1cbb=null;for(var id in _1cb9.selection){if(_1cb9.selection[id]){_1cbb=_1cb9.row(id).data;break;}}if(!_1cbb){this._closePopup();return;}var _1cbc=_1cbb[this.tagProperty];var _1cbd="";var _1cbe=0;(value.charAt(_1cba)!==" "?_1cbd=" ":_1cbe=1);var _1cbf=value.slice(0,this._tagStart+1)+_1cbc+_1cbd;var _1cc0=_1cbf.length+_1cbe;_1cbf+=value.slice(_1cba);_1cb8.value=_1cbf;_1cb8.setSelectionRange(_1cc0,_1cc0);this._closePopup();},_renderRow:function(item){return put("div",""+item[this.displayProperty]);},_openPopup:function(){var _1cc1=this._selectList,_1cc2=_1ca6.getContentBox(this.domNode),_1cc3=this._closePopup.bind(this);_1ca5.set(_1cc1.domNode,"width",_1cc2.w+"px");popup.open({parent:this,popup:_1cc1,around:this.domNode,onExecute:_1cc3,onCancel:_1cc3});this._isPopupOpen=true;},_closePopup:function(){this._isPopupOpen=false;this._tagStart=null;this._tagEnd=null;this._selectList.set("store",null);popup.close(this._selectList);}});});},"epi-cms/project/viewmodels/ActivityViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/Destroyable","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.cms.activities.activity.message"],function(_1cc4,lang,_1cc5,_1cc6,_1cc7){return _1cc4([_1cc6,_1cc5],{hasMessage:false,postscript:function(){this.inherited(arguments);this.own(this.activityService.on("activity-comment-updated",lang.hitch(this,this._activityCommentUpdated)));},_editLabelGetter:function(){return this.hasMessage?_1cc7.reply.label:_1cc7.comment.label;},_save:function(_1cc8){return this.activityService.addComment(this.id,_1cc8);},_activityCommentUpdated:function(_1cc9){if(_1cc9&&_1cc9.activityId===this.id){this.set("upsertActivityComment",_1cc9);}}});});},"epi-cms/project/viewmodels/ActivityCommentViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1cca,_1ccb,_1ccc){return _1cca([_1ccb],{sendLabel:_1ccc.save,_save:function(_1ccd){var _1cce=this.activityService.saveComment(this.id,_1ccd);_1cce.then(this.set.bind(this));return _1cce;}});});},"epi-cms/project/viewmodels/MessageActivityViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1ccf,_1cd0,_1cd1){return _1ccf([_1cd0],{sendLabel:_1cd1.save,_save:function(_1cd2){return this.activityService.saveMessage(this.id,_1cd2);}});});},"url:epi-cms/project/templates/Activity.html":"<div class=\"epi-event epi-activity\">\n    <div class=\"epi-event__title-wrapper\">\n        <span class=\"dijitInline\" data-dojo-attach-point=\"iconNode\"></span>\n        <span class=\"epi-event__title\" data-dojo-attach-point=\"titleNode\"></span>\n    </div>\n    <div class=\"epi-event__status\" data-dojo-attach-point=\"actionNode\">\n        <span class=\"dijitInline epi-event__status__icon\">\n            <span data-dojo-attach-point=\"actionIconNode\"></span>\n        </span><span class=\"epi-event__status__message\" data-dojo-attach-point=\"actionTextNode\"></span>\n    </div><div data-dojo-attach-point=\"messageNode\"></div\n    ><div class=\"epi-activity__comments\" data-dojo-attach-point=\"containerNode\"></div>\n    <div data-dojo-type=\"epi-cms/project/ActivityCommentForm\" data-dojo-attach-point=\"commentForm\"></div>\n</div>\n","epi-cms/project/ProjectItemList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-class","dojo/keys","dojo/on","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/_CssStateMixin","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dgrid/extensions/DijitRegistry","epi","epi/shell/dnd/Target","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi/shell/dgrid/Responsive","epi/shell/widget/_FocusableMixin","epi/shell/widget/_SectionedTemplatedMixin","epi-cms/extension/events","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/WithContextMenu","epi/i18n!epi/cms/nls/episerver.cms.components.project","dojo/text!./templates/ProjectItemList.html"],function(_1cd3,lang,_1cd4,_1cd5,_1cd6,keys,on,_1cd7,_1cd8,_1cd9,_1cda,_1cdb,_1cdc,_1cdd,epi,_1cde,_1cdf,_1ce0,_1ce1,_1ce2,_1ce3,_1ce4,_1ce5,_1ce6,res,_1ce7){return _1cd3([_1cd8,_1ce3,_1cd7,_1cd9,_1ce2],{contentLanguage:null,commandProvider:null,dndEnabled:false,sections:["toolbarSection","listContainer","activitySection"],templateString:_1ce7,listItemType:"card",res:res,_listClass:_1cd3([_1cdb,_1ce0,_1cdc,_1cda,_1ce6,_1cdd,_1cdf,_1ce1]),_list:null,_noDataMessageWrapper:"<span class=\"dgrid-no-data__content\">{0}</span>",buildRendering:function(){this.inherited(arguments);this._setupList();},focus:function(){if(this._list){this._list.focus();}},layout:function(){var _1ce8,size;if(!this._contentBox){return;}_1ce8=_1cd5.getMarginBox(this.toolbar.domNode).h+_1cd5.getMarginBox(this.notificationBarNode).h;size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1ce8});_1cd5.setMarginBox(this.listContainer,size);this._list.resize();},clearSelection:function(){this._list.clearSelection();this.emit("selection-changed",{items:[]});},refresh:function(){this._list.refresh({keepScrollPosition:true});},setSelection:function(_1ce9){this.selectItems(_1ce9);this.emit("selection-changed",{items:_1ce9});},selectItems:function(_1cea){this._list.clearSelection();_1cea.forEach(function(item){this._list.select(item);},this);},toggleActivities:function(_1ceb){_1cd6.toggle(this.domNode,"epi-project-item-list--activities-visible",_1ceb);},updateQuery:function(store,query){var _1cec=!query&&this.res.noquery?this.res.noquery:this.res.nodata,_1ced=lang.replace(this._noDataMessageWrapper,[_1cec]);this._list.set("noDataMessage",_1ced);if(this._list.store!==store||!epi.areEqual(this._list.query,query)){this._list.set("store",store,query);}},_setupList:function(){var list,_1cee;_1ce5.contentLanguage=this.contentLanguage;list=new this._listClass({formatters:_1ce5[this.listItemType],cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,farOffRemoval:Infinity,refocusOnRefresh:true,responsiveMap:{"epi-card-list--narrow":570}},this.itemListNode);list.contextMenu.addProvider(this.commandSource);this.own(this._list=list,list.on("dgrid-cellfocusin, .dgrid-content:click",lang.hitch(this,function(evt){if(evt.target===list.contentNode){this.clearSelection();}var items=this._getSelectedItems(list);this.emit("selection-changed",{items:items});})),list.on("dgrid-select, dgrid-deselect",lang.hitch(this,function(evt){var items=this._getSelectedItems(list);this.emit("active-items-changed",{items:items});})),list.on(".dgrid-row:dblclick",lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.addKeyHandler(keys.ENTER,lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.on(on.selector(".dgrid-row",_1ce4.keys.del),lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemremove",{item:item});})),_1cee=new _1cde(this.overlayNode,{createItemOnDrop:false,accept:["episerver.core.icontentdata.reference"]}),_1cd4.after(_1cee,"onDropData",lang.hitch(this,this._onDropData),true));},_getSelectedItems:function(list){var items=[];Object.keys(list.selection).forEach(function(key){if(list.selection[key]){var item=list.row(key).data;items.push(item);}});return items;},_onDropData:function(_1cef){var items=_1cef.map(function(item){return item.data;});this.emit("itemsdropped",{items:items});},_setDndEnabledAttr:function(value){this._set("dndEnabled",value);_1cd6.toggle(this.overlayNode,"dijitHidden",!value);},_setNotificationMessageAttr:function(value){this.notificationTextNode.textContent=value;_1cd6.toggle(this.notificationBarNode,"dijitHidden",!value);this.layout();},_setSortOrderAttr:function(value){if(this._list.get("sort")!==value){this._list.set("sort",value);}},_setContentLanguageAttr:function(value){this._set("contentLanguage",value);_1ce5.contentLanguage=value;}});});},"epi/shell/dgrid/Responsive":function(){define("epi/shell/dgrid/Responsive",["dojo/_base/declare","dojo/dom-class","dojo/dom-geometry"],function(_1cf0,_1cf1,_1cf2){return _1cf0([],{currentResponsiveClass:"",responsiveMap:null,resize:function(){this.inherited(arguments);var _1cf3=Infinity,_1cf4=_1cf2.getContentBox(this.domNode).w,_1cf5="",_1cf6=this.responsiveMap;if(_1cf6){Object.keys(_1cf6).forEach(function(key){var _1cf7=_1cf6[key];if(_1cf4<=_1cf7&&_1cf7<_1cf3){_1cf3=_1cf7;_1cf5=key;}});_1cf1.replace(this.domNode,_1cf5,this.currentResponsiveClass);this.currentResponsiveClass=_1cf5;}}});});},"epi/shell/widget/_SectionedTemplatedMixin":function(){define("epi/shell/widget/_SectionedTemplatedMixin",["dojo/_base/declare","dojo/query","dojo/string","dijit/_TemplatedMixin"],function(_1cf8,query,_1cf9,_1cfa){return _1cf8([_1cfa],{sections:[],_fillContent:function(_1cfb){this.sections.forEach(function(_1cfc){var _1cfd=this[_1cfc],_1cfe=query(_1cf9.substitute("[data-epi-section=${0}]",[_1cfc]),_1cfb);_1cfe.forEach(function(_1cff){while(_1cff.childNodes.length>0){_1cfd.appendChild(_1cff.childNodes[0]);}});},this);}});});},"url:epi-cms/project/templates/ProjectItemList.html":"<div class=\"epi-project-item-list\">\n    <div data-dojo-type=\"dijit/Toolbar\"\n         data-dojo-attach-point=\"toolbar\"\n         class=\"epi-project-item-list__toolbar epi-flatToolbar\">\n        <span data-dojo-attach-point=\"toolbarSection\"></span>\n    </div>\n    <div data-dojo-attach-point=\"listContainer\" class=\"epi-project-item-list__container\">\n        <div data-dojo-attach-point=\"notificationBarNode\" class=\"epi-notificationBar dijitHidden\">\n            <div class=\"epi-notificationBarItem\">\n                <div class=\"epi-notificationBarText\">\n                    <p data-dojo-attach-point=\"notificationTextNode\"></p>\n                </div>\n            </div>\n        </div>\n        <div data-dojo-attach-point=\"overlayNode\"\n             class=\"epi-project-item-list__dnd-area epi-visible-dnd-area epi-project-list-area__dnd-area--empty-list dijitHidden\">\n            <span class=\"epi-project-item-list__dnd-area-content\">${res.droptoadditems}</span>\n        </div>\n        <div data-dojo-attach-point=\"itemListNode\"\n             class=\"epi-card-list dgrid--centered-no-data-message\"></div\n        ><div data-dojo-attach-point=\"activitySection\"\n              class=\"epi-activity-section\"></div>\n    </div>\n</div>\n","epi-cms/project/PublishMenu":function(){define(["dojo/_base/declare","dojo/on","dijit/DropDownMenu","dijit/registry","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/widget/_SectionedTemplatedMixin","./command/PublishMenuButtonBuilder","dojo/text!./templates/PublishMenu.html"],function(_1d00,on,_1d01,_1d02,_1d03,_1d04,_1d05,_1d06,_1d07){return _1d00([_1d01,_1d05],{sections:["primarySection","statusSection"],templateString:_1d07,buildRendering:function(){this.inherited(arguments);var _1d08=[{builder:new _1d06({settings:{"class":"epi-button--bold epi-button--full-width epi-success",isExecutingClass:"epi-loading"},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),category:"publishmenu-primary",target:this.publishMenuNode},{builder:new _1d04(),category:"publishmenu",target:this.projectActionMenu}];this.own(this._menuAssembler=new _1d03({configuration:_1d08}));this.own(on(this.domNode,"beforeFocusedButtonRemoved",this.domNode.focus));},childSelector:function(node){var _1d09=_1d02.byNode(node);return _1d09&&_1d09.focus&&(node.parentNode===this.projectActionMenu);},getChildren:function(){return [].concat(_1d02.findWidgets(this.publishMenuNode),_1d02.findWidgets(this.projectActionMenu));},_setCommandSourceAttr:function(_1d0a){this._menuAssembler.set("commandSource",_1d0a);},_getCommandSourceAttr:function(){return this._menuAssembler.get("commandSource");}});});},"epi-cms/project/command/PublishMenuButtonBuilder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/form/Button","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/builder/ButtonBuilder"],function(_1d0b,lang,on,_1d0c,_1d0d,_1d0e){return _1d0b([_1d0e],{_buttonClass:_1d0b([_1d0c,_1d0d],{_setSelected:function(){},_setIsAvailableAttr:function(_1d0f){if(!_1d0f&&this.get("focused")){on.emit(this.domNode,"beforeFocusedButtonRemoved",{bubbles:true});}this.inherited(arguments);}})});});},"url:epi-cms/project/templates/PublishMenu.html":"<div tabIndex=\"${tabIndex}\" role=\"menu\" class=\"epi-invertedTooltip epi-publishActionMenu\" data-dojo-attach-point=\"containerNode\" data-dojo-attach-event=\"onkeypress:_onKeyPress\">\n    <div class=\"epi-tooltipDialogTop\">\n        <ul>\n            <li data-dojo-attach-point=\"primarySection\" class=\"epi-projectStatusMessage\"></li>\n            <li data-dojo-attach-point=\"publishMenuNode\"></li>\n        </ul>\n        <div class=\"dijitTooltipConnector\"></div>\n    </div>\n    <div data-dojo-attach-point=\"statusSection\" class=\"epi-tooltipDialogInfo\"></div>\n    <table class=\"epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\n        <tbody data-dojo-attach-point=\"projectActionMenu\"></tbody>\n    </table>\n</div>","epi-cms/project/ProjectComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectComponentViewModel","dojo/text!./templates/ProjectComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList","./ProjectSelector","./PublishMenu"],function(_1d10,lang,_1d11,_1d12,_1d13,on,when,_1d14,_1d15,_1d16,_1d17,res){function show(list){list.forEach(function(node){_1d12.remove(node,"dijitHidden");});};function hide(list){list.forEach(function(node){_1d12.add(node,"dijitHidden");});};var _1d18=lang.delegate(_1d15.prototype.modelBindingMap,{placeHolder:["placeHolder"]});return _1d10([_1d15,_1d14],{"class":"epi-project-component",modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],createProjectInfo:["createProjectInfo"],dndEnabled:["dndEnabled"],placeholderState:["placeholderState"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"]},res:res,templateString:_1d17,layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1d16();},_projectSelectorSortChanged:function(_1d19){this.model.set("projectSortOrder",_1d19);},_projectSelectorChange:function(_1d1a){this.model.set("selectedProject",_1d1a);},_newProjectButtonClickHandler:function(){this.model.namedCommands.addProject.execute();},_setCreateProjectInfoAttr:{node:"createProjectInfoNode",type:"innerText"},_setSelectedProjectAttr:function(value){this.projectSelector.set("value",value);},_setPlaceholderStateAttr:function(value){if(this.get("_placeholderState")===value){return;}this._set("_placeholderState",value);switch(value){case "noProjects":show([this.placeholderNode]);hide([this.projectSelector.domNode,this.publishContainer.domNode]);break;case "noSelectedProject":show([this.projectSelector.domNode,this.placeholderNode]);hide([this.publishContainer.domNode]);break;default:show([this.projectSelector.domNode,this.publishContainer.domNode]);hide([this.placeholderNode]);}}});});},"epi-cms/project/viewmodels/ProjectComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","./_ProjectViewModel","epi/i18n!epi/nls/episerver.cms.components.project"],function(_1d1b,lang,_1d1c,when,_1d1d,res){return _1d1b([_1d1d],{createProjectInfo:"",hasProject:false,_selectedProjectProfileKey:"epi.selected-project-id",initialize:function(){this._updateHasProject();return this.inherited(arguments);},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1d1c().resolve();}return store.remove(this.selectedProject.id).then(function(){self._selectNextProject();});},_loadSelectedProject:function(){var _1d1e=this.projectStore;return when(this.profile.get(this._selectedProjectProfileKey),function(_1d1f){if(!_1d1f){return null;}return when(_1d1e.get(_1d1f)).then(function(_1d20){var _1d21=!!_1d20||undefined;return this._updateHasProject(_1d21).then(function(){return _1d20;});}.bind(this)).otherwise(function(ex){return null;});}.bind(this));},_updatePlaceholderState:function(){var _1d22=this.get("hasProject"),_1d23=!!this.get("selectedProject"),state="";if(!_1d22){state="noProjects";this.set("createProjectInfo",res.placeholder.noprojectscreated);}else{if(_1d22&&!_1d23){state="noSelectedProject";this.set("createProjectInfo",res.placeholder.noprojectselected);}}this.set("placeholderState",state);},_getProjects:function(start,count,sort){return this.projectStore.query(null,{start:start,count:count,sort:sort});},_updateHasProject:function(_1d24){return when(_1d24===true?[_1d24]:this._getProjects(0,1)).then(function(_1d25){var _1d26=_1d25.length>0;this.set("hasProject",_1d26);return _1d26;}.bind(this));},_selectNextProject:function(){when(this._getProjects(0,1,this.get("projectSortOrder")),lang.hitch(this,function(_1d27){var value=_1d27.length>0?_1d27[0]:null;this.set("selectedProject",value);this.set("hasProject",_1d27.length>0);}));},_hasProjectSetter:function(value){this.hasProject=value;this._updatePlaceholderState();},_selectedProjectSetter:function(_1d28){this.inherited(arguments);if(!this.hasProject&&_1d28){this.set("hasProject",true);}else{this._updatePlaceholderState();}this.profile.set(this._selectedProjectProfileKey,_1d28&&_1d28.id,{location:"server"});}});});},"url:epi-cms/project/templates/ProjectComponent.html":"<div>\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\n         data-dojo-attach-point=\"itemList\"\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact'\">\n        <section data-epi-section=\"toolbarSection\">\n            <span data-dojo-type=\"epi-cms/project/ProjectSelector\"\n                  data-dojo-attach-point=\"projectSelector\"\n                  data-dojo-props=\"store:this.model.projectStore\"\n                  data-dojo-attach-event=\"onSortChanged:_projectSelectorSortChanged, onChange:_projectSelectorChange\"></span>\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\n                 data-dojo-attach-point=\"publishContainer\"\n                 data-dojo-props=\"iconClass: 'epi-iconPublishProject', showLabel: false, label: this.res.publishdropdown.label\"\n                 data-dojo-attach-event=\"openDropDown:_publishMenuClickHandler\"\n                 class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\">\n                <span></span>\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\n                     data-dojo-attach-point=\"publishMenu\"\n                     data-dojo-props=\"commandSource: this.model\">\n                    <section data-epi-section=\"primarySection\">\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\n                    </section>\n                    <section data-epi-section=\"statusSection\">\n                        <ul>\n                            <li>\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\n                            </li>\n                        </ul>\n                    </section>\n                </div>\n            </div>\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </section>\n\n        <section data-epi-section=\"listContainer\">\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\">\n                <div class=\"epi-project-gadget__placeholder-content\">\n                    <button data-dojo-type=\"dijit/form/Button\" type=\"button\"\n                            data-dojo-props=\"iconClass: 'epi-iconPlus'\"\n                            data-dojo-attach-event=\"onClick:_newProjectButtonClickHandler\"\n                            class=\"epi-flat epi-chromeless\">${res.command.newproject.label}</button>\n                    <div data-dojo-attach-point=\"createProjectInfoNode\" class=\"epi-project-gadget__placeholder-info\"></div>\n                </div>\n            </div>\n        </section>\n    </div>\n</div>\n","epi-cms/project/ProjectSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/on","dojo/Deferred","dojox/html/entities","epi","dojo/text!dijit/form/templates/Select.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","./ProjectSelectorList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_1d29,lang,_1d2a,_1d2b,on,_1d2c,_1d2d,epi,_1d2e,_1d2f,_1d30,_1d31,_1d32,_1d33){return _1d29([_1d33,_1d32],{"class":"epi-project-selector epi-chromeless epi-chromeless--with-arrow epi-flat",iconClass:"epi-iconProject",value:null,store:null,sort:null,query:null,enableDefaultValue:false,defaultValueText:_1d30.preview.defaultoption,header:_1d30.selector.title,buildRendering:function(){this.inherited(arguments);this.own(this.dropDown=new _1d31({baseClass:"dijitMenu",header:this.header,enableDefaultValue:this.enableDefaultValue,defaultValueText:this.defaultValueText}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);this.closeDropDown(true);}),true));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableDefaultValue&&!this.value){this.set("value",null);}},compare:function(_1d34,_1d35){return epi.areEqual(_1d34,_1d35)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _1d36=this.dropDown.refresh();return _1d36.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableDefaultValue){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_1d2d.encode(value||"")]);},_setValueAttr:function(value,_1d37){this.set("label",value&&value.name);if(this.enableDefaultValue&&!value){this.set("label",this.defaultValueText);}!_1d37&&this.dropDown&&this.dropDown.set("selectedProject",value);this.inherited(arguments);}});});},"epi-cms/project/ProjectModeToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/on","dojo/dom-style","dojo/dom-class","dojo/string","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/form/Button","epi/shell/widget/dialog/Alert","epi/shell/widget/_ModelBindingMixin","./ProjectSelector","./viewmodels/ProjectModeToolbarViewModel","epi/dependency","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","dojo/text!./templates/ProjectModeToolbar.html","dojo/text!./templates/CurrentProjectDoesNotExistsWarning.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.toolbar"],function(_1d38,lang,has,on,_1d39,_1d3a,_1d3b,_1d3c,_1d3d,_1d3e,_1d3f,Alert,_1d40,_1d41,_1d42,_1d43,_1d44,_1d45,_1d46,_1d47,_1d48){return _1d38([_1d3e,_1d3c,_1d3d,_1d40],{modelBindingMap:{projectName:["projectName"]},templateString:_1d46,localizations:_1d48,_projectDoesNotExistWarning:"",postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1d43.resolve("epi.cms.ProjectService");},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _1d42());}this._projectDoesNotExistWarning=_1d3b.substitute(_1d47,{warning:_1d48.projectdoesnotexists.alert.warning,description:_1d48.projectdoesnotexists.alert.description});},buildRendering:function(){this.inherited(arguments);this._setupContextMenu();var _1d49=this.domNode,_1d4a=this._projectDoesNotExistWarning;this.own(this.projectOverviewButton=new _1d3f({showLabel:true,"class":"dijitHidden epi-chromeless",label:_1d48.overview.label},this.projectOverviewButtonNode),this.projectOverviewButton.on("click",lang.hitch(this,"_openProjectOverview")),this.projectSelector=new _1d41({iconClass:"dijitNoIcon","class":"epi-chromeless epi-chromeless--inverted epi-chromeless--with-arrow epi-project-mode-toolbar__selector",enableDefaultValue:true,defaultValueText:_1d48.defaultoption,store:this.model.projectStore},this.projectSelectorNode),this.model.on("currentProjectDoesNotExists",function(){var _1d4b=new Alert({description:_1d4a});_1d4b.show();}));},_toggleOverviewButton:function(_1d4c){var _1d4d=this.projectOverviewButton.domNode;_1d3a.toggle(_1d4d,"dijitHidden",!_1d4c);},startup:function(){this.inherited(arguments);this.own(this.model.watch("overviewButtonVisible",lang.hitch(this,function(_1d4e,_1d4f,_1d50){this._toggleOverviewButton(_1d50);})));var model=this.model;this.model.initialize().then(lang.hitch(this,function(){var _1d51=this.domNode;this.own(this.projectSelector.watch("value",lang.hitch(this,function(_1d52,_1d53,_1d54){_1d3a.toggle(_1d51,"epi-project-mode-toolbar--project-selected",!!_1d54);_1d3a.remove(_1d51,"epi-project-mode-toolbar--project-deleted");model.set("currentProject",_1d54);})));this.projectSelector.set("value",model.get("currentProject"));}));this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,function(_1d55){this.projectSelector.set("value",_1d55);})));this.own(this.model.on("animateToolbar",lang.hitch(this,function(){_1d3a.add(this.domNode,"epi-project-mode-toolbar--flash");var _1d56=on(this.domNode,"animationend",lang.hitch(this,function(){_1d3a.remove(this.domNode,"epi-project-mode-toolbar--flash");_1d56.remove();}));})));this.own(this.model.watch("currentProject",lang.hitch(this,function(_1d57,_1d58,_1d59){if(_1d59&&_1d59.isDeleted){_1d3a.add(this.domNode,"epi-project-mode-toolbar--project-deleted");}})));},_openProjectOverview:function(){var _1d5a=this.projectSelector.get("value");if(_1d5a){this.model.showProjectOverview(_1d5a.id);}},_setProjectNameAttr:function(value){this.projectSelector.set("label",value);},_setupContextMenu:function(){this.own(new _1d45({configuration:[{builder:new _1d44({settings:{"class":"epi-chromeless",iconClass:"epi-iconContextMenu epi-icon--inverted",showLabel:false,label:_1d48.contextmenu.label},optionClass:""}),category:"context",target:this.contextMenu}],commandSource:this.model}));}});});},"epi-cms/project/viewmodels/ProjectModeToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","epi/epi","epi/dependency","epi-cms/_ContentContextMixin","../command/AddProject","../command/RenameProject","../command/RemoveProject","epi/shell/xhr/errorHandler"],function(_1d5b,lang,_1d5c,_1d5d,_1d5e,_1d5f,topic,when,_1d60,_1d61,epi,_1d62,_1d63,_1d64,_1d65,_1d66,_1d67){return _1d5b([_1d5f,_1d60,_1d5e,_1d63,_1d61],{projectStore:null,currentProject:null,overviewButtonVisible:false,postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1d62.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1d62.resolve("epi.storeregistry").get("epi.cms.project");this._createCommands();var _1d68=function(id){if(this.currentProject&&this.currentProject.id===id){this._markCurentProjectAsDeleted();}}.bind(this);var _1d69=function(_1d6a){if(this.currentProject&&this.currentProject.id===_1d6a.id){this.set("projectName",_1d6a.name);}}.bind(this);this.own(this.projectService.on("project-removed",_1d68),this.projectService.on("project-updated",_1d69));when(this.getCurrentContext()).then(this.contextChanged.bind(this));},initialize:function(){return when(this.projectService.getCurrentProject()).then(lang.hitch(this,function(_1d6b){this._changeAttrValue("currentProject",_1d6b,false);this.set("overviewButtonVisible",!!_1d6b);}));},contentContextChanged:function(_1d6c,_1d6d){this.inherited(arguments);if(this.get("currentProject")){var self=this;this.projectService.exists(this.currentProject.id).then(function(_1d6e){if(!_1d6e){self.emit("currentProjectDoesNotExists");}});}},_markCurentProjectAsDeleted:function(){var _1d6f=lang.clone(this.currentProject);_1d6f.isDeleted=true;this.set("currentProject",_1d6f,false);this.set("overviewButtonVisible",false);},contextChanged:function(_1d70,_1d71){this.inherited(arguments);if(_1d70&&_1d70.type==="epi.cms.project"){var _1d72=parseInt(_1d70.id,10);when(this.projectStore.get(_1d72)).then(lang.hitch(this,function(_1d73){if(_1d71&&_1d71.sender&&_1d71.sender._requestContext){this.emit("animateToolbar");}this.set("currentProject",_1d73);}));}},_currentProjectSetter:function(_1d74,_1d75){if(epi.areEqual(this.currentProject,_1d74)){return;}this.set("overviewButtonVisible",!!_1d74);this.currentProject=_1d74;var _1d76=new _1d5d().resolve();if(_1d75||_1d75===undefined){_1d76=this.projectService.setCurrentProject(_1d74);}_1d76.then(lang.hitch(this,"getCurrentContext")).then(function(_1d77){if(_1d77.type!=="epi.cms.project"&&_1d77.currentMode===undefined){topic.publish("/epi/shell/context/request",{uri:_1d77.versionAgnosticUri},{sender:this});}});},showProjectOverview:function(_1d78){var _1d79="epi.cms.project:///"+_1d78;topic.publish("/epi/shell/context/request",{uri:_1d79},{sender:this});},getCommands:function(){return this.commands;},addProject:function(_1d7a){this.projectStore.add(_1d7a).then(lang.hitch(this,function(value){this.set("currentProject",value);})).otherwise(_1d67.forXhr);},updateProject:function(_1d7b){this.projectStore.put(_1d7b).then(lang.hitch(this,"set","currentProject")).otherwise(_1d67.forXhr);},reactivateProject:function(){if(!this.currentProject){return new _1d5d().resolve();}return this.projectService.reactivateProject(this.currentProject.id);},removeProject:function(){if(!this.currentProject){return new _1d5d().resolve();}return this.projectStore.remove(this.currentProject.id).then(lang.hitch(this,function(){this.set("currentProject",null);}));},_createCommands:function(){var _1d7c={model:this,category:"context",modelPropertyToWatch:"currentProject"},_1d7d=this.own(new _1d64(_1d7c),new _1d65(_1d7c),new _1d66(_1d7c));this.set("commands",_1d7d);}});});},"url:epi-cms/project/templates/ProjectModeToolbar.html":"<div class=\"epi-project-mode-toolbar\">\n\t<span data-dojo-attach-point=\"projectIconNode\" class=\"dijitReset dijitInline epi-project-mode-toolbar__icon-node\">\n\t\t<span class=\"dijitReset dijitInline dijitIcon epi-iconProject epi-icon--inverted\"></span>\n    </span>\n    <span data-dojo-attach-point=\"projectLabelNode\" class=\"dijitInline\">${localizations.label}</span>\n    <span data-dojo-attach-point=\"projectSelectorNode\"></span>\n    <span class=\"dijitInline epi-project-mode-toolbar__warning-label\">${localizations.projectdoesnotexists.currentprojectdoesnotexists}</span>\n    <span data-dojo-attach-point=\"contextMenu\" class=\"epi-project-mode-toolbar__contextmenu\"></span>\n    <span data-dojo-attach-point=\"projectOverviewButtonNode\"></span>\n</div>\n","url:epi-cms/project/templates/CurrentProjectDoesNotExistsWarning.html":"<div class=\"epi-project-mode-project-deleted-warning\">${warning}</div>\n<p>${description}</p>","epi-cms/project/ProjectChangesComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectChangesComponentViewModel","dojo/text!./templates/ProjectChangesComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.changes","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList"],function(_1d7e,lang,_1d7f,_1d80,_1d81,on,when,_1d82,_1d83,_1d84,_1d85,res){return _1d7e([_1d83,_1d82],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],dndEnabled:["dndEnabled"],contentLanguage:["contentLanguage"]},res:res,templateString:_1d85,"class":"epi-project-changes-component",layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1d84();}});});},"epi-cms/project/viewmodels/ProjectChangesComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","./_ProjectViewModel"],function(_1d86,lang,_1d87){return _1d86([_1d87],{_sortOrderProfileKey:"epi.project-changes-sort-order",postscript:function(){this.inherited(arguments);this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this._projectChanged)));},refreshProject:function(){if(!this.selectedProject){this._updateHasProject();}this.inherited(arguments);},_createProjectCommands:function(){return {};},_createProjectItemCommands:function(){var _1d88=this.inherited(arguments),_1d89={};Object.keys(_1d88).forEach(function(key){var _1d8a=_1d88[key];switch(key){case "refreshProjectItems":break;case "sortProjectItems":_1d8a.set({category:"projectButton",iconClass:"epi-iconSort"});break;case "readyToPublishProjectItem":_1d89.primaryReadyToPublishProjectItem=lang.delegate(_1d8a,{iconClass:"epi-iconCheckmark",category:null});break;default:_1d89[key+"_context"]=lang.delegate(_1d8a,{category:"context"});}});return lang.mixin(_1d88,_1d89);},_projectChanged:function(_1d8b){this.set("selectedProject",_1d8b);},_updateSelectedProjectDependencies:function(_1d8c){var _1d8d=false,_1d8e=null,_1d8f=this.isProjectModeEnabled();if(_1d8c){_1d8d=(_1d8f&&_1d8c.status!=="publishing")||_1d8c.status==="active"||_1d8c.status==="publishfailed";_1d8e={projectId:_1d8c.id};}this.set({dndEnabled:_1d8d,projectItemQuery:_1d8e});}});});},"url:epi-cms/project/templates/ProjectChangesComponent.html":"<div>\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\n         data-dojo-attach-point=\"itemList\"\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact', res: this.res\">\n        <section data-epi-section=\"toolbarSection\">\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </section>\n        <section data-epi-section=\"listContainer\">\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\"></div>\n        </section>\n    </div>\n</div>\n","epi-cms/widget/CategorySelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/dependency","epi/epi","epi/shell/widget/dialog/Dialog","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(array,_1d90,lang,all,_1d91,_1d92,_1d93,_1d94,query,_1d95,_1d96,_1d97,_1d98,_1d99,_1d9a,_1d9b,_1d9c,_1d9d,epi,_1d9e,_1d9f,res){return _1d90([_1d96,_1d95,_1d97,_1d9a,_1d9c],{templateString:_1d9f,localization:res,multiple:true,value:null,store:null,_categories:null,_categoriesParentsName:{},onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1da0=_1d9d.resolve("epi.storeregistry");this.store=_1da0.get("epi.cms.category");}},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(value){if(!lang.isArray(value)){value=[value];}var _1da1=array.filter(value,function(v){return !!v;});this._setValueAndFireOnChange(_1da1);if(_1da1.length>0){this._set("value",_1da1);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(value){if(epi.areEqual(this._categories,value)){return;}this._categories=value;this.onChange(this._categories);this._updateDisplayNode();},_getValueAttr:function(){return this._categories;},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1d94.set(this.button.domNode,"display",value?"none":"");_1d92.toggle(this.domNode,"dijitReadOnly",value);},focus:function(){this.button.focus();},_createCategoryButton:function(_1da2){if(query("div[data-epi-category-id="+_1da2.id+"]",this.categoriesGroupContainer).length!==0){return;}var _1da3=_1d93.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _1da4=_1d93.create("div",{"class":"dijitInline epi-resourceName"});var _1da5=_1d93.create("div",{"class":"dojoxEllipsis",innerHTML:_1da2.description});_1d93.place(_1da5,_1da4);_1d93.place(_1da4,_1da3);this._tooltip=new _1d99({connectId:_1da5,label:this._getCategoryPath(_1da2)});var _1da6=_1d93.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_1d91.set(_1da6,"data-epi-category-id",_1da2.id);var _1da7=_1da6.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_1da6,_1da7,lang.hitch(this,this._onRemoveClick));_1d93.place(_1da6,_1da4);}else{_1d93.place(_1d93.create("span",{innerHTML:"&nbsp;"}),_1da4);}_1d93.place(_1da3,this.categoriesGroupContainer);},_getCategoryPath:function(_1da8){if(!_1da8.parentsNameCollection||_1da8.parentsNameCollection.length===1){return "";}var path=_1da8.parentsNameCollection[1];for(var i=2;i<_1da8.parentsNameCollection.length;i++){path=path+"/"+_1da8.parentsNameCollection[i];}return path;},_createNoCategoriesChosenSpan:function(){_1d93.create("div",{innerHTML:this.localization.nocategorieschosen,"class":"epi-categoriesGroup__message"},this.categoriesGroupContainer,"only");},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";if(!this._categories||this._categories.length===0){this._createNoCategoriesChosenSpan();return;}this._categoriesParentsName={};var _1da9=[];this._categories.forEach(function(_1daa){_1da9.push(this.store.refresh(_1daa));},this);this._updateDisplayPromise=all(_1da9).then(lang.hitch(this,function(_1dab){this._updateDisplayPromise=null;_1dab.forEach(function(_1dac){if(_1dac&&_1dac.visible){this._categoriesParentsName[_1dac.id]=_1dac.parentsNameCollection;this._createCategoryButton(_1dac);}else{var _1dad=this._categories.indexOf(_1dac.id);if(_1dad!==-1){this._categories.splice(_1dad,1);}}if(this._categories.length===0){this._createNoCategoriesChosenSpan();}},this);}));},_onRemoveClick:function(arg){if(!this._categories){return;}var _1dae=parseInt(_1d91.get(arg.target,"data-epi-category-id"),10);var _1daf=this._categories.indexOf(_1dae);if(_1daf===-1){return;}var _1db0=lang.clone(this._categories);_1db0.splice(_1daf,1);this.set("value",_1db0);},_getCategoriesParentsNameClone:function(){var _1db1={};array.forEach(this._categories,lang.hitch(this,function(_1db2){_1db1[_1db2]=this._categoriesParentsName[_1db2];}));return _1db1;},_onShow:function(){this.categorySelectorDialog.set("value",lang.clone(this._categories));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _1db3=this.categorySelectorDialog.get("value");this.set("value",_1db3);},_isEmptyArray:function(array){return !array||array.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _1d9b({rootCategory:this.root});this.dialog=new _1d9e({title:this.localization.popuptitle,content:this.categorySelectorDialog,destroyOnHide:false,dialogClass:"epi-dialog-portrait"});this.own(this.dialog);this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});},"epi-cms/widget/CategorySelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi-cms/widget/CategoryTree"],function(array,_1db4,lang,_1db5,_1db6,_1db7,_1db8,epi,_1db9,_1dba){return _1db4([_1db6,_1db5,_1db7],{templateString:"<div class=\"epi-categorySelectorDialog\">                             <div data-dojo-attach-point=\"categoryTree\" data-dojo-type=\"epi-cms/widget/CategoryTree\" data-dojo-props=\"rootCategory: ${rootCategory}\"></div>                         </div>",selectedCategoriesData:null,_selectedCategoryIds:null,rootCategory:null,onShow:function(){if(!this._selectedCategoryIds&&!this.categoryTree){return;}this.categoryTree.set("selectedNodeIds",this._selectedCategoryIds);this.categoryTree.set("selectedNodeData",this.selectedCategoriesData);},_setValueAttr:function(value){this._selectedCategoryIds=value;if(!this._selectedCategoryIds){this._selectedCategoryIds=[];}},_getValueAttr:function(){return this.categoryTree.get("selectedNodeIds");}});});},"epi-cms/widget/CategoryTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(array,_1dbb,lang,Tree,epi,_1dbc,_1dbd){return _1dbb([Tree],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _1dbd({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",lang.hitch(this,this._onNodeOpen));this.connect(this,"onClose",lang.hitch(this,this._onNodeClose));this.watch("selectedNodeData",lang.hitch(this,this._loadSelectedNodes));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(args){return new _1dbc(args);},getTooltip:function(item){var _1dbe=this.model.getTooltip||this.model.getLabel;return _1dbe?_1dbe(item):this.inherited(arguments);},getNodeById:function(_1dbf){var nodes=this.getNodesByItem(_1dbf.toString());if(!nodes){return null;}return nodes[0];},_getTotalSelectedNodes:function(_1dc0,_1dc1,_1dc2){if(!_1dc0||!_1dc0.item||!_1dc0.item.hasChildren||!lang.isArray(_1dc1)||_1dc1.length===0||!_1dc2){return 0;}var _1dc3=0,_1dc4=[],_1dc5=[],_1dc6=lang.clone(_1dc0.item.parentsNameCollection);var _1dc7=function(_1dc8){if(lang.isArray(_1dc8)&&_1dc8.length>0){_1dc8.pop();}};_1dc6[_1dc6.length-1]=_1dc0.item.name;array.forEach(_1dc1,function(_1dc9){_1dc4=lang.clone(_1dc2[_1dc9]);_1dc7(_1dc4);_1dc5=lang.clone(_1dc4);lang.mixin(_1dc5,_1dc6);if(lang.isArray(_1dc4)&&epi.areEqual(_1dc4,_1dc5)){_1dc3++;}},this);return _1dc3;},_setTotalSelectedNodes:function(_1dca){if(_1dca){_1dca.set("totalSelectedNodes",this._getTotalSelectedNodes(_1dca,this.selectedNodeIds,this.selectedNodeData));array.forEach(_1dca.getChildren(),function(_1dcb){if(_1dcb&&_1dcb.item&&_1dcb.item.hasChildren){if(_1dcb.isExpanded){this._setTotalSelectedNodes(_1dcb);}else{_1dcb.set("totalSelectedNodes",this._getTotalSelectedNodes(_1dcb,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(lang.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(node){node.set("totalSelectedNodes",this._getTotalSelectedNodes(node,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_1dcc,item){if(!this.getNodeById(item.id)){return;}var index=this.selectedNodeIds.indexOf(item.id),exist=index!==-1;if(_1dcc&&!exist){this.selectedNodeIds.push(item.id);this.selectedNodeData[item.id]=item.parentsNameCollection;}if(!_1dcc&&exist){this.selectedNodeIds.splice(index,1);this.selectedNodeData[item.id]={};}},_onNodeOpen:function(item,node){this.set("toggleSelectNodes",node,this.selectedNodeIds);this._setTotalSelectedNodes(node);},_onNodeClose:function(item,node){this._setTotalSelectedNodes(node);},_setToggleSelectNodesAttr:function(_1dcd,_1dce){if(!_1dcd||!lang.isArray(_1dce)){return;}var _1dcf=false;array.forEach(_1dcd.getChildren(),function(_1dd0){if(_1dd0){_1dcf=_1dce.indexOf(_1dd0.item.id)!==-1;_1dd0.set("checked",_1dcf);if(_1dd0.hasChildren()){this.set("toggleSelectNodes",_1dd0,_1dce);}}},this);},_createTreeNode:function(args){var node=this.buildNodeFromTemplate(args);node.connect(node,"onNodeSelectChanged",lang.hitch(this,function(_1dd1,item){this._onNodeSelectChanged(_1dd1,item);}));this._onNodeCreated(node);return node;}});});},"epi-cms/widget/_CategoryTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/text!./templates/_CategoryTreeNode.html","dijit/_TemplatedMixin","dijit/form/CheckBox","epi","epi-cms/widget/_ContentTreeNode"],function(_1dd2,lang,_1dd3,_1dd4,keys,_1dd5,_1dd6,_1dd7,epi,_1dd8){return _1dd2([_1dd8,_1dd6],{templateString:_1dd5,_checkbox:null,checked:false,postCreate:function(){this.inherited(arguments);_1dd3.add(this.iconNode,"dijitHidden");this._checkbox=this._createCheckbox();},_createCheckbox:function(){if(!this.item.selectable){return;}var _1dd9=_1dd4.create("span",{"class":"epi-checkboxNode dijitTreeExpando"});var _1dda=new _1dd7({name:"checkboxCategory",value:this.item.id,tabIndex:-1,checked:false,onChange:lang.hitch(this,function(_1ddb){this.onNodeSelectChanged(_1ddb,this.item);})});_1dda.placeAt(_1dd9);_1dd4.place(_1dd9,this.expandoNode,"after");return _1dda;},onNodeSelectChanged:function(_1ddc,item){},_onLabelClick:function(){if(!this._checkbox){return;}this.set("checked",!this._checkbox.checked);},_onLabelKeyUp:function(evt){if(evt.keyCode===keys.SPACE||evt.keyCode===keys.ENTER){this._onLabelClick();}},_setCheckedAttr:function(_1ddd){if(!this._checkbox){return;}this._set("checked",_1ddd);this._checkbox.set("checked",_1ddd);},_setTotalSelectedNodesAttr:function(_1dde){var _1ddf=this.tree.model.getLabel(this.item),_1de0=!this.isExpanded&&_1dde>0;this.labelNode.innerHTML=_1de0?_1ddf+" ("+_1dde+")":_1ddf;}});});},"url:epi-cms/widget/templates/_CategoryTreeNode.html":"<div class=\"dijitTreeNode epi-categoryTreeNode\" role=\"presentation\">\r\n    <a href=\"#\" tabIndex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\r\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\r\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel epi-categoryTreeLabel\" role=\"treeitem\"\r\n                  tabindex=\"-1\" aria-selected=\"false\" data-dojo-attach-event=\"onclick:_onLabelClick, keyup:_onLabelKeyUp\">\r\n            </span>\r\n        </span>\r\n    </a>\r\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\r\n</div>","epi-cms/widget/CategoryTreeStoreModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi/routes"],function(_1de1,lang,when,_1de2,_1de3,_1de4){return _1de1(null,{store:null,rootCategory:undefined,constructor:function(args){lang.mixin(this,args);if(!this.store){var _1de5=_1de3.resolve("epi.storeregistry");this.store=_1de5.get("epi.cms.category");}},getRoot:function(_1de6){when(this.store.get(this.rootCategory),_1de6);},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_1de7,_1de8){var id=this.getIdentity(_1de7),_1de9=this.store.query({id:id,query:"getchildren"});_1de9.then(function(_1dea){_1de7.children=_1dea;_1de8(_1dea);});},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){return _1de2.encode(item.description);}});});},"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\r\n    </div> \r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\r\n</div>","epi-cms/widget/ContentSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/string","dojo/when","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/_SelectorBase","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(array,_1deb,lang,_1dec,_1ded,_1dee,_1def,when,_1df0,_1df1,_1df2,_1df3,_1df4,_1df5,_1df6,_1df7,_1df8,_1df9){return _1deb([_1df8],{roots:null,value:null,required:false,missingMessage:_1df9.requiredmessage,tooltipPosition:[],contentLink:null,previewUrl:null,canSelectOwnerContent:false,accessLevel:_1df6.accessLevel.Read,showAllLanguages:true,showSearchBox:true,searchArea:null,_setDisabledAttr:function(value){this.inherited(arguments);this.button.set("disabled",value);this._set("disabled",value);},buildRendering:function(){var _1dfa=this.name?(this.name.replace(/"/g,"&quot;")):"";this.input=_1dee.create("input",{type:"hidden",name:_1dfa});this.inherited(arguments);this.domNode.appendChild(this.input);},postMixInProperties:function(){this.inherited(arguments);var _1dfb=_1df2.resolve("epi.storeregistry");this._store=_1dfb.get("epi.cms.content.light");var _1dfc=this.contentRepositoryDescriptors||_1df2.resolve("epi.cms.contentRepositoryDescriptors");var _1dfd=_1dfc[this.repositoryKey];if(_1dfd&&!this.roots){this.roots=_1dfd.roots;}if(_1dfd&&!this.searchArea){this.searchArea=_1dfd.searchArea;}},postCreate:function(){this.inherited(arguments);if(!this.value){this._updateDisplayNode(null);}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1ded.set(this.button.domNode,"display",value?"none":"");_1ded.set(this.clearButton,"display",value?"none":"");_1dec.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this._setValueAndFireOnChange(value);},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var title=_1df9.title;if(this.allowedTypes&&this.allowedTypes.length===1){var name=_1df3.getResourceValue(this.allowedTypes[0],"name");if(name){title=_1def.substitute(_1df9.format,[name]);}}this.contentSelectorDialog=new _1df7({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes,showAllLanguages:this.showAllLanguages,showSearchBox:this.showSearchBox,searchArea:this.searchArea});this.dialog=new _1df4({title:title,dialogClass:"epi-dialog-portrait",content:this.contentSelectorDialog});this.dialog.own(this.contentSelectorDialog);this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");return this.dialog;},_isContentAllowed:function(_1dfe){var _1dff=_1df3.getValidAcceptedTypes([_1dfe],this.allowedTypes,this.restrictedTypes);return !!_1dff.length;},_onButtonClick:function(){when(this._getContentData(this.contentLink),lang.hitch(this,function(_1e00){this.canSelectOwnerContent=this.canSelectOwnerContent&&_1e00&&this._isContentAllowed(_1e00.typeIdentifier);var _1e01=this._getDialog();this.isShowingChildDialog=true;var _1e02;if(this.value){_1e02=this._convertValueToContentReference(this.value);}if(_1e02){_1e02=_1e02.createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_1e02);_1e01.show();}));},_onDialogExecute:function(){var value=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(value);},_convertValueToContentReference:function(value){return new _1df5(value);},_setValueAndFireOnChange:function(value){var _1e03=value==="-"?this.contentLink:value;this.set("permanentLink",null);this.set("previewUrl",null);this._valueChangedPromise=when(this._getContentData(_1e03),lang.hitch(this,function(_1e04){this._valueChangedPromise=null;var _1e05=this.value!==_1e03;this.value=_1e03;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_1e04);if(_1e05){this.onChange(_1e03);}if(_1e04){this.set("permanentLink",_1e04.permanentLink);this.set("previewUrl",_1e04.previewUrl);}}));},_getContentData:function(_1e06){if(!_1e06){return null;}return this._store.get(_1e06);},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_1df0.focus(this.button.focusNode);}catch(e){}}},_updateDisplayNode:function(_1e07){this.inherited(arguments);if(_1e07){this.set("selectedContentLink",new _1df5(_1e07.contentLink).id);}else{this.set("selectedContentName",_1df9.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_1e08){var self=this;if(!_1e08){return;}when(self._store.get(_1e08),function(_1e09){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",!_1df6.hasAccess(_1e09.accessMask,self.accessLevel));});}});});},"epi-cms/widget/_SelectorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/dom-prop","dojo/query","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/i18n","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","dojo/text!./templates/_SelectorBase.html"],function(_1e0a,lang,_1e0b,_1e0c,_1e0d,_1e0e,_1e0f,query,when,_1e10,_1e11,_1e12,_1e13,_1e14,i18n,_1e15,_1e16,_1e17,_1e18,_1e19){return _1e0a([_1e12,_1e11,_1e13,_1e10,_1e17,_1e18,_1e16,_1e15],{templateString:_1e19,roots:null,value:null,required:false,missingMessage:"",tooltipPosition:[],canSelectOwnerContent:false,contentRepositoryDescriptors:null,allowedDndTypes:[],_valueChangedPromise:null,_setSelectedContentNameAttr:function(value){_1e0f.set(this.selectedContentNameNode,"textContent",value);this._updateDisplayNodeTitle();},_setSelectedContentLinkAttr:function(value){_1e0f.set(this.selectedContentLinkNode,"innerHtml",value);this._updateDisplayNodeTitle();},_updateDisplayNodeTitle:function(){this.resourceName.title=this.resourceName.textContent.trim();},postCreate:function(){this.inherited(arguments);this.own(_1e0b.after(this,"onDrop",lang.hitch(this,this.focus)));},postMixInProperties:function(){this.inherited(arguments);if(!this.contentRepositoryDescriptors){this.contentRepositoryDescriptors=_1e14.resolve("epi.cms.contentRepositoryDescriptors");}if(!this.roots&&this.repositoryKey){var _1e1a=this.contentRepositoryDescriptors[this.repositoryKey];this.roots=_1e1a.roots;}},destroy:function(_1e1b){this.inherited(arguments);if(this._valueChangedPromise){this._valueChangedPromise.cancel();this._valueChangedPromise=null;}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1e0e.set(this.button.domNode,"display",value?"none":"");_1e0e.set(this.clearButton,"display",value?"none":"");_1e0d.toggle(this.domNode,"dijitReadOnly",value);},_getDialog:function(){},_onButtonClick:function(){if(!this.dialog){this.dialog=this._getDialog();this.dialog.startup();this.own(_1e0b.after(this.dialog,"onExecute",lang.hitch(this,this._onDialogExecute)));this.own(_1e0b.after(this.dialog,"onShow",lang.hitch(this,this._onDialogShow)));this.own(_1e0b.after(this.dialog,"onHide",lang.hitch(this,this._onDialogHide)));this.own(this.dialog);}this.dialog.show();},_onDialogShow:function(){this.isShowingChildDialog=true;},_onDialogExecute:function(){},_onDialogHide:function(){this.isShowingChildDialog=false;this.focus();},_onBlur:function(){this.inherited(arguments);this.validate();},focus:function(){this.button.focus();},onChange:function(value){},_updateDisplayNode:function(_1e1c){if(_1e1c){_1e0d.remove(this.domNode,"epi-noValue");_1e0d.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_1e1c.name);}else{_1e0d.add(this.domNode,"epi-noValue");_1e0d.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName","");}},_setDialogButtonState:function(_1e1d){}});});},"epi-cms/widget/_Droppable":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/dnd/Target"],function(_1e1e,lang,when,_1e1f){return _1e1e(null,{dropAreaNode:null,allowedDndTypes:null,postCreate:function(){this.inherited(arguments);var _1e20=this.own(new _1e1f(this.dropAreaNode,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,createItemOnDrop:false,readOnly:this.readOnly,skipForm:true}))[0];this.connect(_1e20,"onDropData","_onDropData");},onDropping:function(){},onDrop:function(){},_onDropData:function(_1e21,_1e22,nodes,copy){var _1e23=_1e21?(_1e21.length?_1e21[0]:_1e21):null;if(_1e23){this.onDropping();when(_1e23.data,lang.hitch(this,function(_1e24){var value;if(this.dndSourcePropertyName){value=_1e24[this.dndSourcePropertyName];}else{value=_1e24;}this.set("value",value);this.onDrop();}));}}});});},"epi-cms/widget/_HasClearButton":function(){define(["epi","dojo","dijit"],function(epi,dojo,dijit){return dojo.declare(null,{postCreate:function(){this.inherited(arguments);var _1e25=this.clearButton.onClick?"onClick":"onclick";dojo.connect(this.clearButton,_1e25,dojo.hitch(this,this.clearValue));},clearValue:function(){if(this.readOnly){return;}var value=this.getEmptyValue();this.set("value",value);},getEmptyValue:function(){return null;}});});},"url:epi-cms/widget/templates/_SelectorBase.html":"<div data-dojo-attach-point=\"inputContainer\" class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\r\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\r\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\r\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\r\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\" >\r\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\r\n</div>","epi-cms/widget/overlay/ContentArea":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dnd/Manager","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/json","dojo/on","dojo/query","dijit/_Container","dijit/registry","epi","epi/shell/widget/overlay/Item","epi/shell/dnd/Source","epi/shell/dnd/_MarkerSource","epi-cms/core/ContentReference","epi-cms/widget/overlay/Block","epi-cms/contentediting/editors/ContentBlockEditor","epi-cms/widget/command/CreateContentFromSelector","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/editors/_TextWithActionLinksMixin","dojo/text!../templates/ContentArea.html"],function(array,_1e26,lang,_1e27,_1e28,_1e29,_1e2a,_1e2b,_1e2c,json,on,query,_1e2d,_1e2e,epi,Item,_1e2f,_1e30,_1e31,Block,_1e32,_1e33,_1e34,_1e35,_1e36,_1e37){return _1e26([Item,_1e2d,_1e36],{templateString:_1e37,layout:"",defaultWatchKey:"",allowedDndTypes:null,blockClass:Block,modelClass:_1e34,dndSourceClass:_1e26([_1e2f,_1e30]),dndSourceSettings:null,allowedTypes:null,restrictedTypes:null,_supressValueChanged:false,constructor:function(){this._watches={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new this.modelClass();}this.model.set("value",lang.clone(this.contentModel.get(this.name)));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_1e38,value){if(epi.areEqual(value,this.model.get("value"))){return;}this.refresh();})));this._pendingPersonalizations=[];this._ownerContentLink=this.contentModel.get("icontent_contentlink");},buildRendering:function(){this.inherited(arguments);this.setupActionLinks(this.actionsNodeControls);},postCreate:function(){this.inherited(arguments);this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._onChildrenChanged();if(this._pendingPersonalizations.length>0){this._pendingPersonalizations=[];this.onClick(this);}})));this._setupDirectionality();this._setupBlocks();},destroy:function(){this.inherited(arguments);for(var i in this._watches){this._watches[i].remove();}this._watches={};this._source.destroy();if(this.textWithLinks){this.textWithLinks.destroy();this.textWithLinks=null;}},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},_setHasChildrenAttr:function(value){this._set("hasChildren",value);},_getMinHeightAttr:function(){return _1e2c.get(this.sourceItemNode,"minHeight");},onValueChange:function(_1e39){},updatePosition:function(_1e3a){if(!this.canUpdatePosition()){return false;}var _1e3b=this.inherited(arguments),_1e3c,_1e3d,_1e3e,_1e3f;if(this.hasChildren){this._setupDirectionality();this._positionBlocks();}_1e3e=this.get("minHeight");_1e2c.set(this.sourceItemNode,"minHeight","");_1e3c=Math.floor(_1e2b.position(this.actionsNodeControls,false).h);_1e3d=_1e3c>0?_1e3c:this.get("actionNodeHeight")||0;_1e3f=Math.floor(_1e2b.position(this.sourceItemNode,false).h);if(_1e3d===0){this._clearPosition();return _1e3b;}_1e3d&&(this.set("actionNodeHeight",_1e3d));_1e2c.set(this.sourceItemNode,"minHeight",(_1e3f+_1e3d)+"px");_1e2c.set(this.actionsNodeControls,"marginTop",(_1e3f)+"px");if(_1e3e===_1e3f+_1e3d){return _1e3b;}return true;},refresh:function(){this._actionNodeHeight=null;this.destroyDescendants();this._source.clearItems();if(this._source.anchor){_1e2a.destroy(this._source.anchor);}for(var i in this._watches){this._watches[i].remove();}this._watches={};this._supressValueChanged=true;this.model.set("value",lang.clone(this.contentModel.get(this.name)));this._setupBlocks();this.inherited(arguments);this._supressValueChanged=false;},_setupDnd:function(){var _1e40=lang.mixin({_skipStartup:true,creator:lang.hitch(this,"_creator"),copyOnly:false,alwaysCopy:false,dropParent:this.containerNode,type:this.allowedDndTypes,accept:this.allowedDndTypes,reject:this.restrictedDndTypes,singular:true,propertyName:this.name},this.dndSourceSettings||{});this._source=new this.dndSourceClass(this.domNode,_1e40);this._source.defaultCheckAcceptance=this._source.checkAcceptance;this._source.checkAcceptance=lang.hitch(this,this._checkAcceptance);this.own(_1e27.after(this._source,"onDropData",lang.hitch(this,"_onDrop"),true));this.own(_1e27.before(this._source,"delItem",lang.hitch(this,"_onDndItemRemoved"),true));},_creator:function(item){var node=_1e2a.create("div"),_1e41;if(typeof item.getNormalizedData=="function"){_1e41=item.getNormalizedData();}_1e41=_1e41?_1e41.data:item;return {node:node,type:this.allowedDndTypes,data:_1e41};},_setupBlocks:function(){var _1e42=this._getBlockNodes();array.forEach(_1e42,this._createBlock,this);this.set("hasChildren",_1e42.length>0);},_createBlock:function(node){var id=_1e29.get(node,"data-epi-block-id"),info=json.parse(_1e29.get(node,"data-epi-block-personalization")),_1e43=info?info.contentGroup:this.defaultWatchKey,model=this.model;if(_1e43){model=model.getChild({name:_1e43});}var _1e44=model&&model.getChild(lang.mixin({contentLink:new _1e31(id).createVersionUnspecificReference().toString()},info));if(!_1e44){return;}var block=new this.blockClass({disabled:this.disabled,viewModel:_1e44,sourceItemNode:node});this.addChild(block);this._watches["block_"+id+"_ensurePersonalization"]=_1e44.watch("ensurePersonalization",lang.hitch(this,function(_1e45,_1e46,_1e47){var index=array.indexOf(this._pendingPersonalizations,_1e44);if(_1e47){if(index<0){this._pendingPersonalizations.push(_1e44);}}else{if(index>0){this._pendingPersonalizations.splice(index,1);}}}));_1e44.set("visible",true);this._source.setItem(block.domNode.id,{name:_1e44.name,data:_1e44,type:this.allowedDndTypes});},_onChildrenChanged:function(){this.onValueChange({propertyName:this.name,value:this.model.get("value")});},_positionBlocks:function(){var _1e48=this.getChildren(),_1e49=[],_1e4a=this.get("position");array.forEach(_1e48,function(_1e4b,i){var _1e4c,_1e4d,_1e4e;if(!_1e49[i]){_1e49[i]=_1e2b.position(_1e4b.sourceItemNode,false);}_1e4c=_1e49[i];_1e4c.x-=_1e4a.x;_1e4c.y-=_1e4a.y;_1e4b.resize(_1e4c);},this);},_checkAcceptance:function(_1e4f,nodes){if(this.readOnly||nodes===undefined){return false;}var _1e50=_1e2e.getEnclosingWidget(nodes[0]);if(_1e50.isInstanceOf(_1e32)){return false;}return this._source.defaultCheckAcceptance(_1e4f,nodes);},_getBlockNodes:function(){var _1e51=query("[data-epi-block-id]",this.sourceItemNode);var _1e52=query("[data-epi-block-id] [data-epi-block-id]",this.sourceItemNode);return array.filter(_1e51,function(node){return _1e52.indexOf(node)===-1;});},_setupDirectionality:function(){var _1e53;if(/vertical|horizontal/.test(this.layout)){_1e53=this.layout==="horizontal";}else{_1e53=array.some(this._getBlockNodes(),function(node){var style=_1e2c.getComputedStyle(node),_1e54=/left|right/.test(style.cssFloat),_1e55=/inline|inline-block/.test(style.display);return _1e54||_1e55;});}this._source.setHorizontal(_1e53);},executeAction:function(_1e56){if(_1e56==="createnewblock"){var _1e57=new _1e33({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,treatAsSecondaryView:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_1e57.set("model",{save:lang.hitch(this,function(block){var value=lang.clone(this.model.get("value"),true)||[];value.push(block);this.onValueChange({propertyName:this._source.propertyName,value:value});})});_1e57.execute();}else{this.inherited(arguments);}},_onDrop:function(data,_1e58,nodes,_1e59){var model=this.model,_1e5a=this._source;if(_1e5a.anchor===_1e5a.targetAnchor){return;}var index=array.indexOf(_1e5a.getAllNodes(),_1e5a.targetAnchor)+(_1e5a.before?-1:1),_1e5b=array.filter(model.getChildren(),function(child){return child.get("visible");});index=model.indexOf(_1e5b[index-1])+1;if(!lang.isArray(data)){data=[data];}if(_1e5a===_1e58&&!_1e59){model.modify(function(){array.forEach(data,function(item,i){var data=item.data;if(data.contentGroup){data=model.getChild({name:data.contentGroup});}model.move(data,index+i);});});}else{model.modify(function(){array.forEach(data,function(item,i){var block=new _1e35(item.data);model.addChild(block,index+i);});});}},_onDndItemRemoved:function(key){var data=this._source.getItem(key);if(!lang.isArray(data)){data=[data];}this.model.modify(function(){array.forEach(data,function(item){this.model.removeChild(item.data);},this);},this);}});});},"epi/shell/dnd/_MarkerSource":function(){define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/has","dojo/dnd/Manager","dojo/dnd/Source","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(array,_1e5c,has,_1e5d,_1e5e,_1e5f,_1e60,_1e61,_1e62){return _1e5c(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_1e60.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_1e63){_1e5f.toggle(this.node,"dojoDndHorizontal",_1e63);this.horizontal=_1e63;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState==="Disabled"){return;}_1e5e.superclass.onMouseMove.call(this,e);var m=_1e5d.manager();var _1e64=has("mac")?"metaKey":"ctrlKey";if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var nodes=this.getSelectedNodes();if(nodes.length){m.startDrag(this,nodes,this.copyState(e[_1e64],true));}}}if(this.isDragging){var _1e65=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!==this.current){this.targetBox=_1e61.position(this.current,true);}if(this.horizontal){_1e65=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_1e65=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_1e65=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!==this.targetAnchor||_1e65!==this.before){this._markTargetAnchor(_1e65);m.canDrop(!this.current||m.source!==this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(point){var _1e66=[],_1e67,_1e68;function _1e69(_1e6a,_1e6b){function _1e6c(value){return value*value;};return Math.sqrt(_1e6c(_1e6a.x-_1e6b.x)+_1e6c(_1e6a.y-_1e6b.y));};this.getAllNodes().forEach(function(node){var pos=_1e61.position(node);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_1e66.push({node:node,before:true,x:pos.x,y:pos.yCentered},{node:node,before:false,x:pos.x2,y:pos.yCentered});}else{_1e66.push({node:node,before:true,x:pos.xCentered,y:pos.y},{node:node,before:false,x:pos.xCentered,y:pos.y2});}},this);array.forEach(_1e66,function(value){value.distance=_1e69(point,value);if(!_1e67||value.distance<_1e68){_1e67=value;_1e68=value.distance;}},this);if(_1e67){this.current=_1e67.node;this._calculatedCurrent=true;return _1e67.before;}return false;},_markTargetAnchor:function(_1e6d){var _1e6e=true,_1e6f=true;if(this.current===this.targetAnchor&&this.before===_1e6d){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_1e6d;if(this.targetAnchor){this.targetAnchorSibling=_1e6d?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_1e5f.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_1e6e=!(this.targetAnchor.id in this.selection);_1e6f=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_1e6e&&_1e6f){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_1e6e&&_1e6f){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_1e6e&&_1e6f);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_1e70){var _1e71=this._markerNode,_1e72,_1e73,_1e74,style,top,left,_1e75,width,gap=-1;if(_1e70){_1e72=_1e61.position(this.targetAnchor,false);_1e73=this.targetAnchorSibling?_1e61.position(this.targetAnchorSibling,false):{h:0,w:0};_1e74=_1e61.position(this.node,false);if(this.horizontal){if(this.before){left=_1e72.x-_1e74.x;if(this.targetAnchorSibling){gap=(_1e72.x-_1e73.x-_1e73.w)/2;}if(gap>=0){left-=gap;}}else{left=_1e72.x+_1e72.w-_1e74.x;if(this.targetAnchorSibling){gap=(_1e73.x-_1e72.x-_1e72.w)/2;}if(gap>=0){left+=gap;}}_1e75=gap>=0?Math.max(_1e72.h,_1e73.h):_1e72.h;style={display:"block",top:_1e72.y-_1e74.y+"px",left:left+"px",height:_1e75+"px"};}else{if(this.before){top=_1e72.y-_1e74.y;if(this.targetAnchorSibling){gap=(_1e72.y-_1e73.y-_1e73.h)/2;}if(gap>=0){top-=gap;}}else{top=_1e72.y+_1e72.h-_1e74.y;if(this.targetAnchorSibling){gap=(_1e73.x-_1e72.x-_1e72.w)/2;}if(gap>=0){top-=gap;}}width=gap>=0?Math.max(_1e72.w,_1e73.w):_1e72.w;style={display:"block",top:top+"px",width:width+"px"};}}else{style={display:"none"};}if(!_1e71){_1e71=this._markerNode=_1e60.place(this.markerTemplateString,this.node);_1e62.set(_1e71,style);}else{setTimeout(function(){_1e62.set(_1e71,style);},this.markerDelay);}}});});},"epi-cms/contentediting/editors/ContentBlockEditor":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/html","dojo/NodeList-dom","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/popup","dojox/html/ellipsis","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/editors/ContentBlockEditorViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!./templates/ContentBlockEditor.html","dojo/NodeList-manipulate"],function(_1e76,_1e77,event,_1e78,_1e79,_1e7a,html,_1e7b,query,_1e7c,_1e7d,pm,_1e7e,_1e7f,_1e80,res,_1e81){return _1e76([_1e7c,_1e7d,_1e7f],{templateString:_1e81,model:null,contextMenu:null,isDraggable:true,modelBindingMap:{contentLink:["contentLink"],name:["name"],contentGroup:["contentGroup"],roleIdentities:["roleIdentities"],selected:["selected"]},_setSelectedAttr:function(_1e82){this.inherited(arguments);_1e79.toggle(this.itemNode,"epi-content-block-editor-node-selected",_1e82);_1e7a.set(this.iconNodeMenu,"visibility",_1e82?"visible":"hidden");},_setNameAttr:function(value){this.inherited(arguments);query(this.labelNode).text(value);_1e78.set(this.iconNodeMenu,"title",res.settingstooltip);},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _1e80(this.modelData);},_setIsDraggableAttr:function(_1e83){this._set("isDraggable",_1e83);if(this.isDraggable){_1e79.add(this.domNode,"dojoDndItem");}else{_1e79.remove(this.domNode,"dojoDndItem");}},_onClick:function(evt){event.stop(evt);this.contextMenu&&pm.close(this.contextMenu);this.model.set("selected",!this.model.selected);},_onContextMenu:function(evt){event.stop(evt);this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});}});});},"epi-cms/contentediting/editors/ContentBlockEditorViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1e84,lang,_1e85,_1e86){return _1e84([_1e85,_1e86],{contentLink:"",contentGroup:"",roleIdentities:null,selected:false,name:"",index:0,getValue:function(){return {contentLink:this.contentLink,name:this.name,contentGroup:this.contentGroup,roleIdentities:this.roleIdentities};}});});},"url:epi-cms/contentediting/editors/templates/ContentBlockEditor.html":"<div class=\"epi-content-block-editor\">\r\n    <a href=\"#\" data-dojo-attach-point=\"itemNode\" style=\"display: block;\" data-dojo-attach-event=\"onclick:_onClick\">\r\n        <span data-dojo-attach-point=\"contentNode\" class=\"epi-content-block-node\">\r\n            <span data-dojo-attach-point=\"labelNode\" class=\"dojoxEllipsis\"></span>\r\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-floatRight\">\r\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-iconContextMenu\" style=\"visibility: hidden;\" data-dojo-attach-event=\"onclick:_onContextMenu\"></span>\r\n            </span>\r\n        </span>\r\n    </a>\r\n</div>","url:epi-cms/widget/templates/ContentArea.html":"<div class=\"epi-overlay-blockarea\">\r\n\t<div class=\"epi-overlay-item-container\">\r\n\t\t<div class=\"epi-overlay-bracket\"></div>\r\n\t</div>\r\n\t<div data-dojo-attach-point=\"containerNode\" class=\"epi-overlay-blockarea-container\"></div>\r\n\t<div data-dojo-attach-point=\"actionsNode\" class=\"epi-overlay-blockarea-actionscontainer\">\r\n\t\t<div data-dojo-attach-point=\"actionsNodeControls\" class=\"epi-overlay-blockarea-actions\"></div>\r\n\t</div>\r\n</div>","epi-cms/widget/overlay/ItemCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/widget/overlay/Property"],function(_1e87,lang,_1e88,_1e89){return _1e87([_1e89],{modelType:"epi-cms/contentediting/viewmodel/ItemCollectionViewModel",model:null,postMixInProperties:function(){this.inherited(arguments);this._setupAllowedTypes();this._setupModel(this.contentModel.get(this.name));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_1e8a,_1e8b){this.model.set("data",_1e8b);})));},onDrop:function(_1e8c,value){this.model.addTo(value,null,false);},_setupModel:function(data){require([this.modelType],lang.hitch(this,function(_1e8d){this.model=new _1e8d(data,this.modelParams);this.own(this.model.on("changed",lang.hitch(this,function(_1e8e){this.onValueChange({propertyName:this.name,value:this.model.get("value")});})));}));},_setupAllowedTypes:function(){var _1e8f=this.modelParams.itemConverterKey,_1e90=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_1e8f){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_1e8f;});}if(_1e90){this.allowedDndTypes.unshift(_1e90);}}});});},"epi-cms/widget/ReadOnlyDateTimeEditor":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","epi/datetime","dojo/text!./templates/ReadOnlyDateTimeEditor.html"],function(_1e91,_1e92,_1e93,_1e94,_1e95){return _1e91([_1e92,_1e93],{templateString:_1e95,value:null,_setValueAttr:function(value){this._set("value",value);if(value){this.valueNode.innerHTML=_1e94.toUserFriendlyHtml(value);}}});});},"url:epi-cms/widget/templates/ReadOnlyDateTimeEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\n    <span data-dojo-attach-point=\"valueNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\n</div>","epi-cms/widget/UrlContentSelector":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/when","epi","epi/Url","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/widget/ContentSelector"],function(_1e96,_1e97,lang,when,epi,Url,_1e98,_1e99,_1e9a){return _1e96([_1e9a],{_contentData:null,_isValueInitilized:false,_setValueAndFireOnChange:function(value){var _1e9b;if(this._valueChangedPromise){this._valueChangedPromise.cancel("");this._valueChangedPromise=null;}if(!value){this._updateDisplayNode(null);_1e9b=this.value!==value;this.value=value;this._contentData=null;if(_1e9b&&this._isValueInitilized){this.onChange(value);}this._started&&this.validate();this._isValueInitilized=true;return;}when(this._getContentByPermanentLink(value),lang.hitch(this,function(_1e9c){this._updateDisplayNode(_1e9c);var _1e9d=_1e9c.permanentLink;this._started&&this.validate();_1e9b=!epi.areEqual(this.value,_1e9d);this.value=_1e9d;if(this._isValueInitilized&&_1e9b){this.onChange(_1e9d);}this._isValueInitilized=true;}));},_convertValueToContentReference:function(value){if(this._contentData){return new _1e98(this._contentData.contentLink);}return null;},_getContentByPermanentLink:function(value){if(epi.areEqual(this.value,value)&&this._contentData){return this._contentData;}this._valueChangedPromise=new _1e97();when(_1e99.getContent(value,{allLanguages:true}),lang.hitch(this,function(_1e9e){this._contentData=_1e9e;if(this._valueChangedPromise){this._valueChangedPromise.resolve(_1e9e);}}));return this._valueChangedPromise.promise;}});});},"epi-cms/widget/UrlSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/when","dojo/aspect","dojo/Deferred","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi/Url","epi-cms/widget/LinkEditor","epi-cms/widget/_SelectorBase","epi-cms/core/PermanentLinkHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink"],function(_1e9f,lang,_1ea0,_1ea1,when,_1ea2,_1ea3,_1ea4,_1ea5,Url,_1ea6,_1ea7,_1ea8,res){return _1e9f([_1ea7,_1ea4],{resource:res,linkHelper:_1ea8,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _1ea9=_1e9f(this.modelClassName);this.model=new _1ea9();}},startup:function(){if(this._started){return;}this.inherited(arguments);!this.value&&this.set("value",null);},isValid:function(){return (!this.required||(!this.get("isEmpty")));},_onDialogShow:function(){this.inherited(arguments);var link=this.get("value");this.dialogContent.set("value",{href:link});},_onDialogExecute:function(){var _1eaa=this.dialogContent.get("value");this.set("value",_1eaa.href);},_getDialog:function(){this.dialogContent=new _1ea6({modelType:this.metadata.additionalValues["modelType"],hiddenFields:["text","title","target","language"]});this.own(this.dialogContent);return new _1ea5({title:this._getTitle(),dialogClass:"epi-dialog-portrait",content:this.dialogContent,destroyOnHide:false,defaultActionsVisible:false});},_setValueAttr:function(value){if(!value){this.set("isEmpty",true);this._setValueAndFireOnChange(null);return;}this.set("isEmpty",false);this._setValueAndFireOnChange(value);},_setValueAndFireOnChange:function(value){var _1eab=this.get("value");this._set("value",value);var _1eac=true;if(!_1eab&&!value){_1eac=false;}else{if(value&&value===_1eab){_1eac=false;}}if(_1eac){this.onChange(value);}if(this._valueChangedPromise){this._valueChangedPromise.cancel("");this._valueChangedPromise=null;}if(value){this._getLinkName(value).then(lang.hitch(this,this._updateDisplayNode));}else{this._updateDisplayNode(null);}},_getLinkName:function(value){this._valueChangedPromise=new _1ea3();when(this.linkHelper.getContent(value,{allLanguages:true}),lang.hitch(this,function(_1ead){var _1eae={name:_1ead?_1ead.name:value};if(this._valueChangedPromise){this._valueChangedPromise.resolve(_1eae);}}));return this._valueChangedPromise.promise;},_getTitle:function(){return lang.replace(this.value?this.resource.title.template.edit:this.resource.title.template.create,this.resource.title.action);}});});},"epi-cms/widget/XFormEditor":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/when","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/html","dijit/focus","dijit/form/Button","epi/shell/widget/dialog/Dialog","epi/dependency","epi-cms/legacy/LegacyFormEditor","epi-cms/_ContentContextMixin","epi-cms/legacy/LegacyDialogPopup","epi/routes","epi-cms/widget/XFormPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_1eaf,event,lang,when,_1eb0,_1eb1,_1eb2,query,html,_1eb3,_1eb4,_1eb5,_1eb6,_1eb7,_1eb8,_1eb9,_1eba,_1ebb,res,_1ebc){return _1eaf([_1eb7,_1eb8],{localization:lang.mixin(res,_1ebc),destroyOnHide:true,editorWidgetClass:_1ebb,store:null,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft dijitInputContainer epi-xFormEditor\">                <div data-dojo-attach-point=\"output\" data-dojo-type=\"dijit/form/TextBox\" value=\"${localization.helptext}\"></div>                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.buttonlabel}'\"></div>                <a href=\"#\" data-dojo-attach-point=\"viewDataLink\" data-dojo-attach-event=\"click: _openViewDataDialog\" title=\"${localization.viewdata.tooltip}\" class=\"disabled\">${localization.viewdata.text}</a>            </div>",postMixInProperties:function(){this.inherited(arguments);var _1ebd=_1eb6.resolve("epi.storeregistry");this.store=this.store||_1ebd.get("epi.cms.xform");},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},openEditor:function(){this.inherited(arguments);this.onFocus();},_createDialog:function(){if(this.contentLink){lang.mixin(this.params,{contentLink:this.contentLink});}else{when(this.getCurrentContext(),lang.hitch(this,function(_1ebe){lang.mixin(this.params,{contentLink:_1ebe.id});}));}this.inherited(arguments);},_openViewDataDialog:function(evt){event.stop(evt);if(_1eb0.contains(this.viewDataLink,"disabled")){return;}this._showFormDataDialog("Edit/XFormViewData.aspx",this.contentLink,this.value);},_onCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_onDialogCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_showFormDataDialog:function(path,_1ebf,_1ec0){var route=_1eba.getActionPath({id:_1ebf,path:path,moduleArea:"LegacyCMS",IsInLegacyWrapper:true,formid:_1ec0}),_1ec1=new _1eb9({url:route,dialogArguments:window.document,showCancelButton:true,features:{width:750,height:300},autoFit:true,showLoadingOverlay:false});this.connect(_1ec1,"onLoad",function(_1ec2){if(!_1ec2){return;}var h1=query("h1[class=\"EP-prefix\"]",_1ec2.containerIframe.contentDocument.body);_1eb2.create("span",{innerHTML:this.localization.viewdata.forms+" >"},h1.parent()[0],"first");var _1ec3=query("select[id$=\"SelectForm\"]",_1ec2.containerIframe.contentDocument.body);if(_1ec3){_1eb1.set(_1ec3.parent()[0],"display","none");}var _1ec4=query("input[type=\"checkbox\"][id$=\"ShowResultFromAllPages\"]",_1ec2.containerIframe.contentDocument.body);if(_1ec4){_1eb1.set(_1ec4.parent()[0],"display","none");}});_1ec1.show();},_setDisplayTextAndValue:function(value){this.output.set("value",value);this.output.set("title",value);},setDisplayValue:function(value){if(!value){this._setDisplayTextAndValue(this.localization.helptext);_1eb0.add(this.viewDataLink,"disabled");return;}this._updateDisplayPromise=when(this.store.query({id:value}),lang.hitch(this,function(_1ec5){this._updateDisplayPromise=null;if(_1ec5&&_1ec5.name){this._setDisplayTextAndValue(_1ec5.name);this.contentLink&&_1eb0.remove(this.viewDataLink,"disabled");}else{this.set("value",null);}}));}});});},"epi-cms/widget/XFormPropertyWidget":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/epi","epi/routes","epi-cms/legacy/LegacyDialogWrapper","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_1ec6,lang,epi,_1ec7,_1ec8,_1ec9,res){return _1ec6([_1ec8],{title:res.selectform,onChange:function(_1eca){},postMixInProperties:function(){this.features=lang.mixin({width:800,height:400},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);this.set("url",this._buildIframeUrl());},onCancel:function(){},_buildIframeUrl:function(){var _1ecb={moduleArea:"LegacyCMS",path:"edit/XFormSelect.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};lang.mixin(_1ecb,{pageId:new _1ec9(this.contentLink).createVersionUnspecificReference().id,form:this.value?this.value:""});return _1ec7.getActionPath(_1ecb);},_onCallback:function(_1ecc){var _1ecd=_1ecc?_1ecc.id:null;if(!epi.areEqual(this.value,_1ecd)&&_1ecc!==null){this.value=_1ecd;this.onChange(_1ecd);}else{this.onCancel();}}});});},"*now":function(r){r(["dojo/i18n!*preload*epi-cms/nls/widgets*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);}}});