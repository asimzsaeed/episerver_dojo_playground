(function(){var e=tinymce.dom.Event,t=(tinymce.each,tinymce.DOM);tinymce.create("tinymce.plugins.ContextMenu",{init:function(t){function n(t,a){return i=null,a&&2==a.button?(i=t.selection.getRng(),void 0):(o._menu&&(o._menu.removeAll(),o._menu.destroy(),e.remove(t.getDoc(),"click",n)),void 0)}var i,o=this;o.editor=t,o.onContextMenu=new tinymce.util.Dispatcher(this),t.onContextMenu.add(function(t,a){a.ctrlKey||(i&&t.selection.setRng(i),o._getMenu(t).showMenu(a.clientX,a.clientY),e.add(t.getDoc(),"click",function(e){n(t,e)}),e.cancel(a))}),t.onRemove.add(function(){o._menu&&o._menu.removeAll()}),t.onMouseDown.add(n),t.onKeyDown.add(n)},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(e){var n,i,o,a=this,r=a._menu,s=e.selection,l=s.isCollapsed(),u=s.getNode()||e.getBody();return r&&(r.removeAll(),r.destroy()),i=t.getPos(e.getContentAreaContainer()),o=t.getPos(e.getContainer()),r=e.controlManager.createDropMenu("contextmenu",{offset_x:i.x+e.getParam("contextmenu_offset_x",0),offset_y:i.y+e.getParam("contextmenu_offset_y",0),constrain:1}),a._menu=r,r.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(l),r.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(l),r.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"}),("A"==u.nodeName&&!e.dom.getAttrib(u,"name")||!l)&&(r.addSeparator(),r.add({title:"advanced.link_desc",icon:"link",cmd:e.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),r.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"})),r.addSeparator(),r.add({title:"advanced.image_desc",icon:"image",cmd:e.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),r.addSeparator(),n=r.addMenu({title:"contextmenu.align"}),n.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),n.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),n.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),n.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),a.onContextMenu.dispatch(a,r,u,l),r}}),tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();