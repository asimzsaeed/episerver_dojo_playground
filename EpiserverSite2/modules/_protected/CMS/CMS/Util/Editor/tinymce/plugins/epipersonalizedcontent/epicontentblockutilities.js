(function(e,t){epiContentBlockUtilities=function(){var n=null,i={_isNull:function(e){return null===e||e===void 0},_getParentNode:function(e,t){return this.ed.dom.hasClass(e,t)?e:this.ed.dom.getParent(e,"."+t)},_updateCommandState:function(e){return e&&null!==n&&n!=this?(this._disabled=!1,!0):e?(this._disabled&&(this._setDisabled(!1,this._enabledControls),n=null),!0):(this._setDisabled(!0,this._enabledControls),n=this,!1)},_setDisabled:function(t,n){var i,o=n.split(",");n="";var r="|"+this.ed.id+"_",a=o.length;for(i=0;a>i;i++)n=n+r+e.trim(o[i]);n+="|",e.each(this.ed.controlManager.controls,function(e){0>n.indexOf("|"+e.id+"|")&&(e.setDisabled(t),t&&e.setActive(!1))}),this._addRemoveInputBlockingEventHandlers(t),this._disabled=t},_addRemoveInputBlockingEventHandlers:function(e){e!==this._disabled&&(e?(this.ed.onKeyDown.addToTop(this._block,this),this.ed.onKeyPress.addToTop(this._block,this),this.ed.onKeyUp.addToTop(this._block,this),this.ed.onPaste.addToTop(this._block,this)):(this.ed.onKeyDown.remove(this._block,this),this.ed.onKeyPress.remove(this._block,this),this.ed.onKeyUp.remove(this._block,this),this.ed.onPaste.remove(this._block,this)))},_moveSelection:function(e,n){var i,o=this.ed.dom.getRoot();if(o.createTextRange&&!this._isIE9StandardMode()){if(i=o.createTextRange(),n&&!e.canHaveHTML&&3!=e.nodeType&&e.previousSibling){var r=this.ed.dom.doc.createTextNode("");this.ed.dom.insertAfter(r,e.previousSibling),e=r}if(3==e.nodeType){var a=String.fromCharCode(160);if(n)null===e.data.match("^"+a)&&(e.data=a+e.data),e.nodeValue="~~~造"+e.data,i.findText("~~~造"),i.collapse(!1),e.replaceData(0,4,""),i.moveStart("character",1);else{e.nodeValue=e.data+"~~~造";var s=e.data.length;i.findText("~~~造"),i.collapse(!0),e.replaceData(s-4,4,"")}}else{if(i.moveToElementText(e),!n&&this.ed.dom.isBlock(e)){i.moveEnd("character",-1);var l=t(":last",e)[0];this._isNull(l)||"BR"!=l.tagName||i.moveEnd("character",-1)}i.collapse(n)}}else i=this.ed.dom.createRng(),1!==e.nodeType||"IMG"!==e.tagName&&"HR"!==e.TagName?(n&&3===e.nodeType&&""===e.textContent&&(e.textContent=String.fromCharCode(160)),i.selectNodeContents(e),i.collapse(n)):i.setStartBefore(e);this.ed.selection.setRng(i)},_insertContent:function(t){var n="";this.ed.focus();var i=this.ed.selection.getNode();i&&"P"===i.tagName&&i.firstChild&&"BR"==i.firstChild.nodeName&&this.ed.selection.select(i),this.ed.selection.setContent('<br class="_mce_marker" />'),e.each("h1,h2,h3,h4,h5,h6,p".split(","),function(e){n&&(n+=","),n+=e+" ._mce_marker"});var o=this;e.each(this.ed.dom.select(n),function(e){o.ed.dom.split(o.ed.dom.getParent(e,"h1,h2,h3,h4,h5,h6,p"),e)});var r=this.ed.dom.create("div",null,t).firstChild;return this.ed.dom.replace(r,this.ed.dom.select("br._mce_marker")[0]),r},_insertInlineContent:function(e){this.ed.focus();var t=this.ed.selection.getNode();if(t===this.ed.getBody()){var n=this.ed.dom.create(this.ed.getParam("element"));this.ed.dom.add(t,n),this.ed.selection.select(n),this.ed.selection.collapse()}var i=this.ed.dom.create("span",null,e).firstChild;return this.ed.selection.setContent('<span class="_mce_marker">&nbsp;</span>'),this.ed.dom.replace(i,this.ed.dom.select("._mce_marker",this.ed.selection.getNode())[0]),i},_getAllContentGroups:function(){for(var e=this.ed.dom.select("[data-contentgroup!=]"),t="",n=0;e.length>n;n++){var i=e[n].getAttribute("data-contentgroup");if(i&&""!==i){if(t==i||t.indexOf(","+i)>=0||t.indexOf(i+",")>=0)continue;t+=""!==t?","+i:i}}return t},_getChildren:function(e){var t,n=[];if(e.childNodes)for(t=0;e.childNodes.length>t;t++){var i=e.childNodes[t];1==i.nodeType&&n.push(i)}return n},_insertParagraphBefore:function(e){var t=this.ed.dom.create("p",null,'<br _mce_bogus="1" />');e.parentNode.insertBefore(t,e)},_selectContentBlock:function(e,t){var n=e.dom.getRoot();if(n.createControlRange&&!this._isIE9StandardMode()){var i=n.createControlRange();t.setAttribute("contentEditable",!1),i.add(t),e.selection.setRng(i);var o=function(e){e.returnValue=!1};e.dom.unbind(t,"resizestart",o),e.dom.bind(t,"resizestart",o)}else e.selection.isCollapsed()?e.selection.select(t):setTimeout(function(){e.selection.select(t)},0)},_deselectContentBlock:function(e,t){document.selection&&(document.selection.empty(),t.removeAttribute("contentEditable"))},_ensureInitialUndoLevel:function(){this.ed.undoManager.hasUndo()||this.ed.undoManager.add()},_onContentChanged:function(){this.ed.undoManager.add(),this.ed.nodeChanged()},_getCaretPosition:function(e){if(this.ed.selection.isCollapsed()){var t=this.ed.selection.getRng(!0);if(t.startOffset||0==t.startOffset)return t.startOffset;var n="",t=document.selection.createRange(),i=t.duplicate();i.moveToElementText(e),t.text=n;var o=i.text.indexOf(n);return t.moveStart("character",-1),t.text="",o}},_getPreviousCaretNode:function(e){for(;e&&e!=document.body;){var t=this._getPreviousElementNode(e);if(t)return t;e=e.parentNode}return null},_getPreviousElementNode:function(e){for(;e&&e.previousSibling&&1!=e.previousSibling.nodeType;)e=e.previousSibling;return e?e.previousSibling:null},_getNextCaretNode:function(e){for(;e&&e!=document.body;){var t=this._getNextElementNode(e);if(t)return t;e=e.parentNode}return null},_getNextElementNode:function(e){for(;e&&e.nextSibling&&1!=e.nextSibling.nodeType;)e=e.nextSibling;return e?e.nextSibling:null},_caretIsAtTheEnd:function(e,n){if(this.ed.selection.isCollapsed()){0==n||n||(n=this._getCaretPosition(e));var i=this.ed.selection.getRng(!0);if(i.commonAncestorContainer){var o=i.commonAncestorContainer;if(o&&3==o.nodeType){var r=o.textContent?o.textContent.length:o.nodeValue?o.nodeValue.length:-1;return n==r}if(o&&1==o.nodeType){for(var a=n;o.childNodes.length>a;a++)if("BR"!=o.childNodes[a].tagName&&(3!=o.childNodes[a].nodeType||0!=t.trim(o.childNodes[a].textContent).length))return!1;return!0}return!1}return i.parentElement?n==t(i.parentElement()).text().length:!1}return!1},_updateUndoRedoButtons:function(e){e.setDisabled("undo",!this.ed.undoManager.hasUndo()&&!this.ed.typing),e.setDisabled("redo",!this.ed.undoManager.hasRedo())},_isIE9StandardMode:function(){var e=this.ed.dom.getRoot();return this._ie9Std||this._ie9Std===!1||(this._ie9Std=e.createControlRange&&!e.createControlRange().commonParentElement),this._ie9Std}};return i}()})(tinymce,epiJQuery);