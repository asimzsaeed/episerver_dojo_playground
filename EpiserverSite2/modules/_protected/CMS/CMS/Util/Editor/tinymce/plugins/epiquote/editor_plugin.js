(function(e){e.PluginManager.requireLangPack("epiquote"),e.create("tinymce.plugins.epiquote",{init:function(e,t){var n=this;e.addCommand("mceEPiQuote",function(){e.windowManager.open({file:t+"/epiquote.htm",width:350,height:240,inline:1},{plugin_url:t})}),e.addButton("epiquote",{title:"epiquote.desc",cmd:"mceEPiQuote","class":"mce_blockquote"}),e.addShortcut("ctrl+shift+q","epiquote.desc","mceEPiQuote"),e.onNodeChange.add(function(e,t,n,i){var o=null!=e.dom.getParent(n,"q")||null!=e.dom.getParent(n,"blockquote");t.setDisabled("epiquote",i&&!o),t.setActive("epiquote",o)}),e.onKeyUp.addToTop(function(e,t){if(13==t.keyCode){if(t.shiftKey||t.altKey||t.ctrlKey)return;n._quoteEscape(e,t)}})},_quoteEscape:function(t,n){function i(e){return""==e.innerHTML||" "==e.innerHTML||"<br>"==e.innerHTML}var o,r=t.selection,a=r.getNode(),s=t.dom.getParent(a,"blockquote");if(null!=s){var l=s.childNodes,d=l.length;i(a)&&l[d-1]===a&&i(l[d-2])&&(t.dom.remove(l[d-2]),t.dom.remove(a),o=t.dom.create("p",null," "),t.dom.insertAfter(o,s),r.select(o,!0),r.collapse(),e.dom.Event.cancel(n),t.undoManager.add())}},getInfo:function(){return{longname:"Quote plugin",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:"1.0"}}}),e.PluginManager.add("epiquote",e.plugins.epiquote)})(tinymce,epiJQuery);