tinyMCEPopup.requireLangPack();var epiquote={init:function(){var e,t,n,i="disabled",o="checked",r=this,a=document.forms[0],s=tinyMCEPopup.editor,l=s.selection;if(t=s.dom.getParent(l.getNode(),"q"),tinyMCEPopup.resizeToInnerSize(),null==t&&(t=s.dom.getParent(l.getNode(),"blockquote")),null!=t){for(r._bookmark=l.getBookmark(),e=0;a.quoteType.length>e;e++)a.quoteType[e].setAttribute(i,i);n="BLOCKQUOTE"==t.nodeName?a.blockquote:a.quote,n.removeAttribute(i),n.setAttribute(o,o),a.title.value=t.title,a.cite.value=t.cite,a.insert.value=s.getLang("update"),a.remove.style.display="",document.title=document.getElementById("general_tab_title").innerHTML=s.getLang("epiquote_dlg.titleupdate")}epiquote._inlineQuoteEnabled()||a.quote.setAttribute(i,i)},insert:function(){var e,t,n,i,o,r,a,s,l=document.forms[0],d=tinyMCEPopup.editor,c=this,u={},m="q";tinyMCEPopup.restoreSelection();var g=d.selection;for(c._bookmark&&g.moveToBookmark(c._bookmark),t=0;l.quoteType.length>t;t++)l.quoteType[t].checked&&(n=l.quoteType[t].value);if(epiquote._trimSelection(g),l.title.value.length&&(u.title=l.title.value),l.cite.value.length&&(u.cite=l.cite.value),n===m){var p=g.getNode();e=d.dom.getParent(p,n),o=d.dom.getParent(p,d.dom.isBlock,d.getBody()),r=g.getContent().toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,""),a=d.dom.getOuterHTML(o).toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,""),s=r===a}if(null==e){if(n===m&&!epiquote._inlineQuoteEnabled())return alert(d.getLang("epiquote_dlg.invalidselectionforq")),!1;i=s?o.innerHTML:g.getContent(),i=d.dom.createHTML(n,u,i),s&&(i=d.dom.createHTML("p",{},i)),tinymce.isGecko?d.execCommand("insertHTML",!1,i):tinymce.isIE&&"Control"===d.selection.getSel().type?d.dom.setOuterHTML(d.selection.getSel().createRange().item(0),i):d.execCommand("mceInsertContent",!1,i)}else d.dom.setAttribs(e,u);d.undoManager.add(),tinyMCEPopup.close()},remove:function(){var e,t,n,i=this,o=document.forms[0],r=tinyMCEPopup.editor;for(tinyMCEPopup.restoreSelection(),s=r.selection,i._bookmark&&s.moveToBookmark(i._bookmark),e=0;o.quoteType.length>e;e++)o.quoteType[e].checked&&(t=o.quoteType[e].value);n=r.dom.getParent(s.getNode(),t),tinyMCEPopup.execCommand("mceRemoveNode",r,n),tinyMCEPopup.close()},_inlineQuoteEnabled:function(){var t=tinyMCEPopup.editor,n=t.selection;if(e=n.getNode(),t.dom.getOuterHTML(e)===n.getContent()&&t.dom.isBlock(e))return!1;switch(e.nodeName){case"BODY":case"TD":case"TH":case"UL":case"OL":case"BLOCKQUOTE":return!1}return!0},_trimSelection:function(e){var t,n,i,o,r=e.getRng();tinyMCEPopup.editor,r.toString?t=""+r:r.text&&(t=r.text),t&&t.length&&t.length!=tinymce.trim(t).length&&(n=t.length,i=n-t.replace(/^\s+/,"").length,o=n-t.search(/\s+$/),r.toString||r.text&&(r.moveStart("character",i),r.moveEnd("character",-o)),e.setRng(r))}};tinyMCEPopup.onInit.add(epiquote.init,epiquote);