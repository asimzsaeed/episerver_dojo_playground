(function(){tinymce.create("tinymce.plugins.FullPagePlugin",{init:function(e,t){var n=this;n.editor=e,e.addCommand("mceFullPageProperties",function(){e.windowManager.open({file:t+"/fullpage.htm",width:430+parseInt(e.getLang("fullpage.delta_width",0)),height:495+parseInt(e.getLang("fullpage.delta_height",0)),inline:1},{plugin_url:t,head_html:n.head})}),e.addButton("fullpage",{title:"fullpage.desc",cmd:"mceFullPageProperties"}),e.onBeforeSetContent.add(n._setContent,n),e.onSetContent.add(n._setBodyAttribs,n),e.onGetContent.add(n._getContent,n)},getInfo:function(){return{longname:"Fullpage",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/fullpage",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_setBodyAttribs:function(e){var t,n,i,o,a,r,s,l=this.head.match(/body(.*?)>/i);if(l&&l[1]&&(t=l[1].match(/\s*(\w+\s*=\s*".*?"|\w+\s*=\s*'.*?'|\w+\s*=\s*\w+|\w+)\s*/g)))for(n=0,i=t.length;i>n;n++)o=t[n].split("="),a=o[0].replace(/\s/,""),r=o[1],r?(r=r.replace(/^\s+/,"").replace(/\s+$/,""),s=r.match(/^["'](.*)["']$/),s&&(r=s[1])):r=a,e.dom.setAttrib(e.getBody(),"style",r)},_createSerializer:function(){return new tinymce.dom.Serializer({dom:this.editor.dom,apply_source_formatting:!0})},_setContent:function(e,t){function n(e){return e.replace(/<\/?[A-Z]+/g,function(e){return e.toLowerCase()})}var i,o,a,r=this,s=t.content,l="";"raw"==t.format&&r.head||t.source_view&&e.getParam("fullpage_hide_in_source_view")||(s=s.replace(/<(\/?)BODY/gi,"<$1body"),i=s.indexOf("<body"),-1!=i?(i=s.indexOf(">",i),r.head=s.substring(0,i+1),o=s.indexOf("</body",i),-1==o&&(o=s.indexOf("</body",o)),t.content=s.substring(i+1,o),r.foot=s.substring(o),r.head=n(r.head),r.foot=n(r.foot)):(r.head="",e.getParam("fullpage_default_xml_pi")&&(r.head+='<?xml version="1.0" encoding="'+e.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n'),r.head+=e.getParam("fullpage_default_doctype",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'),r.head+="\n<html>\n<head>\n<title>"+e.getParam("fullpage_default_title","Untitled document")+"</title>\n",(a=e.getParam("fullpage_default_encoding"))&&(r.head+='<meta http-equiv="Content-Type" content="'+a+'" />\n'),(a=e.getParam("fullpage_default_font_family"))&&(l+="font-family: "+a+";"),(a=e.getParam("fullpage_default_font_size"))&&(l+="font-size: "+a+";"),(a=e.getParam("fullpage_default_text_color"))&&(l+="color: "+a+";"),r.head+="</head>\n<body"+(l?' style="'+l+'"':"")+">\n",r.foot="\n</body>\n</html>"))},_getContent:function(e,t){var n=this;t.source_view&&e.getParam("fullpage_hide_in_source_view")||(t.content=tinymce.trim(n.head)+"\n"+tinymce.trim(t.content)+"\n"+tinymce.trim(n.foot))}}),tinymce.PluginManager.add("fullpage",tinymce.plugins.FullPagePlugin)})();