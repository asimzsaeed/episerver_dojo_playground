(function(){var e=tinymce.DOM,t=tinymce.dom.Element,n=tinymce.dom.Event,i=tinymce.each,o=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(t,n){t.onBeforeRenderUI.add(function(){t.windowManager=new tinymce.InlineWindowManager(t),e.loadCSS(n+"/skins/"+(t.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(e){var t=this;t.parent(e),t.zIndex=3e5,t.count=0,t.windows={}},open:function(i,o){var a,r,l,s,d,c,u=this,m="",g=u.editor,p=0,h=0;return i=i||{},o=o||{},i.inline?(i.type||(u.bookmark=g.selection.getBookmark(1)),a=e.uniqueId(),r=e.getViewPort(),i.width=parseInt(i.width||320),i.height=parseInt(i.height||240)+(tinymce.isIE?8:0),i.min_width=parseInt(i.min_width||150),i.min_height=parseInt(i.min_height||100),i.max_width=parseInt(i.max_width||2e3),i.max_height=parseInt(i.max_height||2e3),i.left=i.left||Math.round(Math.max(r.x,r.x+r.w/2-i.width/2)),i.top=i.top||Math.round(Math.max(r.y,r.y+r.h/2-i.height/2)),i.movable=i.resizable=!0,o.mce_width=i.width,o.mce_height=i.height,o.mce_inline=!0,o.mce_window_id=a,o.mce_auto_focus=i.auto_focus,u.features=i,u.params=o,u.onOpen.dispatch(u,i,o),i.type&&(m+=" mceModal",i.type&&(m+=" mce"+i.type.substring(0,1).toUpperCase()+i.type.substring(1)),i.resizable=!1),i.statusbar&&(m+=" mceStatusbar"),i.resizable&&(m+=" mceResizable"),i.minimizable&&(m+=" mceMinimizable"),i.maximizable&&(m+=" mceMaximizable"),i.movable&&(m+=" mceMovable"),u._addAll(e.doc.body,["div",{id:a,"class":(g.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:a+"_wrapper","class":"mceWrapper"+m},["div",{id:a+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:a+"_title"},i.title||""]],["div",{id:a+"_middle","class":"mceMiddle"},["div",{id:a+"_left","class":"mceLeft"}],["span",{id:a+"_content"}],["div",{id:a+"_right","class":"mceRight"}]],["div",{id:a+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:a+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:a+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]),e.setStyles(a,{top:-1e4,left:-1e4}),tinymce.isGecko&&e.setStyle(a,"overflow","auto"),i.type||(p+=e.get(a+"_left").clientWidth,p+=e.get(a+"_right").clientWidth,h+=e.get(a+"_top").clientHeight,h+=e.get(a+"_bottom").clientHeight),e.setStyles(a,{top:i.top,left:i.left,width:i.width+p,height:i.height+h}),c=i.url||i.file,c&&(tinymce.relaxedDomain&&(c+=(-1==c.indexOf("?")?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),c=tinymce._addVer(c)),i.type?(e.add(a+"_wrapper","a",{id:a+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),"confirm"==i.type&&e.add(a+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),e.add(a+"_middle","div",{"class":"mceIcon"}),e.setHTML(a+"_content",i.content.replace("\n","<br />"))):(e.add(a+"_content","iframe",{id:a+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),e.setStyles(a+"_ifr",{width:i.width,height:i.height}),e.setAttrib(a+"_ifr","src",c)),l=n.add(a,"mousedown",function(t){var n,i,o=t.target;if(n=u.windows[a],u.focus(a),"A"==o.nodeName||"a"==o.nodeName)if("mceMax"==o.className)n.oldPos=n.element.getXY(),n.oldSize=n.element.getSize(),i=e.getViewPort(),i.w-=2,i.h-=2,n.element.moveTo(i.x,i.y),n.element.resizeTo(i.w,i.h),e.setStyles(a+"_ifr",{width:i.w-n.deltaWidth,height:i.h-n.deltaHeight}),e.addClass(a+"_wrapper","mceMaximized");else if("mceMed"==o.className)n.element.moveTo(n.oldPos.x,n.oldPos.y),n.element.resizeTo(n.oldSize.w,n.oldSize.h),n.iframeElement.resizeTo(n.oldSize.w-n.deltaWidth,n.oldSize.h-n.deltaHeight),e.removeClass(a+"_wrapper","mceMaximized");else{if("mceMove"==o.className)return u._startDrag(a,t,o.className);if(e.hasClass(o,"mceResize"))return u._startDrag(a,t,o.className.substring(13))}}),s=n.add(a,"click",function(e){var t=e.target;if(u.focus(a),"A"==t.nodeName||"a"==t.nodeName)switch(t.className){case"mceClose":return u.close(null,a),n.cancel(e);case"mceButton mceOk":case"mceButton mceCancel":return i.button_func("mceButton mceOk"==t.className),n.cancel(e)}}),d=u.windows[a]={id:a,mousedown_func:l,click_func:s,element:new t(a,{blocker:1,container:g.getContainer()}),iframeElement:new t(a+"_ifr"),features:i,deltaWidth:p,deltaHeight:h},d.iframeElement.on("focus",function(){u.focus(a)}),0==u.count&&"modal"==u.editor.getParam("dialog_type","modal")?(e.add(e.doc.body,"div",{id:"mceModalBlocker","class":(u.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:u.zIndex-1}}),e.show("mceModalBlocker")):e.setStyle("mceModalBlocker","z-index",u.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceModalBlocker",{position:"absolute",left:r.x,top:r.y,width:r.w-2,height:r.h-2}),u.focus(a),u._fixIELayout(a,1),e.get(a+"_ok")&&e.get(a+"_ok").focus(),u.count++,d):u.parent(i,o)},focus:function(t){var n,i=this;(n=i.windows[t])&&(n.zIndex=this.zIndex++,n.element.setStyle("zIndex",n.zIndex),n.element.update(),t+="_wrapper",e.removeClass(i.lastId,"mceFocus"),e.addClass(t,"mceFocus"),i.lastId=t)},_addAll:function(e,t){var n,i=this,a=tinymce.DOM;if(o(t,"string"))e.appendChild(a.doc.createTextNode(t));else if(t.length)for(e=e.appendChild(a.create(t[0],t[1])),n=2;t.length>n;n++)i._addAll(e,t[n])},_startDrag:function(i,o,a){function r(){d||(P._fixIELayout(i,0),e.add(E.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(P.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:P.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceEventBlocker",{position:"absolute",left:p.x,top:p.y,width:p.w-2,height:p.h-2}),d=new t("mceEventBlocker"),d.update(),c=M.getXY(),u=M.getSize(),h=g.x+c.x-p.x,f=g.y+c.y-p.y,e.add(d.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:h,top:f,width:u.w,height:u.h}}),m=new t("mcePlaceHolder"))}var l,s,d,c,u,m,g,p,h,f,v,y,_,C,b,w,P=this,E=e.doc,k=P.windows[i],M=k.element;return M.getXY(),g={x:0,y:0},p=e.getViewPort(),p.w-=2,p.h-=2,v=o.screenX,y=o.screenY,_=C=b=w=0,l=n.add(E,"mouseup",function(t){return n.remove(E,"mouseup",l),n.remove(E,"mousemove",s),d&&d.remove(),M.moveBy(_,C),M.resizeBy(b,w),u=M.getSize(),e.setStyles(i+"_ifr",{width:u.w-k.deltaWidth,height:u.h-k.deltaHeight}),P._fixIELayout(i,1),n.cancel(t)}),"Move"!=a&&r(),s=n.add(E,"mousemove",function(e){var t,i,o;switch(r(),t=e.screenX-v,i=e.screenY-y,a){case"ResizeW":_=t,b=0-t;break;case"ResizeE":b=t;break;case"ResizeN":case"ResizeNW":case"ResizeNE":"ResizeNW"==a?(_=t,b=0-t):"ResizeNE"==a&&(b=t),C=i,w=0-i;break;case"ResizeS":case"ResizeSW":case"ResizeSE":"ResizeSW"==a?(_=t,b=0-t):"ResizeSE"==a&&(b=t),w=i;break;case"mceMove":_=t,C=i}return(o=k.features.min_width-u.w)>b&&(0!==_&&(_+=b-o),b=o),(o=k.features.min_height-u.h)>w&&(0!==C&&(C+=w-o),w=o),b=Math.min(b,k.features.max_width-u.w),w=Math.min(w,k.features.max_height-u.h),_=Math.max(_,p.x-(h+p.x)),C=Math.max(C,p.y-(f+p.y)),_=Math.min(_,p.w+p.x-(h+u.w+p.x)),C=Math.min(C,p.h+p.y-(f+u.h+p.y)),0!==_+C&&(0>h+_&&(_=0),0>f+C&&(C=0),m.moveTo(h+_,f+C)),0!==b+w&&m.resizeTo(u.w+b,u.h+w),n.cancel(e)}),n.cancel(o)},resizeBy:function(e,t,n){var i=this.windows[n];i&&(i.element.resizeBy(e,t),i.iframeElement.resizeBy(e,t))},close:function(t,o){var a,r,o,l=this,s=e.doc,d=0;return o=l._findId(o||t),l.windows[o]?(l.count--,0==l.count&&e.remove("mceModalBlocker"),(a=l.windows[o])&&(l.onClose.dispatch(l),n.remove(s,"mousedown",a.mousedownFunc),n.remove(s,"click",a.clickFunc),n.clear(o),n.clear(o+"_ifr"),e.setAttrib(o+"_ifr","src",'javascript:""'),a.element.remove(),delete l.windows[o],i(l.windows,function(e){e.zIndex>d&&(r=e,d=e.zIndex)}),r&&l.focus(r.id)),void 0):(l.parent(t),void 0)},setTitle:function(t,n){var i;t=this._findId(t),(i=e.get(t+"_title"))&&(i.innerHTML=e.encode(n))},alert:function(t,n){var i,o=this;i=o.open({title:o,type:"alert",button_func:function(e){n&&n.call(e||o,e),o.close(null,i.id)},content:e.encode(o.editor.getLang(t,t)),inline:1,width:400,height:130})},confirm:function(t,n){var i,o=this;i=o.open({title:o,type:"confirm",button_func:function(e){n&&n.call(e||o,e),o.close(null,i.id)},content:e.encode(o.editor.getLang(t,t)),inline:1,width:400,height:130})},_findId:function(t){var n=this;return"string"==typeof t?t:(i(n.windows,function(n){var i=e.get(n.id+"_ifr");return i&&t==i.contentWindow?(t=n.id,!1):void 0}),t)},_fixIELayout:function(t,n){var o,a;tinymce.isIE6&&(i(["n","s","w","e","nw","ne","sw","se"],function(i){var o=e.get(t+"_resize_"+i);e.setStyles(o,{width:n?o.clientWidth:"",height:n?o.clientHeight:"",cursor:e.getStyle(o,"cursor",1)}),e.setStyle(t+"_bottom","bottom","-1px"),o=0}),(o=this.windows[t])&&(o.element.hide(),o.element.show(),i(e.select("div,a",t),function(e){"none"!=e.currentStyle.backgroundImage&&(a=new Image,a.src=e.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),e.get(t).style.filter=""))}}),tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();