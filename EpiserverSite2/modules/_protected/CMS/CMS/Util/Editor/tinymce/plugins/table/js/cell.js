function init(){ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=ed.dom.getParent(ed.selection.getStart(),"td,th"),t=document.forms[0],n=ed.dom.parseStyle(ed.dom.getAttrib(e,"style")),i=e.nodeName.toLowerCase(),o=ed.dom.getAttrib(e,"align"),a=ed.dom.getAttrib(e,"valign"),l=trimSize(getStyle(e,"width","width")),r=trimSize(getStyle(e,"height","height")),s=convertRGBToHex(getStyle(e,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(e,"bgcolor","backgroundColor")),d=ed.dom.getAttrib(e,"class"),u=getStyle(e,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),m=ed.dom.getAttrib(e,"id"),g=ed.dom.getAttrib(e,"lang"),p=ed.dom.getAttrib(e,"dir"),h=ed.dom.getAttrib(e,"scope");addClassesToList("class",tinyMCEPopup.getParam("style_formats",!1)?{tag:"TD"}:"table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(e,"mceSelected")?tinyMCEPopup.dom.hide("action"):(t.bordercolor.value=s,t.bgcolor.value=c,t.backgroundimage.value=u,t.width.value=l,t.height.value=r,t.id.value=m,t.lang.value=g,t.style.value=ed.dom.serializeStyle(n),selectByValue(t,"align",o),selectByValue(t,"valign",a),selectByValue(t,"class",d,!0,!0),selectByValue(t,"celltype",i),selectByValue(t,"dir",p),selectByValue(t,"scope",h),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){function e(e){e&&(updateCell(n),ed.addVisual(),ed.nodeChanged(),a.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}var t,n,i,o,a=ed,l=document.forms[0];if(tinyMCEPopup.restoreSelection(),t=ed.selection.getStart(),n=ed.dom.getParent(t,"td,th"),i=ed.dom.getParent(t,"tr"),o=ed.dom.getParent(t,"table"),ed.dom.hasClass(n,"mceSelected"))return tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(e){updateCell(e)}),ed.addVisual(),ed.nodeChanged(),a.execCommand("mceEndUndoLevel"),tinyMCEPopup.close(),void 0;switch(ed.execCommand("mceBeginUndoLevel"),getSelectValue(l,"action")){case"cell":var r=getSelectValue(l,"celltype"),s=getSelectValue(l,"scope");if(ed.getParam("accessibility_warnings",1))return"th"==r&&""==s?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),e):e(1),void 0;updateCell(n);break;case"row":var c=i.firstChild;"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do c=updateCell(c,!0);while(null!=(c=nextCell(c)));break;case"all":for(var d=o.getElementsByTagName("tr"),u=0;d.length>u;u++){var c=d[u].firstChild;"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do c=updateCell(c,!0);while(null!=(c=nextCell(c)))}}ed.addVisual(),ed.nodeChanged(),a.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(e){for(;null!=(e=e.nextSibling);)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function updateCell(e,t){var n=ed,i=document.forms[0],o=e.nodeName.toLowerCase(),a=getSelectValue(i,"celltype"),l=n.getDoc(),r=ed.dom;if(t||e.setAttribute("id",i.id.value),e.setAttribute("align",i.align.value),e.setAttribute("vAlign",i.valign.value),e.setAttribute("lang",i.lang.value),e.setAttribute("dir",getSelectValue(i,"dir")),e.setAttribute("style",ed.dom.serializeStyle(ed.dom.parseStyle(i.style.value))),e.setAttribute("scope",i.scope.value),ed.dom.setAttrib(e,"class",getSelectValue(i,"class")),ed.dom.setAttrib(e,"width",""),ed.dom.setAttrib(e,"height",""),ed.dom.setAttrib(e,"bgColor",""),ed.dom.setAttrib(e,"borderColor",""),ed.dom.setAttrib(e,"background",""),e.style.width=getCSSSize(i.width.value),e.style.height=getCSSSize(i.height.value),""!=i.bordercolor.value?(e.style.borderColor=i.bordercolor.value,e.style.borderStyle=""==e.style.borderStyle?"solid":e.style.borderStyle,e.style.borderWidth=""==e.style.borderWidth?"1px":e.style.borderWidth):e.style.borderColor="",e.style.backgroundColor=i.bgcolor.value,e.style.backgroundImage=""!=i.backgroundimage.value?"url('"+i.backgroundimage.value+"')":"",o!=a){for(var s=l.createElement(a),c=0;e.childNodes.length>c;c++)s.appendChild(e.childNodes[c].cloneNode(1));for(var d=0;e.attributes.length>d;d++)ed.dom.setAttrib(s,e.attributes[d].name,ed.dom.getAttrib(e,e.attributes[d].name));e.parentNode.replaceChild(s,e),e=s}return r.setAttrib(e,"style",r.serializeStyle(r.parseStyle(e.style.cssText))),e}function changedBackgroundImage(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=ed.dom.serializeStyle(t)}function changedSize(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value),n=e.width.value;t.width=""!=n?getCSSSize(n):"";var i=e.height.value;t.height=""!=i?getCSSSize(i):"",e.style.value=ed.dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,t["border-color"]=e.bordercolor.value,e.style.value=ed.dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);e.backgroundimage.value=t["background-image"]?t["background-image"].replace(RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):"",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var ed;tinyMCEPopup.onInit.add(init);