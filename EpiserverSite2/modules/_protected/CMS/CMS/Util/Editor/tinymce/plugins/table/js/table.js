function insertTable(){var e,t,n,i,o,a,l,r,s,c,d,u,m=document.forms[0],g=tinyMCEPopup.editor,p=g.dom,h=2,f=2,_=0,v=-1,y=-1,b="";if(tinyMCEPopup.restoreSelection(),!AutoValidator.validate(m))return tinyMCEPopup.alert(g.getLang("invalid_data")),!1;if(s=p.getParent(g.selection.getNode(),"table"),h=m.elements.cols.value,f=m.elements.rows.value,_=""!=m.elements.border.value?m.elements.border.value:0,v=""!=m.elements.cellpadding.value?m.elements.cellpadding.value:"",y=""!=m.elements.cellspacing.value?m.elements.cellspacing.value:"",e=getSelectValue(m,"align"),a=getSelectValue(m,"tframe"),l=getSelectValue(m,"rules"),t=m.elements.width.value,n=m.elements.height.value,bordercolor=m.elements.bordercolor.value,bgcolor=m.elements.bgcolor.value,i=getSelectValue(m,"class"),id=m.elements.id.value,summary=m.elements.summary.value,style=m.elements.style.value,dir=m.elements.dir.value,lang=m.elements.lang.value,background=m.elements.backgroundimage.value,o=m.elements.caption.checked,c=tinyMCEPopup.getParam("table_cell_limit",!1),d=tinyMCEPopup.getParam("table_row_limit",!1),u=tinyMCEPopup.getParam("table_col_limit",!1),u&&h>u)return tinyMCEPopup.alert(g.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,u)),!1;if(d&&f>d)return tinyMCEPopup.alert(g.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,d)),!1;if(c&&h*f>c)return tinyMCEPopup.alert(g.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,c)),!1;if("update"==action)return g.execCommand("mceBeginUndoLevel"),p.setAttrib(s,"cellPadding",v,!0),p.setAttrib(s,"cellSpacing",y,!0),p.setAttrib(s,"border",_),p.setAttrib(s,"align",e),p.setAttrib(s,"frame",a),p.setAttrib(s,"rules",l),p.setAttrib(s,"class",i),p.setAttrib(s,"style",style),p.setAttrib(s,"id",id),p.setAttrib(s,"summary",summary),p.setAttrib(s,"dir",dir),p.setAttrib(s,"lang",lang),r=g.dom.select("caption",s)[0],r&&!o&&r.parentNode.removeChild(r),!r&&o&&(r=s.ownerDocument.createElement("caption"),tinymce.isIE||(r.innerHTML='<br _mce_bogus="1"/>'),s.insertBefore(r,s.firstChild)),t&&g.settings.inline_styles?(p.setStyle(s,"width",t),p.setAttrib(s,"width","")):(p.setAttrib(s,"width",t,!0),p.setStyle(s,"width","")),p.setAttrib(s,"borderColor",""),p.setAttrib(s,"bgColor",""),p.setAttrib(s,"background",""),n&&g.settings.inline_styles?(p.setStyle(s,"height",n),p.setAttrib(s,"height","")):(p.setAttrib(s,"height",n,!0),p.setStyle(s,"height","")),s.style.backgroundImage=""!=background?"url('"+background+"')":"",""!=bordercolor?(s.style.borderColor=bordercolor,s.style.borderStyle=""==s.style.borderStyle?"solid":s.style.borderStyle,s.style.borderWidth=""==_?"1px":_):s.style.borderColor="",s.style.backgroundColor=bgcolor,s.style.height=getCSSSize(n),g.addVisual(),g.nodeChanged(),g.execCommand("mceEndUndoLevel"),(m.width.value!=orgTableWidth||m.height.value!=orgTableHeight)&&g.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;b+="<table",b+=makeAttrib("id",id),b+=makeAttrib("border",_),b+=makeAttrib("cellpadding",v),b+=makeAttrib("cellspacing",y),b+=makeAttrib("_mce_new","1"),t&&g.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(t)&&(t+="px"),style+="width: "+t):b+=makeAttrib("width",t),b+=makeAttrib("align",e),b+=makeAttrib("frame",a),b+=makeAttrib("rules",l),b+=makeAttrib("class",i),b+=makeAttrib("style",style),b+=makeAttrib("summary",summary),b+=makeAttrib("dir",dir),b+=makeAttrib("lang",lang),b+=">",o&&(b+=tinymce.isIE?"<caption></caption>":'<caption><br _mce_bogus="1"/></caption>');for(var w=0;f>w;w++){b+="<tr>";for(var C=0;h>C;C++)b+=tinymce.isIE?"<td></td>":'<td><br _mce_bogus="1"/></td>';b+="</tr>"}if(b+="</table>",g.execCommand("mceBeginUndoLevel"),g.settings.fix_table_elements){var k="";g.focus(),g.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(e){k&&(k+=","),k+=e+" ._mce_marker"}),tinymce.each(g.dom.select(k),function(e){g.dom.split(g.dom.getParent(e,"h1,h2,h3,h4,h5,h6,p"),e)}),p.setOuterHTML(p.select("br._mce_marker")[0],b)}else g.execCommand("mceInsertContent",!1,b);tinymce.each(p.select("table[_mce_new]"),function(e){var t=p.select("td",e);try{g.selection.select(t[0],!0),g.selection.collapse()}catch(n){}p.setAttrib(e,"_mce_new","")}),g.addVisual(),g.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function makeAttrib(e,t){var n=document.forms[0],i=n.elements[e];return(t===void 0||null==t)&&(t="",i&&(t=i.value)),""==t?"":(t=t.replace(/&/g,"&amp;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")," "+e+'="'+t+'"')}function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=2,t=2,n=tinyMCEPopup.getParam("table_default_border","0"),i=tinyMCEPopup.getParam("table_default_cellpadding",""),o=tinyMCEPopup.getParam("table_default_cellspacing",""),a="",l="",r="",s="",c="",d="",u="",m="",g="",p="",h="",f="",c="",s="",_="",v="",y=tinyMCEPopup.editor,b=y.dom,w=document.forms[0],C=b.getParent(y.selection.getNode(),"table");if(action=tinyMCEPopup.getWindowArg("action"),action||(action=C?"update":"insert"),C&&"insert"!=action){for(var k=C.rows,e=0,x=0;k.length>x;x++)k[x].cells.length>e&&(e=k[x].cells.length);e=e,t=k.length,st=b.parseStyle(b.getAttrib(C,"style")),n=trimSize(getStyle(C,"border","borderWidth")),i=b.getAttrib(C,"cellpadding",""),o=b.getAttrib(C,"cellspacing",""),l=trimSize(getStyle(C,"width","width")),r=trimSize(getStyle(C,"height","height")),s=convertRGBToHex(getStyle(C,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(C,"bgcolor","backgroundColor")),a=b.getAttrib(C,"align",a),v=b.getAttrib(C,"frame"),_=b.getAttrib(C,"rules"),d=tinymce.trim(b.getAttrib(C,"class").replace(/mceItem.+/g,"")),u=b.getAttrib(C,"id"),m=b.getAttrib(C,"summary"),g=b.serializeStyle(st),p=b.getAttrib(C,"dir"),h=b.getAttrib(C,"lang"),f=getStyle(C,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),w.caption.checked=C.getElementsByTagName("caption").length>0,orgTableWidth=l,orgTableHeight=r,action="update",w.insert.value=y.getLang("update")}addClassesToList("class",tinyMCEPopup.getParam("style_formats",!1)?{tag:"TABLE"}:"table_styles"),TinyMCE_EditableSelects.init(),selectByValue(w,"align",a),selectByValue(w,"tframe",v),selectByValue(w,"rules",_),selectByValue(w,"class",d,!0,!0),w.cols.value=e,w.rows.value=t,w.border.value=n,w.cellpadding.value=i,w.cellspacing.value=o,w.width.value=l,w.height.value=r,w.bordercolor.value=s,w.bgcolor.value=c,w.id.value=u,w.summary.value=m,w.style.value=g,w.dir.value=p,w.lang.value=h,w.backgroundimage.value=f,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),"update"==action&&(w.cols.disabled=!0,w.rows.disabled=!0)}function changedSize(){var e=document.forms[0],t=dom.parseStyle(e.style.value),n=e.height.value;t.height=""!=n?getCSSSize(n):"",e.style.value=dom.serializeStyle(t)}function changedBackgroundImage(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=dom.serializeStyle(t)}function changedBorder(){var e=document.forms[0],t=dom.parseStyle(e.style.value);""!=e.border.value&&""!=e.bordercolor.value&&(t["border-width"]=e.border.value+"px"),e.style.value=dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,""!=e.bordercolor.value&&(t["border-color"]=e.bordercolor.value,t["border-width"]||(t["border-width"]=""==e.border.value?"1px":e.border.value+"px")),e.style.value=dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=dom.parseStyle(e.style.value);e.backgroundimage.value=t["background-image"]?t["background-image"].replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):"",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);