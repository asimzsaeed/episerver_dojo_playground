var ImageDialog={preInit:function(){var e;tinyMCEPopup.requireLangPack(),(e=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>')},init:function(){var t=document.forms[0],n=tinyMCEPopup.editor;document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="180px"),e=n.selection.getNode(),this.fillFileList("image_list","tinyMCEImageList"),"IMG"==e.nodeName&&(t.src.value=n.dom.getAttrib(e,"src"),t.alt.value=n.dom.getAttrib(e,"alt"),t.border.value=this.getAttrib(e,"border"),t.vspace.value=this.getAttrib(e,"vspace"),t.hspace.value=this.getAttrib(e,"hspace"),t.width.value=n.dom.getAttrib(e,"width"),t.height.value=n.dom.getAttrib(e,"height"),t.insert.value=n.getLang("update"),this.styleVal=n.dom.getAttrib(e,"style"),selectByValue(t,"image_list",t.src.value),selectByValue(t,"align",this.getAttrib(e,"align")),this.updateStyle())},fillFileList:function(e,t){var n=tinyMCEPopup.dom,i=n.get(e);t=window[t],t&&t.length>0?(i.options[i.options.length]=new Option("",""),tinymce.each(t,function(e){i.options[i.options.length]=new Option(e[0],e[1])})):n.remove(n.getParent(e,"tr"))},update:function(){var e,t=document.forms[0],n=t.elements,i=tinyMCEPopup.editor,o={};return tinyMCEPopup.restoreSelection(),""===t.src.value?("IMG"==i.selection.getNode().nodeName&&(i.dom.remove(i.selection.getNode()),i.execCommand("mceRepaint")),tinyMCEPopup.close(),void 0):(i.settings.inline_styles?o.style=this.styleVal:o=tinymce.extend(o,{vspace:n.vspace.value,hspace:n.hspace.value,border:n.border.value,align:getSelectValue(t,"align")}),tinymce.extend(o,{src:t.src.value,alt:t.alt.value,width:t.width.value,height:t.height.value}),e=i.selection.getNode(),e&&"IMG"==e.nodeName?i.dom.setAttribs(e,o):(i.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" />',{skip_undo:1}),i.dom.setAttribs("__mce_tmp",o),i.dom.setAttrib("__mce_tmp","id",""),i.undoManager.add()),tinyMCEPopup.close(),void 0)},updateStyle:function(){var e,t,n=tinyMCEPopup.dom,i=document.forms[0];tinyMCEPopup.editor.settings.inline_styles&&(e=tinyMCEPopup.dom.parseStyle(this.styleVal),t=getSelectValue(i,"align"),t?"left"==t||"right"==t?(e["float"]=t,delete e["vertical-align"]):(e["vertical-align"]=t,delete e["float"]):(delete e["float"],delete e["vertical-align"]),t=i.border.value,t||"0"==t?e.border="0"==t?"0":t+"px solid black":delete e.border,t=i.hspace.value,t?(delete e.margin,e["margin-left"]=t+"px",e["margin-right"]=t+"px"):(delete e["margin-left"],delete e["margin-right"]),t=i.vspace.value,t?(delete e.margin,e["margin-top"]=t+"px",e["margin-bottom"]=t+"px"):(delete e["margin-top"],delete e["margin-bottom"]),e=tinyMCEPopup.dom.parseStyle(n.serializeStyle(e),"img"),this.styleVal=n.serializeStyle(e,"img"))},getAttrib:function(e,t){var n,i,o=tinyMCEPopup.editor,a=o.dom;if(o.settings.inline_styles)switch(t){case"align":if(n=a.getStyle(e,"float"))return n;if(n=a.getStyle(e,"vertical-align"))return n;break;case"hspace":if(n=a.getStyle(e,"margin-left"),i=a.getStyle(e,"margin-right"),n&&n==i)return parseInt(n.replace(/[^0-9]/g,""));break;case"vspace":if(n=a.getStyle(e,"margin-top"),i=a.getStyle(e,"margin-bottom"),n&&n==i)return parseInt(n.replace(/[^0-9]/g,""));break;case"border":if(n=0,tinymce.each(["top","right","bottom","left"],function(t){return t=a.getStyle(e,"border-"+t+"-width"),!t||t!=n&&0!==n?(n=0,!1):(t&&(n=t),void 0)}),n)return parseInt(n.replace(/[^0-9]/g,""))}return(n=a.getAttrib(e,t))?n:""},resetImageData:function(){var e=document.forms[0];e.width.value=e.height.value=""},updateImageData:function(){var e=document.forms[0],t=ImageDialog;""==e.width.value&&(e.width.value=t.preloadImg.width),""==e.height.value&&(e.height.value=t.preloadImg.height)},getImageData:function(){var e=document.forms[0];this.preloadImg=new Image,this.preloadImg.onload=this.updateImageData,this.preloadImg.onerror=this.resetImageData,this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(e.src.value)}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);