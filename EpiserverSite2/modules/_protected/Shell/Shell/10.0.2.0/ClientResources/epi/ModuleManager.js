//>>built
define("epi/ModuleManager",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi/clientResourcesLoader","epi/routes"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9={require:1,runAfter:2};var _a=_2(null,{_allModules:null,_moduleInstances:null,_modulesConfigured:false,constructor:function(_b){this._allModules={};this._moduleInstances={};_1.forEach(_b,function(_c){this._allModules[_c.name]=_c;},this);},getModule:function(_d){return this._allModules[_d];},configureModules:function(){if(this._modulesConfigured){return;}this._modulesConfigured=true;for(var _e in this._allModules){this._configureModule(this._allModules[_e]);}},startModules:function(_f){this.configureModules();if(_f){return this._startModule(this._allModules[_f]);}else{var _10=[];for(var _11 in this._allModules){_10.push(this._startModule(this._allModules[_11]));}return _5(_10);}},_startModule:function(_12){if(_12._started){return _12._started.promise;}_12._started=new _4();var _13=this,_14=[],_15=function(_16){return _16.moduleName===_12.name&&(_16.dependencyType&_9.runAfter);};for(var m in this._allModules){var _17=this._allModules[m],_18=_1.some(_17.moduleDependencies,_15);if(_18){_14.push(_17);}}_12._started.then(function(){_1.forEach(_14,function(_19){_13._startModule(_19);});});_6(this._startRequiredModules(_12),function(){var _1a=_7.loadResources(_12.cssResources,_12.scriptResources);_6(_1a,function(){_13._runModuleInitializer(_12).then(_12._started.resolve,_12._started.reject);});});return _12._started.promise;},_startRequiredModules:function(_1b){var _1c=_1.filter(_1b.moduleDependencies,function(_1d){return _1d.dependencyType&_9.require;});var _1e=_1.map(_1c,function(_1f){var _20=this._allModules[_1f.moduleName];if(!_20){throw new Error("Module '"+_1b.name+"' has a dependency named '"+_1f.moduleName+"' which doesn't exist.");}return this._startModule(_20);},this);return _5(_1e);},_configureModule:function(_21){if(_21.routes){_1.forEach(_21.routes,function(_22){_8.registerRoute(_22.routeBasePath,_22.routeDefaults);});}},_runModuleInitializer:function(_23){var dfd=new _4();if(_23.initializer){var _24=_23.initializer.replace(/\./g,"/");require([_24],_3.hitch(this,function(_25){try{var _26=new _25(_23);_6(_26.initialize(),_3.hitch(this,function(){this._moduleInstances[_23.name]=_26;dfd.resolve();}),dfd.reject);}catch(e){console.error(e.stack||e);dfd.reject(e);}}));}else{dfd.resolve();}return dfd.promise;},uninitializeModule:function(_27){var _28=this._moduleInstances;if(_28[_27]){_28[_27].uninitialize();delete _28[_27];}}});_a.moduleDependencyType=_9;return _a;});