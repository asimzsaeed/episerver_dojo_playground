//>>built
define("epi/shell/MetadataTransformer",["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/TypeDescriptorManager"],function(_1,_2,_3,_4){return _1(null,{defaultGroupType:"epi/shell/layout/GroupContainer",defaultSingleGroupType:"epi/shell/layout/SimpleContainer",defaultParentType:"epi/shell/layout/ParentContainer",defaultGroupName:"defaultGroup",defaultGroupTitle:"",propertyFilter:null,_item:null,constructor:function(_5){_1.safeMixin(this,_5);},toComponentDefinitions:function(_6,_7,_8,_9){this._item=_6;var _a=this._filterProperties(_6);return this._getComponentDefinitions(_a,_6.groups,_7,_8,_9);},_filterProperties:function(_b){var _c=this.propertyFilter,_d=_b.properties;return _c?_d.filter(_2.hitch(this,function(_e){return _c(_b,_e);})):_d;},_getComponentDefinitions:function(_f,_10,_11,_12,_13){var _14=_2.clone(_f)||[],_15,_16={},_17=_3.pascalToCamel(this.defaultGroupName),_18,_19=function(_1a,_1b){return (_1a.displayOrder||0)-(_1b.displayOrder||0);};_15=(_10||[]).map(function createGroups(_1c){var _1d=this._createGroupContainer(_1c,_13);_16[_1d.settings.name]=_1d;return _1d;},this);_15.sort(_19);_15.unshift(_16[_17]=_18=this._createGroupContainer({name:_17,title:this.defaultGroupTitle,displayUI:true},_13));_14.sort(_19);_14.forEach(function createProperties(_1e){if(!_1e.showForEdit){return;}var _1f=_3.pascalToCamel(_1e.groupName||""),_20=_16[_1f]||_18;var _21=_1e.uiType?this._createPropertyWidget(_1e,_11,_12,_13):this._createParentContainer(_1e,_11,_12,_13);_21 instanceof Array?Array.prototype.push.apply(_20.components,_21):_20.components.push(_21);},this);_15=_15.filter(function(_22){return _22.settings.displayui&&_22.components.length;});if(_15.length===1&&_15[0].widgetType===this.defaultGroupType){_15[0].widgetType=this.defaultSingleGroupType;}return _15;},_createGroupContainer:function(_23,_24){var _25={_type:"group",name:_3.pascalToCamel(_23.name),title:_23.title,readOnly:_24,displayui:_23.displayUI};return {displayOrder:_23.displayOrder,settings:_2.mixin(_25,_23.options),widgetType:_23.uiType||this.defaultGroupType,components:[]};},_createParentContainer:function(_26,_27,_28,_29){var _2a={_type:"parent",name:_27+_3.pascalToCamel(_26.name),title:_26.displayName};this._setTranslatedLabelAndTooltip(_26.name,_2a);var _2b=this._filterProperties(_26);return {settings:_2.mixin(_2a,_26.settings),widgetType:_26.layoutType||this.defaultParentType,components:this._getComponentDefinitions(_2b,_26.groups,_2a.name+".",_28,_29)};},_createPropertyWidget:function(_2c,_2d,_2e,_2f){var _30=_2.mixin(_2e?{value:_2c.initialValue}:{},{_type:_2c.hideSurroundingHtml?"hiddenfield":"field",name:_2d+_3.pascalToCamel(_2c.name),label:_2c.displayName,selections:_2c.selections,displayui:_2c.displayui,readOnly:_2f},_2c.settings);this._setTranslatedLabelAndTooltip(_2c.name,_30);return {settings:_30,widgetType:_2c.uiType,widgetPackage:_2c.uiPackage};},_setTranslatedLabelAndTooltip:function(_31,_32){var _33=this._item.additionalValues&&this._item.additionalValues.modelTypeIdentifier,_34;_31="properties."+_31.toLowerCase();if(!_33||!(_34=_4.getResourceValue(_33,_31))){return;}if(_34.caption){_32.title=_32.label=_34.caption;}if(_34.help){_32.tooltip=_34.help;}}});});