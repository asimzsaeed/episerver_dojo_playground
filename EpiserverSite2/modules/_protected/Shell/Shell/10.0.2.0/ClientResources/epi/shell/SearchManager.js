//>>built
define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/_base/lang","dojo/DeferredList","epi/dependency"],function(_1,_2,_3,_4,_5,_6){return _1(null,{_providersStore:null,_resultsStore:null,constructor:function(){this._setupStores();},getProviderQuery:function(_7){var _8=new _2();_2.when(this.getProviders(_7),_4.hitch(this,function(_9){if(_9&&_9.length>0){_8.resolve(this._getQuery(_9[0],{}));}else{_8.resolve();}}));return _8;},getProviders:function(_a){var _b=new _2();_2.when(this._providersStore.query({searchArea:_a}),function(_c){if(_c&&_c.length>0){_b.resolve(_c);}else{_b.resolve();}});return _b;},getStore:function(){return this._resultsStore;},search:function(_d,_e){var _f=new _2();_2.when(this.getProviders(_d),_4.hitch(this,function(_10){if(_10&&_10.length>0){var _11=[];_3.forEach(_10,function(_12,_13){_11.push(this._getData(_12,_e));},this);var _14=new _5(_11),_15=[];_14.then(function(_16){_3.forEach(_16,function(_17){if(_4.isArray(_17[1])){_15=_15.concat(_17[1]);}});_f.resolve(_15);});}}));return _f;},_setupStores:function(){var _18=_6.resolve("epi.storeregistry");this._providersStore=_18.get("epi.shell.searchproviders");this._resultsStore=_18.get("epi.shell.searchresults");},_getQuery:function(_19,_1a){var _1b={providerId:_19.id};_4.mixin(_1b,_1a||{});return _1b;},_getData:function(_1c,_1d){var _1e=new _2();_2.when(this._resultsStore.query(this._getQuery(_1c,_1d)),function(_1f){if(_1f&&_1f.length>0){_1e.resolve(_1f);}else{_1e.resolve();}});return _1e;}});});