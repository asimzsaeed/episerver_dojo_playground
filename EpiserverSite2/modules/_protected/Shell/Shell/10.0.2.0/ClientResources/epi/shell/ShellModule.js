//>>built
define("epi/shell/ShellModule",["epi/patch/patches","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/topic","dojo/when","dojo/dnd/Manager","epi","epi/_Module","epi/routes","epi/Url","epi/shell/store/Registry","epi/shell/widget/Application","epi/shell/Profile","epi/shell/layout/PositioningUtility","epi/shell/ContextService","epi/shell/ContextHistory","epi/shell/HashWrapper","epi/shell/ViewContextHistory","epi/shell/widget/ComponentController","epi/shell/command/GlobalCommandRegistry","epi/shell/dnd/Avatar","epi/shell/MetadataManager","epi/shell/widget/WidgetFactory","epi/shell/MessageService","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi/shell/socket/hub","epi/shell/customFocusIndicator","dojo/has!epi-socket-logging?epi/shell/socket/log"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,hub){return _2([_9],{_settings:null,_initializeHandle:null,constructor:function(_1c){this._settings=_1c;},initialize:function(){return _6(this.inherited(arguments),_3.hitch(this,function(){var _1d=new _c();this._initializeStores(_1d);if(!!this._settings.enableWebSockets){hub.start();}this.registerDependency("epi.storeregistry",_1d);this.registerDependency("epi.shell.Profile",new _e());this.registerDependency("epi.shell.MetadataManager",_17);this.registerDependency("epi.shell.widget.WidgetFactory",_18);this.registerDependency("epi.shell.MessageService",_19);this.registerDependency("epi.shell.layout.PositioningUtility",_f);this.registerDependency("epi.globalcommandregistry",_15);var _1e=new _12();var _1f=new _13();this.registerDependency("epi.shell.controller.Components",new _14({moduleArea:"Shell"}));this.registerDependency("epi.shell.ContextService",new _10());this.registerDependency("epi.shell.ContextHistory",new _11());this.registerDependency("epi.shell.HashWrapper",_1e);var _20=_7.manager();_20.makeAvatar=function(){return new _16(this);};_20.OFFSET_X=6;_20.OFFSET_Y=6;_4.after(_20,"stopDrag",function(_21){_5.publish("/dnd/stop",null);return _21;});this._initializeHandle=_5.subscribe("/epi/shell/application/initialized",_3.hitch(this,this._requestInitialContext,_1e,_1f));return _1a.initialize();}));},uninitialize:function(){if(this._requestFailedHandle){this._requestFailedHandle.remove();}this.inherited(arguments);},_initializeStores:function(_22){var _23=_a.getRestPath({moduleArea:"shell",storeName:"metadata"}),_24=_a.getRestPath({moduleArea:"shell",storeName:"context"}),_25=_a.getRestPath({moduleArea:"shell",storeName:"searchproviders"}),_26=_a.getRestPath({moduleArea:"shell",storeName:"searchresults"}),_27=_a.getRestPath({moduleArea:"shell",storeName:"componentcategory"}),_28=_a.getRestPath({moduleArea:"shell",storeName:"componentdefinition"}),_29=_a.getRestPath({moduleArea:"shell",storeName:"component"}),_2a=_a.getRestPath({moduleArea:"shell",storeName:"componentsortorder"}),_2b=_a.getRestPath({moduleArea:"shell",storeName:"licenseinformation"}),_2c=_a.getRestPath({moduleArea:"shell",storeName:"uidescriptor"});_22.create("epi.shell.metadata",_23,{idProperty:"modelType"});_22.create("epi.shell.context",_24,{idProperty:"uri"});_22.create("epi.shell.searchproviders",_25);_22.create("epi.shell.searchresults",_26);_22.create("epi.shell.componentcategory",_27,{idProperty:"name"});_22.create("epi.shell.componentdefinition",_28);_22.create("epi.shell.component",_29);_22.create("epi.shell.componentsortorder",_2a);_22.create("epi.shell.licenseinformation",_2b);_22.create("epi.shell.uidescriptor",_2c);},_requestInitialContext:function(_2d,_2e){if(this._initializeHandle){this._initializeHandle.remove();}var _2f=_3.hitch(this,function(_30){var _31=_30||_1b.settings.defaultContext;var _32=null;if(_31){this._requestFailedHandle=_5.subscribe("/epi/shell/context/requestfailed",_3.hitch(this,function(_33,_34,_35){if(_35&&_35.sender===this){this._requestFailedHandle.remove();_2f(null);}}));_32={uri:_31};}_5.publish("/epi/shell/context/request",_32,{sender:this});});var _36=_2d.getHash();if(_36&&_36.context){_2f(_36.context);return;}_6(_2e.getLastContextForView(),function(_37){var _38=null;if(_37&&_37.fullHomeUrl){var url=new _b(_37.fullHomeUrl);if(url.authority.toLowerCase()===window.location.host.toLowerCase()){_38=_37.versionAgnosticUri;}}_2f(_38);});}});});