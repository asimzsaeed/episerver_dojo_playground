//>>built
define("epi/shell/TypeDescriptorManager",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi/dependency","epi/i18n!epi/shell/ui/nls/contenttypes"],function(_1,_2,_3,_4,_5,_6,_7){return {_uiDescriptors:{},resources:_7,store:null,initialize:function(){this.store=this.store||_6.resolve("epi.storeregistry").get("epi.shell.uidescriptor");return _5(this.store.query()).then(_3.hitch(this,function(_8){return this.registerTypeSettings(_8);}));},clear:function(){this._uiDescriptors={};},registerTypeSettings:function(_9){var _a=this._uiDescriptors={},_b=[];function _c(_d){if(_d&&!(_d instanceof Array)){_d=[_d];}return _d?_d.map(function(_e){return _f(_a[_e]);}):[];};function _f(_10){var _11=_10.descriptor,_12=_11.baseTypes||_11.baseTypeIdentifier;return _10.ctor||_4(_c(_12)).then(function(_13){_10.ctor=_2(_13,_11);_10.instance=new _10.ctor();return _10.ctor;});};_9.forEach(_3.hitch(this,function(_14){this._prepareDescriptor(_14);_a[_14.typeIdentifier]={instance:null,ctor:null,descriptor:_14};}));Object.keys(_a).forEach(function(key){var _15=_a[key];_b.push(_f(_15));});return _4(_b).then(function(){return true;});},registerTypeSetting:function(_16,_17){_17.typeIdentifier=_16;this.registerTypeSettings([_17]);},getValue:function(_18,_19){var _1a=this._uiDescriptors[_18];return _1a?_1a.instance[_19]:undefined;},getResourceValue:function(_1b,_1c,_1d){var _1e=this._uiDescriptors[_1b];return _1e?_1e.instance.getResource(_1c,_1d):undefined;},getAndConcatenateValues:function(_1f,_20){var _21=[],_22=this._uiDescriptors[_1f];_22&&_22.instance.getRecursive(_20,_21);return _21;},getInheritanceChain:function(_23){var _24=[],_25=this._uiDescriptors[_23];if(!_25){return _24;}_25.instance.constructor._meta.bases.forEach(function(_26){_24.push(_26._meta.hidden.typeIdentifier);});return _24;},isBaseTypeIdentifier:function(_27,_28){_27=this._uiDescriptors[_27];_28=this._uiDescriptors[_28];if(!_27||!_28){return false;}return _27.instance.isInstanceOf(_28.ctor);},removeIntersectingTypes:function(_29,_2a){var _2b=[];if(_29){_29.forEach(function(_2c){if(_1.indexOf(_2a,_2c)===-1&&_1.some(_2a,function(_2d){return this.isBaseTypeIdentifier(_2c,_2d);},this)===false){_2b.push(_2c);}},this);}return _2b;},getValidAcceptedTypes:function(_2e,_2f,_30){var _31=_2f||[];var _32=_30||[];var _33=_2e||[];if(_31.length===0&&_32.length===0){return _33;}var _34=function(_35,_36){return _1.some(_36,function(_37){return this.isBaseTypeIdentifier(_35,_37);},this);};var _38=_1.filter(_33,function(_39){return (!(_34.call(this,_39,_32))&&_34.call(this,_39,_31));},this);return _38;},_prepareDescriptor:function(_3a){var _3b,_3c=_3a.languageKey;Object.keys(_3a).forEach(function(key){var _3d=_3a[key];if(_3d===null||_3d===undefined){delete _3a[key];}});if(_3c){_3b=this.resources[_3c];}_3.mixin(_3a,{getRecursive:function(key,_3e){var _3f=_3a[key];if(_3f){if(_3f instanceof Array){_3f.forEach(function(v){_3e.push(v);});}else{_3e.push(_3f);}}this.inherited(arguments);},getResource:function(key,_40){var _41=_3a.resource,_3b;if(_41){if(!_40||(_40&&_3a.isPrimaryType)){_3b=_3.getObject(key,false,_41);if(_3b!==undefined){return _3b;}}}return this.inherited(arguments);},resource:_3b});}};});