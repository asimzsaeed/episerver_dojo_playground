//>>built
define("epi/shell/UndoManager",["dojo","dojo/Stateful"],function(_1,_2){return _1.declare(_2,{maxSteps:10,hasUndoSteps:false,hasRedoSteps:false,_undoStack:null,_redoStack:null,_isUndoing:false,_isRedoing:false,constructor:function(_3){_1.mixin(this,_3);this._undoStack=[];this._redoStack=[];},createStep:function(_4,_5,_6,_7){var fn=_5;if(typeof _5=="string"){fn=_4[_5];}if(typeof fn!="function"){throw ("No such callback function");}var _8={context:_4,callback:fn,parameters:_1.isArray(_6)?_6:[_6],description:_7};if(!_8.context&&typeof _8.callback==="string"){throw ("Context object is needed to find the callback");}var _9=this._isUndoing?this._redoStack:this._undoStack;if(!this._isUndoing&&!this._isRedoing){this._redoStack.splice(0,this._redoStack.length);}_9.push(_8);if(this.maxSteps>0&&this._undoStack.length>this.maxSteps){this._undoStack.shift();}this._updateFlags();},undo:function(){if(this._undoStack.length===0){return;}this._isUndoing=true;var _a=this._undoStack.pop();_a.callback.apply(_a.context,_a.parameters);this._updateFlags();this._isUndoing=false;},redo:function(){if(this._redoStack.length===0){return;}this._isRedoing=true;var _b=this._redoStack.pop();_b.callback.apply(_b.context,_b.parameters);this._updateFlags();this._isRedoing=false;},_updateFlags:function(){this.set("hasUndoSteps",this._undoStack.length>0);this.set("hasRedoSteps",this._redoStack.length>0);},clear:function(){this._undoStack=[];this._redoStack=[];this._updateFlags();}});});