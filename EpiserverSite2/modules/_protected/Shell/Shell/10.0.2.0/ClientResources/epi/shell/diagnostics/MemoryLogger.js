//>>built
define("epi/shell/diagnostics/MemoryLogger",["dojo/_base/declare","dojo/_base/lang","./Snapshot"],function(_1,_2,_3){return _1(null,{snapshots:null,constructor:function(_4){_2.mixin(this,_4);this.snapshots=[];},takeSnapshot:function(){var _5=new _3();this.snapshots.push(_5);var _6=this.countItems(_5.widgets);var _7={total:_6,same:_6,destroyed:0,created:0,snapshot:_5};if(this.snapshots.length>1){var _8=this.snapshots[this.snapshots.length-2];var _9=this.diff(_5,_8);_7.destroyed=this.countItems(_9.destroyed);_7.created=this.countItems(_9.created);_7.same=this.countItems(_9.same);}return _7;},countItems:function(_a){var _b=0;for(var p in _a){_b++;}return _b;},last:function(){var l=this.snapshots.length;if(l===0){throw "No snapshots";}return this.snapshots[l-1];},lastDiff:function(){var l=this.snapshots.length;if(l===0){throw "No snapshots";}if(l===1){throw "Only one snapshot";}var a=this.snapshots[l-1];var b=this.snapshots[l-2];return this.diff(a,b);},computeLastLeftBehind:function(){var l=this.snapshots.length;if(l<3){throw "Not enough snapshots, must have at least 3";}var a=this.snapshots[l-1];var b=this.snapshots[l-2];var c=this.snapshots[l-3];var d1=this.diff(a,b);var d2=this.diff(b,c);var o={};for(var p in d2.created){if(!(p in d1.destroyed)){o[p]=d2.created[p];}}return o;},diff:function(_c,_d){var _e=_c.widgets;var _f=_d.widgets;var _10={};var _11={};var _12={};var c;var id;for(id in _e){c=_e[id];if(id in _f){_11[id]=c;}else{_10[id]=c;}}for(id in _f){c=_f[id];if(!(id in _e)){_12[id]=c;}}return {created:_10,same:_11,destroyed:_12};}});});