//>>built
define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/has","dojo/dnd/Manager","dojo/dnd/Source","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _2(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_7.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_a){_6.toggle(this.node,"dojoDndHorizontal",_a);this.horizontal=_a;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState==="Disabled"){return;}_5.superclass.onMouseMove.call(this,e);var m=_4.manager();var _b=_3("mac")?"metaKey":"ctrlKey";if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var _c=this.getSelectedNodes();if(_c.length){m.startDrag(this,_c,this.copyState(e[_b],true));}}}if(this.isDragging){var _d=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!==this.current){this.targetBox=_8.position(this.current,true);}if(this.horizontal){_d=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_d=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_d=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!==this.targetAnchor||_d!==this.before){this._markTargetAnchor(_d);m.canDrop(!this.current||m.source!==this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(_e){var _f=[],_10,_11;function _12(_13,_14){function _15(_16){return _16*_16;};return Math.sqrt(_15(_13.x-_14.x)+_15(_13.y-_14.y));};this.getAllNodes().forEach(function(_17){var pos=_8.position(_17);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_f.push({node:_17,before:true,x:pos.x,y:pos.yCentered},{node:_17,before:false,x:pos.x2,y:pos.yCentered});}else{_f.push({node:_17,before:true,x:pos.xCentered,y:pos.y},{node:_17,before:false,x:pos.xCentered,y:pos.y2});}},this);_1.forEach(_f,function(_18){_18.distance=_12(_e,_18);if(!_10||_18.distance<_11){_10=_18;_11=_18.distance;}},this);if(_10){this.current=_10.node;this._calculatedCurrent=true;return _10.before;}return false;},_markTargetAnchor:function(_19){var _1a=true,_1b=true;if(this.current===this.targetAnchor&&this.before===_19){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_19;if(this.targetAnchor){this.targetAnchorSibling=_19?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_6.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_1a=!(this.targetAnchor.id in this.selection);_1b=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_1a&&_1b){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_1a&&_1b){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_1a&&_1b);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_1c){var _1d=this._markerNode,_1e,_1f,_20,_21,top,_22,_23,_24,gap=-1;if(_1c){_1e=_8.position(this.targetAnchor,false);_1f=this.targetAnchorSibling?_8.position(this.targetAnchorSibling,false):{h:0,w:0};_20=_8.position(this.node,false);if(this.horizontal){if(this.before){_22=_1e.x-_20.x;if(this.targetAnchorSibling){gap=(_1e.x-_1f.x-_1f.w)/2;}if(gap>=0){_22-=gap;}}else{_22=_1e.x+_1e.w-_20.x;if(this.targetAnchorSibling){gap=(_1f.x-_1e.x-_1e.w)/2;}if(gap>=0){_22+=gap;}}_23=gap>=0?Math.max(_1e.h,_1f.h):_1e.h;_21={display:"block",top:_1e.y-_20.y+"px",left:_22+"px",height:_23+"px"};}else{if(this.before){top=_1e.y-_20.y;if(this.targetAnchorSibling){gap=(_1e.y-_1f.y-_1f.h)/2;}if(gap>=0){top-=gap;}}else{top=_1e.y+_1e.h-_20.y;if(this.targetAnchorSibling){gap=(_1f.x-_1e.x-_1e.w)/2;}if(gap>=0){top-=gap;}}_24=gap>=0?Math.max(_1e.w,_1f.w):_1e.w;_21={display:"block",top:top+"px",width:_24+"px"};}}else{_21={display:"none"};}if(!_1d){_1d=this._markerNode=_7.place(this.markerTemplateString,this.node);_9.set(_1d,_21);}else{setTimeout(function(){_9.set(_1d,_21);},this.markerDelay);}}});});