//>>built
define("epi/shell/widget/ComponentSelector",["epi","dojo/_base/declare","dojo/_base/Deferred","dojo/keys","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/extensions/DijitRegistry","dijit/_Contained","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/MenuItem","dijit/layout/ContentPane","dijit/layout/BorderContainer","dijit/form/Button","dijit/form/TextBox","dojo/store/Memory","epi/routes","epi/dependency","epi/shell/ViewSettings","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.ComponentSelection"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,res){var _19=_2([_d,_e,_f,_c],{templateString:"            <div>            <div class=\"dijitDialogPaneToolBar clearfix\">                    <div class=\"dijitDialogPaneLeading\">                    </div>                    <div class=\"dijitDialogPaneTrailing\">                        <input data-dojo-type=\"dijit/form/TextBox\" dojoAttachPoint=\"searchBox\" dojoAttachEvent=\"onKeyUp: _onSearchBoxChange\" placeHolder=\"${commonRes.action.search}\" class=\"epi-searchInput\" />                    </div>                </div>                <div class=\"dijitDialogPaneContentArea epi-wrapped\">                    <div data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-attach-point=\"container\" style=\"width: 100%; height: 330px;\">                        <div data-dojo-type=\"dijit/layout/ContentPane\" region=\"left\" splitter=\"false\" class=\"epi-dialog-resourcePane epi-dijitMenuDisableIcon\" style=\"width: 160px;\" >                            <div data-dojo-type=\"dijit/Menu\" dojoAttachPoint=\"categoryMenu\" dojoAttachEvent=\"onItemClick: _onCategoryMenuClick\" style=\"width:160px;\"></div>                        </div>                            <div data-dojo-attach-point=\"grid\"></div>                    </div>                </div>                <div class=\"dijitDialogPaneActionBar\">                    <button data-dojo-type=\"dijit/form/Button\" type=\"submit\" data-dojo-props=\"'class':'default'\" data-dojo-attach-event=\"onClick:onClose\">${commonRes.action.close}</button>                </div>             </div>",res:res,commonRes:_1.resources,selectedCategory:"*",componentCategories:null,_selectedCategoryMenuItem:null,categoryStore:null,componentDefinitionStore:null,_sortableColumns:[1],_gridClass:_2([_8,_b,_9,_a],{resize:function(_1a){if(!_1a){return;}_7.setMarginBox(this.domNode,{w:_1a.w,h:_1a.h});this.inherited(arguments);}}),postMixInProperties:function(){this.inherited(arguments);this.categoryStore=this.categoryStore||this._getStore("epi.shell.componentcategory");this.componentDefinitionStore=this.componentDefinitionStore||this._getStore("epi.shell.componentdefinition");this.componentCategories=_18.settings.componentCategories;},buildRendering:function(){this.inherited(arguments);this.grid=new this._gridClass({region:"center",columns:{title:{label:this.commonRes.header.name},description:{label:" "}},selectionMode:"single",sort:[{attribute:"title",descending:false}],query:_6.hitch(this,function(_1b){if(this.selectedCategory!=="*"){if(!_1b.categories){return false;}var _1c=this.selectedCategory;var _1d=_5.some(_1b.categories,function(_1e){return _1e===_1c;});if(!_1d){return;}}var _1f=this.searchBox.get("value").toLowerCase();if(_1f.length>0&&(_1b.title&&_1b.title.toLowerCase().indexOf(_1f))){return false;}return true;})},this.grid);this.grid.on(".dgrid-row:click",_6.hitch(this,this._onGridRowSelected));this.grid.on(".dgrid-row:keydown",_6.hitch(this,this._onGridRowSelected));},_getStore:function(_20){var _21=_17.resolve("epi.storeregistry");return _21.get(_20);},onComponentSelected:function(){},onClose:function(){},_onGridRowSelected:function(e){if(e.keyCode&&e.keyCode!==_4.ENTER){return;}var row=this.grid.row(e);if(!row||!row.data){return;}var _22=row.data.component;this.onComponentSelected(_22);},dataBind:function(_23){if(this.grid.store!==null&&_23!==true){return;}if(_23){_5.forEach(this.categoryMenu.getChildren(),function(_24){this.categoryMenu.removeChild(_24);},this);}var _25=this.grid;_3.when(this.componentDefinitionStore.query(),_6.hitch(this,function(_26){var _27=_5.filter(_26,function(_28){return this._inCategoryFilter(_28.categories);},this);this._populateCategoryMenu(_27);var _29=new _15({data:_27});_25.set("store",_29);}));},show:function(_2a){this.inherited(arguments);this.dataBind(_2a);this.resize();},resize:function(){this.inherited(arguments);this.container.resize();},_populateCategoryMenu:function(_2b){this._selectedCategoryMenuItem=new _10({label:this.commonRes.header.all,selected:true,value:"*"});this.categoryMenu.addChild(this._selectedCategoryMenuItem);var _2c=this.categoryStore.query();_3.when(_2c,_6.hitch(this,function(_2d){_5.forEach(_2d,function(_2e){var _2f=_5.some(_2b,function(_30){return _5.indexOf(_30.categories,_2e.name)>=0;});if(_2f){this.categoryMenu.addChild(new _10({label:_2e.displayName,value:_2e.name}));}},this);}));},_inCategoryFilter:function(_31){var _32=this.componentCategories;return _32===null||_5.some(_31,function(c){return _5.some(_32,function(_33){return _33===c;});});},_onCategoryMenuClick:function(_34,e){this._selectedCategoryMenuItem.set("selected",false);_34.set("selected",true);this._selectedCategoryMenuItem=_34;this.selectedCategory=_34.value;this.searchBox.reset();this.grid.refresh();},_onSearchBoxChange:function(e){this.grid.refresh();}});return _19;});