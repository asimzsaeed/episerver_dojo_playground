//>>built
define("epi/shell/widget/Iframe",["dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/dom-style","dojo/Deferred","dojo/io-query","dojo/on","dojo/sniff","dijit/_TemplatedMixin","dijit/_Widget","dijit/focus","epi","epi/Url","epi/shell/postMessage","epi/routes"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c,_d,_e){return _1([_9,_8],{url:"about:blank",_triggeredExternally:false,templateString:"<iframe data-dojo-attach-point=\"iframe\" class=\"dijitReset\" src=\"${url}\" role=\"presentation\" frameborder=\"0\" style=\"width:100%;\"></iframe>",autoFit:false,visible:true,isLoading:false,_isInspectable:null,_loadDeferred:null,onLoading:function(_f){this._set("isLoading",true);},onUnload:function(url){this._set("isLoading",true);},onLoad:function(url,_10){this._set("isLoading",false);},buildRendering:function(){this.inherited(arguments);_3.setSelectable(this.domNode,false);this.own(on(this.iframe,"load",_2.hitch(this,this._onIframeLoad)),_d.subscribe("/site/load",_2.hitch(this,function(_11){if(!this.isInspectable(true)){this._set("url",_11.url);this.onLoad(this.url,this._triggeredExternally);}})));},resize:function(_12){if(this.autoFit){return;}if(_12){_4.set(this.iframe,{width:_12.w+"px",height:_12.h+"px"});}},getDocument:function(){if(!this.isInspectable()){return null;}try{return this.iframe.contentWindow?this.iframe.contentWindow.document:null;}catch(ex){return null;}},getWindow:function(){return this.iframe.contentWindow;},_setVisibleAttr:function(_13){_4.set(this.domNode,"display",_13?"block":"none");},_onIframeLoad:function(_14){var url=null,_15,_16;function _17(e){_16.remove();this.set("_isInspectable",false);if(this._focusHandle){this._focusHandle.remove();this._focusHandle=null;}if(this._mousedownHandle){this._mousedownHandle.remove();this._mousedownHandle=null;}this.onUnload(this.url);};if(this.isInspectable(true)){url=this.getLocation().href;this._focusHandle=_a.registerIframe(this.iframe);this._mousedownHandle=this.connect(this.getDocument(),"onmousedown",function(){on.emit(this.domNode,"mousedown",{bubbles:true,cancelable:true});});_15=this.getWindow();_16=on(_15,"unload",_2.hitch(this,_17));}this._set("url",url);if(url!=="about:blank"){if(this._loadDeferred){this._loadDeferred.resolve();}this.onLoad(this.url,this._triggeredExternally);}this._loadDeferred=null;this._triggeredExternally=false;if(this.autoFit){this._adjustSize(this._calculateActualSize());}},isInspectable:function(_18){if(!_18&&this._isInspectable!==null){return this._isInspectable;}try{return this._isInspectable=!!this.getLocation().href;}catch(ex){}return this._isInspectable=false;},load:function(url,_19,_1a,_1b){if(this._loadDeferred){this._loadDeferred.cancel();}var _1c=new _5();if(!url){_1c.cancel();return _1c.promise;}var _1d=new _c(this.url),_1e=new _c(url,_19,_1a),_1f=window.location.protocol.replace(":",""),_20=(_1e.scheme==="http"&&_1f==="https");if(_20){_1e=_e.getActionPath({moduleArea:"Shell",controller:"PreviewUnavailable"});}if(!_1b&&_1e.path===_1d.path&&_b.areEqual(_1e.query,_1d.query)){_1c.resolve();}else{this._loadDeferred=_1c;this.set("url",_1e.toString());}return _1c.promise;},reload:function(){return this.load(this.get("url"),null,null,true);},getCurrentQuery:function(){return _6.queryToObject(this.getWindow().location.search.substring(1));},getLocation:function(){return this.getWindow().location;},_getUrlAttr:function(){return this.url;},_setUrlAttr:function(url){this._triggeredExternally=true;this.onLoading(url);if(this.iframe.contentWindow){this.iframe.contentWindow.location.replace(url);}else{this.iframe.src=url;}this._set("url",url);},_calculateActualSize:function(){var doc=this.getDocument();function _21(dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};return {h:_21("Height"),w:_21("Width")};},_adjustSize:function(_22){_4.set(this.iframe,"height",_22.h+"px");_4.set(this.getWindow().document.body,"height","auto");}});});