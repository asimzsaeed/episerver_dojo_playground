//>>built
require({cache:{"url:epi/shell/widget/templates/IframeWithOverlay.html":"<div data-dojo-attach-point=\"containerNode\" class=\"epi-editorViewport\">\r\n    <div data-dojo-attach-point=\"scroller\" class=\"epi-editorViewport-center\">\r\n        <div data-dojo-attach-point=\"previewContainer\" class=\"epi-editorViewport-previewBox\"  data-dojo-props=\"region: 'center'\">\r\n            <iframe data-dojo-attach-point=\"iframe\" data-dojo-type=\"epi/shell/widget/AutoResizingIframe\" data-dojo-props=\"autoFit : false\" name=\"sitePreview\"></iframe>\r\n            <div data-dojo-attach-point=\"overlay\" data-dojo-type=\"epi/shell/widget/overlay/OverlayContainer\"></div>\r\n            <div data-dojo-attach-point=\"scrollSizer\" class=\"epi-editorViewport-scrollSizer\"></div>\r\n        </div>\r\n    </div>\r\n</div>"}});define("epi/shell/widget/IframeWithOverlay",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/number","dojo/aspect","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/dom-class","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","./_ScrollbarMeasurementMixin","./AutoResizingIframe","./overlay/OverlayContainer","epi/shell/layout/_LayoutWidget","epi/shell/widget/DelayableStandby","dojo/text!./templates/IframeWithOverlay.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){return _1([_10,_b,_c,_d],{templateString:_12,autoResize:true,previewSize:null,devicePreviewClass:"",previewClass:"",standbySettings:{delayTime:3000,duration:350},postCreate:function(){this.inherited(arguments);this.overlay.set("target",this.iframe);this._setupStandby();},startup:function(){if(this._started){return;}this.inherited(arguments);this.connect(this.iframe,"onUnload",function(){this._standby.show();});this.connect(this.iframe,"onLoad",function(url){_a.toggle(this.scroller,"epi-editorViewport-preview-external",!this.iframe.isInspectable());this._standby.hide();});this.own(_6.after(this.iframe,"onAfterResize",function(){this.emit("viewportresized");}.bind(this),true));this._setCenterViewport(this._availableViewport||this._contentBox||_7.getContentBox(this.containerNode),true);},addChild:function(_13,_14){function _15(){this.layout();_3.forEach(_13.getChildren(),function(_16){_16.connect(_16,"onLayoutChanged",_2.hitch(this,function(){if(_13.open){this.layout();}}));},this);};_13.connect(_13,"onAfterShow",_2.hitch(this,_15));_13.connect(_13,"onAfterHide",_2.hitch(this,this._hide));this.inherited(arguments);},onLayoutChanged:function(){this.inherited(arguments);this.getChildren().forEach(_2.hitch(this,function(_17){if(_17.open){this.scrollIntoView(_17.overlayItem);}else{if(_17!==this.iframe||_17!==this.overlay){this._hide();}}}));},layout:function(_18){if(!this._contentBox){return;}this._layoutChildren(_18);this.inherited(arguments);},_layoutChildren:function(_19){if(_19){this._resetScroll();}this._positionChildren();this._setCenterViewport(this._availableViewport,_19);},_positionChildren:function(){var _1a=this.get("centerSize");this._availableViewport=_2.mixin({},this._contentBox);_8.set(this.scroller,{width:""});var _1b=this.getScrollbars(this.scroller);_3.forEach(this.getChildren(),function(_1c){if(_1c===this.iframe||_1c===this.overlay||_1c.open===false||_1c.visible===false){return;}var _1d;switch(_1c.region){case "leading":if(_1c.resize){_1c.resize({t:0,l:0,h:this._contentBox.h-_1b.x});}_1d=_7.position(_1c.domNode);this._availableViewport.w-=_1d.w;this._availableViewport.l+=_1d.w;break;case "trailing":if(_1c.resize){if(!_1c._computedStyle){_1c._computedStyle=_8.getComputedStyle(_1c.domNode);}_1d=_7.getMarginBox(_1c.domNode,_1c._computedStyle);_1c.resize({t:0,h:this._contentBox.h-_1b.x});_8.set(_1c.domNode,{right:_1b.y+"px"});_8.set(this.scroller,{width:(this._availableViewport.w-_1d.w)+"px"});this._availableViewport.w-=_1d.w+_1b.y;}break;case "center":if(_1c.resize){_1c.resize(_1a);}break;default:break;}},this);},_setCenterViewport:function(_1e,_1f){var _20=_2.clone(this.get("centerSize")),_21,_22;function _23(_24,_25){var _26=_1e[_24],_27=_20[_24],_28=_26>_27?(_26-_27)/2:0;_28-=_22[_25];return Math.round(_28);};if(!_20){return;}this.previewContainer._computedStyle=this.previewContainer._computedStyle||_8.getComputedStyle(this.previewContainer);_22=_7.getPadBorderExtents(this.previewContainer,this.previewContainer._computedStyle);if(!this.autoResize){_21=this.getScrollbarSize();_20.w=parseInt(_20.w)+_21.x;_20.h=parseInt(_20.h);}_8.set(this.previewContainer,{top:_23("h","t")+"px",left:_23("w","l")+"px",width:_20.w+"px",height:_20.h+"px"});this.iframe.resize(_20,!!_1f);},onViewportPullDown:function(){this.emit("viewportpulldown");},scrollIntoView:function(_29){var _2a,_2b,_2c,_2d=16;if(this.iframe.isLoading||!this._contentBox){return;}this._layoutChildren();if((!this.autoResize&&this.previewSize.w<this._availableViewport.w)){return;}_2a=_29.get("position");_2b=_2a.x+_2a.w+_2d-this.scroller.scrollLeft-this._availableViewport.w;_2c=this.previewContainer.clientWidth+_2b;_8.set(this.scrollSizer,{width:_2c+"px"});this.previewContainer.scrollLeft=_2b;this._positionChildren(this.get("centerSize"));},_resetScroll:function(){_8.set(this.scrollSizer,{width:"1px"});},_setupStandby:function(){var _2e=_2.mixin(this.standbySettings,{target:this.scroller});this.own(this._standby=new _11(_2e).placeAt(this.domNode,"last"));},_getCenterSizeAttr:function(){return this.previewSize||this._contentBox;},_setPreviewSizeAttr:function(_2f){this.autoResize=!_2f;this.previewSize=_2f;_a.toggle(this.scroller,"epi-editorViewport-preview",!this.autoResize);this.layout();},_setDevicePreviewClassAttr:function(_30){if(_30){_a.replace(this.scroller,_30,this.devicePreviewClass);}else{_a.remove(this.scroller,this.devicePreviewClass);}this._set("devicePreviewClass",_30);},_setPreviewClassAttr:function(_31){if(_31){_a.replace(this.scroller,_31,this.previewClass);}else{_a.remove(this.scroller,this.previewClass);}this._set("previewClass",_31);},_hide:function(){this._resetScroll();_8.set(this.scroller,{width:""});this._setCenterViewport(this._contentBox);},showDelay:function(_32){this._standby.show(_32);},hideDelay:function(_33){this._standby.hide();}});});