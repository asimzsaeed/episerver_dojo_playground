//>>built
define("dgrid/Grid",["dojo/_base/kernel","dojo/_base/declare","dojo/on","dojo/has","put-selector/put","./List","./util/misc","dojo/_base/sniff"],function(_1,_2,_3,_4,_5,_6,_7){var _8=_4("ie")<8&&!_4("quirks");function _9(_a,_b){if(_b&&_b.nodeType){_a.appendChild(_b);}};function _c(_d){return _7.escapeCssIdentifier(_d,"-");};var _e=_2(_6,{columns:null,cellNavigation:true,tabableHeader:true,showHeader:true,column:function(_f){if(typeof _f!="object"){return this.columns[_f];}else{return this.cell(_f).column;}},listType:"grid",cell:function(_10,_11){if(_10.column&&_10.element){return _10;}if(_10.target&&_10.target.nodeType){_10=_10.target;}var _12;if(_10.nodeType){var _13;do{if(this._rowIdToObject[_10.id]){break;}var _14=_10.columnId;if(_14){_11=_14;_12=_10;break;}_10=_10.parentNode;}while(_10&&_10!=this.domNode);}if(!_12&&typeof _11!="undefined"){var row=this.row(_10),_15=row&&row.element;if(_15){var _16=_15.getElementsByTagName("td");for(var i=0;i<_16.length;i++){if(_16[i].columnId==_11){_12=_16[i];break;}}}}if(_10!=null){return {row:row||this.row(_10),column:_11&&this.column(_11),element:_12};}},createRowCells:function(tag,_17,_18,_19){var row=_5("table.dgrid-row-table[role=presentation]"),_1a=this.cellNavigation,_1b=(_4("ie")<9||_4("quirks"))?_5(row,"tbody"):row,tr,si,sl,i,l,_1c,_1d,id,_1e,_1f,_20,_21,_22,_23;_18=_18||this.subRows;for(si=0,sl=_18.length;si<sl;si++){_1c=_18[si];tr=_5(_1b,"tr");if(_1c.className){_5(tr,"."+_1c.className);}for(i=0,l=_1c.length;i<l;i++){_1d=_1c[i];id=_1d.id;_1e=_1d.field?".field-"+_c(_1d.field):"";_1f=typeof _1d.className==="function"?_1d.className(_19):_1d.className;if(_1f){_1e+="."+_1f;}_20=_5(tag+(".dgrid-cell.dgrid-cell-padding"+(id?".dgrid-column-"+_c(id):"")+_1e.replace(/ +/g,"."))+"[role="+(tag==="th"?"columnheader":"gridcell")+"]");_20.columnId=id;if(_8){_21=_5(_20,"!dgrid-cell-padding div.dgrid-cell-padding");_20.contents=_21;}else{_21=_20;}_22=_1d.colSpan;if(_22){_20.colSpan=_22;}_23=_1d.rowSpan;if(_23){_20.rowSpan=_23;}_17(_21,_1d);tr.appendChild(_20);}}return row;},left:function(_24,_25){if(!_24.element){_24=this.cell(_24);}return this.cell(this._move(_24,-(_25||1),"dgrid-cell"));},right:function(_26,_27){if(!_26.element){_26=this.cell(_26);}return this.cell(this._move(_26,_27||1,"dgrid-cell"));},renderRow:function(_28,_29){var _2a=this;var row=this.createRowCells("td",function(td,_2b){var _2c=_28;if(_2b.get){_2c=_2b.get(_28);}else{if("field" in _2b&&_2b.field!="_item"){_2c=_2c[_2b.field];}}if(_2b.renderCell){_9(td,_2b.renderCell(_28,_2c,td,_29));}else{_2d.call(_2b,_28,_2c,td,_29);}},_29&&_29.subRows,_28);return _5("div[role=row]>",row);},renderHeader:function(){var _2e=this,_2f=this.columns,_30=this.headerNode,i=_30.childNodes.length;_30.setAttribute("role","row");while(i--){_5(_30.childNodes[i],"!");}var row=this.createRowCells("th",function(th,_31){var _32=_31.headerNode=th;if(_8){th=th.parentNode;}var _33=_31.field;if(_33){th.field=_33;}if(_31.renderHeaderCell){_9(_32,_31.renderHeaderCell(_32));}else{if("label" in _31||_31.field){_32.appendChild(document.createTextNode("label" in _31?_31.label:_31.field));}}if(_31.sortable!==false&&_33&&_33!="_item"){th.sortable=true;th.className+=" dgrid-sortable";}},this.subRows&&this.subRows.headerRows);this._rowIdToObject[row.id=this.id+"-header"]=this.columns;_30.appendChild(row);if(this._sortListener){this._sortListener.remove();}this._sortListener=_3(row,"click,keydown",function(_34){if(_34.type=="click"||_34.keyCode==32||(!_4("opera")&&_34.keyCode==13)){var _35=_34.target,_36,_37,_38,_39;do{if(_35.sortable){_38=[{attribute:(_36=_35.field||_35.columnId),descending:(_37=_2e._sort[0])&&_37.attribute==_36&&!_37.descending}];_39={bubbles:true,cancelable:true,grid:_2e,parentType:_34.type,sort:_38};if(_3.emit(_34.target,"dgrid-sort",_39)){_2e._sortNode=_35;_2e.set("sort",_38);}break;}}while((_35=_35.parentNode)&&_35!=_30);}});},resize:function(){var _3a=this.headerNode.firstChild,_3b=this.contentNode,_3c;this.inherited(arguments);if(!_4("ie")||(_4("ie")>7&&!_4("quirks"))){_3b.style.width="";if(_3b&&_3a){if((_3c=_3a.offsetWidth)!=_3b.offsetWidth){_3b.style.width=_3c+"px";}}}},destroy:function(){this._destroyColumns();if(this._sortListener){this._sortListener.remove();}this.inherited(arguments);},_setSort:function(_3d,_3e){this.inherited(arguments);this.updateSortArrow(this._sort);},_findSortArrowParent:function(_3f){var _40=this.columns;for(var i in _40){var _41=_40[i];if(_41.field==_3f){return _41.headerNode;}}},updateSortArrow:function(_42,_43){if(this._lastSortedArrow){_5(this._lastSortedArrow,"<!dgrid-sort-up!dgrid-sort-down");_5(this._lastSortedArrow,"!");delete this._lastSortedArrow;}if(_43){this._sort=_42;}if(!_42[0]){return;}var _44=_42[0].attribute,_45=_42[0].descending,_46=this._sortNode||this._findSortArrowParent(_44),_47;delete this._sortNode;if(_46){_46=_46.contents||_46;_47=this._lastSortedArrow=_5("div.dgrid-sort-arrow.ui-icon[role=presentation]");_47.innerHTML="&nbsp;";_46.insertBefore(_47,_46.firstChild);_5(_46,_45?".dgrid-sort-down":".dgrid-sort-up");this.resize();}},styleColumn:function(_48,css){return this.addCssRule("#"+_7.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_c(_48),css);},_configColumns:function(_49,_4a){var _4b=[],_4c=_4a instanceof Array;function _4d(_4e,_4f){if(typeof _4e=="string"){_4a[_4f]=_4e={label:_4e};}if(!_4c&&!_4e.field){_4e.field=_4f;}_4f=_4e.id=_4e.id||(isNaN(_4f)?_4f:(_49+_4f));if(this._configColumn){this._configColumn(_4e,_4f,_4a,_49);_4f=_4e.id;}if(_4c){this.columns[_4f]=_4e;}_4e.grid=this;if(typeof _4e.init==="function"){_4e.init();}_4b.push(_4e);};_7.each(_4a,_4d,this);return _4c?_4a:_4b;},_destroyColumns:function(){var _50=this.subRows,_51=_50&&_50.length,i,j,_52,len;this.cleanup();for(i=0;i<_51;i++){for(j=0,len=_50[i].length;j<len;j++){_52=_50[i][j];if(typeof _52.destroy==="function"){_52.destroy();}}}},configStructure:function(){var _53=this.subRows,_54=this._columns=this.columns;this.columns=!_54||_54 instanceof Array?{}:_54;if(_53){for(var i=0;i<_53.length;i++){_53[i]=this._configColumns(i+"-",_53[i]);}}else{this.subRows=[this._configColumns("",_54)];}},_getColumns:function(){return this._columns||this.columns;},_setColumns:function(_55){this._destroyColumns();this.subRows=null;this.columns=_55;this._updateColumns();},_setSubRows:function(_56){this._destroyColumns();this.subRows=_56;this._updateColumns();},setColumns:function(_57){_1.deprecated("setColumns(...)","use set(\"columns\", ...) instead","dgrid 0.4");this.set("columns",_57);},setSubRows:function(_58){_1.deprecated("setSubRows(...)","use set(\"subRows\", ...) instead","dgrid 0.4");this.set("subRows",_58);},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);if(this._started){if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}else{this.resize();}}}});function _2d(_59,_5a,td,_5b){if(this.formatter){var _5c=this.formatter,_5d=this.grid.formatterScope;td.innerHTML=typeof _5c==="string"&&_5d?_5d[_5c](_5a,_59):this.formatter(_5a,_59);}else{if(_5a!=null){td.appendChild(document.createTextNode(_5a));}}};_e.appendIfNode=_9;_e.defaultRenderCell=_2d;return _e;});