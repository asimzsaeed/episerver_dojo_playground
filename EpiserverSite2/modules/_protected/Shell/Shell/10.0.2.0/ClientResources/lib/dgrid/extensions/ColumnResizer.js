//>>built
define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){function _a(_b,_c,_d,_e,id){for(var i=1;i<_c;i++){_b[_d+i][_e]=id;}};function _f(_10){var i=_10.length,l=i,_11=_10[0].length,_12=new Array(i);while(i--){_12[i]=new Array(_11);}var _13={};for(i=0;i<l;i++){var row=_12[i],_14=_10[i];for(var j=0,js=0;j<_11;j++){var _15=_14[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=_15.id;if(_15.rowSpan&&_15.rowSpan>1){_a(_12,_15.rowSpan,i,j,_15.id);}if(i>0&&_15.colSpan&&_15.colSpan>1){for(k=1;k<_15.colSpan;k++){row[++j]=_15.id;if(_15.rowSpan&&_15.rowSpan>1){_a(_12,_15.rowSpan,i,j,_15.id);}}}_13[_15.id]=_10[0][j].id;js++;}}return _13;};function _16(_17,_18,_19,_1a,_1b){if(_19<=0){return;}var _1c=_17.columns[_18],_1d,_1e;if(!_1c){return;}_1d={grid:_17,columnId:_18,width:_19,bubbles:true,cancelable:true};if(_1a){_1d.parentType=_1a;}if(!_17._resizedColumns||_2.emit(_17.headerNode,"dgrid-columnresize",_1d)){if(_19==="auto"){delete _1c.width;}else{_1c.width=_19;_19+="px";}_1e=_17._columnSizes[_18];if(_1e){_1e.set("width",_19);}else{_1e=_8.addCssRule("#"+_8.escapeCssIdentifier(_17.domNode.id)+" .dgrid-column-"+_8.escapeCssIdentifier(_18,"-"),"width: "+_19+";");}_17._columnSizes[_18]=_1e;if(_1b!==false){_17.resize();}return true;}};var _1f,_20=0;var _21={create:function(){_1f=_9("div.dgrid-column-resizer");},destroy:function(){_9(_1f,"!");_1f=null;},show:function(_22){var pos=_6.position(_22.domNode,true);_1f.style.top=pos.y+"px";_1f.style.height=pos.h+"px";_9(document.body,_1f);},move:function(x){_1f.style.left=x+"px";},hide:function(){_1f.parentNode.removeChild(_1f);}};return _1(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_20++){_21.create();}},destroy:function(){this.inherited(arguments);for(var _23 in this._columnSizes){this._columnSizes[_23].remove();}if(!--_20){_21.destroy();}},resizeColumnWidth:function(_24,_25){return _16(this,_24,_25);},configStructure:function(){var _26=this._oldColumnSizes=_4.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _26){if(!(k in this._columnSizes)){_26[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_27){this.inherited(arguments);var _28=_27.id,_29;if("width" in _27){if((_29=this._oldColumnSizes[_28])){_29.set("width",_27.width+"px");}else{_29=_8.addCssRule("#"+_8.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_8.escapeCssIdentifier(_28,"-"),"width: "+_27.width+"px;");}this._columnSizes[_28]=_29;}},renderHeader:function(){this.inherited(arguments);var _2a=this;var _2b;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){_2b=_4.mixin(_2b||{},_f(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){_2b=_f(this.subRows);}}var _2c=_3(".dgrid-cell",_2a.headerNode),i=_2c.length;while(i--){var _2d=_2c[i],id=_2d.columnId,col=_2a.columns[id],_2e=_2d.childNodes,_2f;if(!col||col.resizable===false){continue;}var _30=_9("div.dgrid-resize-header-container");_2d.contents=_30;while(_2e.length>0){_9(_30,_2e[0]);}_2f=_9(_2d,_30,"div.dgrid-resize-handle.resizeNode-"+_8.escapeCssIdentifier(id,"-"));_2f.columnId=_2b&&_2b[id]||id;}if(!_2a.mouseMoveListen){_2(_2a.headerNode,".dgrid-resize-handle:mousedown"+(_7("touch")?",.dgrid-resize-handle:touchstart":""),function(e){_2a._resizeMouseDown(e,this);_2a.mouseMoveListen.resume();_2a.mouseUpListen.resume();});_2a._listeners.push(_2a.mouseMoveListen=_2.pausable(document,"mousemove"+(_7("touch")?",touchmove":""),_8.throttleDelayed(function(e){_2a._updateResizerPosition(e);})));_2a._listeners.push(_2a.mouseUpListen=_2.pausable(document,"mouseup"+(_7("touch")?",touchend":""),function(e){_2a._resizeMouseUp(e);_2a.mouseMoveListen.pause();_2a.mouseUpListen.pause();}));_2a.mouseMoveListen.pause();_2a.mouseUpListen.pause();}},_resizeMouseDown:function(e,_31){e.preventDefault();_5.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=_3(".dgrid-column-"+_8.escapeCssIdentifier(_31.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(e);_21.show(this);},_resizeMouseUp:function(e){var _32=this._columnSizes,_33,_34,_35;if(this.adjustLastColumn){_35=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_33=_3(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_33=_33.filter(function(_36){var idx=_36.columnId.split("-");return idx[0]=="0"&&!(_36.columnId in _32);});}else{if(this.subRows&&this.subRows.length>1){_33=_33.filter(function(_37){return _37.columnId.charAt(0)=="0"&&!(_37.columnId in _32);});}}_34=_33.map(function(_38){return _38.offsetWidth;});_33.forEach(function(_39,i){_16(this,_39.columnId,_34[i],null,false);},this);this._resizedColumns=true;}_5.setSelectable(this.domNode,true);var _3a=this._targetCell,_3b=this._getResizeMouseLocation(e)-this._startX,_3c=_3a.offsetWidth+_3b,obj=this._getResizedColumnWidths(),_3d=obj.totalWidth,_3e=obj.lastColId,_3f=_3(".dgrid-column-"+_8.escapeCssIdentifier(_3e,"-"),this.headerNode)[0].offsetWidth;if(_3c<this.minWidth){_3c=this.minWidth;}if(_16(this,_3a.columnId,_3c,e.type)){if(_3a.columnId!=_3e&&this.adjustLastColumn){if(_3d+_3b<_35){_16(this,_3e,"auto",e.type);}else{if(_3f-_3b<=this.minWidth){_16(this,_3e,this.minWidth,e.type);}}}}_21.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _40=this._getResizeMouseLocation(e),_41=_40-this._startX,_42=this._targetCell.offsetWidth,_43=_40;if(_42+_41<this.minWidth){_43=this._startX-(_42-this.minWidth);}_21.move(_43);},_getResizeMouseLocation:function(e){var _44=0;if(e.pageX){_44=e.pageX;}else{if(e.clientX){_44=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return _44;},_getResizedColumnWidths:function(){var _45=0,_46=_3((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode);var i=_46.length;if(!i){return {};}var _47=_46[i-1].columnId;while(i--){_45+=_46[i].offsetWidth;}return {totalWidth:_45,lastColId:_47};}});});