//>>built
define("dgrid/extensions/Pagination",["../_StoreMixin","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/Deferred","dojo/on","dojo/query","dojo/string","dojo/has","put-selector/put","../util/misc","dojo/i18n!./nls/pagination","dojo/_base/sniff","xstyle/css!../css/extensions/Pagination.css"],function(_1,_2,_3,_4,_5,on,_6,_7,_8,_9,_a,_b){function _c(_d){if(_d.noDataNode){_9(_d.noDataNode,"!");delete _d.noDataNode;}else{_d.cleanup();}_d.contentNode.innerHTML="";};function _e(_f){if(_f.loadingNode){_9(_f.loadingNode,"!");delete _f.loadingNode;}else{if(_f._oldPageNodes){for(var id in _f._oldPageNodes){_f.removeRow(_f._oldPageNodes[id]);}delete _f._oldPageNodes;if(_f._oldPageObserver){_f._oldPageObserver.cancel();_f._numObservers--;delete _f._oldPageObserver;}}}delete _f._isLoading;};return _2(_1,{rowsPerPage:10,pagingTextBox:false,previousNextArrows:true,firstLastArrows:false,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:true,i18nPagination:_b,showFooter:true,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var _10=this,_11=this.paginationNode=_9(this.footerNode,"div.dgrid-pagination"),_12=this.paginationStatusNode=_9(_11,"div.dgrid-status"),_b=this.i18nPagination,_13,_14,i;_12.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();_12.innerHTML=_7.substitute(_b.status,{start:1,end:1,total:0});_13=this.paginationNavigationNode=_9(_11,"div.dgrid-navigation");if(this.firstLastArrows){_14=this.paginationFirstNode=_9(_13,"span.dgrid-first.dgrid-page-link","«");_14.setAttribute("aria-label",_b.gotoFirst);_14.tabIndex=0;}if(this.previousNextArrows){_14=this.paginationPreviousNode=_9(_13,"span.dgrid-previous.dgrid-page-link","‹");_14.setAttribute("aria-label",_b.gotoPrev);_14.tabIndex=0;}this.paginationLinksNode=_9(_13,"span.dgrid-pagination-links");if(this.previousNextArrows){_14=this.paginationNextNode=_9(_13,"span.dgrid-next.dgrid-page-link","›");_14.setAttribute("aria-label",_b.gotoNext);_14.tabIndex=0;}if(this.firstLastArrows){_14=this.paginationLastNode=_9(_13,"span.dgrid-last.dgrid-page-link","»");_14.setAttribute("aria-label",_b.gotoLast);_14.tabIndex=0;}this._listeners.push(on(_13,".dgrid-page-link:click,.dgrid-page-link:keydown",function(_15){if(_15.type==="keydown"&&_15.keyCode!==13){return;}var cls=this.className,_16,max;if(_10._isLoading||cls.indexOf("dgrid-page-disabled")>-1){return;}_16=_10._currentPage;max=Math.ceil(_10._total/_10.rowsPerPage);if(this===_10.paginationPreviousNode){_10.gotoPage(_16-1);}else{if(this===_10.paginationNextNode){_10.gotoPage(_16+1);}else{if(this===_10.paginationFirstNode){_10.gotoPage(1);}else{if(this===_10.paginationLastNode){_10.gotoPage(max);}else{if(cls==="dgrid-page-link"){_10.gotoPage(+this.innerHTML);}}}}}}));},destroy:function(){this.inherited(arguments);if(this._pagingTextBoxHandle){this._pagingTextBoxHandle.remove();}},_updatePaginationSizeSelect:function(){var _17=this.pageSizeOptions,_18=this.paginationSizeSelect,_19;if(_17&&_17.length){if(!_18){_18=this.paginationSizeSelect=_9(this.paginationNode,"select.dgrid-page-size[aria-label="+this.i18nPagination.rowsPerPage+"]");_19=this._paginationSizeChangeHandle=on(_18,"change",_4.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value);}));this._listeners.push(_19);}_18.options.length=0;for(var i=0;i<_17.length;i++){_9(_18,"option",_17[i],{value:_17[i],selected:this.rowsPerPage===_17[i]});}this._updateRowsPerPageOption();}else{if(!(_17&&_17.length)&&_18){_9(_18,"!");this.paginationSizeSelect=null;this._paginationSizeChangeHandle.remove();}}},_setPageSizeOptions:function(_1a){this.pageSizeOptions=_1a&&_1a.sort(function(a,b){return a-b;});this._updatePaginationSizeSelect();},_updateRowsPerPageOption:function(){var _1b=this.rowsPerPage,_1c=this.pageSizeOptions,_1d=this.paginationSizeSelect;if(_1d){if(_3.indexOf(_1c,_1b)<0){this._setPageSizeOptions(_1c.concat([_1b]));}else{_1d.value=""+_1b;}}},_setRowsPerPage:function(_1e){this.rowsPerPage=_1e;this._updateRowsPerPageOption();this.gotoPage(1);},_updateNavigation:function(){var _1f=this,_b=this.i18nPagination,_20=this.paginationLinksNode,_21=this._currentPage,_22=this.pagingLinks,_23=this.paginationNavigationNode,end=Math.ceil(this._total/this.rowsPerPage),_24=this._pagingTextBoxHandle,_25=document.activeElement,_26,_27,_28;function _29(_2a,_2b){var _2c;var _2d;if(_1f.pagingTextBox&&_2a==_21&&end>1){_2c=_9(_20,"input.dgrid-page-input[type=text][value=$]",_21);_2c.setAttribute("aria-label",_b.jumpPage);_1f._pagingTextBoxHandle=on(_2c,"change",function(){var _2e=+this.value;if(!isNaN(_2e)&&_2e>0&&_2e<=end){_1f.gotoPage(+this.value);}});if(_25&&_25.tagName==="INPUT"){_2c.focus();}}else{_2d=_2a===_21;_2c=_9(_20,"span"+(_2d?".dgrid-page-disabled":"")+".dgrid-page-link",_2a+(_2b?" ":""));_2c.setAttribute("aria-label",_b.gotoPage);_2c.tabIndex=_2d?-1:0;if(_26===_2a){if(!_2d){_2c.focus();}else{if(_2a<end){_26++;}else{_27.focus();}}}if(!_2d){_27=_2c;}}};function _2f(_30,_31){_9(_30,(_31?".":"!")+"dgrid-page-disabled");_30.tabIndex=_31?-1:0;};if(!_25||!_a.contains(this.paginationNavigationNode,_25)){_25=null;}else{if(_25.className==="dgrid-page-link"){_26=+_25.innerHTML;}}if(_24){_24.remove();}_20.innerHTML="";_6(".dgrid-first, .dgrid-previous",_23).forEach(function(_32){_2f(_32,_21===1);});_6(".dgrid-last, .dgrid-next",_23).forEach(function(_33){_2f(_33,_21>=end);});if(_22&&end>0){_29(1,true);var _34=_21-_22;if(_34>2){_9(_20,"span.dgrid-page-skip","...");}else{_34=2;}for(var i=_34;i<Math.min(_21+_22+1,end);i++){_29(i,true);}if(_21+_22+1<end){_9(_20,"span.dgrid-page-skip","...");}if(end>1){_29(end);}}else{if(_1f.pagingTextBox){_29(_21);}}if(_25&&_25.tabIndex===-1){_28=_6("[tabindex='0']",this.paginationNavigationNode);if(_25===this.paginationPreviousNode||_25===this.paginationFirstNode){_25=_28[0];}else{if(_28.length){_25=_28[_28.length-1];}}if(_25){_25.focus();}}},refresh:function(){var _35=this;this.inherited(arguments);if(!this.store){console.warn("Pagination requires a store to operate.");return;}return this.gotoPage(1).then(function(_36){setTimeout(function(){on.emit(_35.domNode,"dgrid-refresh-complete",{bubbles:true,cancelable:false,grid:_35,results:_36});},0);return _36;});},_onNotification:function(_37){if(_37.length!==this._rowsOnPage){this.gotoPage(this._currentPage);}},renderArray:function(_38,_39){var _3a=this,_3b=this.inherited(arguments);this._lastCollection=null;if(!_39){if(this._topLevelRequest&&this._topLevelRequest!==_38){this._topLevelRequest.cancel();delete this._topLevelRequest;}if(typeof _38.cancel==="function"){this._topLevelRequest=_38;}_5.when(_38,function(){if(_3a._topLevelRequest){delete _3a._topLevelRequest;}});}return _3b;},insertRow:function(){var _3c=this._oldPageNodes,row=this.inherited(arguments);if(_3c&&row===_3c[row.id]){delete _3c[row.id];}return row;},gotoPage:function(_3d){var _3e=this,dfd=new _5();var _3f=this._trackError(function(){var _40=_3e.rowsPerPage,_41=(_3d-1)*_40,_42=_4.mixin(_3e.get("queryOptions"),{start:_41,count:_40}),_43,_44=_3e.contentNode,_45,_46,_47,i,len;if(_3e.showLoadingMessage){_c(_3e);_45=_3e.loadingNode=_9(_44,"div.dgrid-loading");_45.innerHTML=_3e.loadingMessage;}else{_3e._oldPageNodes=_46={};_47=_44.children;for(i=0,len=_47.length;i<len;i++){_46[_47[i].id]=_47[i];}_3e._oldPageObserver=_3e.observers.pop();}_3e._isLoading=true;_43=_3e.store.query(_3e.query,_42);_5.when(_3e.renderArray(_43,null,_42),function(_48){_e(_3e);_3e.scrollTo({y:0});_5.when(_43.total,function(_49){if(!_49){if(_3e.noDataNode){_9(_3e.noDataNode,"!");delete _3e.noDataNode;}_3e.noDataNode=_9(_3e.contentNode,"div.dgrid-no-data");_3e.noDataNode.innerHTML=_3e.noDataMessage;}_3e.paginationStatusNode.innerHTML=_7.substitute(_3e.i18nPagination.status,{start:Math.min(_41+1,_49),end:Math.min(_49,_41+_40),total:_49});_3e._total=_49;_3e._currentPage=_3d;_3e._rowsOnPage=_48.length;_3e._updateNavigation();});if(_8("ie")<7||(_8("ie")&&_8("quirks"))){_3e.resize();}dfd.resolve(_43);},function(_4a){_e(_3e);dfd.reject(_4a);});return dfd.promise;});if(!_3f){dfd.reject();}return dfd.promise;}});});