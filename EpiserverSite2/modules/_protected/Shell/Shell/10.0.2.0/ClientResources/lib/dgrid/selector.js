//>>built
define("dgrid/selector",["dojo/_base/kernel","dojo/_base/array","dojo/on","dojo/aspect","dojo/_base/sniff","put-selector/put"],function(_1,_2,on,_3,_4,_5){return function(_6,_7){var _8=[],_9,_a;if(!_6){_6={};}if(_6.type){_6.selectorType=_6.type;_1.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4");}_6.selectorType=_7=_7||_6.selectorType||"checkbox";_6.sortable=false;function _b(_c){return !_9.allowSelect(_9.row(_c));};function _d(_e){return function(_f){var _10=_f.rows,len=_10.length,_11="false",_12,_13,i;for(i=0;i<len;i++){var _14=_9.cell(_10[i],_6.id).element;if(!_14){continue;}_14=(_14.contents||_14).input;if(_14&&!_14.disabled){_14.checked=_e;_14.setAttribute("aria-checked",_e);}}if(_a.type=="checkbox"){_12=_9.selection;_13=false;for(i in _12){if(_12[i]!=_9.allSelected){_13=true;break;}}_a.indeterminate=_13;_a.checked=_9.allSelected;if(_13){_11="mixed";}else{if(_9.allSelected){_11="true";}}_a.setAttribute("aria-checked",_11);}};};function _15(_16){if(_16.type=="click"||_16.keyCode==32||(!_4("opera")&&_16.keyCode==13)||_16.keyCode===0){var row=_9.row(_16);_9._selectionTriggerEvent=_16;if(row){if(_9.allowSelect(row)){var _17=_9._lastSelected&&_9.row(_9._lastSelected);if(_7=="radio"){if(!_17||_17.id!=row.id){_9.clearSelection();_9.select(row,null,true);_9._lastSelected=row.element;}}else{if(row){if(_16.shiftKey){_d(true)({rows:[row]});}else{_17=null;}_17=_16.shiftKey?_17:null;_9.select(_17||row,row,_17?undefined:null);_9._lastSelected=row.element;}}}}else{_5(this,(_9.allSelected?"!":".")+"dgrid-select-all");_9[_9.allSelected?"clearSelection":"selectAll"]();}_9._selectionTriggerEvent=null;}};function _18(){_9._hasSelectorInputListener=true;_8.push(_9.on(".dgrid-selector:click,.dgrid-selector:keydown",_15));var _19=_9._handleSelect;_9._handleSelect=function(_1a){if(this.cell(_1a).column!=_6){_19.apply(this,arguments);}};if(typeof _6.disabled=="function"){var _1b=_9.allowSelect,_1c=_6.disabled;_9.allowSelect=function(row){var _1d=_1b.call(this,row);if(_1c===_b){return _1d;}else{return _1d&&!_1c.call(_6,row.data);}};_6.disabled=_b;}else{_6.disabled=_b;}_8.push(_9.on("dgrid-select",_d(true)));_8.push(_9.on("dgrid-deselect",_d(false)));};var _1e=typeof _7=="function"?_7:function(_1f,_20,_21){var _22=_20.parentNode,_b;if(!_9._hasSelectorInputListener){_18();}_b=_6.disabled;_5(_22&&_22.contents?_22:_20,".dgrid-selector");var _23=_20.input||(_20.input=_5(_20,"input[type="+_7+"]",{tabIndex:isNaN(_6.tabIndex)?-1:_6.tabIndex,disabled:_b&&(typeof _b=="function"?_b.call(_6,_21):_b),checked:_1f}));_23.setAttribute("aria-checked",!!_1f);return _23;};_3.after(_6,"init",function(){_9=_6.grid;});_3.after(_6,"destroy",function(){_2.forEach(_8,function(l){l.remove();});_9._hasSelectorInputListener=false;});_6.renderCell=function(_24,_25,_26,_27,_28){var row=_24&&_9.row(_24);_25=row&&_9.selection[row.id];_1e(_25,_26,_24);};_6.renderHeaderCell=function(th){var _29="label" in _6?_6.label:_6.field||"";if(_7=="radio"||!_9.allowSelectAll){th.appendChild(document.createTextNode(_29));if(!_9._hasSelectorInputListener){_18();}}else{_1e(false,th,{});}_a=th.lastChild;};return _6;};});