//>>built
define("xstyle/core/Rule",["xstyle/core/expression","xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(_1,_2,_3,_4,_5){var _6=Object.create||function(_7){function _8(){};_8.prototype=_7;return new _8();};var _9=_5.convertCssNameToJs;function _a(_b,_c,_d){try{_b[_c]=_d;}catch(e){}};var _e={"{":"}","[":"]","(":")"};var _f={};var _10=_3("div").style;function _11(){};_11.prototype={property:function(key){return (this._properties||(this._properties={}))[key]||(this._properties[key]=new Proxy(this.get(key)));},eachProperty:function(_12){var _13=this.values||0;for(var i=0;i<_13.length;i++){var _14=_13[i];_12.call(this,_14||"unnamed",_13[_14]);}},fullSelector:function(){return (this.parent?this.parent.fullSelector():"")+(this.selector||"")+" ";},newRule:function(_15){var _16=(this.rules||(this.rules={}))[_15]=new _11();_16.disabled=this.disabled;_16.parent=this;return _16;},newCall:function(_17){var _18=new _19(_17);_18.parent=this;return _18;},addSheetRule:function(_1a,_1b){if(_1a.charAt(0)!="@"){var _1c=this.styleSheet;var _1d=_1c.cssRules||_1c.rules;var _1e=this.ruleIndex>-1?this.ruleIndex:_1d.length;try{_1c.addRule(_1a,_1b||" ",_1e);}catch(e){if(!_1a.match(/-(moz|webkit|ie)-/)){console.warn("Unable to add rule",_1a,_1b);}}return _1d[_1e];}},onRule:function(){var _1f=this.getCssRule();if(this.installStyles){for(var i=0;i<this.installStyles.length;i++){var _20=this.installStyles[i];_a(_1f.style,_20[0],_20[1]);}}},setMediaSelector:function(_21){this.isMediaBlock=true;this.selector=_21;},setStyle:function(_22,_23){if(this.cssRule){_a(this.cssRule.style,_22,_23);}else{(this.installStyles||(this.installStyles=[])).push([_22,_23]);}},getCssRule:function(){if(!this.cssRule){this.cssRule=this.addSheetRule(this.selector,this.cssText);}return this.cssRule;},get:function(key){return this.values[key];},elements:function(_24){var _25=this;require(["xstyle/core/elemental"],function(_26){_26.addRenderer(_25,function(_27){_24(_27);});});},declareDefinition:function(_28,_29,_2a){_28=_28&&_9(_28);if(this.disabled){return;}var _2b=this;if(_29.length){if(_29[0].toString().charAt(0)==">"){if(!_28){this.generator=_29;require(["xstyle/core/generate","xstyle/core/elemental"],function(_2c,_2d){_29=_2c.forSelector(_29,_2b);_2d.addRenderer(_2b,_29);});return;}}else{var _2e=_28 in _10||this.getDefinition(_28);if(!_2a||!_2e){var _2f=(this.definitions||(this.definitions={}));var _30=_29[0];if(_30.indexOf&&_30.indexOf(",")>-1){var _31=_29.join("").split(/\s*,\s*/);var _32=[];for(var i=0;i<_31.length;i++){_32[i]=_1.evaluate(this,_31[i]);}}if(_29[0]&&_29[0].operator=="{"){_32=_29[0];}else{if(_29[1]&&_29[1].operator=="{"){_32=_29[1];_5.extend(_32,_29[0]);}}_32=_32||_1.evaluate(this,_29);if(_32.then){var _33=_32;_32={then:function(_34){return _33.then(function(_35){return _34(_36(_35));});}};}var _36=function(_37){if(_37.define){_37=_37.define(_2b,_28);}return _37;};if(_2e){console.warn("Overriding existing property \""+_28+"\"");}return (_2f[_28]=_36(_32));}}}else{var _2f=(this.definitions||(this.definitions={}));return (_2f[_28]=_29);}},onArguments:function(_38){var _39=_38.ref;return _39&&_39.apply(this,_38.getArgs(),this);},setValue:function(_3a,_3b,_3c){var _3d=_9(_3a);if(this.disabled){return;}var _3e=(this.values||(this.values=[]));_3e.push(_3a);_3e[_3a]=_3b;if(_3a){var _3f=this;do{var _40=(_3c||this).getDefinition(_3a);if(_40!==undefined){if(this.cssRule&&!(_40&&_40.keepCSSValue)){var _41=this.cssRule.style;if(_3d in _41){_a(_41,_3d,"");}}_42(_3f,_40.put(_3b,_3f,_3d));}_3a=_3a.substring(0,_3a.lastIndexOf("-"));}while(_3a);}if(_3d in _10){this._setStyleFromValue(_3d,_3b,true);}},_setStyleFromValue:function(_43,_44,_45){var _46=_44[0];if(_46 instanceof _11){var _47=_46.values;for(var i=0;i<_47.length;i++){var key=_47[i];this._setStyleFromValue(_43+(key=="main"?"":key.charAt(0).toUpperCase()+key.slice(1)),_47[key]);}return;}var _48=_44.calls;if(_48){var _49=this;var _4a=_44.expression=_4b(_44,this,_43,true);if(_4a){var _4c=_44.expression&&_44.expression.valueOf();var _4d=function(_4e,_4f){var _50=_4c&&_4c.forRule?_4c.forRule(_4e,true):_4c;if(_50&&_50.forElement){var _51=_4f&&_4f.elements;if(_51){for(var i=0;i<_51.length;i++){var _52=_51[i].querySelectorAll(_4e.selector);for(var j=0;j<_52.length;j++){var _53=_52[j];_a(_53.style,_43,_50.forElement(_53));}}}else{_95(_4e,_50,function(_54,_55){_a(_55.style,_43,_54);});}return;}if(true||!_4e.getCssRule().style[_43]||_4e.inheritedStyles[_43]){_4e.setStyle(_43,_50);}};var _56=[_49];_5.when(_4c,function(_57){_4c=_57;if(_4c&&_4c.forRule){(_49._subRuleListeners||(_49._subRuleListeners=[])).push(function(_58){_56.push(_58);_4d(_58);});}_4d(_49);});_44.expression.dependencyOf({invalidate:function(_59){_5.when(_44.expression.valueOf(),function(_5a){_4c=_5a;for(var i=0;i<_56.length;i++){var _5b=true;var _5c=_56[i];if(_59&&_59.rules){_5b=false;for(var j=0;j<_59.rules.length;j++){if(_59.rules[j]===_5c){_5b=true;break;}}}if(_5b){_4d(_5c,_59);}}});}});}}if(!_45){this.setStyle(_43,_44);}},put:function(_5d){var _5e=this;return {forRule:function(_5f){_5e.extend(_5f);if(_5d=="defaults"){return;}if(_5d&&typeof _5d=="string"&&_5e.values){var _60=_5d.toString().split(/,\s*/);for(var i=0;i<_60.length;i++){var _61=_5e.values[i];_61&&_5f.setValue(_61,_60[i],_5e);}}}};},extend:function(_62,_63){var _64=this;(_64.derivatives||(_64.derivatives=[])).push(_62);var _65=_64.cssText;var _66=_64.extraSelector;if(_66){_62.selector+=_66;}var _67=_64.cssRule.style;var _68=_62.getCssRule().style;var _69=_62.inheritedStyles||(_62.inheritedStyles={});for(var i=0;i<_67.length;i++){var _6a=_9(_67[i]);if(!_68[_6a]||_69[_6a]){_68[_6a]=_67[_6a];_69[_6a]=true;}}var _6b=_64.values;if(_6b){_6b=_6(_6b);var _6c=_62.values;_62.values=_6c?_4.copy(_6b,_6c):_6b;}if(_63){var _6d=_64.definitions;if(_6d){_6d=_6(_6d);var _6e=_62.definitions;_62.definitions=_6e?_4.copy(_6d,_6e):_6d;}_62.tagName=_64.tagName||_62.tagName;}(_62.bases||(_62.bases=[])).push(_64);var _6f=this._subRuleListeners||0;for(var i=0;i<_6f.length;i++){_6f[i](_62);}var _70=_62.getCssRule().style;_64.eachProperty(function(_71,_72){var _73=_9(_71);if(typeof _72=="object"){_72=_6(_72);}if(_73 in _10&&!_70[_73]){_62._setStyleFromValue(_73,_72);}});if(_6c&&_62.definitions){for(var i=0,l=_6c.length;i<l;i++){var _6a=_6c[i];var _74=_9(_6a);if(_62.definitions[_74]!==(_6e&&_6e[_74])){_62.setValue(_6a,_6c[_74]);}}}var _75=_64.generator;if(_75){if(_75 instanceof Array){_75=_75.slice(0);for(var i=0;i<_75.length;i++){var _76=_75[i];if(_76.operator==="{"){var _77=_62.newRule();_77.selector=_76.selector+_62.selector.slice(1);_77.styleSheet=_62.styleSheet||_62.cssRule.parentStyleSheet;_76.extend(_77,true);_75[i]=_77;}}}_62.declareDefinition(null,_75);}},getDefinition:function(_78,_79){_78=_9(_78);var _7a=this;do{var _7b=(_7a.definitions&&_7a.definitions[_78]);if(_7b===undefined&&_79&&_7a[_79]){_7b=_7a[_79][_78];}_7a=_7a.parent;}while(_7b===undefined&&_7a);return _7b;},newElement:function(){return _3((this.tagName||"span")+(this.selector||""));},cssText:""};_1.evaluateText=_4b;function _4b(_7c,_7d,_7e,_7f){var _80=_7c.calls;if(_80){var _81;for(var i=0;i<_7c.length;i++){var _82=_7c[i];if(_82 instanceof _19){if(!_7c.hasOwnProperty(i)){_7c[i]=_82=_6(_82);}var _83=_82.ref&&(_82.ref.selfResolving?_82.ref.apply(_7d,_82.getArgs(),_7d):_1.evaluate(_7d,[_82.caller,_82]));if(_83!==undefined){(_81||(_81=[])).push(_83);_82.evaluated=true;}}}}if(_81){var _84=_1.react(function(){var j=0;var _85=_7c.slice();for(var i=0;i<_7c.length;i++){var _86=_7c[i];if(_86 instanceof _19&&_86.evaluated){_85[i-1]=_7c[i-1].slice(0,-_86.caller.length);_85[i]=arguments[j++];}}return _85.join("");});_84.skipResolve=true;var _87=new _2();_87.setCompute(_84.apply(_87,_81,_87));return _87;}if(!_7f){return _7c.toString();}};function _19(_88){this.caller=_88;this.args=[];};var _89=_19.prototype=new _11();_89.declareDefinition=_89.setValue=function(_8a,_8b){this.args.push(_8b);};_89.toString=function(){var _8c=this.operator;return _8c+this.args+_e[_8c];};function _42(_8d,_8e,_8f,_90){return _5.when(_8e,function(_91){var _92=_91;if(_91&&_91.forRule){(_8d._subRuleListeners||(_8d._subRuleListeners=[])).push(function(_93){var _94=_92.forRule(_93,true);if(_94&&_94.forElement){_95(_93,_94,_90);}else{_8f&&_8f(_94);}});_91=_91.forRule(_8d);}if(_91&&_91.forElement){return _95(_8d,_91,_90);}else{_8f&&_8f(_91);}});};function _95(_96,_97,_98){return require(["xstyle/core/elemental"],function(_99){_99.addRenderer(_96,function(_9a){var _9b=_97.forElement(_9a);_98&&_98(_9b,_9a);});});};_11.updateStaleProperties=function(){};return _11;});