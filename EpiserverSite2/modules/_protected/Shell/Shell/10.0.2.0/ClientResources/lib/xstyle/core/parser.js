//>>built
define("xstyle/core/parser",[],function(){var _1=/((?:\\.|[^'])*)'/g;var _2=/((?:\\.|[^"])*)"/g;var _3=/\/\*[\w\W]*?\*\//g;var _4={"{":"}","[":"]","(":")"};var _5=0;var _6="".trim?function(_7){return _7.trim();}:function(_8){return _8.replace(/^\s+|\s+$/g,"");};function _9(){this.push.apply(this,arguments);};var _a=_9.prototype=[];_a.toString=function(){return this.join("");};_a.isSequence=true;function _b(_c){this.value=_c;};_b.prototype.toString=function(){return "\""+this.value.replace(/["\\\n\r]/g,"\\$&")+"\"";};_b.prototype.isLiteralString=true;function _d(){var _e,_f=this.args[0];if(typeof _f=="string"){_e=_f.split(/\s*,\s*/);}else{if(_f){_e=[];var _10=0;for(var i=0;i<_f.length+1;i++){var arg=_f[i];if(typeof arg=="string"||arg===undefined){var _11=arg&&arg.split(/\s*,\s*/);if(_e.length>1||_11===undefined){var _12=_f.slice(_10,i);if(_10>0){_12.unshift(_e.pop());}_10=i+1;_e.push(_12);_11&&_e.push.apply(_e,_11.slice(1));}}}}else{return [];}}return _e;};function _13(_14,_15,_16){_16=_16||{addRule:function(){},cssRules:[]};var _17;var _18=_17=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g;var _19=[_14];_14.parse=_1a;_1a(_15,_16);function _1a(_1b,_1c){_1b=_1b.replace(_3,function(_1d){return _1d.replace(/[^\n]/g,"");});function _1e(_1f){_20=false;var _21=_18.lastIndex;_1f.then(function(){_20=true;if(_22){_18.lastIndex=_21;_23();}});var _22=true;};var _24=_14;_18.lastIndex=0;var _20;var _25=0,_26=true,_27="",_28=true;_23();function _23(){function _29(_2a){if(_2a&&typeof _2a=="string"&&_2b){_2a=_2b+_2a;}if(_2c){_2c.push?typeof _2c[_2c.length-1]=="string"&&typeof _2a=="string"?_2c[_2c.length-1]+=_2a:_2a&&_2c.push(_2a):typeof _2c=="string"&&typeof _2a=="string"?_2c+=_2a:_2c=new _9(_2c,_2a);}else{_2c=_2a;}};_20=true;while(_20){var _2d=_18.exec(_1b);if(!_2d){return;}var _2e=_2d[5],_2b=_2d[1],_2f=_2d[2],_30=_2d[3],_31=_2d[4],_32,_33,_2c,_34;_31=_31&&_6(_31);_2f=_2f&&_6(_2f);if(_28){if(_30){_33=_2f;_32=_30.charAt(0);_34=_30.charAt(1)=="?";if(_30.indexOf("\n")>-1){_31=_30.slice(1);}}else{_31=_2f;}_2c=_31;_28=false;}else{_31=_30?_2f+_30:_2f;_29(_31);}if(_2e!="{"){_27+=_2d[0];}switch(_2e){case "'":case "\"":var _35=_2e=="'"?_1:_2;_35.lastIndex=_18.lastIndex;var _36=_35.exec(_1b);if(!_36){_46("unterminated string");}var str=_36[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(_37,_38){if(_38){return String.fromCharCode(parseInt(_38,16));}});_18.lastIndex=_35.lastIndex;_29(new _b(str));_27+=_36[0];continue;case "\\":var _39=_35.lastIndex++;_29(_1b.charAt(_39));continue;case "(":case "{":case "[":var _3a;if(_2e=="{"){_28=true;if(_32==":"&&_30){_2f+=_30;}_27=_6((_27+_2f).replace(/\s+/g," "));_29(_3a=_24.newRule(_27));if(_32=="="){_26=false;_2c.creating=true;}var _3b,_3c=null;var _3d=_25;if(_2d[6]){_3b=_1c.cssRules||_1c.rules;if((_3a.cssRule=_3c=_3b[_2d[6].slice(1)])){_27=_3c.selectorText;}}if(_24.root&&_26){_3b=_1c.cssRules||_1c.rules;while((_3c=_3b[_25++])){if((_3c.selectorText==_27)||(_3c.selectorText&&_3c.selectorText.replace(/::/g,":").replace(/'/g,"\"")==_27.replace(/::/g,":").replace(/'/g,"\""))){_3a.cssRule=_3c;break;}}}if(!_3c){_3a.ruleIndex=_25=_3d;}_3a.styleSheet=_1c;if(_2c.creating){_3a.selector="."+(_32=="="?_2f.match(/[\w-]*$/g,"")[0]:"")+"-x-"+_5++;_3a.creating=true;}else{if(/^@(?!font-face)(?!FONT-FACE)/.test(_27)){_3a.setMediaSelector(_27);}else{_3a.selector=_24.root?_27:_24.selector+" "+_27;}}_27="";}else{var _3e=_31.match(/(.*?)([\w-]*)$/);_29(_3a=_24.newCall(_3e[2],_2c,_24));_3a.ref=_24.getDefinition(_3e[2]);_3a.getArgs=_d;(_2c.calls||(_2c.calls=[])).push(_3a);}_24.currentName=_33;_24.currentSequence=_2c;_24.assignmentOperator=_32;var _3f;if(_2e=="{"&&(_3f=_3a.selector.match(/[@:]\w+/))){_3f=_3f[0];var _40=_24.getDefinition(_3f);if(_40&&_40.selector){_40.selector(_3a);}}_19.push(_24=_3a);_24.operator=_2e;_24.start=_18.lastIndex;_33=null;_2c=null;continue;}if(_2c){var _2f=typeof _2c=="string"?_2c:_2c[0];if(_2f.charAt&&_2f.charAt(0)=="@"){var _41=_2f.match(/\w+/)[0];if(_41=="import"){var _42=_13.getStyleSheet((_1c.cssRules||_1c.imports)[_25++],_2c,_1c);var _43=_18.lastIndex;_1a(_42.localSource,_42);_18.lastIndex=_43;}else{if(_41=="xstyle"){if(_2f.slice(8,13)=="start"){var _3a=_24?_24.newRule(""):_44;_3a.root=_24.root;_19.push(_24=_3a);}else{var _44=_24||_44;_19.pop();_24=_19[_19.length-1];}_18=_24?_17:/(@[\w\s])/g;}}}else{if(_32==="="){try{var _45=_24.declareDefinition(_33,_2c,_34);if(_45&&_45.then){_1e(_45);}}catch(e){_46(e);}}}}switch(_2e){case ":":if(_32=="="){_28=true;_32=":";}else{_29(":");}break;case "}":if(_33&&!(_24.root||_24.isMediaBlock)){try{_24[_32==":"?"setValue":"declareDefinition"](_33,_2c,_34);}catch(e){_46(e);}}case ")":case "]":if(_4[_24.operator]!=_2e){_46("Incorrect opening operator "+_24.operator+" with closing operator "+_2e);}_33=null;var _47=_1b.slice(_24.start,_18.lastIndex-1);_24.cssText=_24.cssText?_24.cssText+";"+_47:_47;if(_2e=="}"){if(_48=="}"){var _49=_24.parent.selector;if(_49&&!_49.charAt(0)=="@"){_46("A nested rule must end with a semicolon");}}if(_24.root){_46("Unmatched "+_2e);}else{try{_24.onRule(_24.selector,_24);}catch(e){_46(e);}_26=true;}_27="";}if(_2e==")"||_2e=="]"){_24.args=[_2c];}if(_2e==")"&&!_32){try{var _45=_19[_19.length-2].onArguments(_24);}catch(e){_46(e);}if(_45&&_45.then){_1e(_45);}}_19.pop();_24=_19[_19.length-1];_2c=_24.currentSequence;_33=_24.currentName;_32=_24.assignmentOperator;if(_24.root&&_2e=="}"){if(_32){try{_24[_32==":"?"setValue":"declareDefinition"](_33,_2c,_34);}catch(e){_46(e);}}_28=true;_32=false;}break;case "":case undefined:return;case ";":if(_24&&_33){try{var _45=_24[_32==":"?"setValue":"declareDefinition"](_33,_2c,_34);if(_45&&_45.then){_1e(_45);}}catch(e){_46(e);}_33;}_2c=null;_28=true;_26=false;_32=false;_27="";}var _48=_2e;}};function _46(e){var _4a=_1b.slice(0,_18.lastIndex).split("\n");var _4b=_4a[_4a.length-1];var _4c=(_1c.href||"in-page stylesheet")+":"+_4a.length+":"+_4b.length+" near:\n"+_4b.slice(-40);if(_1a.onerror){_1a.onerror(e,_4c);}console.error(e.message||e,_4c);if(e.stack){console.error(e.stack);}};};};return _13;});